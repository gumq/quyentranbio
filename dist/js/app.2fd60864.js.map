{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/assets/images/Binguo1.jpg","webpack:///./src/components/PreLoader.vue?b0ef","webpack:///./src/assets/images/mobile/11.png","webpack:///./src/index.vue?8ce6","webpack:///./src/assets/images/4.png","webpack:///./src/assets/images/developer.png","webpack:///./src/assets/images/bingua4.png","webpack:///./src/assets/images/5.png","webpack:///./src/assets/images/mobile/9.png","webpack:///./src/components/ConactPanel.vue?ade4","webpack:///./src/index.vue","webpack:///./src/js/Utils.js","webpack:///./src/webgl/sections/common/shaders/ppMaterial.vs","webpack:///./src/webgl/sections/common/shaders/scetionPPMaterial.fs","webpack:///./src/webgl/sections/common/ScetionPPMaterial.js","webpack:///./src/webgl/sections/common/Section.js","webpack:///./src/webgl/sections/common/AnimeNameTitle.js","webpack:///./src/webgl/sections/home/const/config.js","webpack:///./src/webgl/modules/BGMaterial/shaders/bgMaterial.vs","webpack:///./src/webgl/modules/BGMaterial/shaders/bgMaterial.fs","webpack:///./src/webgl/modules/BGMaterial/BGMaterial.js","webpack:///./src/webgl/modules/PBRMaterial/const/defaultParams.js","webpack:///./src/webgl/modules/PBRMaterial/PBRMaterial.js","webpack:///./src/webgl/modules/PBRMaterial/shaders/chunk/function/computeDiffuseSPH.glsl","webpack:///./src/webgl/modules/PBRMaterial/shaders/chunk/function/integrateBRDFMobile.glsl","webpack:///./src/webgl/modules/PBRMaterial/shaders/chunk/function/panoramaSampler.glsl","webpack:///./src/webgl/modules/PBRMaterial/shaders/chunk/function/precomputeLight.glsl","webpack:///./src/webgl/modules/PBRMaterial/shaders/chunk/function/isotropyLightCompute.glsl","webpack:///./src/webgl/modules/PBRMaterial/shaders/chunk/function/anisotropyLightCompute.glsl","webpack:///./src/webgl/modules/PBRMaterial/shaders/chunk/math.glsl","webpack:///./src/webgl/modules/PBRMaterial/shaders/chunk/shadow.glsl","webpack:///./src/webgl/modules/PBRMaterial/shaders/chunk/light.glsl","webpack:///./src/webgl/modules/PBRMaterial/shaders/chunk/brdf.glsl","webpack:///./src/webgl/modules/PBRMaterial/shaders/chunk/ibl.glsl","webpack:///./src/webgl/modules/PBRMaterial/shaders/chunk/clearCoat.glsl","webpack:///./src/webgl/modules/PBRMaterial/shaders/chunk/advance.glsl","webpack:///./src/webgl/modules/PBRMaterial/shaders/ShaderChunk.js","webpack:///./src/webgl/modules/PBRMaterial/shaders/pbrVS.glsl","webpack:///./src/webgl/modules/PBRMaterial/shaders/pbrFS.glsl","webpack:///./src/webgl/modules/PBRMaterial/PBRProgram.js","webpack:///./src/webgl/modules/ParticleTexture/shaders/particle.vs","webpack:///./src/webgl/modules/ParticleTexture/shaders/particle.fs","webpack:///./src/webgl/modules/Particle/ParticleInstance.js","webpack:///./src/webgl/modules/ParticleTexture/TouchTexture.js","webpack:///./src/webgl/modules/ParticleTexture/ParticleTexture.js","webpack:///./src/webgl/modules/Particle/Particle.js","webpack:///./src/webgl/modules/ParticleSnow/shaders/snow.vs","webpack:///./src/webgl/modules/ParticleSnow/shaders/snow.fs","webpack:///./src/webgl/modules/ParticleSnow/ParticleSnow.js","webpack:///./src/webgl/modules/PostProcessing/materials/shaders/copy/shader.fs","webpack:///./src/webgl/modules/PostProcessing/materials/shaders/common/shader.vs","webpack:///./src/webgl/modules/PostProcessing/materials/CopyMaterial.js","webpack:///./src/webgl/modules/PostProcessing/materials/shaders/fxaa/shader.fs","webpack:///./src/webgl/modules/PostProcessing/materials/FXAAMaterial.js","webpack:///./src/webgl/modules/PostProcessing/materials/GlitchMaterial.js","webpack:///./src/webgl/modules/PostProcessing/materials/shaders/vignette/shader.fs","webpack:///./src/webgl/modules/PostProcessing/materials/VignetteMaterial.js","webpack:///./src/webgl/modules/PostProcessing/materials/shaders/blur/shader.fs","webpack:///./src/webgl/modules/PostProcessing/materials/BlurMaterial.js","webpack:///./src/webgl/sections/common/InitGUI.js","webpack:///./src/webgl/sections/home/HomeSection.js","webpack:///./src/webgl/sections/anime/const/config.js","webpack:///./src/webgl/modules/GalleryTexture/shaders/noiseMask.vs","webpack:///./src/webgl/modules/GalleryTexture/shaders/noiseMask.fs","webpack:///./src/webgl/modules/GalleryTexture/GalleryTexture.js","webpack:///./src/webgl/modules/ParticlePolygon/shaders/particle.vs","webpack:///./src/webgl/modules/ParticlePolygon/shaders/particle.fs","webpack:///./src/webgl/modules/ParticlePolygon/ParticlePolygon.js","webpack:///./src/webgl/modules/Button/shaders/button.vs","webpack:///./src/webgl/modules/Button/shaders/arrowButton.fs","webpack:///./src/webgl/modules/Button/ArrowButton.js","webpack:///./src/webgl/modules/Button/shaders/closeButton.fs","webpack:///./src/webgl/modules/Button/CloseButton.js","webpack:///./src/webgl/modules/Button/shaders/ringButton.fs","webpack:///./src/webgl/modules/Button/RingButton.js","webpack:///./src/webgl/modules/Button/shaders/rectangleButton.fs","webpack:///./src/webgl/modules/Button/RectangleButton.js","webpack:///./src/webgl/sections/anime/AnimeSection.js","webpack:///./src/webgl/sections/work/const/config.js","webpack:///./src/webgl/sections/work/const/defaultParams.js","webpack:///./src/webgl/modules/TextureBG/shaders/image.vs","webpack:///./src/webgl/modules/TextureBG/shaders/image.fs","webpack:///./src/webgl/modules/TextureBG/TextureBG.js","webpack:///./src/webgl/modules/CubeBG/shaders/backgroundVS.glsl","webpack:///./src/webgl/modules/CubeBG/shaders/backgroundFS.glsl","webpack:///./src/webgl/modules/CubeBG/BackgroundMaterial.js","webpack:///./src/webgl/modules/CubeBG/Background.js","webpack:///./src/libs/threejs/controls/OrbitControls.js","webpack:///./src/webgl/sections/work/WorkSection.js","webpack:///./src/webgl/sections/about/const/config.js","webpack:///./src/webgl/modules/ParticleChip/shaders/particle.vs","webpack:///./src/webgl/modules/ParticleChip/shaders/particle.fs","webpack:///./src/webgl/modules/ParticleChip/ParticleChip.js","webpack:///./src/webgl/sections/about/AboutSection.js","webpack:///./src/js/Signal.js","webpack:///./src/js/EventHandler.js","webpack:///./src/webgl/modules/FontShaders/vertex/fontType1.glsl","webpack:///./src/webgl/modules/FontShaders/vertex/fontType2.glsl","webpack:///./src/webgl/modules/FontShaders/vertex/fontType3.glsl","webpack:///./src/webgl/modules/FontShaders/fragment/fontType1.glsl","webpack:///./src/webgl/modules/FontShaders/fragment/fontType2.glsl","webpack:///./src/webgl/modules/FontShaders/fragment/fontType3.glsl","webpack:///./src/webgl/modules/FontShaders/index.js","webpack:///./src/webgl/sections/common/FontGenerator.js","webpack:///./src/webgl/ScenesViewer.js","webpack:///./src/libs/threejs/loaders/GLTFLoader.js","webpack:///./src/webgl/modules/Environment/zlib.js","webpack:///./src/webgl/modules/Environment/EnvironmentCubeMap.js","webpack:///./src/webgl/modules/Environment/EnvironmentPanorama.js","webpack:///./src/webgl/modules/Environment/IntegrateBRDFMap.js","webpack:///./src/webgl/modules/Environment/EnvironmentSphericalHarmonics.js","webpack:///./src/webgl/modules/Environment/requestFile.js","webpack:///./src/webgl/modules/Environment/fileHelper.js","webpack:///./src/webgl/modules/Environment/Environment.js","webpack:///./src/webgl/loader/AssetLibrary.js","webpack:///./src/const/assetsPreloadConfig.js","webpack:///./src/webgl/MainScene.js","webpack:///./src/components/PreLoader.vue","webpack:///src/components/PreLoader.vue","webpack:///./src/components/PreLoader.vue?6d85","webpack:///./src/components/PreLoader.vue?8c8f","webpack:///./src/components/ConactPanel.vue","webpack:///src/components/ConactPanel.vue","webpack:///./src/components/ConactPanel.vue?fd6b","webpack:///./src/components/ConactPanel.vue?eb30","webpack:///src/index.vue","webpack:///./src/index.vue?ee6f","webpack:///./src/index.vue?3a7d","webpack:///./src/main.js","webpack:///./src/assets/images/7.png","webpack:///./src/assets/images/9.jpg","webpack:///./src/assets/images/983837.png","webpack:///./src/assets/images/11.jpg","webpack:///./src/assets/images/1109789.png"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","render","_vm","this","_c","_self","staticClass","attrs","isMobile","isOpenConactPanel","isLoaded","loadingPercent","staticRenderFns","getEleWidth","element","res","currentStyle","width","getComputedStyle","indexOf","Number","getEleHeight","height","e","test","navigator","userAgent","debounce","callback","duration","timer","event","clearTimeout","setTimeout","checkLODSupport","ctx","document","createElement","getContext","getExtension","computeMeshBoundingBox","mesh","box","THREE","geometry","computeBoundingBox","copy","boundingBox","min","max","subVectors","Math","PI","easeOutSine","b","sin","symmetryRandom","random","clamp","ScetionPPMaterial","constructor","super","uniforms","map","progress","edgeProgress","isNext","resolution","innerWidth","innerHeight","vertexShader","ppMaterialVS","fragmentShader","ppMaterialFS","depthTest","transparent","texture","val","resize","x","y","Section","viewer","visible","debug","postProcessingMaterial","renderer","state","eventHandler","assetLibrary","layers","SCENE_LAYER","BG_LAYER","TEX_LAYER","UI_LAYER","scene","camera","position","z","add","uiScene","uiCamera","fontGenerator","entryAnime","precompile","compile","aspect","updateProjectionMatrix","whileVisible","order","whileNoVisible","initTextMesh","text","material","container","createFontMesh","set","rotation","AnimeNameTitle","section","animeName","createFontMaterial","time","keys","clone","resizeForMobile","resizeForPC","animeNameMesh","animeNameScale","animeNameBBox","multiplyScalar","titleMeshLength","offset","animeNamePosX","animeNamePosY","scale","setScalar","BGUniformsConfig","baseColor","area1Color","area2Color","area1Position","area2Position","TextUniformConfig","color1","color2","color3","color4","TextConfig","mainTitle","subTitle","AnimeName","AnimeTitleUniforms","topColor","bottomColor","BGMaterial","strengthFactor","area1Radius","area2Radius","noiseStrength","opacity","depthWrite","bgVS","bgFS","syncMapArr","syncUniformArr","pbrDefaultUniforms","roughness","metalness","color","emissive","uEnvironmentTransform","uEnvBrightness","uSpecularAAVariance","uSpecularAAThreshold","uAnisotropyRotation","uAnisotropyFactor","uClearCoatRoughness","uClearCoat","pbrDefaultDefines","ENABLE_IBL","ENABLE_LIGHT","ENERGY_COMPENSATION","DIFFUSE_LAMBERT","NDF_GGX","F_SCHLICK","V_SMITHJOINTAPPROX","PBRMaterial","environment","shaderData","sourceMaterial","defines","assign","vertexTangents","normalMapType","UniformsLib","merge","common","normalmap","lightmap","bumpmap","roughnessmap","metalnessmap","aomap","emissivemap","displacementmap","envmap","fog","lights","syncEnvSetting","syncParam","pbrVS","pbrFS","isGLTFSpecularGlossinessMaterial","initSGWorkflow","extensions","derivatives","shaderTextureLOD","needsUpdate","mapEnv","uEnvironmentSphericalHarmonics","uEnvironmentLodRange","uEnvironmentSize","textureLODSupport","envMap","uIntegrateBRDF","forEach","undefined","diffuse","specular","glossiness","specularMap","glossinessMap","_extraUniforms","computeDiffuseSPH","integrateBRDFMobile","panoramaSampler","precomputeLight","isotropyLightCompute","anisotropyLightCompute","math","shadow","light","brdf","ibl","clearCoat","advance","PBRProgram","includePattern","getPBRShader","vs","preParseShader","fs","string","includeReplacer","match","include","ShaderChunk","Error","replace","ParticleInstance","initParticle","positions","Float32Array","setXYZ","setAttribute","uvs","setIndex","Uint16Array","TouchTexture","parent","size","maxAge","radius","trail","initTexture","canvas","fillStyle","fillRect","id","style","update","delta","clear","point","age","drawTouch","addTouch","force","last","dx","dy","dd","pos","intensity","grd","createRadialGradient","addColorStop","beginPath","arc","fill","ParticleTexture","areaBounding","layer","touch","mouse","raycaster","intersectsArr","init","minFilter","magFilter","format","image","initPoints","initHitArea","initTouch","initEvent","numPoints","originalColors","numVisible","threshold","img","drawImage","imgData","getImageData","from","uTime","uRandom","uDepth","uSize","uTextureSize","uTexture","uTouch","particleVS","particleFS","instanceMesh","indices","offsets","angles","floor","wireframe","hitArea","onMouseMoveEvent","onMouseMove","preloadFinished","clientX","clientY","setFromCamera","intersects","intersectObjects","uv","Particle","velocity","Array","euler","alpha","zkey","setVelocity","vx","vy","vz","setRotation","rx","ry","rz","setPosition","nx","ny","nz","setEulerAngles","setSize","setAlpha","a","dt","ParticleSnow","deltaTime","particleControl","particleNum","area","sizes","alphas","points","particles","tempVec3","tempVelocity","particle","normalize","far","type","innerColor","outerColor","blending","repeatPos","index","limit","abs","renderParticle","attributes","ShaderMaterial","FXAAMaterial","inputBuffer","Uniform","Vector2","VignetteMaterial","darkness","eskil","BlurMaterial","direction","initBGGUI","gui","bgMaterial","bgMaterialUniforms","params","bgBaseColor","getStyle","bgArea1Color","bgArea2Color","bgArea1PosX","bgArea1PosY","bgArea2PosX","bgArea2PosY","bgStrengthFactor","bgArea1Radius","bgArea2Radius","bgNoiseStrength","bgOpacity","bgFolder","addFolder","addColor","onChange","setStyle","step","open","initAnimeTitleGUI","animeTitleFolder","HomeSection","scrollSpeed","pbrProgram","envRotationMat","cameraRotationMatrix","sceneRotateXLimit","cameraInitPos","cameraLookAtPos","cameraTargetY","particleTextureArr","swordModel","swordModelInitPos","swordModelInitRotate","initBackground","sunlightInfo","loadSunLight","initCamera","gltfScene","traverse","child","isMesh","initParticleTexture","initParticleSnow","initText","initPostprocessing","initGUI","callBack","gsap","to","delay","ease","vignetteMaterial","onUpdate","lookAt","delayedCall","particleTexture","textMaterial","animeNameTitle","postScene","postCamera","postRenderTarget","postScreenMesh","screenGeometry","frustumCulled","fxaaMaterial","pixelRatio","dpr","renderPost","renderTarget","inputTexture","overrideMaterial","setRenderTarget","particleSnow","cloudTexture","cloudParticleTexture","cloudParticleMesh","aerithTexture","aerithParticleTexture","aerithParticleMesh","enableParticleTexture","resizeParticleTexture","offsetWidth","offsetHeight","titleMesh","subTitleMesh","resizeText","resizeTextForMobile","resizeTextForPC","bottom","titleScale","subTitleScale","subBBox","dat","textMaterialUniforms","textColor1","textColor2","textColor3","textColor4","textFolder","sunLight","bgMesh","updateEnvironmentRotation","makeRotationFromQuaternion","quaternion","setFromMatrix4","onTouchMoveEvent","positionNormX","pointer","positionNorm","sceneRoationTarget","textureRoationTarget","killTweensOf","cameraPos","fromTo","scrollAnimeDuration","pixelWidth","pixelHeight","left","right","top","orthoCamera","target","ParticleUniformsConfig","TextUniformConfigList","AnimeTitleUniformsList","GalleryConfig","galleryTexture1","galleryTexture2","AnimeNameList","GalleryTexture","textures","opts","texWidth","texHeight","texAspect","uProgress","uTextures","swapTextures","temp","setNextTexture","ParticlePolygon","number","areaWidth","areaHeight","areaDepth","numberPoints","randoms","ArrowButton","initRing","CloseButton","RingButton","ringMaterial","ringMesh","textMesh","textScale","RectangleButton","initRectangle","rectangleMaterial","rectangleMesh","AnimeSection","rotateGroup","curAnimeIndex","animeProgress","animeDuration","isAnimeChanging","clickNDCPos","initParticles","initGalleryTextures","initUIPanel","arrowBtn","arrowContainer","arrowBtnScale","arrowBtnBox","resizeUIPanel","topOffset","leftOffset","initTextUniforms","animeNameTitleList","ele","galleryTextures","textureArray1","textureArray2","resizeGalleryTextures","particleColor","particleSize","textTopColor","textBottomColor","particleFolder","swapAnime","nextAnimeIndex","tempCurAnimeIndex","galleryTexture","config","onComplete","nextBGUniforms","nextParticleUniforms","nextTextUniforms","curAnimeTitle","nextAnimeTitle","textOpacity","onClickEvent","onClick","console","log","intersectsRes","ndcPosition","body","removeAttribute","content","diffuseEquation","specularFresnelEquation","specularNDFEquation","specularVisEquation","specularAOList","panelDefinesRegs","SPECULAR_AO_SEBLAGARDE","MS_SPECULAR_AO","MS_DIFFUSE_AO","TextureBG","ppMaterial","imageWidth","imageHeight","imageResolution","uvTransformSpeed","vignetteDarkness","vignetteOffset","BackgroundMaterial","options","uBGEnvironmentSize","backgroundVS","backgroundFS","side","Background","sphere","OrbitControls","domElement","warn","error","enabled","Vector3","minDistance","maxDistance","Infinity","minZoom","maxZoom","minPolarAngle","maxPolarAngle","minAzimuthAngle","maxAzimuthAngle","enableDamping","dampingFactor","enableZoom","zoomSpeed","enableRotate","rotateSpeed","enablePan","panSpeed","screenSpacePanning","keyPanSpeed","autoRotate","autoRotateSpeed","enableKeys","LEFT","UP","RIGHT","BOTTOM","mouseButtons","MOUSE","ROTATE","MIDDLE","DOLLY","PAN","touches","ONE","TOUCH","TWO","DOLLY_PAN","target0","position0","zoom0","zoom","getPolarAngle","spherical","phi","getAzimuthalAngle","theta","saveState","scope","reset","dispatchEvent","changeEvent","STATE","NONE","quat","Quaternion","setFromUnitVectors","up","quatInverse","inverse","lastPosition","lastQuaternion","sub","applyQuaternion","setFromVector3","rotateLeft","getAutoRotationAngle","sphericalDelta","makeSafe","addScaledVector","panOffset","setFromSpherical","zoomChanged","distanceToSquared","EPS","dot","dispose","removeEventListener","onContextMenu","onMouseDown","onMouseWheel","onTouchStart","onTouchEnd","onTouchMove","onMouseUp","onKeyDown","startEvent","endEvent","TOUCH_ROTATE","TOUCH_PAN","TOUCH_DOLLY_PAN","TOUCH_DOLLY_ROTATE","Spherical","rotateStart","rotateEnd","rotateDelta","panStart","panEnd","panDelta","dollyStart","dollyEnd","dollyDelta","getZoomScale","pow","angle","rotateUp","panLeft","v","distance","objectMatrix","setFromMatrixColumn","panUp","crossVectors","pan","deltaX","deltaY","isPerspectiveCamera","targetDistance","tan","fov","clientHeight","matrix","isOrthographicCamera","clientWidth","dollyIn","dollyScale","dollyOut","handleMouseDownRotate","handleMouseDownDolly","handleMouseDownPan","handleMouseMoveRotate","handleMouseMoveDolly","handleMouseMovePan","handleMouseUp","handleMouseWheel","handleKeyDown","keyCode","preventDefault","handleTouchStartRotate","pageX","pageY","handleTouchStartPan","handleTouchStartDolly","sqrt","handleTouchStartDollyPan","handleTouchStartDollyRotate","handleTouchMoveRotate","handleTouchMovePan","handleTouchMoveDolly","handleTouchMoveDollyPan","handleTouchMoveDollyRotate","handleTouchEnd","focus","button","ctrlKey","metaKey","shiftKey","addEventListener","stopPropagation","DOLLY_ROTATE","tabIndex","EventDispatcher","MapControls","WorkSection","isModelViewing","envRotation","envRotationFromPanel","makeRotationY","envRotationMat4","envRotationMatBG","envBrightness","sunLightPanelRotateMat","modelInitScale","modelInitPosY","modelInitRotationZ","modelViewingScale","modelViewingPosY","modelViewingRotateZ","backgroundEnv","sunLightStartPos","loadCubeBackground","initPanelGUI","close","guiParams","enableIBL","enableLight","enableAnisotropy","ENABLE_ANISOTROPY","anisotropyFactor","anisotropyRotation","enableClearCoat","ENABLE_CLEARCOAT","clearCoatRoughness","enableCompensation","enableSpecularAA","GEOMETRIC_SPECULAR_AA","specularAAVariance","specularAAThreshold","specularAO","enableMSSpecularAO","enableMSDiffuseAO","pbrFolder","reCompileShader","equationsFolder","anisotropyFolader","clearCoatFolader","advanceFolder","setDefinesFromGUI","reg","toUpperCase","ringBtn","closeBtn","closeContainer","closeBtnScale","closeBtnBox","cubeBackground","control","contentMesh","contentScale","contentBBox","multiplyMatrices","resultSunlight","getInverse","applyMatrix4","openModelViewer","querySelector","closeModelViewer","modelRotation","ParticleChip","AboutSection","isOpenContactPanel","blurIterations","start","initParticleChip","blurVerticalMaterial","blurHorizontalMaterial","setY","setX","contactBtn","particleChip","closeContactPanel","openContactPanel","toggleConactPanle","Signal","_listeners","_lookUp","Map","self","resFun","unbind","delete","dispatch","len","EventHandler","Date","lastTime","touchStartPos","touchMovePos","onScrollEvent","passive","onScroll","normalEvent","normalizeWheel","offsetX","offsetY","fontShaders","vertex","vertex1","fragment","fragment1","vertex2","fragment2","vertex3","fragment3","FontGenerator","fontTexture","font","fontShadersKey","MSDFShader","negate","createGeometry","ScenesViewer","mainScene","clock","scrollMultiplier","isSectionChanging","scissors","visibleSections","currentScetionIndex","nextSectionIndex","scrollDirection","scroll","posVertices","uvVertices","initSection","targets","quad","encoding","outputEncoding","generateMipmaps","sections","stencilBuffer","depthBuffer","status","toggleConactCallback","setPointerPos","swapSection","pixelY","isUpScroll","currentSection","nextSection","curScissors","nextScissors","getPixelRatio","getDelta","item","scissor","scissorY","scissorHeight","scissorTest","GLTFLoader","manager","Loader","dracoLoader","ddsLoader","GLTFRegistry","objects","remove","removeAll","load","url","onLoad","onProgress","onError","resourcePath","path","LoaderUtils","extractUrlBase","itemStart","_onError","itemError","itemEnd","loader","FileLoader","setPath","setResponseType","crossOrigin","setWithCredentials","parse","gltf","setDRACOLoader","setDDSLoader","magic","decodeText","Uint8Array","BINARY_EXTENSION_HEADER_MAGIC","EXTENSIONS","KHR_BINARY_GLTF","GLTFBinaryExtension","json","JSON","asset","version","extensionsUsed","extensionName","extensionsRequired","KHR_LIGHTS_PUNCTUAL","GLTFLightsExtension","KHR_MATERIALS_UNLIT","GLTFMaterialsUnlitExtension","KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS","GLTFMaterialsPbrSpecularGlossinessExtension","KHR_DRACO_MESH_COMPRESSION","GLTFDracoMeshCompressionExtension","MSFT_TEXTURE_DDS","GLTFTextureDDSExtension","KHR_TEXTURE_TRANSFORM","GLTFTextureTransformExtension","KHR_MESH_QUANTIZATION","GLTFMeshQuantizationExtension","parser","GLTFParser","extension","lightDefs","loadLight","lightIndex","lightNode","lightDef","Color","fromArray","range","DirectionalLight","PointLight","SpotLight","spot","innerConeAngle","outerConeAngle","penumbra","decay","Promise","resolve","getMaterialType","MeshBasicMaterial","extendParams","materialParams","materialDef","pending","metallicRoughness","pbrMetallicRoughness","isArray","baseColorFactor","array","baseColorTexture","assignTexture","all","BINARY_EXTENSION_HEADER_LENGTH","BINARY_EXTENSION_CHUNK_TYPES","BIN","headerView","DataView","header","getUint32","chunkView","chunkIndex","byteLength","chunkLength","chunkType","contentArray","byteOffset","preload","GLTFMeshStandardSGMaterial","MeshStandardMaterial","specularMapParsFragmentChunk","join","glossinessMapParsFragmentChunk","specularMapFragmentChunk","glossinessMapFragmentChunk","lightPhysicalFragmentChunk","setHex","onBeforeCompile","shader","uniformName","defineProperties","USE_GLOSSINESSMAP","USE_ROUGHNESSMAP","metalnessMap","roughnessMap","setValues","specularGlossinessParams","pbrSpecularGlossiness","diffuseFactor","diffuseTexture","glossinessFactor","specularFactor","specularGlossinessTexture","specGlossMapDef","createMaterial","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","TangentSpaceNormalMap","normalScale","displacementMap","displacementScale","displacementBias","alphaMap","envMapIntensity","refractionRatio","GLTFCubicSplineInterpolant","parameterPositions","sampleValues","sampleSize","resultBuffer","Interpolant","decodePrimitive","primitive","bufferViewIndex","bufferView","gltfAttributeMap","threeAttributeMap","attributeNormalizedMap","attributeTypeMap","attributeName","threeAttributeName","ATTRIBUTES","toLowerCase","accessorDef","accessors","componentType","WEBGL_COMPONENT_TYPES","normalized","getDependency","then","decodeDracoFile","attribute","extendTexture","transform","repeat","texCoord","source","copySampleValue_","values","valueSize","beforeStart_","afterEnd_","interpolate_","i1","t0","t1","stride","stride2","stride3","td","pp","ppp","offset1","offset0","s2","s3","s0","s1","p0","m0","p1","m1","WEBGL_CONSTANTS","FLOAT","FLOAT_MAT3","FLOAT_MAT4","FLOAT_VEC2","FLOAT_VEC3","FLOAT_VEC4","LINEAR","REPEAT","SAMPLER_2D","POINTS","LINES","LINE_LOOP","LINE_STRIP","TRIANGLES","TRIANGLE_STRIP","TRIANGLE_FAN","UNSIGNED_BYTE","UNSIGNED_SHORT","5120","Int8Array","5121","5122","Int16Array","5123","5125","Uint32Array","5126","WEBGL_FILTERS","9728","NearestFilter","9729","LinearFilter","9984","NearestMipmapNearestFilter","9985","LinearMipmapNearestFilter","9986","NearestMipmapLinearFilter","9987","LinearMipmapLinearFilter","WEBGL_WRAPPINGS","33071","ClampToEdgeWrapping","33648","MirroredRepeatWrapping","10497","RepeatWrapping","WEBGL_TYPE_SIZES","SCALAR","VEC2","VEC3","VEC4","MAT2","MAT3","MAT4","POSITION","NORMAL","TANGENT","TEXCOORD_0","TEXCOORD_1","COLOR_0","WEIGHTS_0","JOINTS_0","PATH_PROPERTIES","translation","weights","INTERPOLATION","CUBICSPLINE","InterpolateLinear","STEP","InterpolateDiscrete","ALPHA_MODES","OPAQUE","MASK","BLEND","MIME_TYPE_FORMATS","RGBAFormat","RGBFormat","resolveURL","createDefaultMaterial","cache","FrontSide","addUnknownExtensionsToUserData","knownExtensions","objectDef","userData","gltfExtensions","assignExtrasToUserData","gltfDef","extras","addMorphTargets","hasMorphPosition","hasMorphNormal","il","pendingPositionAccessors","pendingNormalAccessors","pendingAccessor","normal","morphPositions","morphNormals","morphAttributes","morphTargetsRelative","updateMorphTargets","meshDef","morphTargetInfluences","targetNames","morphTargetDictionary","createPrimitiveKey","primitiveDef","geometryKey","dracoExtension","createAttributesKey","attributesKey","sort","primitiveCache","textureLoader","TextureLoader","setCrossOrigin","fileLoader","computeBounds","Box3","accessor","vector","setZ","expandByVector","Sphere","getCenter","center","distanceTo","boundingSphere","addPrimitiveAttributes","assignAttributeAccessor","accessorIndex","gltfAttributeName","toTrianglesDrawMode","drawMode","getIndex","getAttribute","count","numberOfTriangles","newIndices","TriangleFanDrawMode","getX","newGeometry","markDefs","getDependencies","dependencies","scenes","animations","cameras","catch","nodeDefs","nodes","skinDefs","skins","meshDefs","meshes","meshReferences","meshUses","skinIndex","skinLength","joints","isBone","nodeIndex","nodeLength","nodeDef","skin","isSkinnedMesh","cacheKey","dependency","loadScene","loadNode","loadMesh","loadAccessor","loadBufferView","loadBuffer","loadMaterial","loadTexture","loadSkin","loadAnimation","loadCamera","defs","def","bufferIndex","bufferDef","buffers","uri","reject","bufferViewDef","bufferViews","buffer","sparse","pendingBufferViews","bufferAttribute","itemSize","TypedArray","elementBytes","BYTES_PER_ELEMENT","itemBytes","byteStride","ibSlice","ibCacheKey","ib","InterleavedBuffer","InterleavedBufferAttribute","BufferAttribute","itemSizeIndices","TypedArrayIndices","byteOffsetIndices","byteOffsetValues","sparseIndices","sparseValues","setW","textureIndex","URL","webkitURL","textureDef","textureExtensions","images","sourceURI","isObjectURL","blob","Blob","mimeType","createObjectURL","getHandler","revokeObjectURL","flipY","samplers","sampler","wrapS","wrapT","mapName","mapDef","isCompressedTexture","assignFinalMaterial","useVertexTangents","tangent","useVertexColors","useFlatShading","useSkinning","useMorphTargets","useMorphNormals","isPoints","uuid","pointsMaterial","PointsMaterial","Material","sizeAttenuation","isLine","lineMaterial","LineBasicMaterial","cachedMaterial","skinning","vertexColors","VertexColors","flatShading","morphTargets","uv2","materialIndex","materialType","materials","materialExtensions","sgExtension","kmuExtension","metallicFactor","roughnessFactor","metallicRoughnessTexture","doubleSided","DoubleSide","alphaMode","alphaTest","alphaCutoff","normalTexture","occlusionTexture","strength","emissiveFactor","emissiveTexture","sRGBEncoding","loadGeometries","primitives","createDracoPrimitive","geometryPromise","cached","promise","BufferGeometry","meshIndex","results","geometries","SkinnedMesh","Mesh","skinWeight","normalizeSkinWeights","TriangleStripDrawMode","LineSegments","Line","LineLoop","Points","group","Group","cameraIndex","cameraDef","PerspectiveCamera","MathUtils","radToDeg","yfov","aspectRatio","znear","zfar","OrthographicCamera","xmag","ymag","skinDef","skinEntry","inverseBindMatrices","animationIndex","animationDef","pendingNodes","pendingInputAccessors","pendingOutputAccessors","pendingSamplers","pendingTargets","channels","channel","node","input","parameters","output","inputAccessors","outputAccessors","tracks","inputAccessor","outputAccessor","TypedKeyframeTrack","updateMatrix","matrixAutoUpdate","NumberKeyframeTrack","QuaternionKeyframeTrack","VectorKeyframeTrack","targetName","interpolation","outputArray","scaled","jl","track","createInterpolant","times","getValueSize","isInterpolantFactoryMethodGLTFCubicSpline","AnimationClip","instanceNum","Bone","Object3D","PropertyBinding","sanitizeNodeName","Matrix4","buildNodeHierachy","nodeId","parentObject","pendingJoints","jointNodes","bones","boneInverses","jointNode","mat","Skeleton","matrixWorld","children","sceneIndex","sceneDef","Scene","nodeIds","zlib","Zlib","isGunzipBuffer","arrayBuffer","typedArray","gunzip","zdec","Gunzip","decompress","CubeMapEnv","_options","_size","_data","deinterleaveImage4","src","dst","npixel","npixel2","npixel3","idx","loadPacked","readInputArray","inputArray","maxLevel","LN2","byteSize","face","imageData","deinterleave","_packedImages","createRGBA8Packed","cubeTextures","packedImages","numMips","textureEncoding","mip","cubeTexture","dataTexture","mipmaps","PanoramaEnv","_texture","IntegrateBRDF","EnvironmentSphericalHarmonics","file","_file","initSHCoef","sphCoef","_sphCoef","coef0","coef1","coef2","coef3","coef4","coef5","coef6","coef7","coef8","coef","_uniformSpherical","requestFileFromURL","req","XMLHttpRequest","responseType","response","responseText","send","requestFileFromReader","reader","FileReader","onload","readAsArrayBuffer","readAsText","readAsDataURL","requestFile","urlOrFile","mimeTypes","isString","str","String","isBlobURL","substr","isHttpURL","isURL","createImageFromURL","Image","onerror","createImageFromBlob","privateURL","finally","createArrayBufferFromBlob","fr","createArrayBufferFromURL","createJSONFromURL","createJSONFromString","obj","fileHelper","requestURI","requestResource","mimetype","getMimeType","resolveData","createData","resolveFilesMap","filesMap","promises","filename","fname","dataResolved","lastIndexOf","addMimeTypeForExtension","has","brdfLUTPath","Environment","_config","_files","needBG","configSrc","getImage","getTextures","limitSize","filter","envMapFormat","textureData","mapFile","mapSize","mapData","EnvironmentCubeMap","EnvironmentPanorama","minTextureSize","nbLod","maxLod","lutTextureData","lutSize","lutData","_integrateBRDF","IntegrateBRDFMap","bgTextureData","bgFile","bgSize","bgData","_spherical","diffuseSPH","Lights","sunlight","luminosity","AssetLibrary","loadedNumber","loadQueue","assets","onCompleteEvent","onProgressEvent","addLoadQueue","filePath","loadModel","loadEnvMap","loadFontAsset","onAssetLoaded","model","loadPackage","env","loadFont","err","commonAssetList","require","PCPreloadConfigList","concat","MobilePreloadConfigList","MainScene","preloadConfigList","devicePixelRatio","antialias","setPixelRatio","gammaFactor","toneMapping","setClearColor","autoClear","appendChild","loadAssets","initScene","scenesViewer","initEvents","onWindowResize","requestAnimationFrame","loadingAnimeFinished","_e","class","_v","_s","loadingPercentNum","loadingText","props","mounted","watch","component","_m","components","PreLoader","ConactPanel","persent","methods","updateProgress","loadCompelete","toggleConactPanel","Vue","h","App","$mount"],"mappings":"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","file":"js/app.2fd60864.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"app\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([0,\"chunk-vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","module.exports = __webpack_public_path__ + \"img/Binguo1.15d3085e.jpg\";","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../node_modules/less-loader/dist/cjs.js??ref--11-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PreLoader.vue?vue&type=style&index=0&id=5cffb1cb&prod&lang=less&\"","module.exports = __webpack_public_path__ + \"img/11.db5f0a7b.png\";","export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../node_modules/less-loader/dist/cjs.js??ref--11-oneOf-1-3!../node_modules/cache-loader/dist/cjs.js??ref--1-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&id=c646c88c&prod&lang=less&\"","module.exports = __webpack_public_path__ + \"img/4.31e5ed5e.png\";","module.exports = __webpack_public_path__ + \"img/developer.9831ddf3.png\";","module.exports = __webpack_public_path__ + \"img/bingua4.0c355219.png\";","module.exports = __webpack_public_path__ + \"img/5.a3604e4b.png\";","module.exports = __webpack_public_path__ + \"img/9.778e9959.png\";","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../node_modules/less-loader/dist/cjs.js??ref--11-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ConactPanel.vue?vue&type=style&index=0&id=743f63ba&prod&lang=less&\"","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"wrapper\"},[_c('div',{attrs:{\"id\":\"canvasContainer\"}}),_c('div',{staticClass:\"uiContainer\"},[_c('ConactPanel',{attrs:{\"isMobile\":_vm.isMobile,\"isOpenConactPanel\":_vm.isOpenConactPanel}})],1),_c('PreLoader',{attrs:{\"isMobile\":_vm.isMobile,\"isLoaded\":_vm.isLoaded,\"loadingPercent\":_vm.loadingPercent}})],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import * as THREE from 'three';\r\n\r\nfunction getEleWidth(element) {\r\n\tlet res;\r\n\tif (element.currentStyle) {\r\n\t\tres = element.currentStyle.width; // For IE\r\n\t} else {\r\n\t\tres = getComputedStyle(element, false).width;\r\n\t}\r\n\t// Get number\r\n\tif (~res.indexOf('px')) res = res.slice(0, -2);\r\n\treturn Number(res);\r\n}\r\n\r\nfunction getEleHeight(element) {\r\n\tlet res;\r\n\tif (element.currentStyle) {\r\n\t\tres = element.currentStyle.height;\r\n\t} else {\r\n\t\tres = getComputedStyle(element, false).height;\r\n\t}\r\n\tif (~res.indexOf('px')) res = res.slice(0, -2);\r\n\treturn Number(res);\r\n}\r\n\r\nfunction isMobile() {\r\n\tlet e = /AppleWebKit/.test(navigator.userAgent) && /Mobile\\/\\w+/.test(navigator.userAgent);\r\n\treturn e || /Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(navigator.userAgent);\r\n}\r\n\r\nfunction debounce(callback, duration) {\r\n\tlet timer;\r\n\treturn function (event) {\r\n\t\tclearTimeout(timer);\r\n\t\ttimer = setTimeout(() => {\r\n\t\t\tcallback(event);\r\n\t\t}, duration);\r\n\t};\r\n}\r\n\r\nfunction throttle(callback, duration) {\r\n\tlet _lastTime = null;\r\n\treturn function (event) {\r\n\t\tlet _nowTime = +new Date();\r\n\t\tif (_nowTime - _lastTime > duration || !_lastTime) {\r\n\t\t\tcallback(event);\r\n\t\t\t_lastTime = _nowTime;\r\n\t\t}\r\n\t};\r\n}\r\n\r\nfunction checkLODSupport() {\r\n\tlet ctx = document.createElement('canvas').getContext('webgl');\r\n\treturn ctx.getExtension('EXT_shader_texture_lod');\r\n}\r\n\r\nfunction computeMeshBoundingBox(mesh) {\r\n\tlet box = new THREE.Box3();\r\n\tmesh.geometry.computeBoundingBox();\r\n\tbox.copy(mesh.geometry.boundingBox);\r\n\treturn {\r\n\t\tmin: box.min,\r\n\t\tmax: box.max,\r\n\t\tlength: new THREE.Vector3().subVectors(box.max, box.min)\r\n\t};\r\n}\r\n\r\n// Math\r\nconst PI2 = Math.PI * 2.0;\r\n\r\nfunction randomInRange(min, max) {\r\n\treturn min + Math.random() * (max - min);\r\n}\r\n\r\nfunction randomInt(low, high) {\r\n\treturn low + Math.floor(Math.random() * (high - low + 1));\r\n}\r\n\r\nfunction randomFloat(low, high) {\r\n\treturn low + Math.random() * (high - low);\r\n}\r\n\r\nfunction easeOutSine(t, b, c, d) {\r\n\treturn c * Math.sin((t / d) * (Math.PI / 2)) + b;\r\n}\r\n\r\nfunction symmetryRandom() {\r\n\treturn Math.random() * 2.0 - 1.0;\r\n}\r\n\r\nfunction clamp(value, min, max) {\r\n\treturn Math.min(Math.max(value, min), max);\r\n}\r\n\r\nexport {\r\n\tgetEleWidth,\r\n\tgetEleHeight,\r\n\tisMobile,\r\n\tdebounce,\r\n\tthrottle,\r\n\tcheckLODSupport,\r\n\tcomputeMeshBoundingBox,\r\n\tPI2,\r\n\trandomInRange,\r\n\trandomInt,\r\n\trandomFloat,\r\n\teaseOutSine,\r\n\tsymmetryRandom,\r\n\tclamp\r\n};\r\n","export default \"precision highp float;\\n#define GLSLIFY 1\\nattribute vec2 position;\\nattribute vec2 uv;\\n\\nvarying vec2 vUv;\\n\\nvoid main() {\\n    vUv = uv;\\n    gl_Position = vec4(position, 1.0, 1.0);\\n}\";","export default \"precision highp float;\\n#define GLSLIFY 1\\nuniform sampler2D map;\\nvarying vec2 vUv;\\nuniform float progress;\\nuniform vec2 resolution;\\nuniform bool isNext;\\n#define M_PI 3.1415926535897932384626433832795\\n\\nvoid main() {\\n    vec2 uv = vUv;\\n    vec4 color = texture2D(map, uv);\\n    \\n    float y = gl_FragCoord.y / resolution.y; // [0, 1]\\n\\n    // https://codepen.io/ReGGae/pen/rNxpVEd?editors=0010\\n    // float x = gl_FragCoord.x / resolution.x; // [0, 1]\\n    // y -= ((sin(x * M_PI) * 1.) * .25);\\n  \\n    float opacity = step(progress, y);\\n    if(isNext){\\n        opacity = 1. - opacity;\\n    }\\n    gl_FragColor = vec4(\\n        vec3( ( color.rgb ) / color.a ),\\n        opacity\\n    );\\n    // Test scissor\\n    // gl_FragColor = vec4(color);\\n}\\n\";","import * as THREE from 'three';\r\nimport ppMaterialVS from './shaders/ppMaterial.vs';\r\nimport ppMaterialFS from './shaders/scetionPPMaterial.fs';\r\n\r\nexport class ScetionPPMaterial extends THREE.RawShaderMaterial {\r\n\tconstructor() {\r\n\t\tsuper({\r\n\t\t\tuniforms: {\r\n\t\t\t\tmap: { value: null },\r\n\t\t\t\tprogress: { value: 0 },\r\n\t\t\t\tedgeProgress: { value: 0 },\r\n\t\t\t\tisNext: { value: false },\r\n\t\t\t\tresolution: { value: new THREE.Vector2(window.innerWidth, window.innerHeight) }\r\n\t\t\t},\r\n\t\t\tvertexShader: ppMaterialVS,\r\n\t\t\tfragmentShader: ppMaterialFS,\r\n\t\t\tdepthTest: false,\r\n\t\t\ttransparent: true\r\n\t\t});\r\n\t}\r\n\r\n\tget map() {\r\n\t\treturn this.uniforms.map.value;\r\n\t}\r\n\r\n\tset map(texture) {\r\n\t\tthis.uniforms.map.value = texture;\r\n\t}\r\n\r\n\tget progress() {\r\n\t\treturn this.uniforms.progress.value;\r\n\t}\r\n\r\n\tset progress(val) {\r\n\t\tthis.uniforms.progress.value = val;\r\n\t}\r\n\r\n\tget edgeProgress() {\r\n\t\treturn this.uniforms.edgeProgress.value;\r\n\t}\r\n\r\n\tset edgeProgress(val) {\r\n\t\tthis.uniforms.edgeProgress.value = val;\r\n\t}\r\n\r\n\tget isNext() {\r\n\t\treturn this.uniforms.isNext.value;\r\n\t}\r\n\r\n\tset isNext(val) {\r\n\t\tthis.uniforms.isNext.value = val;\r\n\t}\r\n\r\n\tresize(width, height) {\r\n\t\tthis.uniforms.resolution.value.x = width;\r\n\t\tthis.uniforms.resolution.value.y = height;\r\n\t}\r\n}\r\n","import * as THREE from 'three';\r\nimport { ScetionPPMaterial } from './ScetionPPMaterial';\r\n\r\nexport class Section {\r\n\tconstructor(viewer) {\r\n\t\tthis.name = 'section';\r\n\t\tthis.visible = false;\r\n\t\tthis.debug = false;\r\n\t\tthis.postProcessingMaterial = new ScetionPPMaterial();\r\n\r\n\t\tthis.viewer = viewer;\r\n\t\tthis.isMobile = viewer.isMobile;\r\n\t\tthis.renderer = viewer.renderer;\r\n\t\tthis.state = viewer.state;\r\n\t\tthis.eventHandler = viewer.eventHandler;\r\n\t\tthis.assetLibrary = viewer.assetLibrary;\r\n\r\n\t\tthis.width = this.viewer.width;\r\n\t\tthis.height = this.viewer.height;\r\n\r\n\t\tthis.layers = {\r\n\t\t\tSCENE_LAYER: 0,\r\n\t\t\tBG_LAYER: 1,\r\n\t\t\tTEX_LAYER: 2,\r\n\t\t\tUI_LAYER: 3\r\n\t\t};\r\n\r\n\t\tthis.scene = new THREE.Scene();\r\n\t\tthis.camera = new THREE.PerspectiveCamera(45, this.width / this.height, 0.1, 700);\r\n\t\tthis.camera.position.z = 10;\r\n\t\tthis.scene.add(this.camera);\r\n\r\n\t\tthis.uiScene = new THREE.Scene();\r\n\t\tthis.uiCamera = new THREE.OrthographicCamera(-this.width, this.width, -this.height, this.height, 1, 100);\r\n\t\tthis.uiCamera.position.z = 10;\r\n\r\n\t\tthis.fontGenerator = this.viewer.fontGenerator;\r\n\t}\r\n\r\n\tentryAnime() {}\r\n\r\n\tprecompile() {\r\n\t\tthis.renderer.compile(this.scene, this.camera);\r\n\t\tthis.renderer.compile(this.uiScene, this.uiCamera);\r\n\t}\r\n\r\n\tresize(width, height) {\r\n\t\tthis.camera.aspect = width / height;\r\n\t\tthis.camera.updateProjectionMatrix();\r\n\t}\r\n\r\n\twhileVisible(order) {\r\n\t\t// console.log(\"whileVisible: \", order);\r\n\t}\r\n\r\n\twhileNoVisible(order) {\r\n\t\t// console.log(\"whileNoVisible: \", order);\r\n\t}\r\n\r\n\tinitTextMesh(text, material, container) {\r\n\t\tconst mesh = this.fontGenerator.createFontMesh(text, material);\r\n\t\tmesh.layers.set(this.layers.UI_LAYER);\r\n\t\tmesh.rotation.set(-Math.PI, 0, 0); // Spin to face correctly\r\n\t\tcontainer = container || this.uiScene;\r\n\t\tcontainer.add(mesh);\r\n\t\treturn mesh;\r\n\t}\r\n}\r\n","import { computeMeshBoundingBox, clamp } from 'JS/Utils';\r\n\r\nexport class AnimeNameTitle {\r\n\tconstructor(section, animeName, uniforms) {\r\n\t\tthis.section = section;\r\n\t\tthis.isMobile = section.isMobile;\r\n\t\tthis.fontGenerator = section.fontGenerator;\r\n\t\tthis.material = this.fontGenerator.createFontMaterial(1);\r\n\t\tthis.material.uniforms.time = { value: 0.0 };\r\n\t\tthis.mesh = section.initTextMesh(animeName, this.material);\r\n\t\t// Apply text uniforms\r\n\t\tObject.keys(uniforms).map(key => {\r\n\t\t\tthis.material.uniforms[`${key}`] = { value: uniforms[key].clone() };\r\n\t\t});\r\n\t}\r\n\r\n\tresize(width, height) {\r\n\t\tif(!this.isMobile){\r\n\t\t\tthis.resizeForPC(width, height);\r\n\t\t}else{\r\n\t\t\tthis.resizeForMobile(width, height);\r\n\t\t}\r\n\t}\r\n\r\n\tresizeForPC(width, height) {\r\n\t\tlet animeNameMesh = this.mesh;\r\n\t\tconst animeNameScale = clamp(width / 2000, 0.25, 0.35);\r\n\t\tlet animeNameBBox = computeMeshBoundingBox(animeNameMesh).length.multiplyScalar(animeNameScale);\r\n\t\tlet titleMeshLength = animeNameBBox.x;\r\n\t\t// Right coner\r\n\t\tconst offset = 10;\r\n\t\tconst animeNamePosX = width / 2 - titleMeshLength - offset;\r\n\t\tconst animeNamePosY = -height / 2 + offset;\r\n\t\tanimeNameMesh.scale.setScalar(animeNameScale);\r\n\t\tanimeNameMesh.position.set(animeNamePosX, animeNamePosY, 0);\r\n\t}\r\n\r\n\tresizeForMobile(width, height) {\r\n\t\tlet animeNameMesh = this.mesh;\r\n\t\tconst animeNameScale = clamp(width / 1500, 0.25, 0.35);\r\n\t\tlet animeNameBBox = computeMeshBoundingBox(animeNameMesh).length.multiplyScalar(animeNameScale);\r\n\t\tlet titleMeshLength = animeNameBBox.x;\r\n\t\t// Right coner\r\n\t\tconst offset = 20;\r\n\t\tconst animeNamePosX = width / 2 - titleMeshLength - offset;\r\n\t\tconst animeNamePosY = -height / 2 + offset;\r\n\t\tanimeNameMesh.scale.setScalar(animeNameScale);\r\n\t\tanimeNameMesh.position.set(animeNamePosX, animeNamePosY, 0);\r\n\t}\r\n\r\n\trender(time) {\r\n\t\tthis.material.uniforms.time.value += time;\r\n\t}\r\n}\r\n","import * as THREE from 'three';\r\n\r\nconst Layers = {\r\n\tSCENE_LAYER: 0,\r\n\tBG_LAYER: 1,\r\n\tUI_LAYER: 2\r\n};\r\n\r\nconst BGUniformsConfig = {\r\n\tbaseColor: new THREE.Color('#646666'),\r\n\tarea1Color: new THREE.Color('#4A4F54'),\r\n\tarea2Color: new THREE.Color('#FFFFFF'),\r\n\tarea1Position: new THREE.Vector2(0.2, 0.2),\r\n\tarea2Position: new THREE.Vector2(0.9, 0.9)\r\n};\r\n\r\nconst TextUniformConfig = {\r\n\tcolor1: new THREE.Uniform(new THREE.Color(0.85, 0.85, 0.85)),\r\n\tcolor2: new THREE.Uniform(new THREE.Color(1, 1, 0.85)),\r\n\tcolor3: new THREE.Uniform(new THREE.Color(0.35, 0.35, 0.35)),\r\n\tcolor4: new THREE.Uniform(new THREE.Color(0.0, 0.0, 0.0))\r\n};\r\n\r\nconst TextConfig = {\r\n\tmainTitle: `hello world!`,\r\n\tsubTitle: `Hi, I'm Tran Le Quyen`\r\n};\r\n\r\nconst AnimeName = '[ gumq4 ]';\r\n\r\nconst AnimeTitleUniforms = {\r\n\ttopColor: new THREE.Color('rgb(225,225,225)'),\r\n\tbottomColor: new THREE.Color('rgb(89,89,89)')\r\n};\r\n\r\nexport { BGUniformsConfig, TextUniformConfig, TextConfig, Layers, AnimeName, AnimeTitleUniforms };\r\n","export default \"precision highp float;\\n#define GLSLIFY 1\\nattribute vec2 position;\\nattribute vec2 uv;\\n\\nvarying vec2 vUv;\\n\\nvoid main() {\\n    vUv = uv;\\n    gl_Position = vec4(position, 1.0, 1.0);\\n}\";","export default \"precision highp float;\\n#define GLSLIFY 1\\n\\nuniform vec3 baseColor;\\nuniform vec3 area1Color;\\nuniform vec3 area2Color;\\nuniform vec2 area1Position;\\nuniform vec2 area2Position;\\nuniform float strengthFactor;\\nuniform float area1Radius;\\nuniform float area2Radius;\\nuniform float noiseStrength;\\nuniform float opacity;\\nvarying vec2 vUv;\\n\\n// https://www.shadertoy.com/view/4djSRW\\nfloat random (vec2 st) {\\n\\treturn fract(sin(dot(st, vec2(12.9898, 78.233))) * 43758.5453);\\n}\\n\\nvoid main() {\\n    vec3 color = baseColor;\\n    color += strengthFactor * area1Color * (1.0 - smoothstep(0.0, area1Radius, distance(vUv + random(vUv) * noiseStrength, area1Position)));\\n    color += strengthFactor * area2Color * (1.0 - smoothstep(0.0, area2Radius, distance(vUv + random(vUv) * noiseStrength, area2Position)));\\n    gl_FragColor = vec4(color, opacity);\\n}\";","import * as THREE from 'three';\r\nimport bgVS from './shaders/bgMaterial.vs';\r\nimport bgFS from './shaders/bgMaterial.fs';\r\n\r\nexport class BGMaterial extends THREE.RawShaderMaterial {\r\n\tconstructor({\r\n\t\tbaseColor = new THREE.Color('#000000'),\r\n\t\tarea1Color = new THREE.Color('#000000'),\r\n\t\tarea2Color = new THREE.Color('#FFFFFF'),\r\n\t\tarea1Position = new THREE.Vector2(0, 0),\r\n\t\tarea2Position = new THREE.Vector2(1, 1),\r\n\t\tstrengthFactor = 0.4,\r\n\t\tarea1Radius = 0.6,\r\n\t\tarea2Radius = 0.6,\r\n\t\tnoiseStrength = 0.05,\r\n\t\topacity = 1\r\n\t} = {}) {\r\n\t\tsuper({\r\n\t\t\tuniforms: {\r\n\t\t\t\tbaseColor: { value: baseColor.clone() },\r\n\t\t\t\tarea1Color: { value: area1Color.clone() },\r\n\t\t\t\tarea2Color: { value: area2Color.clone() },\r\n\t\t\t\tarea1Position: { value: area1Position.clone() },\r\n\t\t\t\tarea2Position: { value: area2Position.clone() },\r\n\t\t\t\tstrengthFactor: { value: strengthFactor },\r\n\t\t\t\tarea1Radius: { value: area1Radius },\r\n\t\t\t\tarea2Radius: { value: area2Radius },\r\n\t\t\t\tnoiseStrength: { value: noiseStrength },\r\n\t\t\t\topacity: { value: opacity }\r\n\t\t\t},\r\n\t\t\tdepthWrite: false,\r\n\t\t\tdepthTest: false,\r\n\t\t\ttransparent: true,\r\n\t\t\tvertexShader: bgVS,\r\n\t\t\tfragmentShader: bgFS\r\n\t\t});\r\n\t}\r\n}\r\n","import * as THREE from 'three';\r\n\r\nconst syncMapArr = [\r\n\t'map',\r\n\t'normalMap',\r\n\t'lightMap',\r\n\t'bumpMap',\r\n\t'roughnessMap',\r\n\t'metalnessMap',\r\n\t'aoMap',\r\n\t'emissiveMap',\r\n\t'displacementmap'\r\n];\r\n\r\nconst syncUniformArr = ['color', 'roughness', 'metalness', 'emissive'];\r\n\r\nconst bgDefaultUniforms = {\r\n\tuEnvBrightness: {\r\n\t\tvalue: 1.0\r\n\t},\r\n\tuEnvironmentTransform: {\r\n\t\tvalue: new THREE.Matrix3()\r\n\t}\r\n};\r\n\r\nconst pbrDefaultUniforms = {\r\n\troughness: {\r\n\t\tvalue: 0.5\r\n\t},\r\n\tmetalness: {\r\n\t\tvalue: 0\r\n\t},\r\n\tcolor: {\r\n\t\tvalue: new THREE.Color(0xffffff)\r\n\t},\r\n\temissive: {\r\n\t\tvalue: new THREE.Color(0x000000)\r\n\t},\r\n\tuEnvironmentTransform: {\r\n\t\tvalue: new THREE.Matrix3()\r\n\t},\r\n\tuEnvBrightness: {\r\n\t\tvalue: 1.0\r\n\t},\r\n\tuSpecularAAVariance: {\r\n\t\tvalue: 0.1\r\n\t},\r\n\tuSpecularAAThreshold: {\r\n\t\tvalue: 1.0\r\n\t},\r\n\t// Anisotropy\r\n\tuAnisotropyRotation: {\r\n\t\tvalue: 0\r\n\t},\r\n\tuAnisotropyFactor: {\r\n\t\tvalue: 0.5\r\n\t},\r\n\t// ClearCoat\r\n\tuClearCoatRoughness: {\r\n\t\tvalue: 0.5\r\n\t},\r\n\tuClearCoat: {\r\n\t\tvalue: 0.5\r\n\t}\r\n};\r\n\r\nconst pbrDefaultDefines = {\r\n\tENABLE_IBL: 1,\r\n\tENABLE_LIGHT: 1,\r\n\tENERGY_COMPENSATION: 1,\r\n\tDIFFUSE_LAMBERT: 1,\r\n\tNDF_GGX: 1,\r\n\tF_SCHLICK: 1,\r\n\tV_SMITHJOINTAPPROX: 1\r\n\t// ENABLE_ANISOTROPY: 1,\r\n\t// ENABLE_CLEARCOAT: 1,\r\n\t// GEOMETRIC_SPECULAR_AA: 1\r\n\t// SPECULAR_AO_SEBLAGARDE: 1,\r\n\t// MS_SPECULAR_AO: 1,\r\n\t// MS_DIFFUSE_AO: 1\r\n};\r\n\r\nexport { syncMapArr, syncUniformArr, pbrDefaultUniforms, bgDefaultUniforms, pbrDefaultDefines };\r\n","import * as THREE from 'three';\r\nimport { syncMapArr, syncUniformArr, pbrDefaultUniforms, pbrDefaultDefines } from './const/defaultParams';\r\n\r\nexport class PBRMaterial extends THREE.ShaderMaterial {\r\n\tconstructor(mesh, environment, shaderData) {\r\n\t\tlet sourceMaterial = mesh.material;\r\n\t\tsuper();\r\n\t\tthis.copy(sourceMaterial);\r\n\r\n\t\tthis.defines = Object.assign({}, pbrDefaultDefines);\r\n\t\t// Tips: USE_TANGENT rely on (vertexTangents && normalMap) in threejs. But gltf spec only rely vertexTangents\r\n\t\t// if(this.vertexTangents) this.defines.USE_TANGENT = 1;\r\n\t\t// Copy method no include normalMapType、vertexTangents\r\n\t\tthis.vertexTangents = sourceMaterial.vertexTangents;\r\n\t\tthis.normalMapType = sourceMaterial.normalMapType;\r\n\r\n\t\t// Uniforms\r\n\t\tlet UniformsLib = THREE.UniformsLib;\r\n\t\tthis.uniforms = THREE.UniformsUtils.merge([\r\n\t\t\tUniformsLib.common,\r\n\t\t\tUniformsLib.normalmap,\r\n\t\t\tUniformsLib.lightmap,\r\n\t\t\tUniformsLib.bumpmap,\r\n\t\t\tUniformsLib.roughnessmap,\r\n\t\t\tUniformsLib.metalnessmap,\r\n\t\t\tUniformsLib.aomap,\r\n\t\t\tUniformsLib.emissivemap,\r\n\t\t\tUniformsLib.displacementmap,\r\n\t\t\tUniformsLib.envmap,\r\n\t\t\tUniformsLib.fog,\r\n\t\t\tUniformsLib.lights,\r\n\t\t\tpbrDefaultUniforms\r\n\t\t]);\r\n\t\tthis.syncEnvSetting(environment);\r\n\r\n\t\t// PBR param sync\r\n\t\tthis.syncParam(sourceMaterial);\r\n\r\n\t\tthis.vertexShader = shaderData.pbrVS;\r\n\t\tthis.fragmentShader = shaderData.pbrFS;\r\n\t\tthis.lights = true;\r\n\r\n\t\t// Other\r\n\t\tif (sourceMaterial.isGLTFSpecularGlossinessMaterial === true) this.initSGWorkflow(sourceMaterial);\r\n\r\n\t\t// Extensions\r\n\t\tthis.extensions = {\r\n\t\t\tderivatives: true,\r\n\t\t\tshaderTextureLOD: true\r\n\t\t};\r\n\t\tthis.needsUpdate = true;\r\n\t}\r\n\r\n\tsyncEnvSetting(environment) {\r\n\t\tlet {\r\n\t\t\tmapEnv,\r\n\t\t\tuEnvironmentSphericalHarmonics,\r\n\t\t\tuEnvironmentLodRange,\r\n\t\t\tuEnvironmentSize,\r\n\t\t\ttextureLODSupport\r\n\t\t} = environment;\r\n\t\tif (textureLODSupport) {\r\n\t\t\t// CubeMap\r\n\t\t\tthis.defines[`CUBEMAP_LOD`] = 1;\r\n\t\t} else {\r\n\t\t\t// Panorama\r\n\t\t\tthis.defines[`PANORAMA`] = 1;\r\n\t\t}\r\n\t\t// Common\r\n\t\tthis.envMap = mapEnv.texture;\r\n\t\tthis.uniforms['envMap'] = { value: mapEnv.texture };\r\n\t\tthis.uniforms['uEnvironmentSphericalHarmonics'] = { value: uEnvironmentSphericalHarmonics };\r\n\t\tthis.uniforms['uEnvironmentLodRange'] = { value: uEnvironmentLodRange };\r\n\t\tthis.uniforms['uEnvironmentSize'] = { value: uEnvironmentSize };\r\n\t\tthis.uniforms['uIntegrateBRDF'] = { value: environment.uIntegrateBRDF };\r\n\t\t// Mobile\r\n\t\tif (environment.isMobile) this.defines[`MOBILE`] = 1;\r\n\t}\r\n\r\n\tsyncParam(sourceMaterial) {\r\n\t\t// Map sync\r\n\t\tsyncMapArr.forEach(key => {\r\n\t\t\tif (sourceMaterial[key] != undefined) {\r\n\t\t\t\tthis[key] = sourceMaterial[key];\r\n\t\t\t\tthis.uniforms[key].value = sourceMaterial[key];\r\n\t\t\t}\r\n\t\t});\r\n\t\t// Uniform sync\r\n\t\tsyncUniformArr.forEach(key => {\r\n\t\t\tif (sourceMaterial[key] != undefined) {\r\n\t\t\t\tthis.uniforms[key].value = sourceMaterial[key];\r\n\t\t\t}\r\n\t\t});\r\n\t\t// Special key\r\n\t\tthis.uniforms.diffuse.value = sourceMaterial.color || new THREE.Color(0xffffff);\r\n\t}\r\n\r\n\tinitSGWorkflow(sourceMaterial) {\r\n\t\tthis.defines[`SPECULAR_GLOSSINESS`] = 1;\r\n\t\tlet { specular, glossiness, specularMap, glossinessMap } = sourceMaterial._extraUniforms;\r\n\t\tif (specularMap.value) {\r\n\t\t\tthis.defines[`USE_SPECULARMAP`] = 1;\r\n\t\t\tthis.uniforms[`specularMap`] = specularMap;\r\n\t\t}\r\n\t\tif (glossinessMap.value) {\r\n\t\t\tthis.defines[`USE_GLOSSINESSMAP`] = 1;\r\n\t\t\tthis.uniforms[`glossinessMap`] = glossinessMap;\r\n\t\t}\r\n\t\tthis.uniforms[`specularFactor`] = specular;\r\n\t\tthis.uniforms[`glossinessFactor`] = glossiness;\r\n\t}\r\n}\r\n","export default \"#define GLSLIFY 1\\nvec3 computeDiffuseSPH(vec3 normal, vec3 sphericalHarmonics[9]){\\n    float x = normal.x;\\n    float y = normal.y;\\n    float z = normal.z;\\n    vec3 result = (\\n        sphericalHarmonics[0] +\\n        sphericalHarmonics[1] * y +\\n        sphericalHarmonics[2] * z +\\n        sphericalHarmonics[3] * x +\\n        sphericalHarmonics[4] * y * x +\\n        sphericalHarmonics[5] * y * z +\\n        sphericalHarmonics[6] * (3.0 * z * z - 1.0) +\\n        sphericalHarmonics[7] * (z * x) +\\n        sphericalHarmonics[8] * (x*x - y*y)\\n    );\\n    return max(result, vec3(0.0));\\n}\";","export default \"#define GLSLIFY 1\\n// https://www.unrealengine.com/blog/physically-based-shading-on-mobile\\nvec3 integrateBRDF(vec3 specular, float roughness, float NoV) {\\n    const vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\\n    const vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\\n    vec4 r = roughness * c0 + c1;\\n    float a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\\n    vec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\\n    return specular * AB.x + AB.y * 1.0;\\n}\";","export default \"#define GLSLIFY 1\\n// For y up\\nvec2 normalToPanoramaUV(vec3 dir){\\n    float n = length(dir.xz);\\n\\n    // to avoid bleeding the max(-1.0,dir.x / n) is needed\\n    vec2 pos = vec2( (n>0.0000001) ? max(-1.0,dir.x / n) : 0.0, dir.y);\\n\\n    // fix edge bleeding\\n    if ( pos.x > 0.0 ) pos.x = min( 0.999999, pos.x );\\n\\n    pos = acos(pos)*0.31830988618; // RECIPROCAL_PI\\n\\n    pos.x = (dir.z > 0.0) ? pos.x*0.5 : 1.0-(pos.x*0.5);\\n\\n    // shift u to center the panorama to -z\\n    pos.x = mod(pos.x-0.25+1.0, 1.0 );\\n    pos.y = 1.0-pos.y;\\n    return pos;\\n}\\n\\nvec2 computeUVForMipmap(float level, vec2 uv, float size, float maxLOD){\\n    // width for level\\n    float widthForLevel = exp2( maxLOD-level);\\n\\n    // the height locally for the level in pixel\\n    // to opimitize a bit we scale down the v by two in the inputs uv\\n    float heightForLevel = widthForLevel * 0.5;\\n\\n    // compact version\\n    float texelSize = 1.0/size;\\n    vec2 uvSpaceLocal =  vec2(1.0) + uv * vec2(widthForLevel - 2.0, heightForLevel - 2.0);\\n    uvSpaceLocal.y += size - widthForLevel;\\n    return uvSpaceLocal * texelSize;\\n}\\n\\nvec4 texturePanoramaLod(sampler2D tex, vec2 size , vec3 direction, float lod, float maxLOD){\\n    vec2 uvBase = normalToPanoramaUV(direction);\\n    // we scale down v here because it avoid to do twice in sub functions\\n    // uvBase.y *= 0.5;\\n    float lod0 = floor(lod);\\n    vec2 uv0 = computeUVForMipmap(lod0, uvBase, size.x, maxLOD);\\n    vec4 texel0 = texture2D(tex, uv0.xy);\\n\\n    float lod1 = ceil(lod);\\n    vec2 uv1 = computeUVForMipmap(lod1, uvBase, size.x, maxLOD);\\n    vec4 texel1 = texture2D(tex, uv0.xy);\\n\\n    return mix(texel0, texel1, fract(lod));\\n}\";","export default \"#define GLSLIFY 1\\nvec3 precomputeLight(vec3 normal, vec3 viewDir, float perceptualRoughness){\\n    // perceptually linear roughness to roughness\\n    float roughness = perceptualRoughness * perceptualRoughness;\\n    float NoV =  saturate(dot(normal, viewDir));\\n    return vec3(roughness, roughness * roughness, NoV);\\n}\";","export default \"#define GLSLIFY 1\\n// Refer: UE4\\n\\n// ************************ Normal Distribution Functions(NDF) **************************\\n\\n// [Blinn 1977, \\\"Models of light reflection for computer synthesized pictures\\\"]\\nfloat D_Blinn(vec3 precomputeLight, float NoH){\\n    float a2 = precomputeLight.y;\\n    float n = 2.0 / a2 - 2.0;\\n    return (n+2.0) / (2.0* PI) * pow(NoH, n);   // 1 mad, 1 exp, 1 mul, 1 log\\n}\\n\\n// [Beckmann 1963, \\\"The scattering of electromagnetic waves from rough surfaces\\\"]\\nfloat D_Beckmann(vec3 precomputeLight, float NoH){\\n    float a2 = precomputeLight.y;\\n    float NoH2 = NoH * NoH;\\n    return exp( (NoH2 - 1.0) / (a2 * NoH2) ) / ( PI * a2 * NoH2 * NoH2 );\\n}\\n\\n// GGX / Trowbridge-Reitz\\n// [Walter et al. 2007, \\\"Microfacet models for refraction through rough surfaces\\\"]\\nfloat D_GGX(vec3 precomputeLight, float NoH){\\n    float a2 = precomputeLight.y;\\n    float d = (NoH * a2 - NoH) * NoH + 1.0;\\t// 2 mad\\n    return a2 / (PI * d * d);\\t// 4 mul, 1 rcp\\n}\\n\\nfloat D_GGX(float rougness, float NoH){\\n    float a2 = rougness * rougness;\\n    float d = (NoH * a2 - NoH) * NoH + 1.0;\\t// 2 mad\\n    return a2 / (PI * d * d);\\t// 4 mul, 1 rcp\\n}\\n\\nfloat Specular_D(vec3 precomputeLight, float NoH){\\n#if defined(NDF_BLINNPHONG)\\n    return D_Blinn(precomputeLight, NoH);\\n#elif defined(NDF_BECKMANN)\\n    return D_Beckmann(precomputeLight, NoH);\\n#elif defined(NDF_GGX)\\n    return D_GGX(precomputeLight, NoH);\\n#else\\n    return D_GGX(precomputeLight, NoH);\\n#endif\\n}\\n\\n// ************************************ Fresnel ************************************\\n\\n// [Schlick 1994, \\\"An Inexpensive BRDF Model for Physically-Based Rendering\\\"]\\nvec3 F_Schlick(float VoH, vec3 f0, float f90){\\n    return f0 + (vec3(f90) - f0) * pow5(1.0 - VoH);\\n}\\n\\nfloat F_Schlick(float VoH, float f0, float f90) {\\n    return f0 + (f90 - f0) * pow5(1.0 - VoH);\\n}\\n\\n// [Cook-Torrance 1982]\\nvec3 F_CookTorrance(float VoH, vec3 f0, float f90){\\n    vec3 sqrtSpec = sqrt(f0);\\n    vec3 n = (1.0 + sqrtSpec) / (1.0 - sqrtSpec);\\n    float c = saturate(VoH);\\n    vec3 g = sqrt(n * n + c * c - 1.0);\\n\\n    vec3 part1 = (g - c)/(g + c);\\n    vec3 part2 = ((g + c) * c - 1.0)/((g - c) * c + 1.0);\\n\\n    return max(vec3(0.0), 0.5 * part1 * part1 * (1.0 + part2 * part2));\\n}\\n\\nvec3 F_None(vec3 f0){\\n    return f0;\\n}\\n\\nvec3 Specular_F(float VoH, vec3 f0, float f90) {\\n#if defined(F_SCHLICK)\\n    return F_Schlick(VoH, f0, f90);\\n#elif defined(F_COOKTORRANCE)\\n    return F_CookTorrance(VoH, f0, f90);\\n#else // FRESNSEL_NONE\\n    return F_None(f0);\\n#endif\\n}\\n\\n// ******************************** Visibility Term *********************************\\nfloat Vis_Implicit(){\\n\\treturn 0.25;\\n}\\n\\n// [Neumann et al. 1999, \\\"Compact metallic reflectance models\\\"]\\nfloat Vis_Neumann(vec3 precomputeLight, float NoL){\\n\\tfloat NoV = precomputeLight.z;\\n\\treturn 1. / (4. * max(NoL, NoV));\\n}\\n\\n// [Kelemen 2001, \\\"A microfacet based coupled specular-matte brdf model with importance sampling\\\"]\\nfloat Vis_Kelemen(float VoH){\\n\\t// constant to prevent NaN\\n\\treturn 1./(4. * VoH * VoH + 1e-5);\\n}\\n\\n// Tuned to match behavior of Vis_Smith\\n// [Schlick 1994, \\\"An Inexpensive BRDF Model for Physically-Based Rendering\\\"]\\nfloat Vis_Schlick(vec3 precomputeLight, float NoL){\\n\\tfloat a2 = precomputeLight.y;\\n\\tfloat NoV = precomputeLight.z;\\n\\tfloat k = sqrt(a2) * 0.5;\\n\\tfloat Vis_SchlickV = NoV * (1. - k) + k;\\n\\tfloat Vis_SchlickL = NoL * (1. - k) + k;\\n\\treturn 0.25 / (Vis_SchlickV * Vis_SchlickL);\\n}\\n\\n// Smith term for GGX\\n// [Smith 1967, \\\"Geometrical shadowing of a random rough surface\\\"]\\nfloat Vis_Smith(vec3 precomputeLight, float NoL){\\n\\tfloat a2 = precomputeLight.y;\\n\\tfloat NoV = precomputeLight.z;\\n\\tfloat Vis_SmithV = NoV + sqrt(NoV * (NoV - NoV * a2) + a2);\\n\\tfloat Vis_SmithL = NoL + sqrt(NoL * (NoL - NoL * a2) + a2);\\n\\treturn 1./(Vis_SmithV * Vis_SmithL);\\n}\\n\\n// Appoximation of joint Smith term for GGX\\n// [Heitz 2014, \\\"Understanding the Masking-Shadowing Function in Microfacet-Based BRDFs\\\"]\\nfloat Vis_SmithJointApprox(vec3 precomputeLight, float NoL){\\n    float roughness = precomputeLight.x;\\n    float NoV = precomputeLight.z;\\n    float Vis_SmithV = NoL * (NoV * (1.0 - roughness) + roughness);\\n    float Vis_SmithL = NoV * (NoL * (1.0 - roughness) + roughness);\\n    return 0.5 / (Vis_SmithV + Vis_SmithL);\\n}\\n\\n// Hammon 2017, \\\"PBR Diffuse Lighting for GGX+Smith Microsurfaces\\\"\\nfloat Vis_SmithJointApprox_Hammon(vec3 precomputeLight, float NoL) {\\n    float roughness = precomputeLight.x;\\n    float NoV = precomputeLight.z;\\n\\n    float v = 0.5 / mix(2.0 * NoL * NoV, NoL + NoV, roughness);\\n    return v;\\n}\\n\\nfloat Specular_V(vec3 precomputeLight, float NoL, float VoH){\\n#if defined(V_IMPLICIT)\\n    return Vis_Implicit();\\n#elif defined(V_NEUMANN)\\n    return Vis_Neumann(precomputeLight, NoL);\\n#elif defined(V_KELEMEN)\\n    return Vis_Kelemen(VoH);\\n#elif defined(V_SCHLICK)\\n    return Vis_Schlick(precomputeLight, NoL);\\n#elif defined(V_SMITH)\\n    return Vis_Smith(precomputeLight, NoL);\\n#elif defined(V_SMITHJOINTAPPROX)\\n    return Vis_SmithJointApprox(precomputeLight, NoL);\\n#elif defined(V_HAMMONAPPROX)\\n    return Vis_SmithJointApprox_Hammon(precomputeLight, NoL);\\n#else\\n\\treturn 0.25;\\n#endif\\n}\\n\\nvec3 specularLobe(vec3 precomputeLight, vec3 specular, float NoL, float NoH, float VoH, float f90) {\\n    float D = Specular_D(precomputeLight, NoH);\\n    vec3 F = Specular_F(VoH, specular, f90);\\n    float V = Specular_V(precomputeLight, NoL, VoH);\\n\\t\\n    return (D * V) * F;\\n}\\n\\n// ************************************ Diffuse ************************************\\nvec3 Diffuse_Lambert(vec3 diffuse){\\n\\treturn diffuse / PI;\\n}\\n\\n// [Burley 2012, \\\"Physically-Based Shading at Disney\\\"]\\nvec3 Diffuse_Burley(vec3 precomputeLight, vec3 diffuse, float NoL, float VoH){\\n    float Roughness = precomputeLight.x;\\n    float NoV =  precomputeLight.z;\\n\\n\\tfloat FD90 = 0.5 + 2. * VoH * VoH * Roughness;\\n\\tfloat FdV = 1. + (FD90 - 1.) * pow5(1. - NoV);\\n\\tfloat FdL = 1. + (FD90 - 1.) * pow5(1. - NoL);\\n\\treturn diffuse * ((1. / PI) * FdV * FdL);\\n}\\n\\n// [Gotanda 2012, \\\"Beyond a Simple Physically Based Blinn-Phong Model in Real-Time\\\"]\\nvec3 Diffuse_OrenNayar(vec3 precomputeLight, vec3 diffuse, float NoL, float VoH){\\n    float Roughness = precomputeLight.x;\\n\\tfloat a = precomputeLight.y;\\n    float NoV = precomputeLight.z;\\n\\tfloat s = a; // / ( 1.29 + 0.5 * a );\\n\\tfloat s2 = s * s;\\n\\tfloat VoL = 2. * VoH * VoH - 1.;  // double angle identity\\n\\tfloat Cosri = VoL - NoV * NoL;\\n\\tfloat C1 = 1. - 0.5 * s2 / (s2 + 0.33);\\n\\tfloat C2 = 0.45 * s2 / (s2 + 0.09) * Cosri * (Cosri >= 0. ? 1./(max(NoL, NoV)) : 1.);\\n\\treturn diffuse / PI * (C1 + C2) * (1. + Roughness * 0.5);\\n}\\n\\n// [Gotanda 2014, \\\"Designing Reflectance Models for New Consoles\\\"]\\nvec3 Diffuse_Gotanda(vec3 precomputeLight, vec3 diffuse, float NoL, float VoH){\\n    float Roughness = precomputeLight.x;\\n\\tfloat a = precomputeLight.y;\\n    float NoV = precomputeLight.z;\\n\\tfloat a2 = a * a;\\n\\tfloat F0 = 0.04;\\n\\tfloat VoL = 2. * VoH * VoH - 1.;    // double angle identity\\n\\tfloat Cosri = VoL - NoV * NoL;\\n\\n\\tfloat a2_13 = a2 + 1.36053;\\n\\tfloat Fr = ( 1. - ( 0.542026*a2 + 0.303573*a ) / a2_13 ) * ( 1. - pow( 1. - NoV, 5. - 4.*a2 ) / a2_13 ) * ( ( -0.733996*a2*a + 1.50912*a2 - 1.16402*a ) * pow( 1. - NoV, 1. + 1./(39.*a2*a2+1.) ) + 1. );\\n\\tfloat Lm = ( max( 1. - 2.*a, 0. ) * ( 1. - pow5( 1. - NoL ) ) + min( 2.*a, 1. ) ) * ( 1. - 0.5*a * (NoL - 1.) ) * NoL;\\n\\tfloat Vd = ( a2 / ( (a2 + 0.09) * (1.31072 + 0.995584 * NoV) ) ) * ( 1. - pow( 1. - NoL, ( 1. - 0.3726732 * NoV * NoV ) / ( 0.188566 + 0.38841 * NoV ) ) );\\n\\tfloat Bp = Cosri < 0. ? 1.4 * NoV * NoL * Cosri : Cosri;\\n\\tfloat Lr = (21.0 / 20.0) * (1. - F0) * ( Fr * Lm + Vd + Bp );\\n\\treturn diffuse / PI * Lr;\\n}\\n\\nvec3 diffuseLobe(vec3 precomputeLight, vec3 diffuse, float NoL, float VoH){\\n#if defined(DIFFUSE_LAMBERT)\\n    return Diffuse_Lambert(diffuse);\\n#elif defined(DIFFUSE_BURLEY)\\n    return Diffuse_Burley(precomputeLight, diffuse, NoL, VoH);\\n#elif defined(DIFFUSE_ORENNAYAR)\\n    return Diffuse_OrenNayar(precomputeLight, diffuse, NoL, VoH);\\n#elif defined(DIFFUSE_GOTANDA)\\n    return Diffuse_Gotanda(precomputeLight, diffuse, NoL, VoH);\\n#else // DIFFUSE_NONE\\n    return vec3(0.0);\\n#endif\\n}\\n\\nvoid surfaceShading(in vec3 normal, in vec3 viewDir, in float NoL, in vec3 precomputeLight, in vec3 diffuse, in vec3 specular, in float attenuation, in vec3 lightColor, in vec3 lightDir, in float f90, out vec3 diffuseOut, out vec3 specularOut, out bool lighted) {\\n    lighted = NoL > 0.0;\\n    if (!lighted) {\\n        specularOut = diffuseOut = vec3(0.0);\\n        return;\\n    }\\n    vec3 H = normalize(viewDir + lightDir);\\n    float NoH =  saturate(dot(normal, H));\\n    float VoH =  saturate(dot(viewDir, H));\\n\\t\\n    vec3 colorAttenuate = attenuation * NoL * lightColor;\\n    diffuseOut = colorAttenuate * diffuseLobe(precomputeLight, diffuse, NoL, VoH);\\n    specularOut = colorAttenuate * specularLobe(precomputeLight, specular, NoL, NoH, VoH, f90);\\n}\";","export default \"#define GLSLIFY 1\\n// Refer: Filament\\n// Anisotropy(GGX)\\n#if defined(USE_TANGENT) && defined(ENABLE_ANISOTROPY)\\nfloat D_GGX_Anisotropic(float at, float ab, float ToH, float BoH, float NoH) {\\n    // Burley 2012, \\\"Physically-Based Shading at Disney\\\"\\n\\n    // The values at and ab are perceptualRoughness^2, a2 is therefore perceptualRoughness^4\\n    // The dot product below computes perceptualRoughness^8. We cannot fit in fp16 without clamping\\n    // the roughness to too high values so we perform the dot product and the division in fp32\\n    float a2 = at * ab;\\n    vec3 v = vec3(ab * ToH, at * BoH, a2 * NoH);\\n    float v2 = dot(v, v);\\n    float w2 = a2 / v2;\\n    return a2 * w2 * w2 * (1.0 / PI);\\n}\\n\\nfloat V_SmithGGXCorrelated_Anisotropic(float at, float ab, float ToV, float BoV, float ToL, float BoL, float NoV, float NoL) {\\n    // Heitz 2014, \\\"Understanding the Masking-Shadowing Function in Microfacet-Based BRDFs\\\"\\n    // TODO: lambdaV can be pre-computed for all the lights, it should be moved out of this function\\n    float lambdaV = NoL * length(vec3(at * ToV, ab * BoV, NoV));\\n    float lambdaL = NoV * length(vec3(at * ToL, ab * BoL, NoL));\\n    float v = 0.5 / (lambdaV + lambdaL);\\n    return v;\\n}\\n\\nvec3 anisotropicLobe(vec3 precomputeGGX, vec3 H, vec3 viewDir, vec3 lightDir, float NoH, float VoH, float NoL, vec3 specular, float f90, in vec3 anisotropicT, in vec3 anisotropicB, in float anisotropy) {\\n    float roughness = precomputeGGX.x;\\n    float NoV =  precomputeGGX.z;\\n\\n    float ToV = dot(anisotropicT, viewDir);\\n    float BoV = dot(anisotropicB, viewDir);\\n    float ToL = dot(anisotropicT, lightDir);\\n    float BoL = dot(anisotropicB, lightDir);\\n    float ToH = dot(anisotropicT, H);\\n    float BoH = dot(anisotropicB, H);\\n\\n    // Anisotropic parameters: at and ab are the roughness along the tangent and bitangent\\n    // to simplify materials, we derive them from a single roughness parameter\\n    // Kulla 2017, \\\"Revisiting Physically Based Shading at Imageworks\\\"\\n    float at = max(roughness * (1.0 + anisotropy), MIN_ROUGHNESS);\\n    float ab = max(roughness * (1.0 - anisotropy), MIN_ROUGHNESS);\\n\\n    // Specular anisotropic BRDF\\n    float D = D_GGX_Anisotropic(at, ab, ToH, BoH, NoH);\\n    float V = V_SmithGGXCorrelated_Anisotropic(at, ab, ToV, BoV, ToL, BoL, NoV, NoL);\\n    vec3 F = Specular_F(VoH, specular, f90);\\n\\n    return (D * V) * F;\\n}\\n\\nvoid anisotropicSurfaceShading(vec3 normal, vec3 viewDir, float NoL, vec3 precomputeLight, vec3 diffuse, vec3 specular, float attenuation, vec3 lightColor, vec3 lightDir, float f90, vec3 anisotropicT, vec3 anisotropicB, float anisotropy, out vec3 diffuseOut, out vec3 specularOut, out bool lighted) {\\n    lighted = NoL > 0.0;\\n    if (!lighted) {\\n        specularOut = diffuseOut = vec3(0.0);\\n        return;\\n    }\\n    vec3 H = normalize(viewDir + lightDir);\\n    float NoH =  saturate(dot(normal, H));\\n    float VoH =  saturate(dot(viewDir, H));\\n\\n    vec3 colorAttenuate = attenuation * NoL * lightColor;\\n    diffuseOut = colorAttenuate * diffuseLobe(precomputeLight, diffuse, NoL, VoH);\\n    specularOut = colorAttenuate * anisotropicLobe(precomputeLight, H, viewDir, lightDir, NoH, VoH, NoL, specular, f90, anisotropicT, anisotropicB, anisotropy);\\n}\\n#endif\";","export default \"#define GLSLIFY 1\\nfloat pow5(float x) {\\n\\tfloat xx = x * x;\\n\\treturn xx * xx * x;\\n}\\n\\n// http://www.neilmendoza.com/glsl-rotation-about-an-arbitrary-axis/\\nmat3 rotationMatrix3(vec3 axis, float angle) {\\n\\taxis = normalize(axis);\\n\\tfloat s = sin(angle);\\n\\tfloat c = cos(angle);\\n\\tfloat oc = 1.0 - c;\\n\\treturn mat3(oc * axis.x * axis.x + c,\\n                oc * axis.x * axis.y - axis.z * s,\\n                oc * axis.z * axis.x + axis.y * s,\\n\\t\\t\\t\\toc * axis.x * axis.y + axis.z * s,\\n                oc * axis.y * axis.y + c,\\n                oc * axis.y * axis.z - axis.x * s,\\n                oc * axis.z * axis.x - axis.y * s,\\n                oc * axis.y * axis.z + axis.x * s,\\n                oc * axis.z * axis.z + c);\\n}\";","export default \"#define GLSLIFY 1\\n// Shadow\\nuniform bool receiveShadow;\\n#ifdef USE_SHADOWMAP\\n\\t#if NUM_DIR_LIGHT_SHADOWS > 0\\n        struct DirectionalLightShadow {\\n\\t\\t\\tfloat shadowBias;\\n\\t\\t\\tfloat shadowRadius;\\n\\t\\t\\tvec2 shadowMapSize;\\n\\t\\t};\\n        uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\\n        \\n\\t\\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\\n\\t\\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\\n\\t#endif\\n\\t\\n\\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare, float shadowDistance) {\\n        vec2 centroidCoord = uv / size;\\n        centroidCoord = centroidCoord + 0.5;\\n        vec2 f = fract(centroidCoord);\\n\\n\\t\\tvec2 texelSize = vec2( 1.0 ) / size;\\n\\t\\tvec2 centroidUV = ( floor( uv * size - 0.5 ) + 0.5 ) * texelSize;\\n\\n        vec4 fetches;\\n        const vec2 offset = vec2( 0.0, 1.0 );\\n        fetches.x = compare - unpackRGBAToDepth( texture2D( depths, centroidUV + texelSize * offset.xx ));\\n        fetches.y = compare - unpackRGBAToDepth( texture2D( depths, centroidUV + texelSize * offset.xy ));\\n        fetches.z = compare - unpackRGBAToDepth( texture2D( depths, centroidUV + texelSize * offset.yx ));\\n        fetches.w = compare - unpackRGBAToDepth( texture2D( depths, centroidUV + texelSize * offset.yy ));\\n\\n        // Shadow distance\\n        float _a = mix(fetches.x, fetches.y, f.y);\\n        float _b = mix(fetches.z, fetches.w, f.y);\\n        shadowDistance = mix(_a, _b, f.x);\\n\\n\\t\\tvec4 st = step(fetches, vec4(0.0));\\n\\n        float a = mix(st.x, st.y, f.y);\\n        float b = mix(st.z, st.w, f.y);\\n        return mix(a, b, f.x);\\n\\t}\\n\\n\\tfloat getShadow(bool lighted, sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, out float shadowDistance ) {\\n        bool earlyOut = false;\\n        float shadow = 1.0;\\n\\n        if (!lighted){\\n            shadow = 0.0;\\n            earlyOut = true;\\n        }\\n\\n        if(uShadowDepthRange.x == uShadowDepthRange.y){\\n            earlyOut = true;\\n        }\\n\\n        if (!earlyOut) {\\n            shadowCoord.xyz /= shadowCoord.w;\\n            shadowCoord.z += shadowBias;\\n            // if ( something && something ) breaks ATI OpenGL shader compiler\\n            // if ( all( something, something ) ) using this instead\\n            bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\\n            bool inFrustum = all( inFrustumVec );\\n            bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\\n            bool frustumTest = all( frustumTestVec );\\n            if ( frustumTest ) {\\n                vec2 texelSize = vec2( 1.0 ) / shadowMapSize;\\n                float res = texture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z, shadowDistance);\\n                shadow = res;\\n            }\\n        }\\n\\t\\treturn shadow;\\n\\t}\\n#endif\";","export default \"#define GLSLIFY 1\\n// Light\\n// DirectionalLight\\n#if NUM_DIR_LIGHTS > 0\\n\\tstruct DirectionalLight {\\n\\t\\tvec3 direction;\\n\\t\\tvec3 color;\\n\\t\\tbool visible;\\n\\t};\\n\\n\\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\\n\\n    void precomputeDirect(vec3 normal, vec3 viewDir, inout DirectionalLight directionalLight, out float attenuation, out vec3 lightDir, out float NoL) {\\n        attenuation = 1.0;\\n        lightDir = directionalLight.direction;\\n        NoL = dot(normal, lightDir);\\n\\t\\tdirectionalLight.visible = true;\\n    }\\n#endif\\n// Todo: Spot/Point Light\";","export default \"#define GLSLIFY 1\\n#preImport <isotropyLightCompute>\\n#preImport <anisotropyLightCompute>\";","export default \"#define GLSLIFY 1\\n// IBL\\n#preImport <precomputeLight>\\n#preImport <computeDiffuseSPH>\\n\\n#ifdef PANORAMA\\n    #preImport <panoramaSampler>\\n#endif\\n\\nvec3 integrateBRDF(vec3 materialSpecular, float roughness, float NoV) {\\n    vec4 rgba = texture2D(uIntegrateBRDF, vec2(NoV, roughness));\\n    float a = (rgba[1] * 65280.0 + rgba[0] * 255.0) / 65535.0;\\n    float b = (rgba[3] * 65280.0 + rgba[2] * 255.0) / 65535.0;\\n    return (1.-materialSpecular) * a + materialSpecular * b;\\n}\\n\\n// frostbite, lagarde paper p67\\n// http://www.frostbite.com/wp-content/uploads/2014/11/course_notes_moving_frostbite_to_pbr.pdf\\nfloat linRoughnessToMipmap(float roughnessLinear){\\n    return sqrt(roughnessLinear);\\n}\\n\\nvec3 prefilterEnvMap(float rLinear, vec3 R) {\\n    vec3 dir = R;\\n    float lod = linRoughnessToMipmap(rLinear) * uEnvironmentLodRange[1]; //(uEnvironmentMaxLod - 1.0);\\n    lod = min(uEnvironmentLodRange[0], lod);\\n#ifdef CUBEMAP_LOD\\n    // http://seblagarde.wordpress.com/2012/06/10/amd-cubemapgen-for-physically-based-rendering/\\n    float scale = 1.0 - exp2(lod) / uEnvironmentSize[0];\\n    vec3 absDir = abs(dir);\\n    float M = max(max(absDir.x, absDir.y), absDir.z);\\n    // cubemapSeamlessFixDirection\\n    if (absDir.x != M) dir.x *= scale;\\n    if (absDir.y != M) dir.y *= scale;\\n    if (absDir.z != M) dir.z *= scale;\\n\\treturn LogLuvToLinear(textureCubeLodEXT(envMap, dir, lod)).rgb;\\n#else\\n    return LogLuvToLinear(texturePanoramaLod(envMap, uEnvironmentSize, R, lod, uEnvironmentLodRange[0])).rgb;\\n\\t#endif\\n}\\n\\n// Anisotropic\\n#if defined(USE_TANGENT) && defined(ENABLE_ANISOTROPY)\\nvec3 computeAnisotropicBentNormal(vec3 normal, vec3 viewDir, float roughness, vec3 anisotropicT, vec3 anisotropicB, float anisotropy) {\\n    vec3 anisotropyDirection = anisotropy >= 0.0 ? anisotropicB : anisotropicT;\\n    vec3 anisotropicTangent = cross(anisotropyDirection, viewDir);\\n    vec3 anisotropicNormal = cross(anisotropicTangent, anisotropyDirection);\\n    float bendFactor = abs(anisotropy) * clamp(5.0 * roughness, 0.0, 1.0);\\n    vec3  bentNormal = normalize(mix(normal, anisotropicNormal, bendFactor));\\n    return bentNormal;\\n}\\n#endif\\n\\n// From Sebastien Lagarde Moving Frostbite to PBR page 69\\n// We have a better approximation of the off specular peak\\n// but due to the other approximations we found this one performs better.\\n// N is the normal direction\\n// R is the mirror vector\\n// This approximation works fine for G smith correlated and uncorrelated\\nvec3 getSpecularDominantDir(vec3 N, vec3 R, float realRoughness) {\\n    float smoothness = 1.0 - realRoughness;\\n    float lerpFactor = smoothness * (sqrt(smoothness) + realRoughness);\\n    return mix(N, R, lerpFactor);\\n}\\n\\nvec3 getPrefilteredEnvMapColor(vec3 normal, vec3 viewDir, float roughness) {\\n    vec3 R = reflect(-viewDir, normal);\\n    // From Sebastien Lagarde Moving Frostbite to PBR page 69\\n    vec3 dominantR = getSpecularDominantDir(normal, R, roughness * roughness);\\n    vec3 dir = uEnvironmentTransform * dominantR;\\n    vec3 prefilteredColor = prefilterEnvMap(roughness, dir);\\n\\n    return prefilteredColor;\\n}\\n\\nvec3 computeIBLSpecularUE4(vec3 specularDFG, vec3 normal, vec3 viewDir, float roughness) {\\n    return getPrefilteredEnvMapColor(normal, viewDir, roughness) * specularDFG;\\n}\";","export default \"#define GLSLIFY 1\\n // ClearCoat\\n#ifdef ENABLE_CLEARCOAT\\nvoid computeClearCoatIBL(float clearCoatNoV, vec3 clearCoatNormal, float clearCoatPerceptualRoughness, vec3 viewDir, float specularAO, inout vec3 Fd, inout vec3 Fr){\\n    // The clear coat layer assumes an IOR of 1.5 (4% reflectance)\\n    vec3 materialSpecular = vec3(0.04);\\n    float materialF90 = 1.0;\\n    float Fc = F_Schlick(clearCoatNoV, materialSpecular.x, materialF90) * uClearCoat;\\n    float attenuation = 1.0 - Fc;\\n    Fd *= attenuation;\\n    Fr *= attenuation;\\n\\n    vec3 specularDFG = integrateBRDF(materialSpecular, clearCoatPerceptualRoughness, clearCoatNoV);\\n    vec3 clearCoatLobe = computeIBLSpecularUE4(specularDFG, clearCoatNormal, viewDir, clearCoatPerceptualRoughness);\\n    Fr += clearCoatLobe * (specularAO * uClearCoat);\\n}\\n\\nfloat distributionClearCoat(float roughness, float NoH, const vec3 h) {\\n    return D_GGX(roughness, NoH);\\n}\\n\\nfloat visibilityClearCoat(float LoH) {\\n    return Vis_Kelemen(LoH);\\n}\\n\\nfloat clearCoatLobe(vec3 h, float clearCoatNoH, float clearCoatLoH, float clearCoatRoughness, out float Fcc){\\n    // clear coat specular lobe\\n    float D = distributionClearCoat(clearCoatRoughness, clearCoatNoH, h);\\n    float V = visibilityClearCoat(clearCoatLoH);\\n    float F = F_Schlick(clearCoatLoH, 0.04, 1.0) * uClearCoat; // fix IOR to 1.5\\n\\n    Fcc = F;\\n    return D * V * F;\\n}\\n#endif\";","export default \"#define GLSLIFY 1\\n#ifdef ENERGY_COMPENSATION\\nfloat getEnergyCompensation(vec3 dfg, float f0) {\\n   return 1.0 + f0 * (1.0 / dfg.y - 1.0);\\n}\\n#endif\\n\\n#ifdef SPECULAR_AO_MARMOSETCO\\n// http://marmosetco.tumblr.com/post/81245981087\\nfloat occlusionHorizon(float ao, vec3 normal, vec3 viewDir) {\\n    float d = dot(normal, viewDir) + ao;\\n    return clamp((d * d) - 1.0 + ao, 0.0, 1.0);\\n}\\n#endif\\n\\n#ifdef SPECULAR_AO_SEBLAGARDE\\n// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\\nfloat computeSpecularAO(float ao, vec3 precomputeLight) {\\n    float roughness = precomputeLight.x;\\n    float NoV =  precomputeLight.z;\\n    return clamp(pow(NoV + ao, exp2(-16.0 * roughness - 1.0)) - 1.0 + ao, 0.0, 1.0);\\n}\\n#endif\\n\\n/**\\n* Returns a color ambient occlusion based on a pre-computed visibility term.\\n* The albedo term is meant to be the diffuse color or f0 for the diffuse and\\n* specular terms respectively.\\n*/\\nvec3 gtaoMultiBounce(float visibility, const vec3 albedo) {\\n    // Jimenez et al. 2016, \\\"Practical Realtime Strategies for Accurate Indirect Occlusion\\\"\\n    vec3 a =  2.0404 * albedo - 0.3324;\\n    vec3 b = -4.7951 * albedo + 0.6417;\\n    vec3 c =  2.7552 * albedo + 0.6903;\\n\\n    return max(vec3(visibility), ((visibility * a + b) * visibility + c) * visibility);\\n}\\n#ifdef MS_DIFFUSE_AO\\nvoid multiBounceAO(float visibility, const vec3 albedo, inout vec3 color) {\\n    color *= gtaoMultiBounce(visibility, albedo);\\n}\\n#endif\\n\\n#ifdef MS_SPECULAR_AO\\nvoid multiBounceSpecularAO(float visibility, const vec3 albedo, inout vec3 color) {\\n    color *= gtaoMultiBounce(visibility, albedo);\\n}\\n#endif\\n\\n#ifdef GEOMETRIC_SPECULAR_AA\\nfloat normalFiltering(float perceptualRoughness, const vec3 geometricNormal) {\\n    // Kaplanyan 2016, \\\"Stable specular highlights\\\"\\n    // Tokuyoshi 2017, \\\"Error Reduction and Simplification for Shading Anti-Aliasing\\\"\\n    // Tokuyoshi and Kaplanyan 2019, \\\"Improved Geometric Specular Antialiasing\\\"\\n\\n    // This implementation is meant for deferred rendering in the original paper but\\n    // we use it in forward rendering as well (as discussed in Tokuyoshi and Kaplanyan\\n    // 2019). The main reason is that the forward version requires an expensive transform\\n    // of the half vector by the tangent frame for every light. This is therefore an\\n    // approximation but it works well enough for our needs and provides an improvement\\n    // over our original implementation based on Vlachos 2015, \\\"Advanced VR Rendering\\\".\\n\\n    vec3 du = dFdx(geometricNormal);\\n    vec3 dv = dFdy(geometricNormal);\\n\\n    float variance = uSpecularAAVariance * (dot(du, du) + dot(dv, dv));\\n\\n    float roughness = perceptualRoughness * perceptualRoughness;\\n    float kernelRoughness = min(2.0 * variance, uSpecularAAThreshold);\\n    float squareRoughness = saturate(roughness * roughness + kernelRoughness);\\n\\n    return sqrt(sqrt(squareRoughness));\\n}\\n#endif\";","import computeDiffuseSPH from './chunk/function/computeDiffuseSPH.glsl';\r\nimport integrateBRDFMobile from './chunk/function/integrateBRDFMobile.glsl';\r\nimport panoramaSampler from './chunk/function/panoramaSampler.glsl';\r\nimport precomputeLight from './chunk/function/precomputeLight.glsl';\r\nimport isotropyLightCompute from './chunk/function/isotropyLightCompute.glsl';\r\nimport anisotropyLightCompute from './chunk/function/anisotropyLightCompute.glsl';\r\n\r\nimport math from './chunk/math.glsl';\r\nimport shadow from './chunk/shadow.glsl';\r\nimport light from './chunk/light.glsl';\r\nimport brdf from './chunk/brdf.glsl';\r\nimport ibl from './chunk/ibl.glsl';\r\nimport clearCoat from './chunk/clearCoat.glsl';\r\nimport advance from './chunk/advance.glsl';\r\n\r\nexport default {\r\n\tcomputeDiffuseSPH,\r\n\tintegrateBRDFMobile,\r\n\tpanoramaSampler,\r\n\tprecomputeLight,\r\n\tisotropyLightCompute,\r\n\tanisotropyLightCompute,\r\n\r\n\tmath,\r\n\tshadow,\r\n\tlight,\r\n\tbrdf,\r\n\tibl,\r\n\tclearCoat,\r\n\tadvance\r\n};\r\n","export default \"#define GLSLIFY 1\\nuniform mat3 uModelNormalMatrix;\\nvarying vec3 vViewPosition;\\n\\nvarying vec3 vNormal;\\n\\n#ifdef USE_TANGENT\\n\\tvarying vec3 vTangent;\\n\\tvarying vec3 vBitangent;\\n#endif\\n\\n#include <uv_pars_vertex>\\n#include <uv2_pars_vertex>\\n#include <color_pars_vertex>\\n#include <morphtarget_pars_vertex>\\n#include <skinning_pars_vertex>\\n#include <logdepthbuf_pars_vertex>\\n#include <shadowmap_pars_vertex>\\n\\nvoid main(){\\n\\t#include <uv_vertex>\\n\\t#include <uv2_vertex>\\n    #include <color_vertex>\\n    #include <beginnormal_vertex>\\n\\t#include <morphnormal_vertex>\\n\\t#include <skinbase_vertex>\\n\\t#include <skinnormal_vertex>\\n\\t#include <defaultnormal_vertex>\\n\\n\\tvNormal = normalize(transformedNormal);\\n\\n\\t#ifdef USE_TANGENT\\n\\t\\tvTangent = normalize(transformedTangent);\\n\\t\\tvBitangent = normalize(cross(vNormal, vTangent) * tangent.w);\\n\\t#endif\\n\\n    #include <begin_vertex>\\n\\t#include <morphtarget_vertex>\\n\\t#include <skinning_vertex>\\n\\t#include <project_vertex>\\n\\n    vViewPosition = mvPosition.xyz;\\n\\n\\t#include <worldpos_vertex>\\n\\t#include <logdepthbuf_vertex>\\n\\t#include <shadowmap_vertex>\\n}\\n\";","export default \"#define GLSLIFY 1\\n// refer: \\n// https://github.com/cedricpinson/osgjs\\n// https://google.github.io/filament/Filament.html\\n\\nuniform mat3 uEnvironmentTransform;\\nuniform float uEnvBrightness;\\nuniform vec3 uEnvironmentSphericalHarmonics[9];\\nuniform sampler2D uIntegrateBRDF;\\n\\nconst float MIN_ROUGHNESS = 0.001;\\n\\nuniform vec3 diffuse;\\nuniform vec3 emissive;\\nuniform float roughness;\\nuniform float metalness;\\nuniform float opacity;\\n\\nvarying vec3 vViewPosition;\\n\\n#ifdef GEOMETRIC_SPECULAR_AA\\nuniform float uSpecularAAThreshold;\\nuniform float uSpecularAAVariance;\\n#endif\\n\\n// Anisotropy\\n#if defined(USE_TANGENT) && defined(ENABLE_ANISOTROPY)\\nuniform float uAnisotropyRotation;\\nuniform float uAnisotropyFactor;\\n#endif\\n\\n// ClearCoat\\n#ifdef ENABLE_CLEARCOAT\\nuniform float uClearCoat;\\nuniform float uClearCoatRoughness;\\n#endif\\n\\n#ifdef CUBEMAP_LOD\\nuniform samplerCube envMap;\\n#endif\\n#ifdef PANORAMA\\nuniform sampler2D envMap;\\n#endif\\nuniform vec2 uEnvironmentSize;\\nuniform vec2 uEnvironmentLodRange;\\n\\n#ifdef SPECULAR_GLOSSINESS\\n    uniform vec3 specularFactor;\\n    uniform float glossinessFactor;\\n    #ifdef USE_SPECULARMAP\\n\\t    uniform sampler2D specularMap;\\n    #endif\\n    #ifdef USE_GLOSSINESSMAP\\n\\t    uniform sampler2D glossinessMap;\\n    #endif\\n#endif\\n\\nvarying vec3 vNormal;\\n#ifdef USE_TANGENT\\n    varying vec3 vTangent;\\n    varying vec3 vBitangent;\\n#endif\\n\\n#include <common>\\n#include <uv_pars_fragment>\\n#include <uv2_pars_fragment>\\n#include <color_pars_fragment>\\n#include <normalmap_pars_fragment>\\n#include <map_pars_fragment>\\n#include <aomap_pars_fragment>\\n#include <emissivemap_pars_fragment>\\n#include <roughnessmap_pars_fragment>\\n#include <metalnessmap_pars_fragment>\\n#include <packing>\\n#include <logdepthbuf_pars_fragment>\\n\\n#preImport <math>\\n#preImport <light>\\n#preImport <ibl>\\n#preImport <brdf>\\n#preImport <advance>\\n#preImport <clearCoat>\\n\\nvoid main(){\\n    vec3 viewDir = -normalize(vViewPosition);\\n\\n    vec4 diffuseColor = vec4(diffuse, opacity);\\n    vec3 totalEmissiveRadiance = emissive;\\n    #include <logdepthbuf_fragment>\\n    #include <color_fragment>\\n    #include <normal_fragment_begin>\\n\\t#include <normal_fragment_maps>\\n    #include <map_fragment>\\n    #include <emissivemap_fragment>\\n\\n    float roughnessVal;\\n    #ifdef SPECULAR_GLOSSINESS\\n        roughnessVal = glossinessFactor;\\n        #ifdef USE_GLOSSINESSMAP\\n            roughnessVal = texture2D(glossinessMap, vUv).a * glossinessFactor;\\n        #endif\\n        roughnessVal = 1.0 - roughnessVal;\\n    #else\\n        #include <roughnessmap_fragment>\\n        roughnessVal = roughnessFactor;\\n    #endif\\n\\n    vec3 materialSpecular;\\n    vec3 materialDiffuse = diffuseColor.rgb;\\n    #ifdef SPECULAR_GLOSSINESS\\n        materialSpecular = specularFactor;\\n        #ifdef USE_SPECULARMAP\\n            materialSpecular = sRGBToLinear(texture2D(specularMap, vUv)).rgb * specularFactor;\\n        #endif\\n    #else\\n        #include <metalnessmap_fragment>\\n        float f0 = 0.04;\\n        materialSpecular = mix(vec3(f0), diffuseColor.rgb, metalnessFactor);\\n        // materialSpecular = 0.16 * reflectance * reflectance * (1.0 - metallic) + baseColor * metallic;\\n        materialDiffuse = diffuseColor.rgb * (1.0 - metalnessFactor);\\n    #endif\\n\\n    float materialF90 = 1.0;\\n    #ifndef MOBILE\\n    materialF90 = saturate(dot(materialSpecular, vec3(50.0 * 0.33)));\\n    // cheap luminance approximation\\n    // materialF90 = saturate(50.0 * materialSpecular.g);\\n    #endif\\n\\n    // Roughness\\n    float materialRoughness = clamp(roughnessVal, MIN_ROUGHNESS, 1.0);\\n    #ifdef GEOMETRIC_SPECULAR_AA\\n    materialRoughness = normalFiltering(materialRoughness, geometryNormal);\\n    #endif\\n\\n    vec3 prepCompute = precomputeLight(normal, viewDir, max(0.045, materialRoughness));\\n\\n    // Anisotropy\\n    vec3 bentAnisotropicNormal = normal;\\n    #if defined(USE_TANGENT) && defined(ENABLE_ANISOTROPY)\\n        float anisotropy = uAnisotropyFactor;\\n        vec3 anisotropicT = normalize(vTangent.xyz);\\n        vec3 anisotropicB = normalize(vBitangent.xyz);\\n        // Change direction\\n        mat3 anisotropyRotationMatrix = rotationMatrix3(normal, uAnisotropyRotation);\\n        anisotropicB *= anisotropyRotationMatrix;\\n        anisotropicT *= anisotropyRotationMatrix;\\n        bentAnisotropicNormal = computeAnisotropicBentNormal(normal, viewDir, materialRoughness, anisotropicT, anisotropicB, anisotropy);\\n\\t#endif\\n\\n    // IBL\\n    float NoV = dot(bentAnisotropicNormal, viewDir);\\n    vec3 transformedNormal = uEnvironmentTransform * bentAnisotropicNormal;\\n    vec3 diffuseIBL = materialDiffuse * computeDiffuseSPH(transformedNormal, uEnvironmentSphericalHarmonics);\\n    vec3 specularDFG = integrateBRDF(materialSpecular, materialRoughness, NoV);\\n    vec3 specularIBL = computeIBLSpecularUE4(specularDFG, bentAnisotropicNormal, viewDir, materialRoughness);\\n    \\n    // Diffuse AO\\n    float materialAO = 1.0;\\n    #ifdef USE_AOMAP\\n\\tmaterialAO = (texture2D(aoMap, vUv2).r - 1.0) * aoMapIntensity + 1.0;\\n    #endif\\n    #ifdef MS_DIFFUSE_AO\\n    multiBounceAO(materialAO, materialDiffuse, diffuseIBL);\\n    #else\\n    diffuseIBL *= materialAO;\\n    #endif\\n    diffuseIBL *= uEnvBrightness;\\n    \\n    // Specular AO\\n    float specularAO = 1.0;\\n    #ifdef SPECULAR_AO_SEBLAGARDE\\n    specularAO = computeSpecularAO(materialAO, prepCompute);\\n    #elif defined(SPECULAR_AO_MARMOSETCO)\\n    specularAO = occlusionHorizon(materialAO, normal, viewDir);\\n    #endif\\n    float energyCompensation = 1.0;\\n    #ifdef ENERGY_COMPENSATION\\n    energyCompensation = getEnergyCompensation(specularDFG, materialSpecular.g);\\n    #endif\\n    #ifdef MS_SPECULAR_AO\\n    multiBounceSpecularAO(materialAO, materialSpecular, specularIBL);\\n    #endif\\n\\n    specularIBL *= uEnvBrightness * specularAO * energyCompensation;\\n\\n    // ClearCoat IBL\\n    #ifdef ENABLE_CLEARCOAT\\n    // Todo: ClearCoat normalMap\\n    // Use the geometric normal for the clear coat layer\\n    float clearCoatNoV = prepCompute.z;\\n    vec3 clearCoatNormal = geometryNormal;\\n    float clearCoatPerceptualRoughness = clamp(uClearCoatRoughness, MIN_ROUGHNESS, 1.0);\\n    #ifdef GEOMETRIC_SPECULAR_AA\\n    clearCoatPerceptualRoughness = normalFiltering(materialRoughness, geometryNormal);\\n    #endif\\n    float clearCoatRoughness = clearCoatPerceptualRoughness * clearCoatPerceptualRoughness;\\n    computeClearCoatIBL(clearCoatNoV, clearCoatNormal, clearCoatPerceptualRoughness, viewDir, specularAO, diffuseIBL, specularIBL);\\n    #endif\\n\\n    // Light\\n    float attenuation, NoL;\\n    vec3 lightDir;\\n    vec3 lightSpecular;\\n    vec3 lightDiffuse;\\n    vec3 resultLightSpecular;\\n    vec3 resultLightDiffuse;\\n    float resultLightClearCoat = 0.;\\n    bool lighted;\\n    float shadow = 1.0;\\n    float shadowDistance;\\n\\n    #if NUM_DIR_LIGHTS > 0\\n        DirectionalLight directionalLight;\\n        #if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\\n        DirectionalLightShadow directionalLightShadow;\\n        #endif\\n        #pragma unroll_loop_start\\n\\t    for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\\n            directionalLight = directionalLights[ i ];\\n            precomputeDirect(normal, viewDir, directionalLight, attenuation, lightDir, NoL);\\n            // Todo: combine methods\\n            #if defined(USE_TANGENT) && defined(ENABLE_ANISOTROPY)\\n            anisotropicSurfaceShading(normal, viewDir, NoL, prepCompute, materialDiffuse, materialSpecular, attenuation, directionalLights[ i ].color, lightDir, materialF90, anisotropicT, anisotropicB, anisotropy, lightDiffuse, lightSpecular, lighted);\\n            #else\\n            surfaceShading(normal, viewDir, NoL, prepCompute, materialDiffuse, materialSpecular, attenuation, directionalLights[ i ].color, lightDir, materialF90, lightDiffuse, lightSpecular, lighted);\\n            #endif\\n            // ClearCoat\\n            #ifdef ENABLE_CLEARCOAT\\n            vec3 H = normalize(viewDir + lightDir);\\n            // Todo: ClearCoat normalMap\\n            float clearCoatNoH =  saturate(dot(clearCoatNormal, H));\\n            float clearCoatLoH =  saturate(dot(lightDir, H));\\n            float Fcc;\\n            float clearCoat = clearCoatLobe(H, clearCoatNoH, clearCoatLoH, clearCoatRoughness, Fcc);\\n            float clearCoatAttenuation = 1.0 - Fcc;\\n\\n            lightDiffuse *= clearCoatAttenuation;\\n            lightSpecular *= energyCompensation * clearCoatAttenuation;\\n            resultLightClearCoat += clearCoat;\\n            #else\\n            lightSpecular *= energyCompensation;\\n            #endif\\n\\n            resultLightDiffuse += lightDiffuse;\\n            resultLightSpecular += lightSpecular;\\n        }\\n        #pragma unroll_loop_end\\n    #endif\\n    // Todo: Spot/Point Light\\n\\n    // Test\\n    #ifndef ENABLE_IBL\\n        diffuseIBL = vec3(0.);\\n        specularIBL = vec3(0.);\\n    #endif\\n    #ifndef ENABLE_LIGHT\\n        resultLightDiffuse = vec3(0.);\\n        resultLightSpecular = vec3(0.);\\n    #endif\\n\\n    vec3 resultDiffuse = diffuseIBL + resultLightDiffuse;\\n    vec3 resultSpecular = specularIBL + resultLightSpecular;\\n\\n    vec3 totalResult = resultDiffuse + resultSpecular + totalEmissiveRadiance + resultLightClearCoat;\\n    vec4 frag = vec4(totalResult, diffuseColor.a);\\n    gl_FragColor = frag;\\n    #include <tonemapping_fragment>\\n    #include <encodings_fragment>\\n}\";","import ShaderChunk from './shaders/ShaderChunk';\r\nimport pbrVS from './shaders/pbrVS';\r\nimport pbrFS from './shaders/pbrFS';\r\n\r\nexport class PBRProgram {\r\n\tconstructor() {\r\n\t\tthis.includePattern = /^[ \\t]*#preImport +<([\\w\\d./]+)>/gm;\r\n\t}\r\n\r\n\tgetPBRShader() {\r\n\t\tlet vs = this.preParseShader(pbrVS);\r\n\t\tlet fs = this.preParseShader(pbrFS);\r\n\t\treturn {\r\n\t\t\tpbrVS: vs,\r\n\t\t\tpbrFS: fs\r\n\t\t};\r\n\t}\r\n\r\n\tpreParseShader(string) {\r\n\t\tlet includeReplacer = (match, include) => {\r\n\t\t\tlet string = ShaderChunk[include];\r\n\t\t\tif (string === undefined) {\r\n\t\t\t\tthrow new Error('Can not resolve #preImport <' + include + '>');\r\n\t\t\t}\r\n\t\t\treturn this.preParseShader(string);\r\n\t\t};\r\n\t\treturn string.replace(this.includePattern, includeReplacer);\r\n\t}\r\n}\r\n","export default \"// @author brunoimbrizi / http://brunoimbrizi.com\\n\\nprecision highp float;\\n#define GLSLIFY 1\\n\\nattribute float pindex;\\nattribute vec3 position;\\nattribute vec3 offset;\\nattribute vec2 uv;\\nattribute float angle;\\n\\nuniform mat4 modelViewMatrix;\\nuniform mat4 projectionMatrix;\\n\\nuniform float uTime;\\nuniform float uRandom;\\nuniform float uDepth;\\nuniform float uSize;\\nuniform vec2 uTextureSize;\\nuniform sampler2D uTexture;\\nuniform sampler2D uTouch;\\n\\nvarying vec2 vPUv;\\nvarying vec2 vUv;\\nvarying float touchRes;\\n\\n//\\n// Description : Array and textureless GLSL 2D simplex noise function.\\n//      Author : Ian McEwan, Ashima Arts.\\n//  Maintainer : ijm\\n//     Lastmod : 20110822 (ijm)\\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\\n//               Distributed under the MIT License. See LICENSE file.\\n//               https://github.com/ashima/webgl-noise\\n//\\n\\nvec3 mod289(vec3 x) {\\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\\n}\\n\\nvec2 mod289(vec2 x) {\\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\\n}\\n\\nvec3 permute(vec3 x) {\\n  return mod289(((x*34.0)+1.0)*x);\\n}\\n\\nfloat snoise(vec2 v)\\n  {\\n  const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\\n                      0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\\n                     -0.577350269189626,  // -1.0 + 2.0 * C.x\\n                      0.024390243902439); // 1.0 / 41.0\\n// First corner\\n  vec2 i  = floor(v + dot(v, C.yy) );\\n  vec2 x0 = v -   i + dot(i, C.xx);\\n\\n// Other corners\\n  vec2 i1;\\n  //i1.x = step( x0.y, x0.x ); // x0.x > x0.y ? 1.0 : 0.0\\n  //i1.y = 1.0 - i1.x;\\n  i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\\n  // x0 = x0 - 0.0 + 0.0 * C.xx ;\\n  // x1 = x0 - i1 + 1.0 * C.xx ;\\n  // x2 = x0 - 1.0 + 2.0 * C.xx ;\\n  vec4 x12 = x0.xyxy + C.xxzz;\\n  x12.xy -= i1;\\n\\n// Permutations\\n  i = mod289(i); // Avoid truncation effects in permutation\\n  vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\\n    + i.x + vec3(0.0, i1.x, 1.0 ));\\n\\n  vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\\n  m = m*m ;\\n  m = m*m ;\\n\\n// Gradients: 41 points uniformly over a line, mapped onto a diamond.\\n// The ring size 17*17 = 289 is close to a multiple of 41 (41*7 = 287)\\n\\n  vec3 x = 2.0 * fract(p * C.www) - 1.0;\\n  vec3 h = abs(x) - 0.5;\\n  vec3 ox = floor(x + 0.5);\\n  vec3 a0 = x - ox;\\n\\n// Normalise gradients implicitly by scaling m\\n// Approximation of: m *= inversesqrt( a0*a0 + h*h );\\n  m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\\n\\n// Compute final noise value at P\\n  vec3 g;\\n  g.x  = a0.x  * x0.x  + h.x  * x0.y;\\n  g.yz = a0.yz * x12.xz + h.yz * x12.yw;\\n  return 130.0 * dot(m, g);\\n}\\n\\nfloat random(float n) {\\n\\treturn fract(sin(n) * 43758.5453123);\\n}\\n\\nvoid main() {\\n\\tvUv = uv;\\n\\n\\t// particle uv\\n\\tvec2 puv = offset.xy / uTextureSize;\\n\\tvPUv = puv;\\n\\n\\t// pixel color\\n\\tvec4 colA = texture2D(uTexture, puv);\\n\\t// if(t>0.1)\\n\\tfloat grey = colA.r * 0.21 + colA.g * 0.71 + colA.b * 0.07;\\n\\n\\t// displacement\\n\\tvec3 displaced = offset;\\n\\n\\t// touch\\n\\ttouchRes = texture2D(uTouch, puv).r;\\n\\tfloat randomVal = uRandom;\\n\\tfloat depthVal = uDepth;\\n\\tif(touchRes>0.1){\\n\\t\\trandomVal = 0.;\\n\\t\\tdepthVal = 0.;\\n\\t}\\n\\t// randomise\\n\\tdisplaced.xy += vec2(random(pindex) - 0.5, random(offset.x + pindex) - 0.5) * randomVal;\\n\\tfloat rndz = (random(pindex) + snoise(vec2(pindex * 0.1, uTime * 0.1)));\\n\\tdisplaced.z += rndz * (random(pindex) * 2.0 * depthVal);\\n\\t// center\\n\\tdisplaced.xy -= uTextureSize * 0.5;\\n\\n\\t// touch\\n\\t// float t = texture2D(uTouch, puv).r;\\n\\t// displaced.z += t * 20.0 * rndz;\\n\\t// displaced.x += cos(angle) * t * 20.0 * rndz;\\n\\t// displaced.y += sin(angle) * t * 20.0 * rndz;\\n\\n\\t// particle size\\n\\tfloat psize = (snoise(vec2(uTime, pindex) * 0.5) + 2.0);\\n\\t// psize *= max(grey, 0.2);\\n\\tpsize *= uSize;\\n\\n\\t// final position\\n\\tvec4 mvPosition = modelViewMatrix * vec4(displaced, 1.0);\\n\\tmvPosition.xyz += position * psize;\\n\\tvec4 finalPosition = projectionMatrix * mvPosition;\\n\\n\\tgl_Position = finalPosition;\\n}\\n\";","export default \"// @author brunoimbrizi / http://brunoimbrizi.com\\n\\nprecision highp float;\\n#define GLSLIFY 1\\n\\nuniform sampler2D uTexture;\\n\\nvarying vec2 vPUv;\\nvarying vec2 vUv;\\nvarying float touchRes;\\n\\nvoid main() {\\n\\tvec4 color = vec4(0.0);\\n\\tvec2 uv = vUv;\\n\\tvec2 puv = vPUv;\\n\\n\\t// pixel color\\n\\tvec4 colA = texture2D(uTexture, puv);\\n\\n\\t// greyscale\\n\\tfloat grey = colA.r * 0.21 + colA.g * 0.71 + colA.b * 0.07;\\n\\tvec4 colB = vec4(grey, grey, grey, 1.0);\\n\\n\\t// circle\\n\\tfloat border = 0.3;\\n\\tfloat radius = 0.5;\\n\\tfloat dist = radius - distance(uv, vec2(0.5));\\n\\tfloat t = smoothstep(0.0, border, dist);\\n\\n\\t// final color\\n\\tif(touchRes>0.1){\\n\\t\\tcolor = colA;\\n\\t}else{\\n\\t\\tcolor = colB;\\n\\t}\\n\\tcolor.a = t;\\n\\n\\tgl_FragColor = color;\\n}\";","import * as THREE from 'three';\r\n\r\nexport class ParticleInstance {\r\n\tconstructor(material) {\r\n\t\tthis.material = material;\r\n\t\tthis.initParticle();\r\n\t}\r\n\r\n\tinitParticle() {\r\n\t\tconst geometry = new THREE.InstancedBufferGeometry();\r\n\r\n\t\t// positions\r\n\t\tconst positions = new THREE.BufferAttribute(new Float32Array(4 * 3), 3);\r\n\t\tpositions.setXYZ(0, -0.5, -0.5, 0.0);\r\n\t\tpositions.setXYZ(1, 0.5, -0.5, 0.0);\r\n\t\tpositions.setXYZ(2, -0.5, 0.5, 0.0);\r\n\t\tpositions.setXYZ(3, 0.5, 0.5, 0.0);\r\n\t\tgeometry.setAttribute('position', positions);\r\n\r\n\t\t// uvs\r\n\t\tconst uvs = new THREE.BufferAttribute(new Float32Array(4 * 2), 2);\r\n\t\tuvs.setXYZ(0, 0.0, 0.0);\r\n\t\tuvs.setXYZ(1, 1.0, 0.0);\r\n\t\tuvs.setXYZ(2, 0.0, 1.0);\r\n\t\tuvs.setXYZ(3, 1.0, 1.0);\r\n\t\tgeometry.setAttribute('uv', uvs);\r\n\r\n\t\t// CCW\r\n\t\tgeometry.setIndex(new THREE.BufferAttribute(new Uint16Array([0, 1, 2, 2, 1, 3]), 1));\r\n\r\n\t\tthis.mesh = new THREE.Mesh(geometry, this.material);\r\n\t}\r\n}\r\n","import * as THREE from 'three';\r\nimport { easeOutSine } from 'JS/Utils';\r\n\r\nexport default class TouchTexture {\r\n\tconstructor(parent) {\r\n\t\tthis.parent = parent;\r\n\t\tthis.size = 64;\r\n\t\tthis.maxAge = 120;\r\n\t\tthis.radius = 0.2;\r\n\t\tthis.trail = [];\r\n\r\n\t\tthis.initTexture();\r\n\t}\r\n\r\n\tinitTexture() {\r\n\t\tthis.canvas = document.createElement('canvas');\r\n\t\tthis.canvas.width = this.canvas.height = this.size;\r\n\t\tthis.ctx = this.canvas.getContext('2d');\r\n\t\tthis.ctx.fillStyle = 'black';\r\n\t\tthis.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\r\n\r\n\t\tthis.texture = new THREE.Texture(this.canvas);\r\n\r\n\t\tthis.canvas.id = 'touchTexture';\r\n\t\tthis.canvas.style.width = this.canvas.style.height = `${this.canvas.width}px`;\r\n\t}\r\n\r\n\tupdate(delta) {\r\n\t\tthis.clear();\r\n\r\n\t\t// age points\r\n\t\tthis.trail.forEach((point, i) => {\r\n\t\t\tpoint.age++;\r\n\t\t\t// remove old\r\n\t\t\tif (point.age > this.maxAge) {\r\n\t\t\t\tthis.trail.splice(i, 1);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.trail.forEach((point, i) => {\r\n\t\t\tthis.drawTouch(point);\r\n\t\t});\r\n\r\n\t\tthis.texture.needsUpdate = true;\r\n\t}\r\n\r\n\tclear() {\r\n\t\tthis.ctx.fillStyle = 'black';\r\n\t\tthis.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);\r\n\t}\r\n\r\n\taddTouch(point) {\r\n\t\tlet force = 0;\r\n\t\tconst last = this.trail[this.trail.length - 1];\r\n\t\tif (last) {\r\n\t\t\tconst dx = last.x - point.x;\r\n\t\t\tconst dy = last.y - point.y;\r\n\t\t\tconst dd = dx * dx + dy * dy;\r\n\t\t\tforce = Math.min(dd * 10000, 1);\r\n\t\t}\r\n\t\tthis.trail.push({ x: point.x, y: point.y, age: 0, force });\r\n\t}\r\n\r\n\tdrawTouch(point) {\r\n\t\tconst pos = {\r\n\t\t\tx: point.x * this.size,\r\n\t\t\ty: (1 - point.y) * this.size\r\n\t\t};\r\n\r\n\t\tlet intensity = 1;\r\n\t\tif (point.age < this.maxAge * 0.3) {\r\n\t\t\tintensity = easeOutSine(point.age / (this.maxAge * 0.3), 0, 1, 1);\r\n\t\t} else {\r\n\t\t\tintensity = easeOutSine(1 - (point.age - this.maxAge * 0.3) / (this.maxAge * 0.7), 0, 1, 1);\r\n\t\t}\r\n\r\n\t\tintensity *= point.force;\r\n\r\n\t\tconst radius = this.size * this.radius * intensity;\r\n\t\tconst grd = this.ctx.createRadialGradient(pos.x, pos.y, radius * 0.25, pos.x, pos.y, radius);\r\n\t\tgrd.addColorStop(0, `rgba(255, 255, 255, 0.2)`);\r\n\t\tgrd.addColorStop(1, 'rgba(0, 0, 0, 0.0)');\r\n\r\n\t\tthis.ctx.beginPath();\r\n\t\tthis.ctx.fillStyle = grd;\r\n\t\tthis.ctx.arc(pos.x, pos.y, radius, 0, Math.PI * 2);\r\n\t\tthis.ctx.fill();\r\n\t}\r\n}\r\n","// refer: https://github.com/brunoimbrizi/interactive-particles\r\n\r\nimport * as THREE from 'three';\r\nimport particleVS from './shaders/particle.vs';\r\nimport particleFS from './shaders/particle.fs';\r\nimport { ParticleInstance } from 'MODULES/Particle/ParticleInstance';\r\nimport TouchTexture from './TouchTexture';\r\n\r\nexport class ParticleTexture {\r\n\tconstructor(section, texture, areaBounding) {\r\n\t\tthis.container = new THREE.Object3D();\r\n\t\tthis.texture = texture;\r\n\t\tthis.section = section;\r\n\t\tthis.layer = section.layers.UI_LAYER;\r\n\t\tthis.viewer = section.viewer;\r\n\t\tthis.eventHandler = this.viewer.eventHandler;\r\n\t\tthis.areaBounding = areaBounding;\r\n\r\n\t\tthis.touch = null;\r\n\t\tthis.mouse = new THREE.Vector2();\r\n\t\tthis.raycaster = new THREE.Raycaster();\r\n\t\tthis.raycaster.layers.set(this.layer);\r\n\t\tthis.intersectsArr = [];\r\n\t\tthis.camera = section.uiCamera;\r\n\t\tthis.init(texture);\r\n\t}\r\n\r\n\tinit(texture) {\r\n\t\tthis.texture = texture;\r\n\t\tthis.texture.minFilter = THREE.LinearFilter;\r\n\t\tthis.texture.magFilter = THREE.LinearFilter;\r\n\t\tthis.texture.format = THREE.RGBFormat;\r\n\r\n\t\tthis.width = texture.image.width;\r\n\t\tthis.height = texture.image.height;\r\n\t\tthis.initPoints();\r\n\t\tthis.initHitArea();\r\n\t\tthis.initTouch();\r\n\t\tthis.initEvent();\r\n\t}\r\n\r\n\tinitPoints() {\r\n\t\tthis.numPoints = this.width * this.height;\r\n\r\n\t\t// discard pixels darker than threshold #22\r\n\t\tlet numVisible = 0;\r\n\t\tlet threshold = 1;\r\n\t\tlet originalColors;\r\n\r\n\t\tconst img = this.texture.image;\r\n\t\tconst canvas = document.createElement('canvas');\r\n\t\tconst ctx = canvas.getContext('2d');\r\n\r\n\t\tcanvas.width = this.width;\r\n\t\tcanvas.height = this.height;\r\n\t\tctx.scale(1, -1);\r\n\t\tctx.drawImage(img, 0, 0, this.width, this.height * -1);\r\n\r\n\t\tconst imgData = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n\t\toriginalColors = Float32Array.from(imgData.data);\r\n\r\n\t\tfor (let i = 0; i < this.numPoints; i++) {\r\n\t\t\tif (originalColors[i * 4 + 0] > threshold) numVisible++;\r\n\t\t}\r\n\r\n\t\tconst uniforms = {\r\n\t\t\tuTime: { value: 0 },\r\n\t\t\tuRandom: { value: 30.0 },\r\n\t\t\tuDepth: { value: 0 },\r\n\t\t\tuSize: { value: 0 }, // hide default\r\n\t\t\tuTextureSize: { value: new THREE.Vector2(this.width, this.height) },\r\n\t\t\tuTexture: { value: this.texture },\r\n\t\t\tuTouch: { value: null }\r\n\t\t};\r\n\r\n\t\tconst material = new THREE.RawShaderMaterial({\r\n\t\t\tuniforms,\r\n\t\t\tvertexShader: particleVS,\r\n\t\t\tfragmentShader: particleFS,\r\n\t\t\tdepthTest: false,\r\n\t\t\ttransparent: true\r\n\t\t\t// blending: THREE.AdditiveBlending\r\n\t\t});\r\n\r\n\t\tthis.instanceMesh = new ParticleInstance(material).mesh;\r\n\t\tthis.instanceMesh.layers.set(this.layer);\r\n\t\tconst geometry = this.instanceMesh.geometry;\r\n\r\n\t\tconst indices = new Uint16Array(numVisible);\r\n\t\tconst offsets = new Float32Array(numVisible * 3);\r\n\t\tconst angles = new Float32Array(numVisible);\r\n\r\n\t\tfor (let i = 0, j = 0; i < this.numPoints; i++) {\r\n\t\t\tif (originalColors[i * 4 + 0] <= threshold) continue;\r\n\r\n\t\t\toffsets[j * 3 + 0] = i % this.width;\r\n\t\t\toffsets[j * 3 + 1] = Math.floor(i / this.width);\r\n\r\n\t\t\tindices[j] = i;\r\n\r\n\t\t\tangles[j] = Math.random() * Math.PI;\r\n\r\n\t\t\tj++;\r\n\t\t}\r\n\r\n\t\tgeometry.setAttribute('pindex', new THREE.InstancedBufferAttribute(indices, 1, false));\r\n\t\tgeometry.setAttribute('offset', new THREE.InstancedBufferAttribute(offsets, 3, false));\r\n\t\tgeometry.setAttribute('angle', new THREE.InstancedBufferAttribute(angles, 1, false));\r\n\r\n\t\tthis.container.add(this.instanceMesh);\r\n\t}\r\n\r\n\tinitHitArea() {\r\n\t\tconst geometry = new THREE.PlaneGeometry(this.width, this.height, 1, 1);\r\n\t\tconst material = new THREE.MeshBasicMaterial({ color: 0xffffff, wireframe: true, depthTest: false });\r\n\t\tmaterial.visible = false;\r\n\t\tthis.hitArea = new THREE.Mesh(geometry, material);\r\n\t\tthis.hitArea.layers.set(this.layer);\r\n\t\tthis.container.add(this.hitArea);\r\n\t}\r\n\r\n\tinitTouch() {\r\n\t\t// create only once\r\n\t\tif (!this.touch) this.touch = new TouchTexture(this);\r\n\t\tthis.instanceMesh.material.uniforms.uTouch.value = this.touch.texture;\r\n\t}\r\n\r\n\tinitEvent() {\r\n\t\tthis.intersectsArr.push(this.hitArea);\r\n\t\tthis.eventHandler.onMouseMoveEvent.bind(this.onMouseMove.bind(this));\r\n\t}\r\n\r\n\tonMouseMove(event) {\r\n\t\tif (!this.viewer.preloadFinished || !this.section.visible) return;\r\n\t\tthis.mouse.x = (event.clientX / window.innerWidth) * 2 - 1;\r\n\t\tthis.mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;\r\n\t\t// Bounding optimize hack\r\n\t\tif (this.areaBounding === 'left' && this.mouse.x > 0) return;\r\n\t\tif (this.areaBounding === 'right' && this.mouse.x < 0) return;\r\n\r\n\t\tthis.raycaster.setFromCamera(this.mouse, this.camera);\r\n\t\tconst intersects = this.raycaster.intersectObjects(this.intersectsArr);\r\n\t\tif (intersects.length > 0) {\r\n\t\t\tconst uv = intersects[0].uv;\r\n\t\t\tif (this.touch) this.touch.addTouch(uv);\r\n\t\t}\r\n\t}\r\n\r\n\tupdate(delta) {\r\n\t\tif (this.touch) this.touch.update();\r\n\t\tthis.instanceMesh.material.uniforms.uTime.value += delta;\r\n\t}\r\n\r\n\tget material() {\r\n\t\treturn this.instanceMesh.material;\r\n\t}\r\n}\r\n","export class Particle {\r\n\tconstructor() {\r\n\t\tthis.velocity = new Array(3);\r\n\t\tthis.rotation = new Array(3);\r\n\t\tthis.position = new Array(3);\r\n\t\tthis.euler = new Array(3);\r\n\t\tthis.size = 1.0;\r\n\t\tthis.alpha = 1.0;\r\n\t\tthis.zkey = 0.0;\r\n\t}\r\n\r\n\tsetVelocity(vx, vy, vz) {\r\n\t\tthis.velocity[0] = vx;\r\n\t\tthis.velocity[1] = vy;\r\n\t\tthis.velocity[2] = vz;\r\n\t}\r\n\r\n\tsetRotation(rx, ry, rz) {\r\n\t\tthis.rotation[0] = rx;\r\n\t\tthis.rotation[1] = ry;\r\n\t\tthis.rotation[2] = rz;\r\n\t}\r\n\r\n\tsetPosition(nx, ny, nz) {\r\n\t\tthis.position[0] = nx;\r\n\t\tthis.position[1] = ny;\r\n\t\tthis.position[2] = nz;\r\n\t}\r\n\r\n\tsetEulerAngles(rx, ry, rz) {\r\n\t\tthis.euler[0] = rx;\r\n\t\tthis.euler[1] = ry;\r\n\t\tthis.euler[2] = rz;\r\n\t}\r\n\r\n\tsetSize(s) {\r\n\t\tthis.size = s;\r\n\t}\r\n\r\n\tsetAlpha(a) {\r\n\t\tthis.alpha = a;\r\n\t}\r\n\r\n\tupdate(dt) {\r\n\t\tthis.position[0] += this.velocity[0] * dt;\r\n\t\tthis.position[1] += this.velocity[1] * dt;\r\n\t\tthis.position[2] += this.velocity[2] * dt;\r\n\r\n\t\tthis.euler[0] += this.rotation[0] * dt;\r\n\t\tthis.euler[1] += this.rotation[1] * dt;\r\n\t\tthis.euler[2] += this.rotation[2] * dt;\r\n\t}\r\n}\r\n","export default \"#define GLSLIFY 1\\nattribute float aSize;\\nattribute float aAlpha;\\n\\nvarying vec3 vPosition;\\nvarying float vPreAlpha;\\n\\nvoid main() {\\n\\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\\n\\tgl_Position = projectionMatrix * mvPosition;\\n\\tgl_PointSize = aSize * (300.0 / - mvPosition.z);\\n\\t\\n\\tvPosition = vec3(mvPosition.xyz);\\n\\tvPreAlpha = aAlpha;\\n}\";","export default \"precision highp float;\\n#define GLSLIFY 1\\n\\nvarying vec3 vPosition;\\nvarying float vPreAlpha;\\n\\nuniform vec3 innerColor;\\nuniform vec3 outerColor;\\n\\n// pos orign r.ab\\nfloat ellipse(vec2 p, vec2 o, vec2 r) { \\n    vec2 lp = (p - o) / r;\\n    return length(lp);\\n}\\n\\nvoid main() {\\n\\tvec2 st = (gl_PointCoord - vec2(0.5, 0.5)) * 2.0; // [-1,1]\\n\\tfloat r = ellipse(st, vec2(0.), vec2(1.));\\n\\tfloat alpha = 1. - r;\\n\\tvec3 col;\\n\\tcol = mix(innerColor, outerColor, r);\\n\\tgl_FragColor = vec4(col, alpha * vPreAlpha);\\n}\";","import * as THREE from 'three';\r\nimport { Particle } from 'MODULES/Particle/Particle';\r\nimport vertexShader from './shaders/snow.vs';\r\nimport fragmentShader from './shaders/snow.fs';\r\nimport { symmetryRandom } from 'JS/Utils';\r\n\r\nexport class ParticleSnow {\r\n\tconstructor(section) {\r\n\t\tthis.scene = section.scene;\r\n\t\tthis.isMobile = section.isMobile;\r\n\t\tthis.deltaTime = 0;\r\n\t\tthis.particleControl = {};\r\n\t\tif(!this.isMobile){\r\n\t\t\tthis.particleControl.particleNum = 500;\r\n\t\t\tthis.particleControl.area = [5, 8, 5];\r\n\t\t}else{\r\n\t\t\tthis.particleControl.particleNum = 250;\r\n\t\t\tthis.particleControl.area = [2, 4, 2.5];\r\n\t\t}\r\n\t\t// Data\r\n\t\tthis.geometry = new THREE.BufferGeometry();\r\n\t\tthis.positions = new Float32Array(this.particleControl.particleNum * 3);\r\n\t\tthis.sizes = new Float32Array(this.particleControl.particleNum);\r\n\t\tthis.alphas = new Float32Array(this.particleControl.particleNum);\r\n\t\tthis.initParticle();\r\n\t}\r\n\r\n\tget mesh() {\r\n\t\treturn this.points;\r\n\t}\r\n\r\n\tinitParticle() {\r\n\t\tlet { particleControl } = this;\r\n\t\tlet { particleNum, area } = particleControl;\r\n\t\tparticleControl.particles = new Array(particleNum);\r\n\t\tlet tempVec3 = new THREE.Vector3();\r\n\t\tlet tempVelocity = 0;\r\n\t\tfor (let i = 0; i < particleNum; i++) {\r\n\t\t\tparticleControl.particles[i] = new Particle();\r\n\t\t\tlet particle = particleControl.particles[i];\r\n\t\t\t// Init Transform\r\n\t\t\ttempVec3.x = symmetryRandom() * 0.3 + 0.8;\r\n\t\t\ttempVec3.y = symmetryRandom() * 0.2 - 1.0;\r\n\t\t\ttempVec3.z = symmetryRandom() * 0.3 + 0.5;\r\n\t\t\ttempVec3.normalize();\r\n\t\t\ttempVelocity = 2.0 + Math.random() * 1.0;\r\n\t\t\ttempVec3.multiplyScalar(tempVelocity);\r\n\t\t\t// Velocity\r\n\t\t\tparticle.setVelocity(tempVec3.x, tempVec3.y, tempVec3.z);\r\n\t\t\t// Position\r\n\t\t\tparticle.setPosition(symmetryRandom() * area[0], symmetryRandom() * area[1], symmetryRandom() * area[2]);\r\n\t\t\t// Size\r\n\t\t\tparticle.setSize(Math.random() / 5);\r\n\t\t\t// Alpha\r\n\t\t\tparticle.setAlpha(Math.random());\r\n\t\t}\r\n\t\t// Attributes\r\n\t\tthis.geometry.setAttribute('position', new THREE.BufferAttribute(this.positions, 3));\r\n\t\tthis.geometry.setAttribute('aSize', new THREE.BufferAttribute(this.sizes, 1));\r\n\t\tthis.geometry.setAttribute('aAlpha', new THREE.BufferAttribute(this.alphas, 1));\r\n\r\n\t\t// Uniforms\r\n\t\tthis.uniforms = {\r\n\t\t\tfar: {\r\n\t\t\t\ttype: 'f',\r\n\t\t\t\tvalue: area[2]\r\n\t\t\t},\r\n\t\t\tinnerColor: { value: new THREE.Color('#FFFFFF') },\r\n\t\t\touterColor: { value: new THREE.Color('#EEEEEE') }\r\n\t\t};\r\n\t\tthis.points = new THREE.Points(\r\n\t\t\tthis.geometry,\r\n\t\t\tnew THREE.ShaderMaterial({\r\n\t\t\t\tuniforms: this.uniforms,\r\n\t\t\t\tvertexShader,\r\n\t\t\t\tfragmentShader,\r\n\t\t\t\tblending: THREE.AdditiveBlending,\r\n\t\t\t\ttransparent: true\r\n\t\t\t})\r\n\t\t);\r\n\t\tthis.scene.add(this.points);\r\n\t}\r\n\r\n\t// Cycle Position\r\n\trepeatPos(particle, area) {\r\n\t\tfor (let index = 0; index < 3; index++) {\r\n\t\t\tlet limit = area[index];\r\n\t\t\tif (Math.abs(particle.position[index]) - particle.size * 0.5 > limit) {\r\n\t\t\t\t// Out Of Area\r\n\t\t\t\tif (particle.position[index] > 0) {\r\n\t\t\t\t\tparticle.position[index] -= limit * 2.0;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tparticle.position[index] += limit * 2.0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\trenderParticle() {\r\n\t\tlet { particleNum, area, particles } = this.particleControl;\r\n\t\t// Update Data\r\n\t\tfor (let i = 0; i < particleNum; i++) {\r\n\t\t\tlet particle = particles[i];\r\n\t\t\tparticle.update(this.deltaTime);\r\n\t\t\tthis.repeatPos(particle, area);\r\n\t\t\t// Position\r\n\t\t\tthis.positions[i * 3] = particle.position[0];\r\n\t\t\tthis.positions[i * 3 + 1] = particle.position[1];\r\n\t\t\tthis.positions[i * 3 + 2] = particle.position[2];\r\n\t\t\t// Size\r\n\t\t\tthis.sizes[i] = particle.size;\r\n\t\t\t// Alpha\r\n\t\t\tthis.alphas[i] = particle.alpha;\r\n\t\t}\r\n\t\tthis.geometry.attributes['position'].needsUpdate = true;\r\n\t\tthis.geometry.attributes['aSize'].needsUpdate = true;\r\n\t}\r\n\r\n\trender(time) {\r\n\t\tthis.deltaTime = time;\r\n\t\tthis.renderParticle();\r\n\t}\r\n}\r\n","export default \"#define GLSLIFY 1\\nuniform sampler2D inputBuffer;\\nuniform float opacity;\\n\\nvarying vec2 vUv;\\n\\nvoid main() {\\n\\tvec4 texel = texture2D(inputBuffer, vUv);\\n\\tgl_FragColor = opacity * texel;\\n}\\n\";","export default \"#define GLSLIFY 1\\nvarying vec2 vUv;\\n\\nvoid main() {\\n\\tvUv = uv;\\n\\tgl_Position = vec4(position.xy, 1.0, 1.0);\\n}\\n\";","import { ShaderMaterial, Uniform } from 'three';\r\nimport fragmentShader from './shaders/copy/shader.fs';\r\nimport vertexShader from './shaders/common/shader.vs';\r\n\r\nexport class CopyMaterial extends ShaderMaterial {\r\n\tconstructor() {\r\n\t\tsuper({\r\n\t\t\ttype: 'CopyMaterial',\r\n\r\n\t\t\tuniforms: {\r\n\t\t\t\tinputBuffer: new Uniform(null),\r\n\t\t\t\topacity: new Uniform(1.0)\r\n\t\t\t},\r\n\r\n\t\t\tfragmentShader,\r\n\t\t\tvertexShader,\r\n\r\n\t\t\tdepthWrite: false,\r\n\t\t\tdepthTest: false\r\n\t\t});\r\n\t}\r\n}\r\n","export default \"#define GLSLIFY 1\\nuniform sampler2D inputBuffer;\\n\\nuniform vec2 resolution;\\n\\nvarying vec2 vUv;\\n\\n// FXAA 3.11 implementation by NVIDIA, ported to WebGL by Agost Biro (biro@archilogic.com)\\n//----------------------------------------------------------------------------------\\n// File:        es3-keplerFXAAassetsshaders/FXAA_DefaultES.frag\\n// SDK Version: v3.00\\n// Email:       gameworks@nvidia.com\\n// Site:        http://developer.nvidia.com/\\n\\n// Copyright (c) 2014-2015, NVIDIA CORPORATION. All rights reserved.\\n\\n// Redistribution and use in source and binary forms, with or without\\n// modification, are permitted provided that the following conditions\\n// are met:\\n//  * Redistributions of source code must retain the above copyright\\n//    notice, this list of conditions and the following disclaimer.\\n//  * Redistributions in binary form must reproduce the above copyright\\n//    notice, this list of conditions and the following disclaimer in the\\n//    documentation and/or other materials provided with the distribution.\\n//  * Neither the name of NVIDIA CORPORATION nor the names of its\\n//    contributors may be used to endorse or promote products derived\\n//    from this software without specific prior written permission.\\n\\n// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY\\n// EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE\\n// IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR\\n// PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR\\n// CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,\\n// EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,\\n// PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR\\n// PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY\\n// OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\\n// (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\\n// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\\n\\n//----------------------------------------------------------------------------------\\n\\n#define FXAA_PC 1\\n#define FXAA_GLSL_100 1\\n#define FXAA_QUALITY_PRESET 12\\n\\n#define FXAA_GREEN_AS_LUMA 1\\n\\n/*--------------------------------------------------------------------------*/\\n#ifndef FXAA_PC_CONSOLE\\n    //\\n    // The console algorithm for PC is included\\n    // for developers targeting really low spec machines.\\n    // Likely better to just run FXAA_PC, and use a really low preset.\\n    //\\n    #define FXAA_PC_CONSOLE 0\\n#endif\\n/*--------------------------------------------------------------------------*/\\n#ifndef FXAA_GLSL_120\\n    #define FXAA_GLSL_120 0\\n#endif\\n/*--------------------------------------------------------------------------*/\\n#ifndef FXAA_GLSL_130\\n    #define FXAA_GLSL_130 0\\n#endif\\n/*--------------------------------------------------------------------------*/\\n#ifndef FXAA_HLSL_3\\n    #define FXAA_HLSL_3 0\\n#endif\\n/*--------------------------------------------------------------------------*/\\n#ifndef FXAA_HLSL_4\\n    #define FXAA_HLSL_4 0\\n#endif\\n/*--------------------------------------------------------------------------*/\\n#ifndef FXAA_HLSL_5\\n    #define FXAA_HLSL_5 0\\n#endif\\n/*==========================================================================*/\\n#ifndef FXAA_GREEN_AS_LUMA\\n    //\\n    // For those using non-linear color,\\n    // and either not able to get luma in alpha, or not wanting to,\\n    // this enables FXAA to run using green as a proxy for luma.\\n    // So with this enabled, no need to pack luma in alpha.\\n    //\\n    // This will turn off AA on anything which lacks some amount of green.\\n    // Pure red and blue or combination of only R and B, will get no AA.\\n    //\\n    // Might want to lower the settings for both,\\n    //    fxaaConsoleEdgeThresholdMin\\n    //    fxaaQualityEdgeThresholdMin\\n    // In order to insure AA does not get turned off on colors\\n    // which contain a minor amount of green.\\n    //\\n    // 1 = On.\\n    // 0 = Off.\\n    //\\n    #define FXAA_GREEN_AS_LUMA 0\\n#endif\\n/*--------------------------------------------------------------------------*/\\n#ifndef FXAA_EARLY_EXIT\\n    //\\n    // Controls algorithm's early exit path.\\n    // On PS3 turning this ON adds 2 cycles to the shader.\\n    // On 360 turning this OFF adds 10ths of a millisecond to the shader.\\n    // Turning this off on console will result in a more blurry image.\\n    // So this defaults to on.\\n    //\\n    // 1 = On.\\n    // 0 = Off.\\n    //\\n    #define FXAA_EARLY_EXIT 1\\n#endif\\n/*--------------------------------------------------------------------------*/\\n#ifndef FXAA_DISCARD\\n    //\\n    // Only valid for PC OpenGL currently.\\n    // Probably will not work when FXAA_GREEN_AS_LUMA = 1.\\n    //\\n    // 1 = Use discard on pixels which don't need AA.\\n    //     For APIs which enable concurrent TEX+ROP from same surface.\\n    // 0 = Return unchanged color on pixels which don't need AA.\\n    //\\n    #define FXAA_DISCARD 0\\n#endif\\n/*--------------------------------------------------------------------------*/\\n#ifndef FXAA_FAST_PIXEL_OFFSET\\n    //\\n    // Used for GLSL 120 only.\\n    //\\n    // 1 = GL API supports fast pixel offsets\\n    // 0 = do not use fast pixel offsets\\n    //\\n    #ifdef GL_EXT_gpu_shader4\\n        #define FXAA_FAST_PIXEL_OFFSET 1\\n    #endif\\n    #ifdef GL_NV_gpu_shader5\\n        #define FXAA_FAST_PIXEL_OFFSET 1\\n    #endif\\n    #ifdef GL_ARB_gpu_shader5\\n        #define FXAA_FAST_PIXEL_OFFSET 1\\n    #endif\\n    #ifndef FXAA_FAST_PIXEL_OFFSET\\n        #define FXAA_FAST_PIXEL_OFFSET 0\\n    #endif\\n#endif\\n/*--------------------------------------------------------------------------*/\\n#ifndef FXAA_GATHER4_ALPHA\\n    //\\n    // 1 = API supports gather4 on alpha channel.\\n    // 0 = API does not support gather4 on alpha channel.\\n    //\\n    #if (FXAA_HLSL_5 == 1)\\n        #define FXAA_GATHER4_ALPHA 1\\n    #endif\\n    #ifdef GL_ARB_gpu_shader5\\n        #define FXAA_GATHER4_ALPHA 1\\n    #endif\\n    #ifdef GL_NV_gpu_shader5\\n        #define FXAA_GATHER4_ALPHA 1\\n    #endif\\n    #ifndef FXAA_GATHER4_ALPHA\\n        #define FXAA_GATHER4_ALPHA 0\\n    #endif\\n#endif\\n\\n/*============================================================================\\n                        FXAA QUALITY - TUNING KNOBS\\n------------------------------------------------------------------------------\\nNOTE the other tuning knobs are now in the shader function inputs!\\n============================================================================*/\\n#ifndef FXAA_QUALITY_PRESET\\n    //\\n    // Choose the quality preset.\\n    // This needs to be compiled into the shader as it effects code.\\n    // Best option to include multiple presets is to\\n    // in each shader define the preset, then include this file.\\n    //\\n    // OPTIONS\\n    // -----------------------------------------------------------------------\\n    // 10 to 15 - default medium dither (10=fastest, 15=highest quality)\\n    // 20 to 29 - less dither, more expensive (20=fastest, 29=highest quality)\\n    // 39       - no dither, very expensive\\n    //\\n    // NOTES\\n    // -----------------------------------------------------------------------\\n    // 12 = slightly faster then FXAA 3.9 and higher edge quality (default)\\n    // 13 = about same speed as FXAA 3.9 and better than 12\\n    // 23 = closest to FXAA 3.9 visually and performance wise\\n    //  _ = the lowest digit is directly related to performance\\n    // _  = the highest digit is directly related to style\\n    //\\n    #define FXAA_QUALITY_PRESET 12\\n#endif\\n\\n/*============================================================================\\n\\n                           FXAA QUALITY - PRESETS\\n\\n============================================================================*/\\n\\n/*============================================================================\\n                     FXAA QUALITY - MEDIUM DITHER PRESETS\\n============================================================================*/\\n#if (FXAA_QUALITY_PRESET == 10)\\n    #define FXAA_QUALITY_PS 3\\n    #define FXAA_QUALITY_P0 1.5\\n    #define FXAA_QUALITY_P1 3.0\\n    #define FXAA_QUALITY_P2 12.0\\n#endif\\n/*--------------------------------------------------------------------------*/\\n#if (FXAA_QUALITY_PRESET == 11)\\n    #define FXAA_QUALITY_PS 4\\n    #define FXAA_QUALITY_P0 1.0\\n    #define FXAA_QUALITY_P1 1.5\\n    #define FXAA_QUALITY_P2 3.0\\n    #define FXAA_QUALITY_P3 12.0\\n#endif\\n/*--------------------------------------------------------------------------*/\\n#if (FXAA_QUALITY_PRESET == 12)\\n    #define FXAA_QUALITY_PS 5\\n    #define FXAA_QUALITY_P0 1.0\\n    #define FXAA_QUALITY_P1 1.5\\n    #define FXAA_QUALITY_P2 2.0\\n    #define FXAA_QUALITY_P3 4.0\\n    #define FXAA_QUALITY_P4 12.0\\n#endif\\n/*--------------------------------------------------------------------------*/\\n#if (FXAA_QUALITY_PRESET == 13)\\n    #define FXAA_QUALITY_PS 6\\n    #define FXAA_QUALITY_P0 1.0\\n    #define FXAA_QUALITY_P1 1.5\\n    #define FXAA_QUALITY_P2 2.0\\n    #define FXAA_QUALITY_P3 2.0\\n    #define FXAA_QUALITY_P4 4.0\\n    #define FXAA_QUALITY_P5 12.0\\n#endif\\n/*--------------------------------------------------------------------------*/\\n#if (FXAA_QUALITY_PRESET == 14)\\n    #define FXAA_QUALITY_PS 7\\n    #define FXAA_QUALITY_P0 1.0\\n    #define FXAA_QUALITY_P1 1.5\\n    #define FXAA_QUALITY_P2 2.0\\n    #define FXAA_QUALITY_P3 2.0\\n    #define FXAA_QUALITY_P4 2.0\\n    #define FXAA_QUALITY_P5 4.0\\n    #define FXAA_QUALITY_P6 12.0\\n#endif\\n/*--------------------------------------------------------------------------*/\\n#if (FXAA_QUALITY_PRESET == 15)\\n    #define FXAA_QUALITY_PS 8\\n    #define FXAA_QUALITY_P0 1.0\\n    #define FXAA_QUALITY_P1 1.5\\n    #define FXAA_QUALITY_P2 2.0\\n    #define FXAA_QUALITY_P3 2.0\\n    #define FXAA_QUALITY_P4 2.0\\n    #define FXAA_QUALITY_P5 2.0\\n    #define FXAA_QUALITY_P6 4.0\\n    #define FXAA_QUALITY_P7 12.0\\n#endif\\n\\n/*============================================================================\\n                     FXAA QUALITY - LOW DITHER PRESETS\\n============================================================================*/\\n#if (FXAA_QUALITY_PRESET == 20)\\n    #define FXAA_QUALITY_PS 3\\n    #define FXAA_QUALITY_P0 1.5\\n    #define FXAA_QUALITY_P1 2.0\\n    #define FXAA_QUALITY_P2 8.0\\n#endif\\n/*--------------------------------------------------------------------------*/\\n#if (FXAA_QUALITY_PRESET == 21)\\n    #define FXAA_QUALITY_PS 4\\n    #define FXAA_QUALITY_P0 1.0\\n    #define FXAA_QUALITY_P1 1.5\\n    #define FXAA_QUALITY_P2 2.0\\n    #define FXAA_QUALITY_P3 8.0\\n#endif\\n/*--------------------------------------------------------------------------*/\\n#if (FXAA_QUALITY_PRESET == 22)\\n    #define FXAA_QUALITY_PS 5\\n    #define FXAA_QUALITY_P0 1.0\\n    #define FXAA_QUALITY_P1 1.5\\n    #define FXAA_QUALITY_P2 2.0\\n    #define FXAA_QUALITY_P3 2.0\\n    #define FXAA_QUALITY_P4 8.0\\n#endif\\n/*--------------------------------------------------------------------------*/\\n#if (FXAA_QUALITY_PRESET == 23)\\n    #define FXAA_QUALITY_PS 6\\n    #define FXAA_QUALITY_P0 1.0\\n    #define FXAA_QUALITY_P1 1.5\\n    #define FXAA_QUALITY_P2 2.0\\n    #define FXAA_QUALITY_P3 2.0\\n    #define FXAA_QUALITY_P4 2.0\\n    #define FXAA_QUALITY_P5 8.0\\n#endif\\n/*--------------------------------------------------------------------------*/\\n#if (FXAA_QUALITY_PRESET == 24)\\n    #define FXAA_QUALITY_PS 7\\n    #define FXAA_QUALITY_P0 1.0\\n    #define FXAA_QUALITY_P1 1.5\\n    #define FXAA_QUALITY_P2 2.0\\n    #define FXAA_QUALITY_P3 2.0\\n    #define FXAA_QUALITY_P4 2.0\\n    #define FXAA_QUALITY_P5 3.0\\n    #define FXAA_QUALITY_P6 8.0\\n#endif\\n/*--------------------------------------------------------------------------*/\\n#if (FXAA_QUALITY_PRESET == 25)\\n    #define FXAA_QUALITY_PS 8\\n    #define FXAA_QUALITY_P0 1.0\\n    #define FXAA_QUALITY_P1 1.5\\n    #define FXAA_QUALITY_P2 2.0\\n    #define FXAA_QUALITY_P3 2.0\\n    #define FXAA_QUALITY_P4 2.0\\n    #define FXAA_QUALITY_P5 2.0\\n    #define FXAA_QUALITY_P6 4.0\\n    #define FXAA_QUALITY_P7 8.0\\n#endif\\n/*--------------------------------------------------------------------------*/\\n#if (FXAA_QUALITY_PRESET == 26)\\n    #define FXAA_QUALITY_PS 9\\n    #define FXAA_QUALITY_P0 1.0\\n    #define FXAA_QUALITY_P1 1.5\\n    #define FXAA_QUALITY_P2 2.0\\n    #define FXAA_QUALITY_P3 2.0\\n    #define FXAA_QUALITY_P4 2.0\\n    #define FXAA_QUALITY_P5 2.0\\n    #define FXAA_QUALITY_P6 2.0\\n    #define FXAA_QUALITY_P7 4.0\\n    #define FXAA_QUALITY_P8 8.0\\n#endif\\n/*--------------------------------------------------------------------------*/\\n#if (FXAA_QUALITY_PRESET == 27)\\n    #define FXAA_QUALITY_PS 10\\n    #define FXAA_QUALITY_P0 1.0\\n    #define FXAA_QUALITY_P1 1.5\\n    #define FXAA_QUALITY_P2 2.0\\n    #define FXAA_QUALITY_P3 2.0\\n    #define FXAA_QUALITY_P4 2.0\\n    #define FXAA_QUALITY_P5 2.0\\n    #define FXAA_QUALITY_P6 2.0\\n    #define FXAA_QUALITY_P7 2.0\\n    #define FXAA_QUALITY_P8 4.0\\n    #define FXAA_QUALITY_P9 8.0\\n#endif\\n/*--------------------------------------------------------------------------*/\\n#if (FXAA_QUALITY_PRESET == 28)\\n    #define FXAA_QUALITY_PS 11\\n    #define FXAA_QUALITY_P0 1.0\\n    #define FXAA_QUALITY_P1 1.5\\n    #define FXAA_QUALITY_P2 2.0\\n    #define FXAA_QUALITY_P3 2.0\\n    #define FXAA_QUALITY_P4 2.0\\n    #define FXAA_QUALITY_P5 2.0\\n    #define FXAA_QUALITY_P6 2.0\\n    #define FXAA_QUALITY_P7 2.0\\n    #define FXAA_QUALITY_P8 2.0\\n    #define FXAA_QUALITY_P9 4.0\\n    #define FXAA_QUALITY_P10 8.0\\n#endif\\n/*--------------------------------------------------------------------------*/\\n#if (FXAA_QUALITY_PRESET == 29)\\n    #define FXAA_QUALITY_PS 12\\n    #define FXAA_QUALITY_P0 1.0\\n    #define FXAA_QUALITY_P1 1.5\\n    #define FXAA_QUALITY_P2 2.0\\n    #define FXAA_QUALITY_P3 2.0\\n    #define FXAA_QUALITY_P4 2.0\\n    #define FXAA_QUALITY_P5 2.0\\n    #define FXAA_QUALITY_P6 2.0\\n    #define FXAA_QUALITY_P7 2.0\\n    #define FXAA_QUALITY_P8 2.0\\n    #define FXAA_QUALITY_P9 2.0\\n    #define FXAA_QUALITY_P10 4.0\\n    #define FXAA_QUALITY_P11 8.0\\n#endif\\n\\n/*============================================================================\\n                     FXAA QUALITY - EXTREME QUALITY\\n============================================================================*/\\n#if (FXAA_QUALITY_PRESET == 39)\\n    #define FXAA_QUALITY_PS 12\\n    #define FXAA_QUALITY_P0 1.0\\n    #define FXAA_QUALITY_P1 1.0\\n    #define FXAA_QUALITY_P2 1.0\\n    #define FXAA_QUALITY_P3 1.0\\n    #define FXAA_QUALITY_P4 1.0\\n    #define FXAA_QUALITY_P5 1.5\\n    #define FXAA_QUALITY_P6 2.0\\n    #define FXAA_QUALITY_P7 2.0\\n    #define FXAA_QUALITY_P8 2.0\\n    #define FXAA_QUALITY_P9 2.0\\n    #define FXAA_QUALITY_P10 4.0\\n    #define FXAA_QUALITY_P11 8.0\\n#endif\\n\\n/*============================================================================\\n\\n                                API PORTING\\n\\n============================================================================*/\\n#if (FXAA_GLSL_100 == 1) || (FXAA_GLSL_120 == 1) || (FXAA_GLSL_130 == 1)\\n    #define FxaaBool bool\\n    #define FxaaDiscard discard\\n    #define FxaaFloat float\\n    #define FxaaFloat2 vec2\\n    #define FxaaFloat3 vec3\\n    #define FxaaFloat4 vec4\\n    #define FxaaHalf float\\n    #define FxaaHalf2 vec2\\n    #define FxaaHalf3 vec3\\n    #define FxaaHalf4 vec4\\n    #define FxaaInt2 ivec2\\n    #define FxaaSat(x) clamp(x, 0.0, 1.0)\\n    #define FxaaTex sampler2D\\n#else\\n    #define FxaaBool bool\\n    #define FxaaDiscard clip(-1)\\n    #define FxaaFloat float\\n    #define FxaaFloat2 float2\\n    #define FxaaFloat3 float3\\n    #define FxaaFloat4 float4\\n    #define FxaaHalf half\\n    #define FxaaHalf2 half2\\n    #define FxaaHalf3 half3\\n    #define FxaaHalf4 half4\\n    #define FxaaSat(x) saturate(x)\\n#endif\\n/*--------------------------------------------------------------------------*/\\n#if (FXAA_GLSL_100 == 1)\\n  #define FxaaTexTop(t, p) texture2D(t, p, 0.0)\\n  #define FxaaTexOff(t, p, o, r) texture2D(t, p + (o * r), 0.0)\\n#endif\\n/*--------------------------------------------------------------------------*/\\n#if (FXAA_GLSL_120 == 1)\\n    // Requires,\\n    //  #version 120\\n    // And at least,\\n    //  #extension GL_EXT_gpu_shader4 : enable\\n    //  (or set FXAA_FAST_PIXEL_OFFSET 1 to work like DX9)\\n    #define FxaaTexTop(t, p) texture2DLod(t, p, 0.0)\\n    #if (FXAA_FAST_PIXEL_OFFSET == 1)\\n        #define FxaaTexOff(t, p, o, r) texture2DLodOffset(t, p, 0.0, o)\\n    #else\\n        #define FxaaTexOff(t, p, o, r) texture2DLod(t, p + (o * r), 0.0)\\n    #endif\\n    #if (FXAA_GATHER4_ALPHA == 1)\\n        // use #extension GL_ARB_gpu_shader5 : enable\\n        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)\\n        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)\\n        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)\\n        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)\\n    #endif\\n#endif\\n/*--------------------------------------------------------------------------*/\\n#if (FXAA_GLSL_130 == 1)\\n    #define FxaaTexTop(t, p) textureLod(t, p, 0.0)\\n    #define FxaaTexOff(t, p, o, r) textureLodOffset(t, p, 0.0, o)\\n    #if (FXAA_GATHER4_ALPHA == 1)\\n        // use #extension GL_ARB_gpu_shader5 : enable\\n        #define FxaaTexAlpha4(t, p) textureGather(t, p, 3)\\n        #define FxaaTexOffAlpha4(t, p, o) textureGatherOffset(t, p, o, 3)\\n        #define FxaaTexGreen4(t, p) textureGather(t, p, 1)\\n        #define FxaaTexOffGreen4(t, p, o) textureGatherOffset(t, p, o, 1)\\n    #endif\\n#endif\\n/*--------------------------------------------------------------------------*/\\n#if (FXAA_HLSL_3 == 1)\\n    #define FxaaInt2 float2\\n    #define FxaaTex sampler2D\\n    #define FxaaTexTop(t, p) tex2Dlod(t, float4(p, 0.0, 0.0))\\n    #define FxaaTexOff(t, p, o, r) tex2Dlod(t, float4(p + (o * r), 0, 0))\\n#endif\\n/*--------------------------------------------------------------------------*/\\n#if (FXAA_HLSL_4 == 1)\\n    #define FxaaInt2 int2\\n    struct FxaaTex { SamplerState smpl; Texture2D tex; };\\n    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)\\n    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)\\n#endif\\n/*--------------------------------------------------------------------------*/\\n#if (FXAA_HLSL_5 == 1)\\n    #define FxaaInt2 int2\\n    struct FxaaTex { SamplerState smpl; Texture2D tex; };\\n    #define FxaaTexTop(t, p) t.tex.SampleLevel(t.smpl, p, 0.0)\\n    #define FxaaTexOff(t, p, o, r) t.tex.SampleLevel(t.smpl, p, 0.0, o)\\n    #define FxaaTexAlpha4(t, p) t.tex.GatherAlpha(t.smpl, p)\\n    #define FxaaTexOffAlpha4(t, p, o) t.tex.GatherAlpha(t.smpl, p, o)\\n    #define FxaaTexGreen4(t, p) t.tex.GatherGreen(t.smpl, p)\\n    #define FxaaTexOffGreen4(t, p, o) t.tex.GatherGreen(t.smpl, p, o)\\n#endif\\n\\n/*============================================================================\\n                   GREEN AS LUMA OPTION SUPPORT FUNCTION\\n============================================================================*/\\n#if (FXAA_GREEN_AS_LUMA == 0)\\n    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.w; }\\n#else\\n    FxaaFloat FxaaLuma(FxaaFloat4 rgba) { return rgba.y; }\\n#endif\\n\\n/*============================================================================\\n\\n                             FXAA3 QUALITY - PC\\n\\n============================================================================*/\\n#if (FXAA_PC == 1)\\n/*--------------------------------------------------------------------------*/\\nFxaaFloat4 FxaaPixelShader(\\n    //\\n    // Use noperspective interpolation here (turn off perspective interpolation).\\n    // {xy} = center of pixel\\n    FxaaFloat2 pos,\\n    //\\n    // Used only for FXAA Console, and not used on the 360 version.\\n    // Use noperspective interpolation here (turn off perspective interpolation).\\n    // {xy_} = upper left of pixel\\n    // {_zw} = lower right of pixel\\n    FxaaFloat4 fxaaConsolePosPos,\\n    //\\n    // Input color texture.\\n    // {rgb_} = color in linear or perceptual color space\\n    // if (FXAA_GREEN_AS_LUMA == 0)\\n    //     {__a} = luma in perceptual color space (not linear)\\n    FxaaTex tex,\\n    //\\n    // Only used on the optimized 360 version of FXAA Console.\\n    // For everything but 360, just use the same input here as for tex.\\n    // For 360, same texture, just alias with a 2nd sampler.\\n    // This sampler needs to have an exponent bias of -1.\\n    FxaaTex fxaaConsole360TexExpBiasNegOne,\\n    //\\n    // Only used on the optimized 360 version of FXAA Console.\\n    // For everything but 360, just use the same input here as for tex.\\n    // For 360, same texture, just alias with a 3nd sampler.\\n    // This sampler needs to have an exponent bias of -2.\\n    FxaaTex fxaaConsole360TexExpBiasNegTwo,\\n    //\\n    // Only used on FXAA Quality.\\n    // This must be from a constant/uniform.\\n    // {x_} = 1.0/screenWidthInPixels\\n    // {_y} = 1.0/screenHeightInPixels\\n    FxaaFloat2 fxaaQualityRcpFrame,\\n    //\\n    // Only used on FXAA Console.\\n    // This must be from a constant/uniform.\\n    // This effects sub-pixel AA quality and inversely sharpness.\\n    //   Where N ranges between,\\n    //     N = 0.50 (default)\\n    //     N = 0.33 (sharper)\\n    // {x__} = -N/screenWidthInPixels\\n    // {_y_} = -N/screenHeightInPixels\\n    // {_z_} =  N/screenWidthInPixels\\n    // {__w} =  N/screenHeightInPixels\\n    FxaaFloat4 fxaaConsoleRcpFrameOpt,\\n    //\\n    // Only used on FXAA Console.\\n    // Not used on 360, but used on PS3 and PC.\\n    // This must be from a constant/uniform.\\n    // {x__} = -2.0/screenWidthInPixels\\n    // {_y_} = -2.0/screenHeightInPixels\\n    // {_z_} =  2.0/screenWidthInPixels\\n    // {__w} =  2.0/screenHeightInPixels\\n    FxaaFloat4 fxaaConsoleRcpFrameOpt2,\\n    //\\n    // Only used on FXAA Console.\\n    // Only used on 360 in place of fxaaConsoleRcpFrameOpt2.\\n    // This must be from a constant/uniform.\\n    // {x__} =  8.0/screenWidthInPixels\\n    // {_y_} =  8.0/screenHeightInPixels\\n    // {_z_} = -4.0/screenWidthInPixels\\n    // {__w} = -4.0/screenHeightInPixels\\n    FxaaFloat4 fxaaConsole360RcpFrameOpt2,\\n    //\\n    // Only used on FXAA Quality.\\n    // This used to be the FXAA_QUALITY_SUBPIX define.\\n    // It is here now to allow easier tuning.\\n    // Choose the amount of sub-pixel aliasing removal.\\n    // This can effect sharpness.\\n    //   1.00 - upper limit (softer)\\n    //   0.75 - default amount of filtering\\n    //   0.50 - lower limit (sharper, less sub-pixel aliasing removal)\\n    //   0.25 - almost off\\n    //   0.00 - completely off\\n    FxaaFloat fxaaQualitySubpix,\\n    //\\n    // Only used on FXAA Quality.\\n    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD define.\\n    // It is here now to allow easier tuning.\\n    // The minimum amount of local contrast required to apply algorithm.\\n    //   0.333 - too little (faster)\\n    //   0.250 - low quality\\n    //   0.166 - default\\n    //   0.125 - high quality\\n    //   0.063 - overkill (slower)\\n    FxaaFloat fxaaQualityEdgeThreshold,\\n    //\\n    // Only used on FXAA Quality.\\n    // This used to be the FXAA_QUALITY_EDGE_THRESHOLD_MIN define.\\n    // It is here now to allow easier tuning.\\n    // Trims the algorithm from processing darks.\\n    //   0.0833 - upper limit (default, the start of visible unfiltered edges)\\n    //   0.0625 - high quality (faster)\\n    //   0.0312 - visible limit (slower)\\n    // Special notes when using FXAA_GREEN_AS_LUMA,\\n    //   Likely want to set this to zero.\\n    //   As colors that are mostly not-green\\n    //   will appear very dark in the green channel!\\n    //   Tune by looking at mostly non-green content,\\n    //   then start at zero and increase until aliasing is a problem.\\n    FxaaFloat fxaaQualityEdgeThresholdMin,\\n    //\\n    // Only used on FXAA Console.\\n    // This used to be the FXAA_CONSOLE_EDGE_SHARPNESS define.\\n    // It is here now to allow easier tuning.\\n    // This does not effect PS3, as this needs to be compiled in.\\n    //   Use FXAA_CONSOLE_PS3_EDGE_SHARPNESS for PS3.\\n    //   Due to the PS3 being ALU bound,\\n    //   there are only three safe values here: 2 and 4 and 8.\\n    //   These options use the shaders ability to a free *|/ by 2|4|8.\\n    // For all other platforms can be a non-power of two.\\n    //   8.0 is sharper (default!!!)\\n    //   4.0 is softer\\n    //   2.0 is really soft (good only for vector graphics inputs)\\n    FxaaFloat fxaaConsoleEdgeSharpness,\\n    //\\n    // Only used on FXAA Console.\\n    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD define.\\n    // It is here now to allow easier tuning.\\n    // This does not effect PS3, as this needs to be compiled in.\\n    //   Use FXAA_CONSOLE_PS3_EDGE_THRESHOLD for PS3.\\n    //   Due to the PS3 being ALU bound,\\n    //   there are only two safe values here: 1/4 and 1/8.\\n    //   These options use the shaders ability to a free *|/ by 2|4|8.\\n    // The console setting has a different mapping than the quality setting.\\n    // Other platforms can use other values.\\n    //   0.125 leaves less aliasing, but is softer (default!!!)\\n    //   0.25 leaves more aliasing, and is sharper\\n    FxaaFloat fxaaConsoleEdgeThreshold,\\n    //\\n    // Only used on FXAA Console.\\n    // This used to be the FXAA_CONSOLE_EDGE_THRESHOLD_MIN define.\\n    // It is here now to allow easier tuning.\\n    // Trims the algorithm from processing darks.\\n    // The console setting has a different mapping than the quality setting.\\n    // This only applies when FXAA_EARLY_EXIT is 1.\\n    // This does not apply to PS3,\\n    // PS3 was simplified to avoid more shader instructions.\\n    //   0.06 - faster but more aliasing in darks\\n    //   0.05 - default\\n    //   0.04 - slower and less aliasing in darks\\n    // Special notes when using FXAA_GREEN_AS_LUMA,\\n    //   Likely want to set this to zero.\\n    //   As colors that are mostly not-green\\n    //   will appear very dark in the green channel!\\n    //   Tune by looking at mostly non-green content,\\n    //   then start at zero and increase until aliasing is a problem.\\n    FxaaFloat fxaaConsoleEdgeThresholdMin,\\n    //\\n    // Extra constants for 360 FXAA Console only.\\n    // Use zeros or anything else for other platforms.\\n    // These must be in physical constant registers and NOT immediates.\\n    // Immediates will result in compiler un-optimizing.\\n    // {xyzw} = float4(1.0, -1.0, 0.25, -0.25)\\n    FxaaFloat4 fxaaConsole360ConstDir\\n) {\\n/*--------------------------------------------------------------------------*/\\n    FxaaFloat2 posM;\\n    posM.x = pos.x;\\n    posM.y = pos.y;\\n    #if (FXAA_GATHER4_ALPHA == 1)\\n        #if (FXAA_DISCARD == 0)\\n            FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);\\n            #if (FXAA_GREEN_AS_LUMA == 0)\\n                #define lumaM rgbyM.w\\n            #else\\n                #define lumaM rgbyM.y\\n            #endif\\n        #endif\\n        #if (FXAA_GREEN_AS_LUMA == 0)\\n            FxaaFloat4 luma4A = FxaaTexAlpha4(tex, posM);\\n            FxaaFloat4 luma4B = FxaaTexOffAlpha4(tex, posM, FxaaInt2(-1, -1));\\n        #else\\n            FxaaFloat4 luma4A = FxaaTexGreen4(tex, posM);\\n            FxaaFloat4 luma4B = FxaaTexOffGreen4(tex, posM, FxaaInt2(-1, -1));\\n        #endif\\n        #if (FXAA_DISCARD == 1)\\n            #define lumaM luma4A.w\\n        #endif\\n        #define lumaE luma4A.z\\n        #define lumaS luma4A.x\\n        #define lumaSE luma4A.y\\n        #define lumaNW luma4B.w\\n        #define lumaN luma4B.z\\n        #define lumaW luma4B.x\\n    #else\\n        FxaaFloat4 rgbyM = FxaaTexTop(tex, posM);\\n        #if (FXAA_GREEN_AS_LUMA == 0)\\n            #define lumaM rgbyM.w\\n        #else\\n            #define lumaM rgbyM.y\\n        #endif\\n        #if (FXAA_GLSL_100 == 1)\\n          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0, 1.0), fxaaQualityRcpFrame.xy));\\n          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 0.0), fxaaQualityRcpFrame.xy));\\n          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 0.0,-1.0), fxaaQualityRcpFrame.xy));\\n          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 0.0), fxaaQualityRcpFrame.xy));\\n        #else\\n          FxaaFloat lumaS = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0, 1), fxaaQualityRcpFrame.xy));\\n          FxaaFloat lumaE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 0), fxaaQualityRcpFrame.xy));\\n          FxaaFloat lumaN = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 0,-1), fxaaQualityRcpFrame.xy));\\n          FxaaFloat lumaW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 0), fxaaQualityRcpFrame.xy));\\n        #endif\\n    #endif\\n/*--------------------------------------------------------------------------*/\\n    FxaaFloat maxSM = max(lumaS, lumaM);\\n    FxaaFloat minSM = min(lumaS, lumaM);\\n    FxaaFloat maxESM = max(lumaE, maxSM);\\n    FxaaFloat minESM = min(lumaE, minSM);\\n    FxaaFloat maxWN = max(lumaN, lumaW);\\n    FxaaFloat minWN = min(lumaN, lumaW);\\n    FxaaFloat rangeMax = max(maxWN, maxESM);\\n    FxaaFloat rangeMin = min(minWN, minESM);\\n    FxaaFloat rangeMaxScaled = rangeMax * fxaaQualityEdgeThreshold;\\n    FxaaFloat range = rangeMax - rangeMin;\\n    FxaaFloat rangeMaxClamped = max(fxaaQualityEdgeThresholdMin, rangeMaxScaled);\\n    FxaaBool earlyExit = range < rangeMaxClamped;\\n/*--------------------------------------------------------------------------*/\\n    if(earlyExit)\\n        #if (FXAA_DISCARD == 1)\\n            FxaaDiscard;\\n        #else\\n            return rgbyM;\\n        #endif\\n/*--------------------------------------------------------------------------*/\\n    #if (FXAA_GATHER4_ALPHA == 0)\\n        #if (FXAA_GLSL_100 == 1)\\n          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0,-1.0), fxaaQualityRcpFrame.xy));\\n          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0, 1.0), fxaaQualityRcpFrame.xy));\\n          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2( 1.0,-1.0), fxaaQualityRcpFrame.xy));\\n          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaFloat2(-1.0, 1.0), fxaaQualityRcpFrame.xy));\\n        #else\\n          FxaaFloat lumaNW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1,-1), fxaaQualityRcpFrame.xy));\\n          FxaaFloat lumaSE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1, 1), fxaaQualityRcpFrame.xy));\\n          FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2( 1,-1), fxaaQualityRcpFrame.xy));\\n          FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\\n        #endif\\n    #else\\n        FxaaFloat lumaNE = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(1, -1), fxaaQualityRcpFrame.xy));\\n        FxaaFloat lumaSW = FxaaLuma(FxaaTexOff(tex, posM, FxaaInt2(-1, 1), fxaaQualityRcpFrame.xy));\\n    #endif\\n/*--------------------------------------------------------------------------*/\\n    FxaaFloat lumaNS = lumaN + lumaS;\\n    FxaaFloat lumaWE = lumaW + lumaE;\\n    FxaaFloat subpixRcpRange = 1.0/range;\\n    FxaaFloat subpixNSWE = lumaNS + lumaWE;\\n    FxaaFloat edgeHorz1 = (-2.0 * lumaM) + lumaNS;\\n    FxaaFloat edgeVert1 = (-2.0 * lumaM) + lumaWE;\\n/*--------------------------------------------------------------------------*/\\n    FxaaFloat lumaNESE = lumaNE + lumaSE;\\n    FxaaFloat lumaNWNE = lumaNW + lumaNE;\\n    FxaaFloat edgeHorz2 = (-2.0 * lumaE) + lumaNESE;\\n    FxaaFloat edgeVert2 = (-2.0 * lumaN) + lumaNWNE;\\n/*--------------------------------------------------------------------------*/\\n    FxaaFloat lumaNWSW = lumaNW + lumaSW;\\n    FxaaFloat lumaSWSE = lumaSW + lumaSE;\\n    FxaaFloat edgeHorz4 = (abs(edgeHorz1) * 2.0) + abs(edgeHorz2);\\n    FxaaFloat edgeVert4 = (abs(edgeVert1) * 2.0) + abs(edgeVert2);\\n    FxaaFloat edgeHorz3 = (-2.0 * lumaW) + lumaNWSW;\\n    FxaaFloat edgeVert3 = (-2.0 * lumaS) + lumaSWSE;\\n    FxaaFloat edgeHorz = abs(edgeHorz3) + edgeHorz4;\\n    FxaaFloat edgeVert = abs(edgeVert3) + edgeVert4;\\n/*--------------------------------------------------------------------------*/\\n    FxaaFloat subpixNWSWNESE = lumaNWSW + lumaNESE;\\n    FxaaFloat lengthSign = fxaaQualityRcpFrame.x;\\n    FxaaBool horzSpan = edgeHorz >= edgeVert;\\n    FxaaFloat subpixA = subpixNSWE * 2.0 + subpixNWSWNESE;\\n/*--------------------------------------------------------------------------*/\\n    if(!horzSpan) lumaN = lumaW;\\n    if(!horzSpan) lumaS = lumaE;\\n    if(horzSpan) lengthSign = fxaaQualityRcpFrame.y;\\n    FxaaFloat subpixB = (subpixA * (1.0/12.0)) - lumaM;\\n/*--------------------------------------------------------------------------*/\\n    FxaaFloat gradientN = lumaN - lumaM;\\n    FxaaFloat gradientS = lumaS - lumaM;\\n    FxaaFloat lumaNN = lumaN + lumaM;\\n    FxaaFloat lumaSS = lumaS + lumaM;\\n    FxaaBool pairN = abs(gradientN) >= abs(gradientS);\\n    FxaaFloat gradient = max(abs(gradientN), abs(gradientS));\\n    if(pairN) lengthSign = -lengthSign;\\n    FxaaFloat subpixC = FxaaSat(abs(subpixB) * subpixRcpRange);\\n/*--------------------------------------------------------------------------*/\\n    FxaaFloat2 posB;\\n    posB.x = posM.x;\\n    posB.y = posM.y;\\n    FxaaFloat2 offNP;\\n    offNP.x = (!horzSpan) ? 0.0 : fxaaQualityRcpFrame.x;\\n    offNP.y = ( horzSpan) ? 0.0 : fxaaQualityRcpFrame.y;\\n    if(!horzSpan) posB.x += lengthSign * 0.5;\\n    if( horzSpan) posB.y += lengthSign * 0.5;\\n/*--------------------------------------------------------------------------*/\\n    FxaaFloat2 posN;\\n    posN.x = posB.x - offNP.x * FXAA_QUALITY_P0;\\n    posN.y = posB.y - offNP.y * FXAA_QUALITY_P0;\\n    FxaaFloat2 posP;\\n    posP.x = posB.x + offNP.x * FXAA_QUALITY_P0;\\n    posP.y = posB.y + offNP.y * FXAA_QUALITY_P0;\\n    FxaaFloat subpixD = ((-2.0)*subpixC) + 3.0;\\n    FxaaFloat lumaEndN = FxaaLuma(FxaaTexTop(tex, posN));\\n    FxaaFloat subpixE = subpixC * subpixC;\\n    FxaaFloat lumaEndP = FxaaLuma(FxaaTexTop(tex, posP));\\n/*--------------------------------------------------------------------------*/\\n    if(!pairN) lumaNN = lumaSS;\\n    FxaaFloat gradientScaled = gradient * 1.0/4.0;\\n    FxaaFloat lumaMM = lumaM - lumaNN * 0.5;\\n    FxaaFloat subpixF = subpixD * subpixE;\\n    FxaaBool lumaMLTZero = lumaMM < 0.0;\\n/*--------------------------------------------------------------------------*/\\n    lumaEndN -= lumaNN * 0.5;\\n    lumaEndP -= lumaNN * 0.5;\\n    FxaaBool doneN = abs(lumaEndN) >= gradientScaled;\\n    FxaaBool doneP = abs(lumaEndP) >= gradientScaled;\\n    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P1;\\n    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P1;\\n    FxaaBool doneNP = (!doneN) || (!doneP);\\n    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P1;\\n    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P1;\\n/*--------------------------------------------------------------------------*/\\n    if(doneNP) {\\n        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\\n        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\\n        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\\n        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\\n        doneN = abs(lumaEndN) >= gradientScaled;\\n        doneP = abs(lumaEndP) >= gradientScaled;\\n        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P2;\\n        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P2;\\n        doneNP = (!doneN) || (!doneP);\\n        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P2;\\n        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P2;\\n/*--------------------------------------------------------------------------*/\\n        #if (FXAA_QUALITY_PS > 3)\\n        if(doneNP) {\\n            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\\n            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\\n            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\\n            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\\n            doneN = abs(lumaEndN) >= gradientScaled;\\n            doneP = abs(lumaEndP) >= gradientScaled;\\n            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P3;\\n            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P3;\\n            doneNP = (!doneN) || (!doneP);\\n            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P3;\\n            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P3;\\n/*--------------------------------------------------------------------------*/\\n            #if (FXAA_QUALITY_PS > 4)\\n            if(doneNP) {\\n                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\\n                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\\n                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\\n                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\\n                doneN = abs(lumaEndN) >= gradientScaled;\\n                doneP = abs(lumaEndP) >= gradientScaled;\\n                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P4;\\n                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P4;\\n                doneNP = (!doneN) || (!doneP);\\n                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P4;\\n                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P4;\\n/*--------------------------------------------------------------------------*/\\n                #if (FXAA_QUALITY_PS > 5)\\n                if(doneNP) {\\n                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\\n                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\\n                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\\n                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\\n                    doneN = abs(lumaEndN) >= gradientScaled;\\n                    doneP = abs(lumaEndP) >= gradientScaled;\\n                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P5;\\n                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P5;\\n                    doneNP = (!doneN) || (!doneP);\\n                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P5;\\n                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P5;\\n/*--------------------------------------------------------------------------*/\\n                    #if (FXAA_QUALITY_PS > 6)\\n                    if(doneNP) {\\n                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\\n                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\\n                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\\n                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\\n                        doneN = abs(lumaEndN) >= gradientScaled;\\n                        doneP = abs(lumaEndP) >= gradientScaled;\\n                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P6;\\n                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P6;\\n                        doneNP = (!doneN) || (!doneP);\\n                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P6;\\n                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P6;\\n/*--------------------------------------------------------------------------*/\\n                        #if (FXAA_QUALITY_PS > 7)\\n                        if(doneNP) {\\n                            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\\n                            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\\n                            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\\n                            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\\n                            doneN = abs(lumaEndN) >= gradientScaled;\\n                            doneP = abs(lumaEndP) >= gradientScaled;\\n                            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P7;\\n                            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P7;\\n                            doneNP = (!doneN) || (!doneP);\\n                            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P7;\\n                            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P7;\\n/*--------------------------------------------------------------------------*/\\n    #if (FXAA_QUALITY_PS > 8)\\n    if(doneNP) {\\n        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\\n        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\\n        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\\n        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\\n        doneN = abs(lumaEndN) >= gradientScaled;\\n        doneP = abs(lumaEndP) >= gradientScaled;\\n        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P8;\\n        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P8;\\n        doneNP = (!doneN) || (!doneP);\\n        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P8;\\n        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P8;\\n/*--------------------------------------------------------------------------*/\\n        #if (FXAA_QUALITY_PS > 9)\\n        if(doneNP) {\\n            if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\\n            if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\\n            if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\\n            if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\\n            doneN = abs(lumaEndN) >= gradientScaled;\\n            doneP = abs(lumaEndP) >= gradientScaled;\\n            if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P9;\\n            if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P9;\\n            doneNP = (!doneN) || (!doneP);\\n            if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P9;\\n            if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P9;\\n/*--------------------------------------------------------------------------*/\\n            #if (FXAA_QUALITY_PS > 10)\\n            if(doneNP) {\\n                if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\\n                if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\\n                if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\\n                if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\\n                doneN = abs(lumaEndN) >= gradientScaled;\\n                doneP = abs(lumaEndP) >= gradientScaled;\\n                if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P10;\\n                if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P10;\\n                doneNP = (!doneN) || (!doneP);\\n                if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P10;\\n                if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P10;\\n/*--------------------------------------------------------------------------*/\\n                #if (FXAA_QUALITY_PS > 11)\\n                if(doneNP) {\\n                    if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\\n                    if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\\n                    if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\\n                    if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\\n                    doneN = abs(lumaEndN) >= gradientScaled;\\n                    doneP = abs(lumaEndP) >= gradientScaled;\\n                    if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P11;\\n                    if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P11;\\n                    doneNP = (!doneN) || (!doneP);\\n                    if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P11;\\n                    if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P11;\\n/*--------------------------------------------------------------------------*/\\n                    #if (FXAA_QUALITY_PS > 12)\\n                    if(doneNP) {\\n                        if(!doneN) lumaEndN = FxaaLuma(FxaaTexTop(tex, posN.xy));\\n                        if(!doneP) lumaEndP = FxaaLuma(FxaaTexTop(tex, posP.xy));\\n                        if(!doneN) lumaEndN = lumaEndN - lumaNN * 0.5;\\n                        if(!doneP) lumaEndP = lumaEndP - lumaNN * 0.5;\\n                        doneN = abs(lumaEndN) >= gradientScaled;\\n                        doneP = abs(lumaEndP) >= gradientScaled;\\n                        if(!doneN) posN.x -= offNP.x * FXAA_QUALITY_P12;\\n                        if(!doneN) posN.y -= offNP.y * FXAA_QUALITY_P12;\\n                        doneNP = (!doneN) || (!doneP);\\n                        if(!doneP) posP.x += offNP.x * FXAA_QUALITY_P12;\\n                        if(!doneP) posP.y += offNP.y * FXAA_QUALITY_P12;\\n/*--------------------------------------------------------------------------*/\\n                    }\\n                    #endif\\n/*--------------------------------------------------------------------------*/\\n                }\\n                #endif\\n/*--------------------------------------------------------------------------*/\\n            }\\n            #endif\\n/*--------------------------------------------------------------------------*/\\n        }\\n        #endif\\n/*--------------------------------------------------------------------------*/\\n    }\\n    #endif\\n/*--------------------------------------------------------------------------*/\\n                        }\\n                        #endif\\n/*--------------------------------------------------------------------------*/\\n                    }\\n                    #endif\\n/*--------------------------------------------------------------------------*/\\n                }\\n                #endif\\n/*--------------------------------------------------------------------------*/\\n            }\\n            #endif\\n/*--------------------------------------------------------------------------*/\\n        }\\n        #endif\\n/*--------------------------------------------------------------------------*/\\n    }\\n/*--------------------------------------------------------------------------*/\\n    FxaaFloat dstN = posM.x - posN.x;\\n    FxaaFloat dstP = posP.x - posM.x;\\n    if(!horzSpan) dstN = posM.y - posN.y;\\n    if(!horzSpan) dstP = posP.y - posM.y;\\n/*--------------------------------------------------------------------------*/\\n    FxaaBool goodSpanN = (lumaEndN < 0.0) != lumaMLTZero;\\n    FxaaFloat spanLength = (dstP + dstN);\\n    FxaaBool goodSpanP = (lumaEndP < 0.0) != lumaMLTZero;\\n    FxaaFloat spanLengthRcp = 1.0/spanLength;\\n/*--------------------------------------------------------------------------*/\\n    FxaaBool directionN = dstN < dstP;\\n    FxaaFloat dst = min(dstN, dstP);\\n    FxaaBool goodSpan = directionN ? goodSpanN : goodSpanP;\\n    FxaaFloat subpixG = subpixF * subpixF;\\n    FxaaFloat pixelOffset = (dst * (-spanLengthRcp)) + 0.5;\\n    FxaaFloat subpixH = subpixG * fxaaQualitySubpix;\\n/*--------------------------------------------------------------------------*/\\n    FxaaFloat pixelOffsetGood = goodSpan ? pixelOffset : 0.0;\\n    FxaaFloat pixelOffsetSubpix = max(pixelOffsetGood, subpixH);\\n    if(!horzSpan) posM.x += pixelOffsetSubpix * lengthSign;\\n    if( horzSpan) posM.y += pixelOffsetSubpix * lengthSign;\\n    #if (FXAA_DISCARD == 1)\\n        return FxaaTexTop(tex, posM);\\n    #else\\n        return FxaaFloat4(FxaaTexTop(tex, posM).xyz, lumaM);\\n    #endif\\n}\\n/*==========================================================================*/\\n#endif\\n\\nvoid main() {\\n  gl_FragColor = FxaaPixelShader(\\n    vUv,\\n    vec4(0.0),\\n    inputBuffer,\\n    inputBuffer,\\n    inputBuffer,\\n    resolution,\\n    vec4(0.0),\\n    vec4(0.0),\\n    vec4(0.0),\\n    0.75,\\n    0.166,\\n    0.0833,\\n    0.0,\\n    0.0,\\n    0.0,\\n    vec4(0.0)\\n  );\\n\\n  // TODO avoid querying texture twice for same texel\\n  gl_FragColor.a = texture2D(inputBuffer, vUv).a;\\n}\";","import { ShaderMaterial, Uniform, Vector2 } from 'three';\r\nimport fragmentShader from './shaders/fxaa/shader.fs';\r\nimport vertexShader from './shaders/common/shader.vs';\r\n\r\nexport class FXAAMaterial extends ShaderMaterial {\r\n\tconstructor() {\r\n\t\tsuper({\r\n\t\t\ttype: 'FXAAMaterial',\r\n\r\n\t\t\tuniforms: {\r\n\t\t\t\tinputBuffer: new Uniform(null),\r\n\t\t\t\tresolution: { value: new Vector2(1 / window.innerWidth, 1 / window.innerHeight) }\r\n\t\t\t},\r\n\r\n\t\t\tfragmentShader,\r\n\t\t\tvertexShader,\r\n\r\n\t\t\tdepthWrite: false,\r\n\t\t\tdepthTest: false\r\n\t\t});\r\n\t}\r\n}\r\n","import { ShaderMaterial, Uniform, Vector2, DataTexture, RGBFormat } from 'three';\r\nimport fragmentShader from './shaders/glitch/shader.fs';\r\nimport vertexShader from './shaders/common/shader.vs';\r\nimport { randomFloat } from 'JS/Utils';\r\n\r\nexport class GlitchMaterial extends ShaderMaterial {\r\n\tconstructor({ dtSize = 64 } = {}) {\r\n\t\tsuper({\r\n\t\t\ttype: 'GlitchMaterial',\r\n\r\n\t\t\tuniforms: {\r\n\t\t\t\tinputBuffer: new Uniform(null),\r\n\t\t\t\tactive: new Uniform(false),\r\n\t\t\t\tperturbationMap: new Uniform(null),\r\n\t\t\t\tcolumns: new Uniform(0.015),\r\n\t\t\t\trandom: new Uniform(0.01),\r\n\t\t\t\tseed: new Uniform(new Vector2()),\r\n\t\t\t\tdistortion: new Uniform(new Vector2())\r\n\t\t\t},\r\n\r\n\t\t\tfragmentShader,\r\n\t\t\tvertexShader,\r\n\r\n\t\t\tdepthWrite: false,\r\n\t\t\tdepthTest: false\r\n\t\t});\r\n\r\n\t\tlet map = this.generatePerturbationMap(dtSize);\r\n\t\tthis.uniforms.perturbationMap.value = map;\r\n\t}\r\n\r\n\tget active() {\r\n\t\treturn this.uniforms.active.value;\r\n\t}\r\n\r\n\tset active(val) {\r\n\t\tthis.uniforms.active.value = val;\r\n\t}\r\n\r\n\tgeneratePerturbationMap(size = 64) {\r\n\t\tconst pixels = size * size;\r\n\t\tconst data = new Uint8Array(pixels * 3);\r\n\r\n\t\tlet i, l, x;\r\n\t\tfor (i = 0, l = data.length; i < l; i += 3) {\r\n\t\t\tx = Math.random() * 255;\r\n\t\t\tdata[i] = x;\r\n\t\t\tdata[i + 1] = x;\r\n\t\t\tdata[i + 2] = x;\r\n\t\t}\r\n\r\n\t\tconst map = new DataTexture(data, size, size, RGBFormat);\r\n\t\tmap.needsUpdate = true;\r\n\r\n\t\treturn map;\r\n\t}\r\n\r\n\tupdate() {\r\n\t\tif (!this.active) return;\r\n\r\n\t\tthis.uniforms.random.value = Math.random();\r\n\t\tthis.uniforms.seed.value.set(randomFloat(-1, 1), randomFloat(-1, 1));\r\n\t\tthis.uniforms.distortion.value.set(randomFloat(0.0, 1.0), randomFloat(0.0, 1.0));\r\n\t}\r\n}\r\n","export default \"#define GLSLIFY 1\\nuniform sampler2D inputBuffer;\\nuniform float offset;\\nuniform float darkness;\\n\\nvarying vec2 vUv;\\n\\nvoid main() {\\n\\tvec2 uv = vUv;\\n\\tconst vec2 center = vec2(0.5);\\n\\tvec4 texel = texture2D(inputBuffer, vUv);\\n\\tvec3 color = texel.rgb;\\n\\n\\t#ifdef ESKIL\\n\\t// Eskil's vignette\\n\\tvec2 coord = (uv - center) * vec2(offset);\\n\\tcolor = mix(color, vec3(1.0 - darkness), dot(coord, coord));\\n\\t#else\\n\\t// alternative version from glfx.js\\n\\t// this one makes more \\\"dusty\\\" look (as opposed to \\\"burned\\\")\\n\\tfloat d = distance(uv, center);\\n\\tcolor *= smoothstep(0.8, offset * 0.799, d * (darkness + offset));\\n\\t#endif\\n\\t\\n\\tgl_FragColor = vec4(color, texel.a);\\n}\\n\";","import { ShaderMaterial, Uniform } from 'three';\r\nimport fragmentShader from './shaders/vignette/shader.fs';\r\nimport vertexShader from './shaders/common/shader.vs';\r\n\r\nexport class VignetteMaterial extends ShaderMaterial {\r\n\tconstructor({ offset = 0.5, darkness = 0.5, eskil = false } = {}) {\r\n\t\tsuper({\r\n\t\t\ttype: 'VignetteMaterial',\r\n\r\n\t\t\tuniforms: {\r\n\t\t\t\tinputBuffer: new Uniform(null),\r\n\t\t\t\toffset: new Uniform(offset),\r\n\t\t\t\tdarkness: new Uniform(darkness)\r\n\t\t\t},\r\n\r\n\t\t\tfragmentShader,\r\n\t\t\tvertexShader,\r\n\r\n\t\t\tdepthWrite: false,\r\n\t\t\tdepthTest: false\r\n\t\t});\r\n\r\n\t\tif (eskil) this.defines['ESKIL'] = 1;\r\n\t}\r\n}\r\n","export default \"#define GLSLIFY 1\\nuniform sampler2D inputBuffer;\\nuniform vec2 resolution;\\nuniform vec2 direction;\\n\\nvarying vec2 vUv;\\n\\n//https://github.com/Jam3/glsl-fast-gaussian-blur\\nvec4 blur5(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\\n  vec4 color = vec4(0.0);\\n  vec2 off1 = vec2(1.3333333333333333) * direction;\\n  color += texture2D(image, uv) * 0.29411764705882354;\\n  color += texture2D(image, uv + (off1 / resolution)) * 0.35294117647058826;\\n  color += texture2D(image, uv - (off1 / resolution)) * 0.35294117647058826;\\n  return color;\\n}\\n\\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\\n  vec4 color = vec4(0.0);\\n  vec2 off1 = vec2(1.3846153846) * direction;\\n  vec2 off2 = vec2(3.2307692308) * direction;\\n  color += texture2D(image, uv) * 0.2270270270;\\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\\n  return color;\\n}\\n\\nvec4 blur13(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\\n  vec4 color = vec4(0.0);\\n  vec2 off1 = vec2(1.411764705882353) * direction;\\n  vec2 off2 = vec2(3.2941176470588234) * direction;\\n  vec2 off3 = vec2(5.176470588235294) * direction;\\n  color += texture2D(image, uv) * 0.1964825501511404;\\n  color += texture2D(image, uv + (off1 / resolution)) * 0.2969069646728344;\\n  color += texture2D(image, uv - (off1 / resolution)) * 0.2969069646728344;\\n  color += texture2D(image, uv + (off2 / resolution)) * 0.09447039785044732;\\n  color += texture2D(image, uv - (off2 / resolution)) * 0.09447039785044732;\\n  color += texture2D(image, uv + (off3 / resolution)) * 0.010381362401148057;\\n  color += texture2D(image, uv - (off3 / resolution)) * 0.010381362401148057;\\n  return color;\\n}\\n\\nvoid main() {\\n   gl_FragColor = blur9(inputBuffer, vUv, resolution, direction);\\n}\";","import { ShaderMaterial, Uniform, Vector2 } from 'three';\r\nimport fragmentShader from './shaders/blur/shader.fs';\r\nimport vertexShader from './shaders/common/shader.vs';\r\n\r\nexport class BlurMaterial extends ShaderMaterial {\r\n\tconstructor({ direction = new Vector2(0, 1) } = {}) {\r\n\t\tsuper({\r\n\t\t\ttype: 'BlurMaterial',\r\n\r\n\t\t\tuniforms: {\r\n\t\t\t\tinputBuffer: new Uniform(null),\r\n\t\t\t\tresolution: new Uniform(new Vector2(window.innerWidth, window.innerHeight)),\r\n\t\t\t\tdirection: new Uniform(direction)\r\n\t\t\t},\r\n\r\n\t\t\tfragmentShader,\r\n\t\t\tvertexShader,\r\n\r\n\t\t\tdepthWrite: false,\r\n\t\t\tdepthTest: false\r\n\t\t});\r\n\t}\r\n\r\n\tresize(width, height) {\r\n\t\tthis.material.uniforms.resolution.value.set(width, height);\r\n\t}\r\n}\r\n","function initBGGUI(gui, bgMaterial) {\r\n\tlet bgMaterialUniforms = bgMaterial.uniforms;\r\n\tlet params = {\r\n\t\tbgBaseColor: bgMaterialUniforms.baseColor.value.getStyle(),\r\n\t\tbgArea1Color: bgMaterialUniforms.area1Color.value.getStyle(),\r\n\t\tbgArea2Color: bgMaterialUniforms.area2Color.value.getStyle(),\r\n\t\tbgArea1PosX: bgMaterialUniforms.area1Position.value.x,\r\n\t\tbgArea1PosY: bgMaterialUniforms.area1Position.value.y,\r\n\t\tbgArea2PosX: bgMaterialUniforms.area2Position.value.x,\r\n\t\tbgArea2PosY: bgMaterialUniforms.area2Position.value.y,\r\n\t\tbgStrengthFactor: bgMaterialUniforms.strengthFactor.value,\r\n\t\tbgArea1Radius: bgMaterialUniforms.area1Radius.value,\r\n\t\tbgArea2Radius: bgMaterialUniforms.area2Radius.value,\r\n\t\tbgNoiseStrength: bgMaterialUniforms.noiseStrength.value,\r\n\t\tbgOpacity: bgMaterialUniforms.opacity.value\r\n\t};\r\n\t// Background\r\n\tconst bgFolder = gui.addFolder('Background');\r\n\tbgFolder\r\n\t\t.addColor(params, 'bgBaseColor')\r\n\t\t.name('baseColor')\r\n\t\t.onChange(value => {\r\n\t\t\tbgMaterialUniforms.baseColor.value.setStyle(value);\r\n\t\t});\r\n\t// Area1\r\n\tbgFolder\r\n\t\t.addColor(params, 'bgArea1Color')\r\n\t\t.name('area1Color')\r\n\t\t.onChange(value => {\r\n\t\t\tbgMaterialUniforms.area1Color.value.setStyle(value);\r\n\t\t});\r\n\tbgFolder\r\n\t\t.add(params, 'bgArea1PosX', 0, 1)\r\n\t\t.name('area1PosX')\r\n\t\t.onChange(value => {\r\n\t\t\tbgMaterialUniforms.area1Position.value.x = value;\r\n\t\t});\r\n\tbgFolder\r\n\t\t.add(params, 'bgArea1PosY', 0, 1)\r\n\t\t.step(0.01)\r\n\t\t.name('area1PosY')\r\n\t\t.onChange(value => {\r\n\t\t\tbgMaterialUniforms.area1Position.value.y = value;\r\n\t\t});\r\n\tbgFolder\r\n\t\t.add(params, 'bgArea1Radius', 0, 1)\r\n\t\t.name('area1Radius')\r\n\t\t.onChange(value => {\r\n\t\t\tbgMaterialUniforms.area1Radius.value = value;\r\n\t\t});\r\n\t// Area2\r\n\tbgFolder\r\n\t\t.addColor(params, 'bgArea2Color')\r\n\t\t.name('area2Color')\r\n\t\t.onChange(value => {\r\n\t\t\tbgMaterialUniforms.area2Color.value.setStyle(value);\r\n\t\t});\r\n\tbgFolder\r\n\t\t.add(params, 'bgArea2PosX', 0, 1)\r\n\t\t.name('area2PosX')\r\n\t\t.onChange(value => {\r\n\t\t\tbgMaterialUniforms.area2Position.value.x = value;\r\n\t\t});\r\n\tbgFolder\r\n\t\t.add(params, 'bgArea2PosY', 0, 1)\r\n\t\t.name('area2PosY')\r\n\t\t.onChange(value => {\r\n\t\t\tbgMaterialUniforms.area2Position.value.y = value;\r\n\t\t});\r\n\tbgFolder\r\n\t\t.add(params, 'bgArea2Radius', 0, 1)\r\n\t\t.name('area2Radius')\r\n\t\t.onChange(value => {\r\n\t\t\tbgMaterialUniforms.area2Radius.value = value;\r\n\t\t});\r\n\t// Other\r\n\tbgFolder\r\n\t\t.add(params, 'bgStrengthFactor', 0, 1)\r\n\t\t.name('strengthFactor')\r\n\t\t.onChange(value => {\r\n\t\t\tbgMaterialUniforms.strengthFactor.value = value;\r\n\t\t});\r\n\tbgFolder\r\n\t\t.add(params, 'bgNoiseStrength', 0, 1)\r\n\t\t.name('noiseStrength')\r\n\t\t.onChange(value => {\r\n\t\t\tbgMaterialUniforms.noiseStrength.value = value;\r\n\t\t});\r\n\tbgFolder\r\n\t\t.add(params, 'bgOpacity', 0, 1)\r\n\t\t.name('opacity')\r\n\t\t.onChange(value => {\r\n\t\t\tbgMaterialUniforms.opacity.value = value;\r\n\t\t});\r\n\tbgFolder.open();\r\n}\r\n\r\nfunction initAnimeTitleGUI(gui, material) {\r\n\tlet uniforms = material.uniforms;\r\n\tlet params = {\r\n\t\ttopColor: uniforms.topColor.value.getStyle(),\r\n\t\tbottomColor: uniforms.bottomColor.value.getStyle()\r\n\t};\r\n\t// AnimeNameTitle\r\n\tconst animeTitleFolder = gui.addFolder('AnimeNameTitle');\r\n\tanimeTitleFolder.addColor(params, 'topColor').onChange(value => {\r\n\t\tuniforms.topColor.value.setStyle(value);\r\n\t});\r\n\tanimeTitleFolder.addColor(params, 'bottomColor').onChange(value => {\r\n\t\tuniforms.bottomColor.value.setStyle(value);\r\n\t});\r\n\tanimeTitleFolder.open();\r\n}\r\n\r\nexport { initBGGUI, initAnimeTitleGUI };\r\n","import * as THREE from 'three';\r\nimport { Section } from '../common/Section';\r\nimport { AnimeNameTitle } from '../common/AnimeNameTitle';\r\nimport { BGUniformsConfig, TextUniformConfig, TextConfig, AnimeName, AnimeTitleUniforms } from './const/config';\r\nimport { computeMeshBoundingBox, clamp } from 'JS/Utils';\r\n// Modules\r\nimport { BGMaterial } from 'MODULES/BGMaterial/BGMaterial';\r\nimport { PBRMaterial, PBRProgram } from 'MODULES/PBRMaterial/';\r\nimport { ParticleTexture } from 'MODULES/ParticleTexture/ParticleTexture';\r\nimport { ParticleSnow } from 'MODULES/ParticleSnow/ParticleSnow';\r\nimport { FXAAMaterial, VignetteMaterial } from 'MODULES/PostProcessing/';\r\n\r\nimport { gsap } from 'gsap';\r\nimport { initBGGUI, initAnimeTitleGUI } from '../common/InitGUI';\r\nimport * as dat from 'dat.gui';\r\n\r\nexport class HomeSection extends Section {\r\n\tconstructor(viewer) {\r\n\t\tsuper(viewer);\r\n\t\tthis.name = 'HomeSection';\r\n\t\tthis.debug = 0;\r\n\t\tthis.visible = true;\r\n\t\tthis.scrollSpeed = 0.06;\r\n\t\tthis.pbrProgram = new PBRProgram();\r\n\t\tthis.envRotationMat = { value: new THREE.Matrix3() };\r\n\t\tthis.cameraRotationMatrix = new THREE.Matrix4();\r\n\t\t// Left/Right Rotate limit\r\n\t\tthis.sceneRotateXLimit = Math.PI / 6;\r\n\r\n\t\tthis.cameraInitPos = new THREE.Vector3(1.3, 0, 2.4);\r\n\t\tthis.cameraLookAtPos = new THREE.Vector3(-0.1, 0.4, 0);\r\n\t\tthis.cameraTargetY = this.cameraInitPos.y;\r\n\r\n\t\tthis.particleTextureArr = [];\r\n\r\n\t\tthis.swordModel = null;\r\n\t\tthis.swordModelInitPos = new THREE.Vector3(0, 20, 0);\r\n\t\tthis.swordModelInitRotate = new THREE.Euler(Math.PI / 2, Math.PI, Math.PI);\r\n\t}\r\n\r\n\tinit() {\r\n\t\tthis.initBackground();\r\n\t\tlet environment = this.assetLibrary.get('EnvMap-Industrial');\r\n\t\tlet { sunlightInfo } = environment;\r\n\t\tthis.loadSunLight(sunlightInfo);\r\n\t\tthis.initCamera();\r\n\t\t// Load model\r\n\t\tlet gltfScene = (this.gltfScene = this.assetLibrary.get('Model-FF7').scene);\r\n\t\t// console.log(gltfScene);\r\n\t\tthis.scene.add(gltfScene);\r\n\t\t// Load Shader\r\n\t\tlet { pbrVS, pbrFS } = this.pbrProgram.getPBRShader();\r\n\t\t// Replace PBR Material\r\n\t\tgltfScene.traverse(child => {\r\n\t\t\tif (child.name === 'Sword') this.swordModel = child;\r\n\t\t\tif (child.isMesh) {\r\n\t\t\t\tchild.material = new PBRMaterial(child, environment, {\r\n\t\t\t\t\tpbrVS,\r\n\t\t\t\t\tpbrFS\r\n\t\t\t\t});\r\n\t\t\t\tchild.material.uniforms.uEnvironmentTransform = this.envRotationMat;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis.swordModel.position.copy(this.swordModelInitPos);\r\n\t\tthis.swordModel.rotation.copy(this.swordModelInitRotate);\r\n\t\tif (!this.isMobile) this.initParticleTexture();\r\n\t\tthis.initParticleSnow();\r\n\t\tthis.initText();\r\n\t\tthis.initPostprocessing();\r\n\t\tthis.initEvent();\r\n\r\n\t\tif (this.debug) this.initGUI();\r\n\t}\r\n\r\n\tentryAnime(callBack) {\r\n\t\t// Sword\r\n\t\tgsap.to(this.swordModel.position, {\r\n\t\t\ty: 0,\r\n\t\t\tduration: 1,\r\n\t\t\tdelay: 1,\r\n\t\t\tease: 'power2.out'\r\n\t\t});\r\n\t\tgsap.to(this.swordModel.rotation, {\r\n\t\t\tx: Math.PI / 2,\r\n\t\t\ty: 0,\r\n\t\t\tz: 0,\r\n\t\t\tduration: 1,\r\n\t\t\tdelay: 1,\r\n\t\t\tease: 'power2.out'\r\n\t\t});\r\n\t\t// Post\r\n\t\tgsap.to(this.vignetteMaterial.uniforms.darkness, {\r\n\t\t\tvalue: 0.4,\r\n\t\t\tduration: 1.3,\r\n\t\t\tdelay: 1.2,\r\n\t\t\tease: 'power2.out'\r\n\t\t});\r\n\t\t// Camera\r\n\t\tgsap.to(this.camera.position, {\r\n\t\t\tz: 1.4,\r\n\t\t\tduration: 1.2,\r\n\t\t\tdelay: 1.2,\r\n\t\t\tonUpdate: () => {\r\n\t\t\t\tthis.camera.lookAt(this.cameraLookAtPos);\r\n\t\t\t}\r\n\t\t});\r\n\t\t// Particle\r\n\t\tgsap.delayedCall(1.8, () => {\r\n\t\t\tthis.particleTextureArr.forEach(particleTexture => {\r\n\t\t\t\tif (particleTexture)\r\n\t\t\t\t\tgsap.to(particleTexture.material.uniforms.uSize, {\r\n\t\t\t\t\t\tvalue: 1.5,\r\n\t\t\t\t\t\tduration: 1\r\n\t\t\t\t\t});\r\n\t\t\t});\r\n\t\t\t// Text\r\n\t\t\tgsap.to(this.textMaterial.uniforms.opacity, {\r\n\t\t\t\tvalue: 1,\r\n\t\t\t\tdelay: 0.2,\r\n\t\t\t\tduration: 1,\r\n\t\t\t\tease: 'power2.out'\r\n\t\t\t});\r\n\t\t\tgsap.to(this.animeNameTitle.material.uniforms.opacity, {\r\n\t\t\t\tvalue: 1,\r\n\t\t\t\tdelay: 0.2,\r\n\t\t\t\tduration: 1,\r\n\t\t\t\tease: 'power2.out'\r\n\t\t\t});\r\n\t\t\ttypeof callBack === 'function' && callBack();\r\n\t\t});\r\n\t}\r\n\r\n\tinitCamera() {\r\n\t\tthis.camera.position.copy(this.cameraInitPos);\r\n\t\tthis.camera.lookAt(this.cameraLookAtPos);\r\n\t}\r\n\r\n\tinitPostprocessing() {\r\n\t\tthis.postScene = new THREE.Scene();\r\n\t\tthis.postCamera = this.viewer.postCamera;\r\n\t\tthis.postRenderTarget = this.viewer.postRenderTarget;\r\n\t\tthis.postScreenMesh = new THREE.Mesh(this.viewer.screenGeometry);\r\n\t\tthis.postScreenMesh.frustumCulled = false;\r\n\t\tthis.postScene.add(this.postScreenMesh);\r\n\r\n\t\tlet fxaaMaterial = (this.fxaaMaterial = new FXAAMaterial());\r\n\t\tlet pixelRatio = this.viewer.dpr;\r\n\t\tfxaaMaterial.uniforms['resolution'].value.x = 1 / (this.width * pixelRatio);\r\n\t\tfxaaMaterial.uniforms['resolution'].value.y = 1 / (this.height * pixelRatio);\r\n\r\n\t\tthis.vignetteMaterial = new VignetteMaterial({\r\n\t\t\toffset: .5,\r\n\t\t\tdarkness: 1\r\n\t\t});\r\n\t}\r\n\r\n\trenderPost(renderTarget) {\r\n\t\tlet inputTexture = renderTarget.texture;\r\n\t\tthis.vignetteMaterial.uniforms.inputBuffer.value = inputTexture;\r\n\t\tthis.postScene.overrideMaterial = this.vignetteMaterial;\r\n\t\tthis.renderer.setRenderTarget(this.postRenderTarget);\r\n\t\tthis.renderer.render(this.postScene, this.postCamera);\r\n\r\n\t\tthis.fxaaMaterial.uniforms.inputBuffer.value = this.postRenderTarget.texture;\r\n\t\tthis.postScene.overrideMaterial = this.fxaaMaterial;\r\n\t\tthis.renderer.setRenderTarget(renderTarget);\r\n\t\tthis.renderer.render(this.postScene, this.postCamera);\r\n\t}\r\n\r\n\tinitParticleSnow() {\r\n\t\tthis.particleSnow = new ParticleSnow(this);\r\n\t}\r\n\r\n\tinitParticleTexture() {\r\n\t\tlet cloudTexture = this.assetLibrary.get('Texture-Cloud');\r\n\t\tlet cloudParticleTexture = new ParticleTexture(this, cloudTexture, 'left');\r\n\t\tthis.particleTextureArr.push(cloudParticleTexture);\r\n\r\n\t\tlet cloudParticleMesh = (this.cloudParticleMesh = cloudParticleTexture.container);\r\n\t\tcloudParticleMesh.position.set(-this.width / 2, 200, 0);\r\n\t\tthis.uiScene.add(cloudParticleMesh);\r\n\r\n\t\tlet aerithTexture = this.assetLibrary.get('Texture-Aerith');\r\n\t\tlet aerithParticleTexture = new ParticleTexture(this, aerithTexture, 'right');\r\n\t\tthis.particleTextureArr.push(aerithParticleTexture);\r\n\r\n\t\tlet aerithParticleMesh = (this.aerithParticleMesh = aerithParticleTexture.container);\r\n\t\taerithParticleMesh.position.set(this.width / 2, 180, 0);\r\n\t\tthis.uiScene.add(aerithParticleMesh);\r\n\t\tthis.enableParticleTexture = true;\r\n\r\n\t\tthis.resizeParticleTexture(this.width, this.height);\r\n\t}\r\n\r\n\tresizeParticleTexture(width, height) {\r\n\t\tlet { cloudParticleMesh, aerithParticleMesh } = this;\r\n\t\tconst offsetWidth = -width / 3.5; // -width / 2 is left origin\r\n\t\tconst offsetHeight = height / 5.5;\r\n\t\tcloudParticleMesh.position.set(offsetWidth, offsetHeight, 0);\r\n\t\taerithParticleMesh.position.set(-offsetWidth, offsetHeight - 20, 0);\r\n\t\t// scale\r\n\t\tconst scale = clamp(width / 900, 1.5, 2);\r\n\t\tcloudParticleMesh.scale.setScalar(scale);\r\n\t\taerithParticleMesh.scale.setScalar(scale);\r\n\t}\r\n\r\n\tinitText() {\r\n\t\tlet material = (this.textMaterial = this.fontGenerator.createFontMaterial(0));\r\n\t\tmaterial.uniforms.time = { value: 0.0 };\r\n\t\t// Apply text color\r\n\t\tObject.assign(material.uniforms, TextUniformConfig);\r\n\r\n\t\tthis.titleMesh = this.initTextMesh(TextConfig.mainTitle, material);\r\n\t\tthis.subTitleMesh = this.initTextMesh(TextConfig.subTitle, material);\r\n\r\n\t\t// AnimeName Text\r\n\t\tthis.animeNameTitle = new AnimeNameTitle(this, AnimeName, AnimeTitleUniforms);\r\n\r\n\t\tthis.resizeText(this.width, this.height);\r\n\t}\r\n\r\n\tresizeText(width, height) {\r\n\t\tif(!this.isMobile){\r\n\t\t\tthis.resizeTextForPC(width, height);\r\n\t\t}else{\r\n\t\t\tthis.resizeTextForMobile(width, height);\r\n\t\t}\r\n\t\tthis.animeNameTitle.resize(width, height);\r\n\t}\r\n\r\n\tresizeTextForPC(width, height){\r\n\t\tlet { titleMesh, subTitleMesh } = this;\r\n\t\tlet titleMeshLength;\r\n\t\tconst bottom = -height / 2.5; // -height / 2 is screen bottom\r\n\t\tconst titleScale = clamp(width / 1000, 1.2, 1.8);\r\n\t\ttitleMeshLength = computeMeshBoundingBox(titleMesh).length.x * titleScale;\r\n\t\ttitleMesh.scale.setScalar(titleScale);\r\n\t\ttitleMesh.position.set(-titleMeshLength / 2, bottom, 0);\r\n\t\tconst subTitleScale = clamp(width / 2000, 0.6, 0.9);\r\n\t\tlet subBBox = computeMeshBoundingBox(subTitleMesh).length.multiplyScalar(subTitleScale);\r\n\t\ttitleMeshLength = subBBox.x;\r\n\t\tsubTitleMesh.scale.setScalar(subTitleScale);\r\n\t\tsubTitleMesh.position.set(-titleMeshLength / 2, bottom, 0);\r\n\r\n\t\t// Gap between title and subtitle\r\n\t\ttitleMesh.position.y = bottom + subBBox.y + 50;\r\n\t}\r\n\r\n\tresizeTextForMobile(width, height){\r\n\t\tlet { titleMesh, subTitleMesh } = this;\r\n\t\tlet titleMeshLength;\r\n\t\tconst bottom = -height / 3; // -height / 2 is screen bottom\r\n\t\tconst titleScale = clamp(width / 500, .6, .8);\r\n\t\ttitleMeshLength = computeMeshBoundingBox(titleMesh).length.x * titleScale;\r\n\t\ttitleMesh.scale.setScalar(titleScale);\r\n\t\ttitleMesh.position.set(-titleMeshLength / 2, bottom, 0);\r\n\t\tconst subTitleScale = clamp(width / 1000, .3, .4);\r\n\t\tlet subBBox = computeMeshBoundingBox(subTitleMesh).length.multiplyScalar(subTitleScale);\r\n\t\ttitleMeshLength = subBBox.x;\r\n\t\tsubTitleMesh.scale.setScalar(subTitleScale);\r\n\t\tsubTitleMesh.position.set(-titleMeshLength / 2, bottom, 0);\r\n\r\n\t\t// Gap between title and subtitle\r\n\t\ttitleMesh.position.y = bottom + subBBox.y + 40;\r\n\t}\r\n\r\n\tinitGUI() {\r\n\t\tconst gui = new dat.GUI();\r\n\t\tinitBGGUI(gui, this.bgMaterial);\r\n\t\tinitAnimeTitleGUI(gui, this.animeNameTitle.material);\r\n\t\tlet textMaterialUniforms = this.textMaterial.uniforms;\r\n\t\tlet params = {\r\n\t\t\t// Text\r\n\t\t\ttextColor1: textMaterialUniforms.color1.value.getStyle(),\r\n\t\t\ttextColor2: textMaterialUniforms.color2.value.getStyle(),\r\n\t\t\ttextColor3: textMaterialUniforms.color3.value.getStyle(),\r\n\t\t\ttextColor4: textMaterialUniforms.color4.value.getStyle()\r\n\t\t};\r\n\t\t// Text\r\n\t\tconst textFolder = gui.addFolder('Text');\r\n\t\ttextFolder\r\n\t\t\t.addColor(params, 'textColor1')\r\n\t\t\t.name('color1')\r\n\t\t\t.onChange(value => {\r\n\t\t\t\ttextMaterialUniforms.color1.value.setStyle(value);\r\n\t\t\t});\r\n\t\ttextFolder\r\n\t\t\t.addColor(params, 'textColor2')\r\n\t\t\t.name('color2')\r\n\t\t\t.onChange(value => {\r\n\t\t\t\ttextMaterialUniforms.color2.value.setStyle(value);\r\n\t\t\t});\r\n\t\ttextFolder\r\n\t\t\t.addColor(params, 'textColor3')\r\n\t\t\t.name('color3')\r\n\t\t\t.onChange(value => {\r\n\t\t\t\ttextMaterialUniforms.color3.value.setStyle(value);\r\n\t\t\t});\r\n\t\ttextFolder\r\n\t\t\t.addColor(params, 'textColor4')\r\n\t\t\t.name('color4')\r\n\t\t\t.onChange(value => {\r\n\t\t\t\ttextMaterialUniforms.color4.value.setStyle(value);\r\n\t\t\t});\r\n\t\ttextFolder.open();\r\n\t}\r\n\r\n\tloadSunLight(sunlightInfo) {\r\n\t\tif (!this.sunLight) this.sunLight = new THREE.DirectionalLight(0xffffff, 1);\r\n\t\tthis.sunLight.position.copy(sunlightInfo.position);\r\n\t\tthis.scene.add(this.sunLight);\r\n\t}\r\n\r\n\tinitBackground() {\r\n\t\tlet bgMaterial = (this.bgMaterial = new BGMaterial(BGUniformsConfig));\r\n\t\tlet bgMesh = new THREE.Mesh(this.viewer.screenGeometry, bgMaterial);\r\n\t\tbgMesh.layers.set(this.layers.BG_LAYER);\r\n\t\tthis.scene.add(bgMesh);\r\n\t}\r\n\r\n\tupdateEnvironmentRotation() {\r\n\t\t// Sync camera roatation to Environment\r\n\t\tthis.cameraRotationMatrix.makeRotationFromQuaternion(this.camera.quaternion);\r\n\t\tthis.envRotationMat.value.setFromMatrix4(this.cameraRotationMatrix);\r\n\t}\r\n\r\n\tinitEvent() {\r\n\t\tif(!this.isMobile){\r\n\t\t\tthis.eventHandler.onMouseMoveEvent.bind(this.onMouseMove.bind(this));\r\n\t\t}else{\r\n\t\t\tthis.eventHandler.onTouchMoveEvent.bind(this.onMouseMove.bind(this));\r\n\t\t}\r\n\t}\r\n\r\n\tonMouseMove(event) {\r\n\t\tif (!this.viewer.preloadFinished || !this.visible) return;\r\n\t\tlet positionNormX = this.state.pointer.positionNorm[0] - 0.5;\r\n\t\tlet sceneRoationTarget = positionNormX * this.sceneRotateXLimit;\r\n\t\t// Small rotation for particleTexture\r\n\t\tlet textureRoationTarget = sceneRoationTarget / 10;\r\n\r\n\t\tgsap.killTweensOf(this.gltfScene.rotation);\r\n\t\tgsap.to(this.gltfScene.rotation, {\r\n\t\t\ty: sceneRoationTarget,\r\n\t\t\tduration: 0.5,\r\n\t\t\tease: 'power2.out'\r\n\t\t});\r\n\t\tif (this.enableParticleTexture) {\r\n\t\t\tgsap.killTweensOf(this.aerithParticleMesh.rotation);\r\n\t\t\tgsap.killTweensOf(this.cloudParticleMesh.rotation);\r\n\t\t\tgsap.to(this.aerithParticleMesh.rotation, {\r\n\t\t\t\ty: textureRoationTarget,\r\n\t\t\t\tduration: 0.5,\r\n\t\t\t\tease: 'power2.out'\r\n\t\t\t});\r\n\t\t\tgsap.to(this.cloudParticleMesh.rotation, {\r\n\t\t\t\ty: textureRoationTarget,\r\n\t\t\t\tduration: 0.5,\r\n\t\t\t\tease: 'power2.out'\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\twhileVisible(order) {\r\n\t\tlet cameraPos = this.camera.position;\r\n\t\tgsap.killTweensOf(cameraPos);\r\n\t\tif (order === 'pre') {\r\n\t\t\tgsap.fromTo(cameraPos, { y: -0.2 }, { y: 0, duration: this.viewer.scrollAnimeDuration });\r\n\t\t} else {\r\n\t\t\tgsap.fromTo(cameraPos, { y: 0.35 }, { y: 0, duration: this.viewer.scrollAnimeDuration });\r\n\t\t}\r\n\t\tgsap.to(this.animeNameTitle.material.uniforms.opacity, {\r\n\t\t\tvalue: 1,\r\n\t\t\tduration: 1,\r\n\t\t\tdelay: 1,\r\n\t\t\tease: 'power2.out'\r\n\t\t});\r\n\t}\r\n\r\n\twhileNoVisible(order) {\r\n\t\tlet cameraPos = this.camera.position;\r\n\t\tgsap.killTweensOf(cameraPos);\r\n\t\tif (order === 'pre') {\r\n\t\t\tgsap.fromTo(cameraPos, { y: 0 }, { y: 0.35, duration: this.viewer.scrollAnimeDuration });\r\n\t\t} else {\r\n\t\t\tgsap.fromTo(cameraPos, { y: 0 }, { y: -0.2, duration: this.viewer.scrollAnimeDuration });\r\n\t\t}\r\n\t\tgsap.to(this.animeNameTitle.material.uniforms.opacity, {\r\n\t\t\tvalue: 0,\r\n\t\t\tduration: 1,\r\n\t\t\tease: 'power2.out'\r\n\t\t});\r\n\t}\r\n\r\n\tresize(width, height, dpr) {\r\n\t\tconst pixelWidth = width * dpr;\r\n\t\tconst pixelHeight = height * dpr;\r\n\t\tthis.postProcessingMaterial.resize(pixelWidth, pixelHeight);\r\n\t\tthis.camera.aspect = width / height;\r\n\t\tthis.camera.updateProjectionMatrix();\r\n\t\tthis.uiCamera.left = -width / 2;\r\n\t\tthis.uiCamera.right = width / 2;\r\n\t\tthis.uiCamera.top = height / 2;\r\n\t\tthis.uiCamera.bottom = -height / 2;\r\n\t\tthis.uiCamera.updateProjectionMatrix();\r\n\t\t// FXAA\r\n\t\tthis.fxaaMaterial.uniforms['resolution'].value.x = 1 / pixelWidth;\r\n\t\tthis.fxaaMaterial.uniforms['resolution'].value.y = 1 / pixelHeight;\r\n\r\n\t\tif (this.enableParticleTexture) this.resizeParticleTexture(width, height);\r\n\t\tthis.resizeText(width, height);\r\n\t}\r\n\r\n\trender({ renderer, orthoCamera, target, deltaTime } = {}) {\r\n\t\tif (!this.visible) return;\r\n\t\tthis.updateEnvironmentRotation();\r\n\t\tthis.textMaterial.uniforms.time.value += deltaTime;\r\n\t\tthis.animeNameTitle.render(deltaTime);\r\n\t\t// BG\r\n\t\torthoCamera.layers.set(this.layers.BG_LAYER);\r\n\t\trenderer.render(this.scene, orthoCamera);\r\n\t\t// Scene\r\n\t\tif (this.particleSnow) this.particleSnow.render(deltaTime);\r\n\t\trenderer.render(this.scene, this.camera);\r\n\t\tthis.renderPost(target);\r\n\t\t// UI\r\n\t\tthis.uiCamera.layers.set(this.layers.UI_LAYER);\r\n\t\tthis.particleTextureArr.forEach(particleTexture => {\r\n\t\t\tparticleTexture.update(deltaTime);\r\n\t\t});\r\n\t\trenderer.render(this.uiScene, this.uiCamera);\r\n\t}\r\n}\r\n","import * as THREE from 'three';\r\n\r\n// Array config for every anime scene\r\nconst BGUniformsConfig = [\r\n\t{\r\n\t\tbaseColor: new THREE.Color('rgb(0,5,5)'),\r\n\t\tarea1Color: new THREE.Color('rgb(0,37,55)'),\r\n\t\tarea2Color: new THREE.Color('rgb(0,61,100)'),\r\n\t\tarea1Position: new THREE.Vector2(0.5, 0),\r\n\t\tarea1Radius: 0.23,\r\n\t\tarea2Position: new THREE.Vector2(0.5, 1)\r\n\t},\r\n\t{\r\n\t\tbaseColor: new THREE.Color('#f2c9cc'),\r\n\t\tarea1Color: new THREE.Color('rgb(55,0,52)'),\r\n\t\tarea2Color: new THREE.Color('rgb(85,51,0)'),\r\n\t\tarea1Position: new THREE.Vector2(0, 0),\r\n\t\tarea1Radius: 1,\r\n\t\tarea2Position: new THREE.Vector2(1, 1),\r\n\t\tarea2Radius: 1\r\n\t},\r\n\t{\r\n\t\tbaseColor: new THREE.Color('rgb(105,105,105)'),\r\n\t\tarea1Color: new THREE.Color('rgb(25,25,25)'),\r\n\t\tarea2Color: new THREE.Color('rgb(176,179,185)'),\r\n\t\tarea1Position: new THREE.Vector2(0.5, 0),\r\n\t\tarea1Radius: 0.2,\r\n\t\tarea2Position: new THREE.Vector2(0.5, 1),\r\n\t\tarea2Radius: 1\r\n\t}\r\n];\r\n\r\nconst ParticleUniformsConfig = [\r\n\t{\r\n\t\tcolor: new THREE.Color('rgb(92,120,145)')\r\n\t},\r\n\t{\r\n\t\tcolor: new THREE.Color('#F3759E')\r\n\t},\r\n\t{\r\n\t\tcolor: new THREE.Color('rgb(255,255,255)')\r\n\t}\r\n];\r\n\r\nconst TextUniformConfigList = [\r\n\t{\r\n\t\ttopColor: new THREE.Color('rgb(207,224,235)'),\r\n\t\tbottomColor: new THREE.Color('rgb(0,37,55)')\r\n\t},\r\n\t{\r\n\t\ttopColor: new THREE.Color('rgb(243,81,126)'),\r\n\t\tbottomColor: new THREE.Color('rgb(255,255,255)')\r\n\t},\r\n\t{\r\n\t\ttopColor: new THREE.Color('rgb(255,255,255)'),\r\n\t\tbottomColor: new THREE.Color('rgb(255,255,255)')\r\n\t}\r\n];\r\n\r\nconst AnimeTitleUniformsList = [\r\n\t{\r\n\t\ttopColor: new THREE.Color('rgb(207,224,235)'),\r\n\t\tbottomColor: new THREE.Color('rgb(0,37,55)')\r\n\t},\r\n\t{\r\n\t\ttopColor: new THREE.Color('rgb(243,81,126)'),\r\n\t\tbottomColor: new THREE.Color('rgb(255,255,255)')\r\n\t},\r\n\t{\r\n\t\ttopColor: new THREE.Color('rgb(255,255,255)'),\r\n\t\tbottomColor: new THREE.Color('rgb(255,255,255)')\r\n\t}\r\n];\r\n\r\nconst GalleryConfig = {\r\n\tgalleryTexture1: ['Texture-Diamond1', 'Texture-Binguo1', 'Texture-STM1'],\r\n\tgalleryTexture2: ['Texture-Diamond2', 'Texture-Binguo2', 'Texture-STM2']\r\n};\r\n\r\nconst TextConfig = {\r\n\tmainTitle: `Hi, I'm Gumq4!`,\r\n\tsubTitle: `I used to live in Quang Ngai. Now,\r\n\t I'm living in Ho Chi Minh city and \r\n\t I used to study University of Transport \r\n\t and Communications campus in HCMC.\r\n\t  My major is software engineering`\r\n};\r\n\r\nconst AnimeNameList = ['[ gumq4 ]', '[ no love ]', '[ no pain ]'];\r\n\r\nexport {\r\n\tBGUniformsConfig,\r\n\tParticleUniformsConfig,\r\n\tTextUniformConfigList,\r\n\tGalleryConfig,\r\n\tTextConfig,\r\n\tAnimeNameList,\r\n\tAnimeTitleUniformsList\r\n};\r\n","export default \"#define GLSLIFY 1\\nattribute vec3 position;\\nattribute vec2 uv;\\n\\nuniform mat4 projectionMatrix;\\nuniform mat4 modelViewMatrix;\\n\\nvarying vec3 vPosition;\\nvarying vec2 vUv;\\n\\nvoid main(void) {\\n  vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\\n  vPosition = position;\\n  vUv = uv;\\n  gl_Position = projectionMatrix * mvPosition;\\n}\\n\";","export default \"precision highp float;\\n#define GLSLIFY 1\\n\\nuniform float uTime;\\nuniform float uProgress;\\nuniform sampler2D uTextures[2];\\nvarying vec3 vPosition;\\nvarying vec2 vUv;\\n\\n//\\n// Description : Array and textureless GLSL 2D/3D/4D simplex\\n//               noise functions.\\n//      Author : Ian McEwan, Ashima Arts.\\n//  Maintainer : ijm\\n//     Lastmod : 20110822 (ijm)\\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\\n//               Distributed under the MIT License. See LICENSE file.\\n//               https://github.com/ashima/webgl-noise\\n//\\n\\nvec3 mod289(vec3 x) {\\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\\n}\\n\\nvec4 mod289(vec4 x) {\\n  return x - floor(x * (1.0 / 289.0)) * 289.0;\\n}\\n\\nvec4 permute(vec4 x) {\\n     return mod289(((x*34.0)+1.0)*x);\\n}\\n\\nvec4 taylorInvSqrt(vec4 r)\\n{\\n  return 1.79284291400159 - 0.85373472095314 * r;\\n}\\n\\nfloat snoise(vec3 v)\\n  {\\n  const vec2  C = vec2(1.0/6.0, 1.0/3.0) ;\\n  const vec4  D = vec4(0.0, 0.5, 1.0, 2.0);\\n\\n// First corner\\n  vec3 i  = floor(v + dot(v, C.yyy) );\\n  vec3 x0 =   v - i + dot(i, C.xxx) ;\\n\\n// Other corners\\n  vec3 g = step(x0.yzx, x0.xyz);\\n  vec3 l = 1.0 - g;\\n  vec3 i1 = min( g.xyz, l.zxy );\\n  vec3 i2 = max( g.xyz, l.zxy );\\n\\n  //   x0 = x0 - 0.0 + 0.0 * C.xxx;\\n  //   x1 = x0 - i1  + 1.0 * C.xxx;\\n  //   x2 = x0 - i2  + 2.0 * C.xxx;\\n  //   x3 = x0 - 1.0 + 3.0 * C.xxx;\\n  vec3 x1 = x0 - i1 + C.xxx;\\n  vec3 x2 = x0 - i2 + C.yyy; // 2.0*C.x = 1/3 = C.y\\n  vec3 x3 = x0 - D.yyy;      // -1.0+3.0*C.x = -0.5 = -D.y\\n\\n// Permutations\\n  i = mod289(i);\\n  vec4 p = permute( permute( permute(\\n             i.z + vec4(0.0, i1.z, i2.z, 1.0 ))\\n           + i.y + vec4(0.0, i1.y, i2.y, 1.0 ))\\n           + i.x + vec4(0.0, i1.x, i2.x, 1.0 ));\\n\\n// Gradients: 7x7 points over a square, mapped onto an octahedron.\\n// The ring size 17*17 = 289 is close to a multiple of 49 (49*6 = 294)\\n  float n_ = 0.142857142857; // 1.0/7.0\\n  vec3  ns = n_ * D.wyz - D.xzx;\\n\\n  vec4 j = p - 49.0 * floor(p * ns.z * ns.z);  //  mod(p,7*7)\\n\\n  vec4 x_ = floor(j * ns.z);\\n  vec4 y_ = floor(j - 7.0 * x_ );    // mod(j,N)\\n\\n  vec4 x = x_ *ns.x + ns.yyyy;\\n  vec4 y = y_ *ns.x + ns.yyyy;\\n  vec4 h = 1.0 - abs(x) - abs(y);\\n\\n  vec4 b0 = vec4( x.xy, y.xy );\\n  vec4 b1 = vec4( x.zw, y.zw );\\n\\n  //vec4 s0 = vec4(lessThan(b0,0.0))*2.0 - 1.0;\\n  //vec4 s1 = vec4(lessThan(b1,0.0))*2.0 - 1.0;\\n  vec4 s0 = floor(b0)*2.0 + 1.0;\\n  vec4 s1 = floor(b1)*2.0 + 1.0;\\n  vec4 sh = -step(h, vec4(0.0));\\n\\n  vec4 a0 = b0.xzyw + s0.xzyw*sh.xxyy ;\\n  vec4 a1 = b1.xzyw + s1.xzyw*sh.zzww ;\\n\\n  vec3 p0 = vec3(a0.xy,h.x);\\n  vec3 p1 = vec3(a0.zw,h.y);\\n  vec3 p2 = vec3(a1.xy,h.z);\\n  vec3 p3 = vec3(a1.zw,h.w);\\n\\n//Normalise gradients\\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\\n  p0 *= norm.x;\\n  p1 *= norm.y;\\n  p2 *= norm.z;\\n  p3 *= norm.w;\\n\\n// Mix final noise value\\n  vec4 m = max(0.6 - vec4(dot(x0,x0), dot(x1,x1), dot(x2,x2), dot(x3,x3)), 0.0);\\n  m = m * m;\\n  return 42.0 * dot( m*m, vec4( dot(p0,x0), dot(p1,x1),\\n                                dot(p2,x2), dot(p3,x3) ) );\\n  }\\n\\nvoid main() {\\n    float noiseRange = 2.;\\n\\n    vec2 st = (vUv * 2.0 - 1.0); // [-1, 1]\\n    float circleOut = 1. - smoothstep(0.6, 1., length(st));\\n    float circleIn = 1. - smoothstep(0.4, 0.8, length(st));\\n    float noise = (snoise(vec3(st * (1.5 + noiseRange * .1) + vec2(sin(uTime), cos(uTime)), uTime + noiseRange * 100.)) + 1.5) / 2.;\\n\\n    float mask = circleOut * noise + circleIn;\\n    float opacity = 1.0 - step(mask, 0.15);\\n\\n    vec4 texColorPrev =  texture2D(uTextures[0], vUv);\\n    vec4 texColorNext = texture2D(uTextures[1], vUv);\\n\\n    float progress = uProgress + noise * 0.1;\\n    float intpl = smoothstep(0., 1., (progress*2. - vUv.x));\\n    vec4 finColor = mix(texColorPrev, texColorNext, intpl);\\n\\n    // gl_FragColor = vec4(vec3(opacity) , 1.);\\n    gl_FragColor = vec4(finColor.rgb, opacity);\\n}\";","import * as THREE from 'three';\r\nimport vertexShader from './shaders/noiseMask.vs';\r\nimport fragmentShader from './shaders/noiseMask.fs';\r\n\r\nexport class GalleryTexture {\r\n\tconstructor(container, textures, opts = {}) {\r\n\t\tthis.container = container;\r\n\t\tthis.textures = textures;\r\n\t\tthis.texWidth = textures[0].image.width;\r\n\t\tthis.texHeight = textures[0].image.height;\r\n\t\tthis.texAspect = this.texWidth / this.texHeight;\r\n\t\tthis.width = opts.width || 5;\r\n\t\tthis.height = this.width / this.texAspect;\r\n\t\t// this.height = this.width;\r\n\r\n\t\tthis.uniforms = {\r\n\t\t\tuTime: {\r\n\t\t\t\ttype: 'f',\r\n\t\t\t\tvalue: 0\r\n\t\t\t},\r\n\t\t\tuProgress: {\r\n\t\t\t\ttype: 'f',\r\n\t\t\t\tvalue: 0\r\n\t\t\t},\r\n\t\t\tuTextures: {\r\n\t\t\t\ttype: 't',\r\n\t\t\t\tvalue: textures\r\n\t\t\t}\r\n\t\t};\r\n\t\tthis.init();\r\n\t}\r\n\r\n\tinit() {\r\n\t\tconst geometry = new THREE.PlaneBufferGeometry(this.width, this.height, 2, 2);\r\n\t\tconst material = new THREE.RawShaderMaterial({\r\n\t\t\tuniforms: this.uniforms,\r\n\t\t\tvertexShader,\r\n\t\t\tfragmentShader,\r\n\t\t\tdepthTest: false,\r\n\t\t\ttransparent: true\r\n\t\t});\r\n\t\tthis.mesh = new THREE.Mesh(geometry, material);\r\n\t\tthis.container.add(this.mesh);\r\n\t}\r\n\r\n\tget material() {\r\n\t\treturn this.mesh.material;\r\n\t}\r\n\r\n\tget progress() {\r\n\t\treturn this.material.uniforms.uProgress.value;\r\n\t}\r\n\r\n\tset progress(val) {\r\n\t\tthis.material.uniforms.uProgress.value = val;\r\n\t}\r\n\r\n\tswapTextures() {\r\n\t\tif (!this.material.uniforms.uTextures.value) return;\r\n\t\tlet textures = this.material.uniforms.uTextures;\r\n\t\tlet temp = textures.value[0];\r\n\t\ttextures.value[0] = textures.value[1];\r\n\t\ttextures.value[1] = temp;\r\n\t}\r\n\r\n\tsetNextTexture(texture) {\r\n\t\tthis.material.uniforms.uTextures.value[1] = texture;\r\n\t}\r\n\r\n\tresize() {}\r\n\r\n\trender(time) {\r\n\t\tthis.uniforms.uTime.value += time;\r\n\t}\r\n}\r\n","export default \"precision highp float;\\n#define GLSLIFY 1\\n\\nattribute float pindex;\\nattribute vec3 position;\\nattribute vec3 offset;\\nattribute vec3 random; // rotation/scale/alpha\\nattribute vec2 uv;\\n\\nuniform mat4 modelViewMatrix;\\nuniform mat4 projectionMatrix;\\n\\nuniform float time;\\nuniform float size;\\n\\nvarying vec2 vUv;\\nvarying float vPreAlpha;\\n\\nvoid rotate2d(inout vec2 v, float a){\\n    mat2 m = mat2(cos(a), -sin(a), sin(a),  cos(a));\\n    v = m * v;\\n}\\n\\nvoid main() {\\n\\tvUv = uv;\\n\\n\\t// displacement\\n\\tvec3 displaced = offset;\\n\\n\\t// rotate around z axis\\n\\tvec3 pos = position;\\n    rotate2d(pos.xy, random.x * .5 + time * (random.y - 0.5) / 4.);\\n\\n\\tvec4 mvPosition = modelViewMatrix * vec4(displaced, 1.0);\\n\\tmvPosition.xyz += pos * clamp(0.1, 1., size * random.y);\\n\\tvec4 finalPosition = projectionMatrix * mvPosition;\\n\\n\\tvPreAlpha = random.z;\\n\\tgl_Position = finalPosition;\\n}\\n\";","export default \"precision highp float;\\n#define GLSLIFY 1\\nvarying vec2 vUv;\\nvarying float vPreAlpha;\\nuniform vec3 color;\\nuniform float type;\\n\\n// https://www.shadertoy.com/view/llVyWW\\nfloat sdPentagon(vec2 p, float r){\\n    const vec3 k = vec3(0.809016994,0.587785252,0.726542528); // pi/5: cos, sin, tan\\n    p.y = -p.y;\\n    p.x = abs(p.x);\\n    p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\\n    p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\\n\\tp -= vec2(clamp(p.x,-r*k.z,r*k.z),r);    \\n    return length(p)*sign(p.y);\\n}\\n\\n// Heart curve suggested by IQ, improved by Dave_Hoskins.\\nfloat heart(vec2 p) {\\n    // Center it more, vertically:\\n    p.y += .6;\\n    // This offset reduces artifacts on the center vertical axis.\\n    const float offset = .3;\\n    // (x^2+(1.2*y-sqrt(abs(x)))^2−1)\\n    float k = 1.2 * p.y - sqrt(abs(p.x) + offset);\\n    return p.x * p.x + k * k - 1.;\\n}\\n\\nfloat sdStar(in vec2 p, in float r, in float rf){\\n    const vec2 k1 = vec2(0.809016994375, -0.587785252292);\\n    const vec2 k2 = vec2(-k1.x,k1.y);\\n\\n    // repeat domain 5x\\n    p.x = abs(p.x);\\n    p -= 2.0*max(dot(k1,p),0.0)*k1;\\n    p -= 2.0*max(dot(k2,p),0.0)*k2;\\n    p.x = abs(p.x);\\n    \\n    // draw triangle\\n    p.y -= r;\\n    vec2 ba = rf*vec2(-k1.y,k1.x) - vec2(0,1);\\n\\tfloat h = clamp( dot(p,ba)/dot(ba,ba), 0.0, r );\\n    return length(p-ba*h) * sign(p.y*ba.x-p.x*ba.y);\\n}\\n\\nvoid main() {\\n\\tvec2 st = (vUv * 2.0 - 1.0); // [-1, 1]\\n    float r;\\n\\n    if(type>1.1)\\n        r = sdStar(st, 1., .5);\\n    else if(type>0.1)\\n        r = heart(st);\\n    else\\n        r = sdPentagon(st, .5);\\n    \\n\\tfloat alpha = 1. - sign(r);\\n\\n\\tvec3 col = color;\\n\\n\\tgl_FragColor = vec4(col, alpha * vPreAlpha);\\n}\";","import * as THREE from 'three';\r\nimport particleVS from './shaders/particle.vs';\r\nimport particleFS from './shaders/particle.fs';\r\nimport { ParticleInstance } from 'MODULES/Particle/ParticleInstance';\r\nimport { symmetryRandom } from 'JS/Utils';\r\n\r\nexport class ParticlePolygon {\r\n\tconstructor(container, { number = 1000, areaWidth = 100, areaHeight = 50, areaDepth = 50 } = {}) {\r\n\t\tthis.container = container;\r\n\t\tthis.number = number;\r\n\t\tthis.areaWidth = areaWidth;\r\n\t\tthis.areaHeight = areaHeight;\r\n\t\tthis.areaDepth = areaDepth;\r\n\r\n\t\tthis.initParticle();\r\n\t}\r\n\r\n\tinitParticle() {\r\n\t\tconst uniforms = {\r\n\t\t\ttime: { value: 0 },\r\n\t\t\tsize: { value: 1 },\r\n\t\t\tcolor: { value: new THREE.Color(0xd7f1fe) },\r\n\t\t\ttype: { value: 0 }\r\n\t\t};\r\n\r\n\t\tconst material = (this.material = new THREE.RawShaderMaterial({\r\n\t\t\tuniforms,\r\n\t\t\tvertexShader: particleVS,\r\n\t\t\tfragmentShader: particleFS,\r\n\t\t\tdepthTest: false,\r\n\t\t\ttransparent: true\r\n\t\t\t// blending: THREE.AdditiveBlending,\r\n\t\t}));\r\n\r\n\t\tthis.instanceMesh = new ParticleInstance(material).mesh;\r\n\t\tconst geometry = this.instanceMesh.geometry;\r\n\r\n\t\tconst numberPoints = this.number;\r\n\t\tconst indices = new Uint16Array(numberPoints);\r\n\t\tconst offsets = new Float32Array(numberPoints * 3); // Each position\r\n\t\tconst randoms = new Float32Array(numberPoints * 3); // rotation/scale/alpha\r\n\r\n\t\tfor (let i = 0; i < numberPoints; i++) {\r\n\t\t\toffsets.set(\r\n\t\t\t\t[\r\n\t\t\t\t\tthis.areaWidth * symmetryRandom(),\r\n\t\t\t\t\tthis.areaHeight * symmetryRandom(),\r\n\t\t\t\t\tthis.areaDepth * symmetryRandom()\r\n\t\t\t\t],\r\n\t\t\t\ti * 3\r\n\t\t\t);\r\n\r\n\t\t\trandoms.set([Math.random(), Math.random(), Math.random()], i * 3);\r\n\r\n\t\t\tindices[i] = i;\r\n\t\t}\r\n\r\n\t\tgeometry.setAttribute('pindex', new THREE.InstancedBufferAttribute(indices, 1, false));\r\n\t\tgeometry.setAttribute('offset', new THREE.InstancedBufferAttribute(offsets, 3, false));\r\n\t\tgeometry.setAttribute('random', new THREE.InstancedBufferAttribute(randoms, 3, false));\r\n\r\n\t\tthis.container.add(this.instanceMesh);\r\n\t}\r\n\r\n\tget color() {\r\n\t\treturn this.material.uniforms.color.value;\r\n\t}\r\n\r\n\tset color(val) {\r\n\t\tthis.material.uniforms.color.value = val;\r\n\t}\r\n\r\n\tget size() {\r\n\t\treturn this.material.uniforms.size.value;\r\n\t}\r\n\r\n\tset size(val) {\r\n\t\tthis.material.uniforms.size.value = val;\r\n\t}\r\n\r\n\tget type() {\r\n\t\treturn this.material.uniforms.type.value;\r\n\t}\r\n\r\n\tset type(val) {\r\n\t\tthis.material.uniforms.type.value = val;\r\n\t}\r\n\r\n\tget mesh() {\r\n\t\treturn this.instanceMesh;\r\n\t}\r\n\r\n\trender(time) {\r\n\t\tthis.instanceMesh.material.uniforms.time.value += time;\r\n\t\tthis.instanceMesh.rotation.y -= 0.001;\r\n\t}\r\n}\r\n","export default \"#define GLSLIFY 1\\nvarying vec2 vUv;\\n\\nvoid main() {\\n    vUv = uv;\\n\\n    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\\n    gl_Position = projectionMatrix * mvPosition;\\n}\";","export default \"#define GLSLIFY 1\\nvarying vec2 vUv;\\nuniform float time;\\nuniform float opacity;\\n\\nfloat sdLine(in vec2 p, in vec2 a, in vec2 b){\\n    vec2 ba = b-a;\\n    vec2 pa = p-a;\\n    float h =clamp( dot(pa,ba)/dot(ba,ba), 0.0, 1.0 );\\n    float line = length(pa-h*ba) - 0.1;\\n    return 1. - sign(line);\\n}\\n\\nvoid main() {\\n\\tvec2 st = (vUv * 2.0 - 1.0); // [-1, 1]\\n    st *= 1.4;\\n    vec2 v1 = vec2(-1.0,-1.0);\\n\\tvec2 v2 = vec2(.5,0.);\\n    float line1 = sdLine( st, v1, v2 );\\n\\n    vec2 v3 = vec2(-1.0,1.0);\\n\\tvec2 v4 = vec2(.5,0.);\\n    float line2 = sdLine( st, v3, v4 );\\n\\n\\tfloat alpha = line1 + line2;\\n    float common = line1 * line2 / 2.;\\n    alpha -= common;\\n\\n    float animeAlpha = 0.3 + abs(sin(time)) / 5.;\\n\\n\\tvec3 col = vec3(1.);\\n\\n\\tgl_FragColor = vec4(col, alpha * opacity * animeAlpha);\\n}\";","import * as THREE from 'three';\r\nimport vertexShader from './shaders/button.vs';\r\nimport fragmentShader from './shaders/arrowButton.fs';\r\n\r\nexport class ArrowButton {\r\n\tconstructor(section, layer, { name = 'arrowButton', width = 100 } = {}) {\r\n\t\tthis.name = name;\r\n\t\tthis.section = section;\r\n\t\tthis.layer = layer;\r\n\t\tthis.width = width;\r\n\t\tthis.height = width;\r\n\r\n\t\tthis.container = new THREE.Group();\r\n\t\tthis.initRing();\r\n\t\tthis.initHitArea();\r\n\t}\r\n\r\n\tinitRing() {\r\n\t\tthis.material = new THREE.ShaderMaterial({\r\n\t\t\tuniforms: {\r\n\t\t\t\ttime: { value: 0 },\r\n\t\t\t\topacity: { value: 0.0 }\r\n\t\t\t},\r\n\t\t\ttransparent: true,\r\n\t\t\tvertexShader,\r\n\t\t\tfragmentShader\r\n\t\t});\r\n\t\tlet geometry = new THREE.PlaneBufferGeometry(this.width, this.height, 1, 1);\r\n\t\tthis.mesh = new THREE.Mesh(geometry, this.material);\r\n\t\tthis.mesh.layers.set(this.layer);\r\n\t\tthis.container.add(this.mesh);\r\n\t}\r\n\r\n\tinitHitArea() {\r\n\t\tthis.hitArea = this.mesh;\r\n\t\tthis.hitArea.name = this.name;\r\n\t}\r\n\r\n\tget opacity() {\r\n\t\treturn this.material.uniforms.opacity.value;\r\n\t}\r\n\r\n\tset opacity(val) {\r\n\t\tthis.material.uniforms.opacity.value = val;\r\n\t}\r\n\r\n\tresize() {}\r\n\r\n\tupdate(time) {\r\n\t\tthis.material.uniforms.time.value += time;\r\n\t}\r\n}\r\n","export default \"#define GLSLIFY 1\\nvarying vec2 vUv;\\nuniform float time;\\nuniform float opacity;\\n\\nfloat sdRing(vec2 p, float r1, float r2) {\\n    float len = length(p);\\n    float outer = step(len-r1, 0.);\\n    float inner = step(len-r2, 0.);\\n    return outer - inner;\\n}\\n\\nfloat sdRoundedX(in vec2 p, in float w, in float r){\\n    p = abs(p);\\n    return length(p-min(p.x+p.y,w)*0.5) - r;\\n}\\n\\nvoid main() {\\n\\tvec2 st = (vUv * 2.0 - 1.0); // [-1, 1]\\n\\n    float alpha = sdRoundedX(st, .8, .03);\\n    alpha = 1. - sign(alpha);\\n\\n    st *= 1. + abs(sin(time)) / 10.;\\n    float r1 = sdRing(st, 1., 0.9);\\n    alpha += r1;\\n\\n\\tvec3 col = vec3(1.);\\n\\n\\tgl_FragColor = vec4(col, alpha * opacity);\\n}\";","import * as THREE from 'three';\r\nimport vertexShader from './shaders/button.vs';\r\nimport fragmentShader from './shaders/closeButton.fs';\r\n\r\nexport class CloseButton {\r\n\tconstructor(section, layer, { name = 'closeButton', width = 100 } = {}) {\r\n\t\tthis.name = name;\r\n\t\tthis.section = section;\r\n\t\tthis.layer = layer;\r\n\t\tthis.width = width;\r\n\t\tthis.height = width;\r\n\r\n\t\tthis.container = new THREE.Group();\r\n\t\tthis.initRing();\r\n\t\tthis.initHitArea();\r\n\t}\r\n\r\n\tinitRing() {\r\n\t\tthis.material = new THREE.ShaderMaterial({\r\n\t\t\tuniforms: {\r\n\t\t\t\ttime: { value: 0 },\r\n\t\t\t\topacity: { value: 0.0 }\r\n\t\t\t},\r\n\t\t\ttransparent: true,\r\n\t\t\tvertexShader,\r\n\t\t\tfragmentShader\r\n\t\t});\r\n\t\tlet geometry = new THREE.PlaneBufferGeometry(this.width, this.height, 1, 1);\r\n\t\tthis.mesh = new THREE.Mesh(geometry, this.material);\r\n\t\tthis.mesh.layers.set(this.layer);\r\n\t\tthis.container.add(this.mesh);\r\n\t}\r\n\r\n\tinitHitArea() {\r\n\t\tthis.hitArea = this.mesh;\r\n\t\tthis.hitArea.name = this.name;\r\n\t}\r\n\r\n\tget opacity() {\r\n\t\treturn this.material.uniforms.opacity.value;\r\n\t}\r\n\r\n\tset opacity(val) {\r\n\t\tthis.material.uniforms.opacity.value = val;\r\n\t}\r\n\r\n\tresize() {}\r\n\r\n\tupdate(time) {\r\n\t\tthis.material.uniforms.time.value += time;\r\n\t}\r\n}\r\n","export default \"#define GLSLIFY 1\\nvarying vec2 vUv;\\nuniform float time;\\nuniform float opacity;\\n\\nfloat sdRing(vec2 p, float r1, float r2) {\\n    float len = length(p);\\n    float outer = step(len-r1, 0.);\\n    float inner = step(len-r2, 0.);\\n    return outer - inner;\\n}\\n\\nvoid main() {\\n\\tvec2 st = (vUv * 2.0 - 1.0); // [-1, 1]\\n    st *= 1. + abs(sin(time)) / 5.;\\n    float r1 = sdRing(st, .85, 0.8);\\n    float r2 = sdRing(st, .95, 0.9);\\n    \\n\\tfloat alpha = r1 + r2;\\n\\n\\tvec3 col = vec3(1.);\\n\\n\\tgl_FragColor = vec4(col, alpha * opacity);\\n}\";","import * as THREE from 'three';\r\nimport vertexShader from './shaders/button.vs';\r\nimport fragmentShader from './shaders/ringButton.fs';\r\nimport { computeMeshBoundingBox } from 'JS/Utils';\r\n\r\nexport class RingButton {\r\n\tconstructor(section, layer, text, { width = 100, name = 'ringButton' } = {}) {\r\n\t\tthis.text = text;\r\n\t\tthis.name = name;\r\n\t\tthis.section = section;\r\n\t\tthis.fontGenerator = section.fontGenerator;\r\n\t\tthis.layer = layer;\r\n\t\tthis.width = width;\r\n\t\tthis.height = width;\r\n\r\n\t\tthis.container = new THREE.Group();\r\n\t\tthis.initRing();\r\n\t\tthis.initText();\r\n\t\tthis.initHitArea();\r\n\t}\r\n\r\n\tinitRing() {\r\n\t\tthis.ringMaterial = new THREE.ShaderMaterial({\r\n\t\t\tuniforms: {\r\n\t\t\t\ttime: { value: 0 },\r\n\t\t\t\topacity: { value: 0 }\r\n\t\t\t},\r\n\t\t\ttransparent: true,\r\n\t\t\tvertexShader,\r\n\t\t\tfragmentShader\r\n\t\t});\r\n\t\tlet geometry = new THREE.PlaneBufferGeometry(this.width, this.height, 1, 1);\r\n\t\tthis.ringMesh = new THREE.Mesh(geometry, this.ringMaterial);\r\n\t\tthis.ringMesh.layers.set(this.layer);\r\n\t\tthis.container.add(this.ringMesh);\r\n\t}\r\n\r\n\tinitText() {\r\n\t\tlet material = (this.textMaterial = this.fontGenerator.createFontMaterial(1));\r\n\t\tlet textMesh = (this.textMesh = this.section.initTextMesh(this.text, material, this.container));\r\n\t\ttextMesh.layers.set(this.layer);\r\n\t\tconst textScale = 0.5;\r\n\t\tlet titleMeshLength = computeMeshBoundingBox(textMesh).length.multiplyScalar(textScale);\r\n\t\ttextMesh.scale.setScalar(textScale);\r\n\t\ttextMesh.position.set(-titleMeshLength.x / 2, -titleMeshLength.y / 3, 0);\r\n\t\tthis.container.add(this.textMesh);\r\n\t}\r\n\r\n\tinitHitArea() {\r\n\t\tthis.hitArea = this.ringMesh;\r\n\t\tthis.hitArea.name = this.name;\r\n\t}\r\n\r\n\tget opacity() {\r\n\t\treturn this.textMaterial.uniforms.opacity.value;\r\n\t}\r\n\r\n\tset opacity(val) {\r\n\t\tthis.textMaterial.uniforms.opacity.value = val;\r\n\t\tthis.ringMaterial.uniforms.opacity.value = val;\r\n\t}\r\n\r\n\tresize() {}\r\n\r\n\tupdate(time) {\r\n\t\tthis.ringMaterial.uniforms.time.value += time;\r\n\t}\r\n}\r\n","export default \"#define GLSLIFY 1\\nvarying vec2 vUv;\\nuniform float time;\\nuniform float opacity;\\n\\nfloat sdRoundBox( in vec2 p, in vec2 b, in vec4 r ) {\\n    r.xy = (p.x>0.0)?r.xy : r.zw;\\n    r.x  = (p.y>0.0)?r.x  : r.y;\\n    \\n    vec2 q = abs(p)-b+r.x;\\n    float box = min(max(q.x,q.y),0.0) + length(max(q,0.0)) - r.x;\\n    float boxLine = abs(box) - 0.01;\\n    return 1. - sign(boxLine);\\n}\\n\\nvoid main() {\\n\\tvec2 st = (vUv * 2.0 - 1.0); // [-1, 1]\\n    \\n    vec2 si1 = vec2(0.8,0.35);\\n    vec4 ra1 = vec4(0.35);\\n\\tfloat alpha = sdRoundBox(st, si1, ra1);\\n\\n    float animeAlpha = 0.2 + abs(sin(time)) / 5.;\\n\\tvec3 col = vec3(1.);\\n\\n\\tgl_FragColor = vec4(col, alpha * animeAlpha * opacity);\\n}\";","import * as THREE from 'three';\r\nimport vertexShader from './shaders/button.vs';\r\nimport fragmentShader from './shaders/rectangleButton.fs';\r\nimport { computeMeshBoundingBox } from 'JS/Utils';\r\n\r\nexport class RectangleButton {\r\n\tconstructor(section, layer, text, { name = 'rectangleButton', width = 200 } = {}) {\r\n\t\tthis.text = text;\r\n\t\tthis.name = name;\r\n\t\tthis.section = section;\r\n\t\tthis.fontGenerator = section.fontGenerator;\r\n\t\tthis.layer = layer;\r\n\t\tthis.width = width;\r\n\t\tthis.height = width;\r\n\r\n\t\tthis.container = new THREE.Group();\r\n\t\tthis.initRectangle();\r\n\t\tthis.initText();\r\n\t\tthis.initHitArea();\r\n\t}\r\n\r\n\tinitRectangle() {\r\n\t\tthis.rectangleMaterial = new THREE.ShaderMaterial({\r\n\t\t\tuniforms: {\r\n\t\t\t\ttime: { value: 0 },\r\n\t\t\t\topacity: { value: 0 }\r\n\t\t\t},\r\n\t\t\ttransparent: true,\r\n\t\t\tvertexShader,\r\n\t\t\tfragmentShader\r\n\t\t});\r\n\t\tlet geometry = new THREE.PlaneBufferGeometry(this.width, this.height, 1, 1);\r\n\t\tthis.rectangleMesh = new THREE.Mesh(geometry, this.rectangleMaterial);\r\n\t\tthis.rectangleMesh.layers.set(this.layer);\r\n\t\tthis.container.add(this.rectangleMesh);\r\n\t}\r\n\r\n\tinitText() {\r\n\t\tlet material = (this.textMaterial = this.fontGenerator.createFontMaterial(1));\r\n\t\tlet textMesh = (this.textMesh = this.section.initTextMesh(this.text, material, this.container));\r\n\t\ttextMesh.layers.set(this.layer);\r\n\t\tconst textScale = 0.5;\r\n\t\tlet titleMeshLength = computeMeshBoundingBox(textMesh).length.multiplyScalar(textScale);\r\n\t\ttextMesh.scale.setScalar(textScale);\r\n\t\ttextMesh.position.set(-titleMeshLength.x / 2, -titleMeshLength.y / 3, 0);\r\n\t\tthis.container.add(this.textMesh);\r\n\t}\r\n\r\n\tinitHitArea() {\r\n\t\tthis.hitArea = this.rectangleMesh;\r\n\t\tthis.hitArea.name = this.name;\r\n\t}\r\n\r\n\tget opacity() {\r\n\t\treturn this.textMaterial.uniforms.opacity.value;\r\n\t}\r\n\r\n\tset opacity(val) {\r\n\t\tthis.textMaterial.uniforms.opacity.value = val;\r\n\t\tthis.rectangleMaterial.uniforms.opacity.value = val;\r\n\t}\r\n\r\n\tresize() {}\r\n\r\n\tupdate(time) {\r\n\t\tthis.rectangleMaterial.uniforms.time.value += time;\r\n\t}\r\n}\r\n","import * as THREE from 'three';\r\nimport { Section } from '../common/Section';\r\nimport { AnimeNameTitle } from '../common/AnimeNameTitle';\r\nimport {\r\n\tBGUniformsConfig,\r\n\tParticleUniformsConfig,\r\n\tTextUniformConfigList,\r\n\tGalleryConfig,\r\n\tTextConfig,\r\n\tAnimeNameList,\r\n\tAnimeTitleUniformsList\r\n} from './const/config';\r\nimport { computeMeshBoundingBox, clamp } from 'JS/Utils';\r\n// Modules\r\nimport { BGMaterial } from 'MODULES/BGMaterial/BGMaterial';\r\nimport { GalleryTexture } from 'MODULES/GalleryTexture/GalleryTexture';\r\nimport { ParticlePolygon } from 'MODULES/ParticlePolygon/ParticlePolygon';\r\nimport { ArrowButton } from 'MODULES/Button/';\r\n\r\nimport { gsap } from 'gsap';\r\nimport { initBGGUI, initAnimeTitleGUI } from '../common/InitGUI';\r\nimport * as dat from 'dat.gui';\r\n\r\nexport class AnimeSection extends Section {\r\n\tconstructor(viewer) {\r\n\t\tsuper(viewer);\r\n\t\tthis.name = 'AnimeSection';\r\n\t\tthis.debug = 0;\r\n\r\n\t\tthis.sceneRotateXLimit = Math.PI / 9;\r\n\t\tthis.rotateGroup = new THREE.Group();\r\n\t\tthis.scene.add(this.rotateGroup);\r\n\r\n\t\tthis.cameraInitPos = new THREE.Vector3(0, 0, 100);\r\n\t\tthis.cameraLookAtPos = new THREE.Vector3(0, 0, 0);\r\n\r\n\t\tthis.intersectsArr = [];\r\n\t\tthis.intersects = []; // intersect result\r\n\t\tthis.raycaster = new THREE.Raycaster();\r\n\t\tthis.raycaster.layers.set(this.layers.UI_LAYER);\r\n\r\n\t\tthis.curAnimeIndex = 0;\r\n\t\tthis.animeProgress = { value: 0 };\r\n\t\tthis.animeDuration = 2;\r\n\t\tthis.isAnimeChanging = false;\r\n\r\n\t\tthis.clickNDCPos = new THREE.Vector2();\r\n\t}\r\n\r\n\tinit() {\r\n\t\tthis.initBackground();\r\n\t\tthis.initParticles();\r\n\t\tthis.initCamera();\r\n\t\tthis.initGalleryTextures();\r\n\t\tthis.initText();\r\n\t\tthis.initUIPanel();\r\n\t\tthis.initEvent();\r\n\r\n\t\tif (this.debug) this.initGUI();\r\n\t}\r\n\r\n\tinitUIPanel() {\r\n\t\t// Close Btn\r\n\t\tthis.arrowBtn = new ArrowButton(this, this.layers.UI_LAYER);\r\n\t\tlet arrowContainer = this.arrowBtn.container;\r\n\t\tconst arrowBtnScale = 0.4;\r\n\t\tthis.arrowBtnBox = computeMeshBoundingBox(this.arrowBtn.mesh).length.multiplyScalar(arrowBtnScale);\r\n\t\tarrowContainer.scale.setScalar(arrowBtnScale);\r\n\t\tthis.uiScene.add(arrowContainer);\r\n\t\tthis.resizeUIPanel(this.width, this.height);\r\n\t}\r\n\r\n\tresizeUIPanel(width, height) {\r\n\t\tlet arrowContainer = this.arrowBtn.container;\r\n\t\tconst topOffset = 0;\r\n\t\tconst leftOffset = width / 2 - this.arrowBtnBox.x / 2;\r\n\t\tarrowContainer.position.set(leftOffset, topOffset, 0);\r\n\t}\r\n\r\n\tinitText() {\r\n\t\tlet material = (this.textMaterial = this.fontGenerator.createFontMaterial(1));\r\n\t\tmaterial.uniforms.time = { value: 0.0 };\r\n\t\t// Apply text color\r\n\t\tlet initTextUniforms = TextUniformConfigList[0];\r\n\t\tObject.keys(initTextUniforms).map(key => {\r\n\t\t\tmaterial.uniforms[`${key}`] = { value: initTextUniforms[key].clone() };\r\n\t\t});\r\n\r\n\t\tthis.titleMesh = this.initTextMesh(TextConfig.mainTitle, material);\r\n\t\tthis.subTitleMesh = this.initTextMesh(TextConfig.subTitle, material);\r\n\r\n\t\tthis.animeNameTitleList = new Array(AnimeNameList.length).fill().map((ele, index) => {\r\n\t\t\treturn new AnimeNameTitle(this, AnimeNameList[index], AnimeTitleUniformsList[index]);\r\n\t\t});\r\n\r\n\t\tthis.resizeText(this.width, this.height);\r\n\t}\r\n\r\n\tresizeText(width, height) {\r\n\t\tif (!this.isMobile) {\r\n\t\t\tthis.resizeTextForPC(width, height);\r\n\t\t} else {\r\n\t\t\tthis.resizeTextForMobile(width, height);\r\n\t\t}\r\n\t\tthis.animeNameTitleList[this.curAnimeIndex].resize(width, height);\r\n\t}\r\n\r\n\tresizeTextForPC(width, height) {\r\n\t\tlet { titleMesh, subTitleMesh } = this;\r\n\t\tconst topOffset = height / 4;\r\n\t\tconst leftOffset = -width / 2.25;\r\n\t\tconst titleScale = clamp(width / 1000, 1.2, 1.4);\r\n\t\ttitleMesh.scale.setScalar(titleScale);\r\n\t\ttitleMesh.position.set(leftOffset, topOffset, 0);\r\n\r\n\t\tconst subTitleScale = clamp(width / 2000, 0.6, 0.7);\r\n\t\tlet subBBox = computeMeshBoundingBox(subTitleMesh).length.multiplyScalar(subTitleScale);\r\n\t\tsubTitleMesh.scale.setScalar(subTitleScale);\r\n\t\tsubTitleMesh.position.set(leftOffset, topOffset, 0);\r\n\r\n\t\t// Gap between title and subtitle\r\n\t\tsubTitleMesh.position.y = topOffset - subBBox.y - 20;\r\n\t}\r\n\r\n\tresizeTextForMobile(width, height) {\r\n\t\tlet { titleMesh, subTitleMesh } = this;\r\n\t\tconst topOffset = height / 2.5;\r\n\t\tconst leftOffset = -width / 2.25;\r\n\t\tconst titleScale = clamp(width / 500, 0.7, 0.9);\r\n\t\ttitleMesh.scale.setScalar(titleScale);\r\n\t\ttitleMesh.position.set(leftOffset, topOffset, 0);\r\n\r\n\t\tconst subTitleScale = clamp(width / 1000, 0.35, 0.45);\r\n\t\tlet subBBox = computeMeshBoundingBox(subTitleMesh).length.multiplyScalar(subTitleScale);\r\n\t\tsubTitleMesh.scale.setScalar(subTitleScale);\r\n\t\tsubTitleMesh.position.set(leftOffset, topOffset, 0);\r\n\r\n\t\t// Gap between title and subtitle\r\n\t\tsubTitleMesh.position.y = topOffset - subBBox.y - 20;\r\n\t}\r\n\r\n\tinitCamera() {\r\n\t\tthis.camera.position.copy(this.cameraInitPos);\r\n\t\tthis.camera.lookAt(this.cameraLookAtPos);\r\n\t}\r\n\r\n\tinitParticles() {\r\n\t\tthis.particles = new ParticlePolygon(this.rotateGroup);\r\n\t\tthis.particles.color = ParticleUniformsConfig[0].color.clone();\r\n\t}\r\n\r\n\tinitGalleryTextures() {\r\n\t\tthis.galleryTextures = [];\r\n\t\tlet textureArray1 = [this.assetLibrary.get(GalleryConfig.galleryTexture1[0]), null];\r\n\t\tlet textureArray2 = [this.assetLibrary.get(GalleryConfig.galleryTexture2[0]), null];\r\n\t\tlet galleryTexture1 = (this.galleryTexture1 = new GalleryTexture(this.rotateGroup, textureArray1, {\r\n\t\t\twidth: 100\r\n\t\t}));\r\n\t\tgalleryTexture1.mesh.layers.set(this.layers.TEX_LAYER);\r\n\r\n\t\tlet galleryTexture2 = (this.galleryTexture2 = new GalleryTexture(this.rotateGroup, textureArray2, {\r\n\t\t\twidth: 50\r\n\t\t}));\r\n\t\tgalleryTexture2.mesh.layers.set(this.layers.TEX_LAYER);\r\n\r\n\t\t// Once\r\n\t\tgalleryTexture1.material.uniforms.uProgress = this.animeProgress;\r\n\t\tgalleryTexture2.material.uniforms.uProgress = this.animeProgress;\r\n\r\n\t\tthis.galleryTextures.push(galleryTexture1);\r\n\t\tthis.galleryTextures.push(galleryTexture2);\r\n\r\n\t\tthis.resizeGalleryTextures(this.width, this.height);\r\n\t}\r\n\r\n\tresizeGalleryTextures(width, height) {\r\n\t\tlet { galleryTexture1, galleryTexture2 } = this;\r\n\t\tif (!this.isMobile) {\r\n\t\t\tgalleryTexture1.mesh.scale.setScalar(clamp(width / 1800, 0.8, 1.2));\r\n\t\t\tgalleryTexture1.mesh.position.x = 30 * galleryTexture1.mesh.scale.x;\r\n\t\t\tgalleryTexture1.mesh.position.y = 10 * galleryTexture1.mesh.scale.x;\r\n\r\n\t\t\tgalleryTexture2.mesh.scale.setScalar(clamp(width / 1800, 0.8, 1.2));\r\n\t\t\tgalleryTexture2.mesh.position.y = -20 * galleryTexture1.mesh.scale.x;\r\n\t\t\tgalleryTexture2.mesh.position.x = -30 * galleryTexture1.mesh.scale.x;\r\n\t\t} else {\r\n\t\t\tgalleryTexture1.mesh.scale.setScalar(clamp(width / 800, 0.5, 0.8));\r\n\t\t\tgalleryTexture1.mesh.position.x = 5 * galleryTexture1.mesh.scale.x;\r\n\t\t\t// galleryTexture1.mesh.position.y = 0 * galleryTexture1.mesh.scale.x;\r\n\r\n\t\t\tgalleryTexture2.mesh.scale.setScalar(clamp(width / 800, 0.5, 0.8));\r\n\t\t\tgalleryTexture2.mesh.position.y = -50 * galleryTexture1.mesh.scale.x;\r\n\t\t\tgalleryTexture2.mesh.position.x = -10 * galleryTexture1.mesh.scale.x;\r\n\t\t}\r\n\t}\r\n\r\n\tinitGUI() {\r\n\t\tconst gui = new dat.GUI();\r\n\t\tinitBGGUI(gui, this.bgMaterial);\r\n\t\tinitAnimeTitleGUI(gui, this.animeNameTitleList[this.curAnimeIndex].material);\r\n\t\tlet { particles, textMaterial } = this;\r\n\t\tlet params = {\r\n\t\t\t// Particle\r\n\t\t\tparticleColor: particles.color.getStyle(),\r\n\t\t\tparticleSize: particles.size,\r\n\t\t\t// Text\r\n\t\t\ttextTopColor: textMaterial.uniforms.topColor.value.getStyle(),\r\n\t\t\ttextBottomColor: textMaterial.uniforms.bottomColor.value.getStyle()\r\n\t\t};\r\n\t\t// Particle\r\n\t\tconst particleFolder = gui.addFolder('Particle');\r\n\t\tparticleFolder\r\n\t\t\t.addColor(params, 'particleColor')\r\n\t\t\t.name('color')\r\n\t\t\t.onChange(value => {\r\n\t\t\t\tparticles.color.setStyle(value);\r\n\t\t\t});\r\n\t\tparticleFolder\r\n\t\t\t.add(params, 'particleSize', 0, 5)\r\n\t\t\t.name('size')\r\n\t\t\t.onChange(value => {\r\n\t\t\t\tparticles.size = value;\r\n\t\t\t});\r\n\t\tparticleFolder.open();\r\n\t\t// Text\r\n\t\tconst textFolder = gui.addFolder('Text');\r\n\t\ttextFolder\r\n\t\t\t.addColor(params, 'textTopColor')\r\n\t\t\t.name('topColor')\r\n\t\t\t.onChange(value => {\r\n\t\t\t\ttextMaterial.uniforms.topColor.value.setStyle(value);\r\n\t\t\t});\r\n\t\ttextFolder\r\n\t\t\t.addColor(params, 'textBottomColor')\r\n\t\t\t.name('bottomColor')\r\n\t\t\t.onChange(value => {\r\n\t\t\t\ttextMaterial.uniforms.bottomColor.value.setStyle(value);\r\n\t\t\t});\r\n\t\ttextFolder.open();\r\n\t}\r\n\r\n\tinitBackground() {\r\n\t\tlet bgMaterial = (this.bgMaterial = new BGMaterial(BGUniformsConfig[0]));\r\n\t\tlet bgMesh = new THREE.Mesh(this.viewer.screenGeometry, bgMaterial);\r\n\t\tbgMesh.layers.set(this.layers.BG_LAYER);\r\n\t\tthis.scene.add(bgMesh);\r\n\t}\r\n\r\n\tswapAnime() {\r\n\t\tif (this.isAnimeChanging) return;\r\n\t\tthis.isAnimeChanging = true;\r\n\t\tgsap.killTweensOf(this.animeNameTitleList[this.curAnimeIndex].material.uniforms.opacity);\r\n\t\t// Set next anime index\r\n\t\tlet nextAnimeIndex = (this.curAnimeIndex + 1) % GalleryConfig.galleryTexture1.length;\r\n\t\tlet tempCurAnimeIndex = this.curAnimeIndex;\r\n\t\tthis.curAnimeIndex = nextAnimeIndex;\r\n\t\tthis.galleryTextures.forEach((galleryTexture, index) => {\r\n\t\t\tlet config = GalleryConfig[`galleryTexture${index + 1}`];\r\n\t\t\tgalleryTexture.setNextTexture(this.assetLibrary.get(config[nextAnimeIndex]));\r\n\t\t});\r\n\t\t// Animation\r\n\t\t// galleryTextures Animation\r\n\t\tgsap.fromTo(\r\n\t\t\tthis.animeProgress,\r\n\t\t\t{ value: 0 },\r\n\t\t\t{\r\n\t\t\t\tvalue: 1,\r\n\t\t\t\tduration: this.animeDuration,\r\n\t\t\t\tease: 'power2.out',\r\n\t\t\t\tonComplete: () => {\r\n\t\t\t\t\tthis.galleryTextures.forEach(galleryTexture => {\r\n\t\t\t\t\t\tgalleryTexture.swapTextures();\r\n\t\t\t\t\t});\r\n\t\t\t\t\tgsap.set(this.animeProgress, { value: 0 });\r\n\t\t\t\t\tthis.isAnimeChanging = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t);\r\n\t\t// BG Animation\r\n\t\tlet nextBGUniforms = BGUniformsConfig[nextAnimeIndex];\r\n\t\tObject.keys(nextBGUniforms).map(key => {\r\n\t\t\tif (typeof nextBGUniforms[`${key}`] === 'number') {\r\n\t\t\t\tgsap.to(this.bgMaterial.uniforms[`${key}`], {\r\n\t\t\t\t\tduration: this.animeDuration,\r\n\t\t\t\t\tease: 'power2.out',\r\n\t\t\t\t\tvalue: nextBGUniforms[`${key}`]\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\tgsap.to(this.bgMaterial.uniforms[`${key}`].value, {\r\n\t\t\t\t\tduration: this.animeDuration,\r\n\t\t\t\t\tease: 'power2.out',\r\n\t\t\t\t\t...nextBGUniforms[`${key}`]\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t\t// Particle Animation\r\n\t\tlet nextParticleUniforms = ParticleUniformsConfig[nextAnimeIndex];\r\n\t\tgsap.to(this.particles.color, {\r\n\t\t\tduration: this.animeDuration,\r\n\t\t\tease: 'power2.out',\r\n\t\t\t...nextParticleUniforms.color\r\n\t\t});\r\n\t\tthis.particles.type = nextAnimeIndex;\r\n\t\t// Text Animation\r\n\t\tlet nextTextUniforms = TextUniformConfigList[nextAnimeIndex];\r\n\t\tObject.keys(nextTextUniforms).map(key => {\r\n\t\t\tgsap.to(this.textMaterial.uniforms[`${key}`].value, {\r\n\t\t\t\tduration: this.animeDuration,\r\n\t\t\t\tease: 'power2.out',\r\n\t\t\t\t...nextTextUniforms[`${key}`]\r\n\t\t\t});\r\n\t\t});\r\n\t\t// AnimeTitle Animation\r\n\t\tlet curAnimeTitle = this.animeNameTitleList[tempCurAnimeIndex];\r\n\t\tlet nextAnimeTitle = this.animeNameTitleList[nextAnimeIndex];\r\n\t\tnextAnimeTitle.resize(this.viewer.width, this.viewer.height);\r\n\t\tgsap.fromTo(\r\n\t\t\tcurAnimeTitle.material.uniforms.opacity,\r\n\t\t\t{ value: 1 },\r\n\t\t\t{ value: 0, duration: 0.5, ease: 'power2.out' }\r\n\t\t);\r\n\t\tgsap.fromTo(\r\n\t\t\tnextAnimeTitle.material.uniforms.opacity,\r\n\t\t\t{ value: 0 },\r\n\t\t\t{ value: 1, duration: 0.5, delay: 0.5, ease: 'power2.out' }\r\n\t\t);\r\n\t}\r\n\r\n\twhileVisible(order) {\r\n\t\tlet cameraPos = this.camera.position;\r\n\t\tlet textOpacity = this.textMaterial.uniforms.opacity;\r\n\t\tgsap.killTweensOf(cameraPos);\r\n\t\tgsap.killTweensOf(textOpacity);\r\n\t\tif (order === 'pre') {\r\n\t\t\tgsap.fromTo(cameraPos, { y: -30 }, { y: 0, duration: this.viewer.scrollAnimeDuration, ease: 'power2.out' });\r\n\t\t} else {\r\n\t\t\tgsap.fromTo(cameraPos, { y: 30 }, { y: 0, duration: this.viewer.scrollAnimeDuration, ease: 'power2.out' });\r\n\t\t}\r\n\t\tgsap.fromTo(textOpacity, { value: 0 }, { value: 1, duration: 1.5, delay: 0.8, ease: 'power2.out' });\r\n\t\tgsap.to(this.animeNameTitleList[this.curAnimeIndex].material.uniforms.opacity, {\r\n\t\t\tvalue: 1,\r\n\t\t\tduration: 1,\r\n\t\t\tdelay: 1,\r\n\t\t\tease: 'power2.out'\r\n\t\t});\r\n\t\tgsap.to(this.arrowBtn, { opacity: 0.8, duration: 1.5, delay: 0.5, ease: 'power2.out' });\r\n\t}\r\n\r\n\twhileNoVisible(order) {\r\n\t\tlet cameraPos = this.camera.position;\r\n\t\tlet textOpacity = this.textMaterial.uniforms.opacity;\r\n\t\tgsap.killTweensOf(cameraPos);\r\n\t\tgsap.killTweensOf(textOpacity);\r\n\t\tif (order === 'pre') {\r\n\t\t\tgsap.fromTo(cameraPos, { y: 0 }, { y: 30, duration: this.viewer.scrollAnimeDuration, ease: 'power2.out' });\r\n\t\t} else {\r\n\t\t\tgsap.fromTo(cameraPos, { y: 0 }, { y: -30, duration: this.viewer.scrollAnimeDuration, ease: 'power2.out' });\r\n\t\t}\r\n\t\tgsap.fromTo(textOpacity, { value: 1 }, { value: 0, duration: 0.5, ease: 'power2.out' });\r\n\t\tgsap.to(this.animeNameTitleList[this.curAnimeIndex].material.uniforms.opacity, {\r\n\t\t\tvalue: 0,\r\n\t\t\tduration: 1,\r\n\t\t\tease: 'power2.out'\r\n\t\t});\r\n\t\tgsap.to(this.arrowBtn, { opacity: 0.0, duration: 0.8, ease: 'power2.out' });\r\n\t}\r\n\r\n\tinitEvent() {\r\n\t\tif (!this.isMobile) {\r\n\t\t\tthis.eventHandler.onMouseMoveEvent.bind(this.onMouseMove.bind(this));\r\n\t\t} else {\r\n\t\t\tthis.eventHandler.onTouchMoveEvent.bind(this.onMouseMove.bind(this));\r\n\t\t}\r\n\t\tthis.intersectsArr.push(this.arrowBtn.hitArea);\r\n\t\tthis.eventHandler.onClickEvent.bind(this.onClick.bind(this));\r\n\t}\r\n\r\n\tonClick(event) {\r\n\t\tif (!this.visible) return;\r\n\t\tif (this.isMobile) {\r\n\t\t\tlet x = event.clientX;\r\n\t\t\tlet y = event.clientY;\r\n\t\t\tthis.clickNDCPos.set((x / window.innerWidth) * 2 - 1, (-y / window.innerHeight) * 2 + 1);\r\n\t\t\tconsole.log(this.clickNDCPos);\r\n\t\t\tthis.raycaster.setFromCamera(this.clickNDCPos, this.uiCamera);\r\n\t\t\tthis.intersects = this.raycaster.intersectObjects(this.intersectsArr);\r\n\t\t}\r\n\t\tif (!this.intersects.length) return;\r\n\t\tlet intersectsRes = this.intersects[0].object;\r\n\t\tif (intersectsRes.name === 'arrowButton' && !this.isAnimeChanging) {\r\n\t\t\tthis.swapAnime();\r\n\t\t}\r\n\t}\r\n\r\n\tonMouseMove(event) {\r\n\t\tif (!this.visible) return;\r\n\t\tlet positionNormX = this.state.pointer.positionNorm[0] - 0.5;\r\n\t\tlet sceneRoationTarget = positionNormX * this.sceneRotateXLimit;\r\n\t\tgsap.killTweensOf(this.rotateGroup.rotation);\r\n\t\tgsap.to(this.rotateGroup.rotation, { y: sceneRoationTarget, duration: 1, ease: 'power2.out' });\r\n\t\t// Button\r\n\t\tthis.raycaster.setFromCamera(this.state.pointer.ndcPosition, this.uiCamera);\r\n\t\tthis.intersects = this.raycaster.intersectObjects(this.intersectsArr);\r\n\t\tif (this.intersects.length > 0) {\r\n\t\t\tdocument.body.setAttribute('cursor', 'pointer');\r\n\t\t} else {\r\n\t\t\tdocument.body.removeAttribute('cursor');\r\n\t\t}\r\n\t}\r\n\r\n\tresize(width, height, dpr) {\r\n\t\tconst pixelWidth = width * dpr;\r\n\t\tconst pixelHeight = height * dpr;\r\n\t\tthis.postProcessingMaterial.resize(pixelWidth, pixelHeight);\r\n\t\tthis.camera.aspect = width / height;\r\n\t\tthis.camera.updateProjectionMatrix();\r\n\t\tthis.uiCamera.left = -width / 2;\r\n\t\tthis.uiCamera.right = width / 2;\r\n\t\tthis.uiCamera.top = height / 2;\r\n\t\tthis.uiCamera.bottom = -height / 2;\r\n\t\tthis.uiCamera.updateProjectionMatrix();\r\n\t\tthis.resizeText(width, height);\r\n\t\tthis.resizeGalleryTextures(width, height);\r\n\t\tthis.resizeUIPanel(width, height);\r\n\t}\r\n\r\n\trender({ renderer, orthoCamera, target, deltaTime } = {}) {\r\n\t\tif (!this.visible) return;\r\n\t\tthis.textMaterial.uniforms.time.value += deltaTime;\r\n\t\t// BG\r\n\t\torthoCamera.layers.set(this.layers.BG_LAYER);\r\n\t\trenderer.render(this.scene, orthoCamera);\r\n\t\t// Scene\r\n\t\tthis.camera.layers.set(this.layers.SCENE_LAYER);\r\n\t\tif (this.particles) this.particles.render(deltaTime);\r\n\t\trenderer.render(this.scene, this.camera);\r\n\t\t// Texture\r\n\t\tthis.camera.layers.set(this.layers.TEX_LAYER);\r\n\t\tif (this.galleryTextures) this.galleryTextures.forEach(texture => texture.render(deltaTime));\r\n\t\trenderer.render(this.scene, this.camera);\r\n\t\t// UI\r\n\t\tthis.arrowBtn.update(deltaTime);\r\n\t\tthis.uiCamera.layers.set(this.layers.UI_LAYER);\r\n\t\trenderer.render(this.uiScene, this.uiCamera);\r\n\t}\r\n}\r\n","import * as THREE from 'three';\r\n\r\nconst BGUniformsConfig = {\r\n\tbaseColor: new THREE.Color('rgb(33,33,33)'),\r\n\tarea1Color: new THREE.Color('rgb(255,255,255)'),\r\n\tarea1Radius: 1,\r\n\tarea1Position: new THREE.Vector2(1, 0),\r\n\tarea2Color: new THREE.Color('rgb(255,255,255)'),\r\n\tarea2Radius: 1,\r\n\tarea2Position: new THREE.Vector2(1, 1)\r\n};\r\n\r\nconst TextUniformConfig = {\r\n\ttopColor: new THREE.Color('rgb(255,255,255)'),\r\n\tbottomColor: new THREE.Color('rgb(0,0,255)')\r\n};\r\n\r\nconst TextConfig = {\r\n\tmainTitle: `Work !`,\r\n\tsubTitle: `three-viewer`,\r\n\tcontent: `I am working for 1 company 'FB*******'.\r\n\t And there are many plans for the future ~`\r\n};\r\n\r\nconst AnimeName = '[ gumq4 ]';\r\n\r\nconst AnimeTitleUniforms = {\r\n\ttopColor: new THREE.Color('rgb(255,255,255)'),\r\n\tbottomColor: new THREE.Color('rgb(0,0,255)')\r\n};\r\n\r\nconst diffuseEquation = ['Lambert', 'Burley', 'OrenNayar', 'Gotanda', 'None'];\r\n\r\nconst specularFresnelEquation = ['Schlick', 'CookTorrance', 'None'];\r\n\r\nconst specularNDFEquation = ['GGX', 'BlinnPhong', 'Beckmann'];\r\n\r\nconst specularVisEquation = ['SmithJointApprox', 'Implicit', 'Neumann', 'Kelemen', 'Schlick', 'Smith', 'HammonApprox'];\r\n\r\nconst specularAOList = ['Seblagarde', 'Marmosetco', 'None'];\r\n\r\nconst panelDefinesRegs = /(ENABLE_IBL)|(ENABLE_LIGHT)|(ENABLE_ANISOTROPY)|(ENABLE_CLEARCOAT)|(ENERGY_COMPENSATION)|(DIFFUSE_*)|(F_*)|(NDF_*)|(V_*)|(SPECULAR_AO_*)|(GEOMETRIC_SPECULAR_AA)|(MS_SPECULAR_AO)|(MS_DIFFUSE_AO)/;\r\n\r\nexport {\r\n\tBGUniformsConfig,\r\n\tTextUniformConfig,\r\n\tTextConfig,\r\n\tAnimeName,\r\n\tAnimeTitleUniforms,\r\n\tdiffuseEquation,\r\n\tspecularFresnelEquation,\r\n\tspecularNDFEquation,\r\n\tspecularVisEquation,\r\n\tspecularAOList,\r\n\tpanelDefinesRegs\r\n};\r\n","import * as THREE from 'three';\r\n\r\nconst bgDefaultUniforms = {\r\n\tuEnvBrightness: {\r\n\t\tvalue: 1.0\r\n\t},\r\n\tuEnvironmentTransform: {\r\n\t\tvalue: new THREE.Matrix3()\r\n\t}\r\n};\r\n\r\nconst pbrDefaultUniforms = {\r\n\troughness: {\r\n\t\tvalue: 0.5\r\n\t},\r\n\tmetalness: {\r\n\t\tvalue: 1\r\n\t},\r\n\tcolor: {\r\n\t\tvalue: new THREE.Color(0xffffff)\r\n\t},\r\n\temissive: {\r\n\t\tvalue: new THREE.Color(0x000000)\r\n\t},\r\n\tuEnvironmentTransform: {\r\n\t\tvalue: new THREE.Matrix3()\r\n\t},\r\n\tuEnvBrightness: {\r\n\t\tvalue: 1.0\r\n\t},\r\n\tuSpecularAAVariance: {\r\n\t\tvalue: 0.1\r\n\t},\r\n\tuSpecularAAThreshold: {\r\n\t\tvalue: 1.0\r\n\t},\r\n\t// Anisotropy\r\n\tuAnisotropyRotation: {\r\n\t\tvalue: 0\r\n\t},\r\n\tuAnisotropyFactor: {\r\n\t\tvalue: 0.5\r\n\t},\r\n\t// ClearCoat\r\n\tuClearCoatRoughness: {\r\n\t\tvalue: 0.5\r\n\t},\r\n\tuClearCoat: {\r\n\t\tvalue: 0.5\r\n\t}\r\n};\r\n\r\nconst pbrDefaultDefines = {\r\n\tENABLE_IBL: 1,\r\n\tENABLE_LIGHT: 1,\r\n\tENERGY_COMPENSATION: 1,\r\n\tDIFFUSE_LAMBERT: 1,\r\n\tNDF_GGX: 1,\r\n\tF_SCHLICK: 1,\r\n\tV_SMITHJOINTAPPROX: 1,\r\n\t// ENABLE_ANISOTROPY: 1,\r\n\t// ENABLE_CLEARCOAT: 1,\r\n\t// GEOMETRIC_SPECULAR_AA: 1\r\n\tSPECULAR_AO_SEBLAGARDE: 1,\r\n\tMS_SPECULAR_AO: 1,\r\n\tMS_DIFFUSE_AO: 1\r\n};\r\n\r\nexport { pbrDefaultUniforms, bgDefaultUniforms, pbrDefaultDefines };\r\n","export default \"#define GLSLIFY 1\\nattribute vec3 position;\\nattribute vec2 uv;\\n\\nuniform vec2 resolution;\\nuniform vec2 imageResolution;\\n\\nvarying vec2 vUv;\\n\\nvoid main(void) {\\n\\t// source ratio / full image ratio => uv.x * ratio.x to set full screen image\\n\\tvec2 ratio = vec2(\\n\\t\\tmin((resolution.x / resolution.y) / (imageResolution.x / imageResolution.y), 1.0),\\n\\t\\tmin((resolution.y / resolution.x) / (imageResolution.y / imageResolution.x), 1.0)\\n\\t);\\n\\n\\t// Center\\n\\tvec2 updateUv = vec2(\\n\\t\\tuv.x * ratio.x + (1.0 - ratio.x) * 0.5,\\n\\t\\tuv.y * ratio.y + (1.0 - ratio.y) * 0.5\\n\\t);\\n\\n\\tvUv = updateUv;\\n\\tgl_Position = vec4(position.xy, 1.0, 1.0);\\n}\\n\";","export default \"precision highp float;\\n#define GLSLIFY 1\\n\\nuniform float time;\\nuniform sampler2D texture;\\nuniform vec2 resolution;\\nuniform float progress;\\nvarying vec2 vUv;\\nuniform bool isNext;\\nuniform vec2 uvTransformSpeed; // [down, up]\\nuniform float opacity;\\n\\nuniform float vignetteDarkness;\\nuniform float vignetteOffset;\\n\\nvoid main(void) {\\n\\tvec2 uv = vUv;\\n\\n\\tfloat y = gl_FragCoord.y / resolution.y; // [0, 1]\\n\\tfloat offset = progress;\\n\\tif(isNext){\\n        offset = 1. - progress;\\n\\t\\tuv.y += offset / uvTransformSpeed.x;\\n    }else{\\n\\t\\tuv.y -= offset / uvTransformSpeed.y;\\n\\t}\\n\\tvec4 texColor = texture2D(texture, uv);\\n\\n\\t// Vignette\\n\\tconst vec2 center = vec2(0.5);\\n\\tfloat d = distance(uv, center);\\n\\ttexColor *= smoothstep(0.8, vignetteOffset * 0.799, d * (vignetteDarkness + vignetteOffset));\\n\\n\\ttexColor.a *= opacity;\\n\\t\\n\\tgl_FragColor = texColor;\\n}\\n\";","import * as THREE from 'three';\r\nimport vertexShader from './shaders/image.vs';\r\nimport fragmentShader from './shaders/image.fs';\r\n\r\nexport class TextureBG extends THREE.Mesh {\r\n\tconstructor(texture, ppMaterial, opts = {}) {\r\n\t\tlet imageWidth = texture.image.width;\r\n\t\tlet imageHeight = texture.image.height;\r\n\t\tconst geometry = new THREE.PlaneBufferGeometry(2, 2);\r\n\t\tconst material = new THREE.RawShaderMaterial({\r\n\t\t\tuniforms: {\r\n\t\t\t\ttime: {\r\n\t\t\t\t\ttype: 'f',\r\n\t\t\t\t\tvalue: 0\r\n\t\t\t\t},\r\n\t\t\t\tprogress: {\r\n\t\t\t\t\ttype: 'f',\r\n\t\t\t\t\tvalue: 0\r\n\t\t\t\t},\r\n\t\t\t\tresolution: {\r\n\t\t\t\t\ttype: 'v2',\r\n\t\t\t\t\tvalue: new THREE.Vector2(window.innerWidth, window.innerHeight)\r\n\t\t\t\t},\r\n\t\t\t\timageResolution: {\r\n\t\t\t\t\ttype: 'v2',\r\n\t\t\t\t\tvalue: new THREE.Vector2(imageWidth, imageHeight)\r\n\t\t\t\t},\r\n\t\t\t\ttexture: {\r\n\t\t\t\t\ttype: 't',\r\n\t\t\t\t\tvalue: texture\r\n\t\t\t\t},\r\n\t\t\t\tisNext: { value: false },\r\n\t\t\t\tuvTransformSpeed: {\r\n\t\t\t\t\ttype: 'v2',\r\n\t\t\t\t\tvalue: opts.uvTransformSpeed || new THREE.Vector2(2, 2)\r\n\t\t\t\t},\r\n\t\t\t\topacity: { value: 1.0 },\r\n\t\t\t\tvignetteDarkness: { value: 1 },\r\n\t\t\t\tvignetteOffset: { value: 0.2 }\r\n\t\t\t},\r\n\t\t\tvertexShader,\r\n\t\t\tfragmentShader,\r\n\t\t\ttransparent: true,\r\n\t\t\tdepthTest: false,\r\n\t\t\tdepthWrite: false\r\n\t\t});\r\n\t\tsuper(geometry, material);\r\n\t\tthis.name = 'TextureBGMesh';\r\n\r\n\t\t// Sync postProcessingMaterial\r\n\t\tmaterial.uniforms.progress = ppMaterial.uniforms.progress;\r\n\t\tmaterial.uniforms.isNext = ppMaterial.uniforms.isNext;\r\n\t}\r\n\r\n\tupdate(time) {\r\n\t\tthis.material.uniforms.time.value += time;\r\n\t}\r\n\r\n\tresize(width, height) {\r\n\t\tthis.material.uniforms.resolution.value.set(width, height);\r\n\t}\r\n}\r\n","export default \"#define GLSLIFY 1\\nvarying vec3 vViewNormal;\\n\\nvoid main() {\\n    vViewNormal = position;\\n    vec4 pos = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\\n    // pos.z = 1.;\\n    gl_Position = pos;\\n}\\n\";","export default \"#define GLSLIFY 1\\nuniform samplerCube envMap;\\nuniform mat3 uEnvironmentTransform;\\nuniform float uEnvBrightness;\\nuniform vec2 uEnvironmentSize;\\nuniform float opacity;\\n\\nvarying vec3 vViewNormal;\\n\\nvec3 cubemapSeamlessFixDirection(const in vec3 direction, const in float scale ){\\n    vec3 dir = direction;\\n    // http://seblagarde.wordpress.com/2012/06/10/amd-cubemapgen-for-physically-based-rendering/\\n    float M = max(max(abs(dir.x), abs(dir.y)), abs(dir.z));\\n\\n    if (abs(dir.x) != M) dir.x *= scale;\\n    if (abs(dir.y) != M) dir.y *= scale;\\n    if (abs(dir.z) != M) dir.z *= scale;\\n\\n    return dir;\\n}\\n\\nvec4 textureCubemap(const in samplerCube tex, const in vec3 dir){\\n    vec4 rgba = textureCube(tex, dir);\\n    return LogLuvToLinear(rgba);\\n}\\n\\n// Seamless cubemap for background\\nvec4 textureCubeFixed(const in samplerCube tex, const in vec3 direction){\\n    // http://seblagarde.wordpress.com/2012/06/10/amd-cubemapgen-for-physically-based-rendering/\\n    float scale = 1.0 - 1.0 / uEnvironmentSize[0];\\n    vec3 dir = cubemapSeamlessFixDirection(direction, scale);\\n    return textureCubemap(tex, dir);\\n}\\n\\nvoid main(){\\n    vec3 direction = normalize(vViewNormal);\\n    direction = uEnvironmentTransform * direction;\\n    vec4 samplerColor = uEnvBrightness * textureCubeFixed(envMap, direction);\\n    samplerColor.a *= opacity;\\n    gl_FragColor = samplerColor;\\n    #include <tonemapping_fragment>\\n    #include <encodings_fragment>\\n}\\n\";","import * as THREE from 'three';\r\nimport backgroundVS from './shaders/backgroundVS';\r\nimport backgroundFS from './shaders/backgroundFS';\r\n\r\nclass BackgroundMaterial extends THREE.ShaderMaterial {\r\n\tconstructor(options) {\r\n\t\tlet { envMap, uBGEnvironmentSize } = options;\r\n\t\tlet uniforms = {\r\n\t\t\tenvMap: { value: envMap },\r\n\t\t\tuEnvironmentSize: { value: uBGEnvironmentSize },\r\n\t\t\tuEnvBrightness: { value: 1.0 },\r\n\t\t\tuEnvironmentTransform: { value: new THREE.Matrix3() },\r\n\t\t\topacity: { value: 0.0 }\r\n\t\t};\r\n\t\tsuper({\r\n\t\t\tuniforms,\r\n\t\t\tvertexShader: backgroundVS,\r\n\t\t\tfragmentShader: backgroundFS,\r\n\t\t\tside: THREE.DoubleSide,\r\n\t\t\ttransparent: true\r\n\t\t});\r\n\t}\r\n}\r\n\r\nexport { BackgroundMaterial };\r\n","import * as THREE from 'three';\r\nimport { BackgroundMaterial } from './BackgroundMaterial';\r\n\r\nclass Background extends THREE.Mesh {\r\n\tconstructor(uniforms, size = 1000) {\r\n\t\tconst radius = size / 2;\r\n\t\tlet sphere = new THREE.SphereGeometry(radius, 20, 20);\r\n\t\tlet material = new BackgroundMaterial(uniforms);\r\n\t\tsuper(sphere, material);\r\n\t\tthis.radius = radius;\r\n\t\tthis.sphere = sphere;\r\n\t}\r\n\r\n\tget envMap() {\r\n\t\treturn this.material.envMap;\r\n\t}\r\n\r\n\tset envMap(envMap) {\r\n\t\tthis.material.envMap = envMap;\r\n\t}\r\n\r\n\tget mesh() {\r\n\t\treturn this.sphere;\r\n\t}\r\n\r\n\tsetSize(size) {\r\n\t\tlet scale = size / this.radius;\r\n\t\t// Half\r\n\t\tthis.scale.setScalar(scale);\r\n\t}\r\n}\r\n\r\nexport { Background };\r\n","/**\r\n * @author qiao / https://github.com/qiao\r\n * @author mrdoob / http://mrdoob.com\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n * @author erich666 / http://erichaines.com\r\n * @author ScieCode / http://github.com/sciecode\r\n */\r\n\r\nimport { EventDispatcher, MOUSE, Quaternion, Spherical, TOUCH, Vector2, Vector3 } from 'three';\r\n\r\n// This set of controls performs orbiting, dollying (zooming), and panning.\r\n// Unlike TrackballControls, it maintains the \"up\" direction object.up (+Y by default).\r\n//\r\n//    Orbit - left mouse / touch: one-finger move\r\n//    Zoom - middle mouse, or mousewheel / touch: two-finger spread or squish\r\n//    Pan - right mouse, or left mouse + ctrl/meta/shiftKey, or arrow keys / touch: two-finger move\r\n\r\nvar OrbitControls = function (object, domElement) {\r\n\tif (domElement === undefined)\r\n\t\tconsole.warn('THREE.OrbitControls: The second parameter \"domElement\" is now mandatory.');\r\n\tif (domElement === document)\r\n\t\tconsole.error(\r\n\t\t\t'THREE.OrbitControls: \"document\" should not be used as the target \"domElement\". Please use \"renderer.domElement\" instead.'\r\n\t\t);\r\n\r\n\tthis.object = object;\r\n\tthis.domElement = domElement;\r\n\r\n\t// Set to false to disable this control\r\n\tthis.enabled = true;\r\n\r\n\t// \"target\" sets the location of focus, where the object orbits around\r\n\tthis.target = new Vector3();\r\n\r\n\t// How far you can dolly in and out ( PerspectiveCamera only )\r\n\tthis.minDistance = 0;\r\n\tthis.maxDistance = Infinity;\r\n\r\n\t// How far you can zoom in and out ( OrthographicCamera only )\r\n\tthis.minZoom = 0;\r\n\tthis.maxZoom = Infinity;\r\n\r\n\t// How far you can orbit vertically, upper and lower limits.\r\n\t// Range is 0 to Math.PI radians.\r\n\tthis.minPolarAngle = 0; // radians\r\n\tthis.maxPolarAngle = Math.PI; // radians\r\n\r\n\t// How far you can orbit horizontally, upper and lower limits.\r\n\t// If set, must be a sub-interval of the interval [ - Math.PI, Math.PI ].\r\n\tthis.minAzimuthAngle = -Infinity; // radians\r\n\tthis.maxAzimuthAngle = Infinity; // radians\r\n\r\n\t// Set to true to enable damping (inertia)\r\n\t// If damping is enabled, you must call controls.update() in your animation loop\r\n\tthis.enableDamping = false;\r\n\tthis.dampingFactor = 0.05;\r\n\r\n\t// This option actually enables dollying in and out; left as \"zoom\" for backwards compatibility.\r\n\t// Set to false to disable zooming\r\n\tthis.enableZoom = true;\r\n\tthis.zoomSpeed = 1.0;\r\n\r\n\t// Set to false to disable rotating\r\n\tthis.enableRotate = true;\r\n\tthis.rotateSpeed = 1.0;\r\n\r\n\t// Set to false to disable panning\r\n\tthis.enablePan = true;\r\n\tthis.panSpeed = 1.0;\r\n\tthis.screenSpacePanning = false; // if true, pan in screen-space\r\n\tthis.keyPanSpeed = 7.0; // pixels moved per arrow key push\r\n\r\n\t// Set to true to automatically rotate around the target\r\n\t// If auto-rotate is enabled, you must call controls.update() in your animation loop\r\n\tthis.autoRotate = false;\r\n\tthis.autoRotateSpeed = 2.0; // 30 seconds per round when fps is 60\r\n\r\n\t// Set to false to disable use of the keys\r\n\tthis.enableKeys = true;\r\n\r\n\t// The four arrow keys\r\n\tthis.keys = { LEFT: 37, UP: 38, RIGHT: 39, BOTTOM: 40 };\r\n\r\n\t// Mouse buttons\r\n\tthis.mouseButtons = { LEFT: MOUSE.ROTATE, MIDDLE: MOUSE.DOLLY, RIGHT: MOUSE.PAN };\r\n\r\n\t// Touch fingers\r\n\tthis.touches = { ONE: TOUCH.ROTATE, TWO: TOUCH.DOLLY_PAN };\r\n\r\n\t// for reset\r\n\tthis.target0 = this.target.clone();\r\n\tthis.position0 = this.object.position.clone();\r\n\tthis.zoom0 = this.object.zoom;\r\n\r\n\t//\r\n\t// public methods\r\n\t//\r\n\r\n\tthis.getPolarAngle = function () {\r\n\t\treturn spherical.phi;\r\n\t};\r\n\r\n\tthis.getAzimuthalAngle = function () {\r\n\t\treturn spherical.theta;\r\n\t};\r\n\r\n\tthis.saveState = function () {\r\n\t\tscope.target0.copy(scope.target);\r\n\t\tscope.position0.copy(scope.object.position);\r\n\t\tscope.zoom0 = scope.object.zoom;\r\n\t};\r\n\r\n\tthis.reset = function () {\r\n\t\tscope.target.copy(scope.target0);\r\n\t\tscope.object.position.copy(scope.position0);\r\n\t\tscope.object.zoom = scope.zoom0;\r\n\r\n\t\tscope.object.updateProjectionMatrix();\r\n\t\tscope.dispatchEvent(changeEvent);\r\n\r\n\t\tscope.update();\r\n\r\n\t\tstate = STATE.NONE;\r\n\t};\r\n\r\n\t// this method is exposed, but perhaps it would be better if we can make it private...\r\n\tthis.update = (function () {\r\n\t\tvar offset = new Vector3();\r\n\r\n\t\t// so camera.up is the orbit axis\r\n\t\tvar quat = new Quaternion().setFromUnitVectors(object.up, new Vector3(0, 1, 0));\r\n\t\tvar quatInverse = quat.clone().inverse();\r\n\r\n\t\tvar lastPosition = new Vector3();\r\n\t\tvar lastQuaternion = new Quaternion();\r\n\r\n\t\treturn function update() {\r\n\t\t\tvar position = scope.object.position;\r\n\r\n\t\t\toffset.copy(position).sub(scope.target);\r\n\r\n\t\t\t// rotate offset to \"y-axis-is-up\" space\r\n\t\t\toffset.applyQuaternion(quat);\r\n\r\n\t\t\t// angle from z-axis around y-axis\r\n\t\t\tspherical.setFromVector3(offset);\r\n\r\n\t\t\tif (scope.autoRotate && state === STATE.NONE) {\r\n\t\t\t\trotateLeft(getAutoRotationAngle());\r\n\t\t\t}\r\n\r\n\t\t\tif (scope.enableDamping) {\r\n\t\t\t\tspherical.theta += sphericalDelta.theta * scope.dampingFactor;\r\n\t\t\t\tspherical.phi += sphericalDelta.phi * scope.dampingFactor;\r\n\t\t\t} else {\r\n\t\t\t\tspherical.theta += sphericalDelta.theta;\r\n\t\t\t\tspherical.phi += sphericalDelta.phi;\r\n\t\t\t}\r\n\r\n\t\t\t// restrict theta to be between desired limits\r\n\t\t\tspherical.theta = Math.max(scope.minAzimuthAngle, Math.min(scope.maxAzimuthAngle, spherical.theta));\r\n\r\n\t\t\t// restrict phi to be between desired limits\r\n\t\t\tspherical.phi = Math.max(scope.minPolarAngle, Math.min(scope.maxPolarAngle, spherical.phi));\r\n\r\n\t\t\tspherical.makeSafe();\r\n\r\n\t\t\tspherical.radius *= scale;\r\n\r\n\t\t\t// restrict radius to be between desired limits\r\n\t\t\tspherical.radius = Math.max(scope.minDistance, Math.min(scope.maxDistance, spherical.radius));\r\n\r\n\t\t\t// move target to panned location\r\n\r\n\t\t\tif (scope.enableDamping === true) {\r\n\t\t\t\tscope.target.addScaledVector(panOffset, scope.dampingFactor);\r\n\t\t\t} else {\r\n\t\t\t\tscope.target.add(panOffset);\r\n\t\t\t}\r\n\r\n\t\t\toffset.setFromSpherical(spherical);\r\n\r\n\t\t\t// rotate offset back to \"camera-up-vector-is-up\" space\r\n\t\t\toffset.applyQuaternion(quatInverse);\r\n\r\n\t\t\tposition.copy(scope.target).add(offset);\r\n\r\n\t\t\tscope.object.lookAt(scope.target);\r\n\r\n\t\t\tif (scope.enableDamping === true) {\r\n\t\t\t\tsphericalDelta.theta *= 1 - scope.dampingFactor;\r\n\t\t\t\tsphericalDelta.phi *= 1 - scope.dampingFactor;\r\n\r\n\t\t\t\tpanOffset.multiplyScalar(1 - scope.dampingFactor);\r\n\t\t\t} else {\r\n\t\t\t\tsphericalDelta.set(0, 0, 0);\r\n\r\n\t\t\t\tpanOffset.set(0, 0, 0);\r\n\t\t\t}\r\n\r\n\t\t\tscale = 1;\r\n\r\n\t\t\t// update condition is:\r\n\t\t\t// min(camera displacement, camera rotation in radians)^2 > EPS\r\n\t\t\t// using small-angle approximation cos(x/2) = 1 - x^2 / 8\r\n\r\n\t\t\tif (\r\n\t\t\t\tzoomChanged ||\r\n\t\t\t\tlastPosition.distanceToSquared(scope.object.position) > EPS ||\r\n\t\t\t\t8 * (1 - lastQuaternion.dot(scope.object.quaternion)) > EPS\r\n\t\t\t) {\r\n\t\t\t\tscope.dispatchEvent(changeEvent);\r\n\r\n\t\t\t\tlastPosition.copy(scope.object.position);\r\n\t\t\t\tlastQuaternion.copy(scope.object.quaternion);\r\n\t\t\t\tzoomChanged = false;\r\n\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\t\t};\r\n\t})();\r\n\r\n\tthis.dispose = function () {\r\n\t\tscope.domElement.removeEventListener('contextmenu', onContextMenu, false);\r\n\t\tscope.domElement.removeEventListener('mousedown', onMouseDown, false);\r\n\t\tscope.domElement.removeEventListener('wheel', onMouseWheel, false);\r\n\r\n\t\tscope.domElement.removeEventListener('touchstart', onTouchStart, false);\r\n\t\tscope.domElement.removeEventListener('touchend', onTouchEnd, false);\r\n\t\tscope.domElement.removeEventListener('touchmove', onTouchMove, false);\r\n\r\n\t\tdocument.removeEventListener('mousemove', onMouseMove, false);\r\n\t\tdocument.removeEventListener('mouseup', onMouseUp, false);\r\n\r\n\t\tscope.domElement.removeEventListener('keydown', onKeyDown, false);\r\n\r\n\t\t//scope.dispatchEvent( { type: 'dispose' } ); // should this be added here?\r\n\t};\r\n\r\n\t//\r\n\t// internals\r\n\t//\r\n\r\n\tvar scope = this;\r\n\r\n\tvar changeEvent = { type: 'change' };\r\n\tvar startEvent = { type: 'start' };\r\n\tvar endEvent = { type: 'end' };\r\n\r\n\tvar STATE = {\r\n\t\tNONE: -1,\r\n\t\tROTATE: 0,\r\n\t\tDOLLY: 1,\r\n\t\tPAN: 2,\r\n\t\tTOUCH_ROTATE: 3,\r\n\t\tTOUCH_PAN: 4,\r\n\t\tTOUCH_DOLLY_PAN: 5,\r\n\t\tTOUCH_DOLLY_ROTATE: 6\r\n\t};\r\n\r\n\tvar state = STATE.NONE;\r\n\r\n\tvar EPS = 0.000001;\r\n\r\n\t// current position in spherical coordinates\r\n\tvar spherical = new Spherical();\r\n\tvar sphericalDelta = new Spherical();\r\n\r\n\tvar scale = 1;\r\n\tvar panOffset = new Vector3();\r\n\tvar zoomChanged = false;\r\n\r\n\tvar rotateStart = new Vector2();\r\n\tvar rotateEnd = new Vector2();\r\n\tvar rotateDelta = new Vector2();\r\n\r\n\tvar panStart = new Vector2();\r\n\tvar panEnd = new Vector2();\r\n\tvar panDelta = new Vector2();\r\n\r\n\tvar dollyStart = new Vector2();\r\n\tvar dollyEnd = new Vector2();\r\n\tvar dollyDelta = new Vector2();\r\n\r\n\tfunction getAutoRotationAngle() {\r\n\t\treturn ((2 * Math.PI) / 60 / 60) * scope.autoRotateSpeed;\r\n\t}\r\n\r\n\tfunction getZoomScale() {\r\n\t\treturn Math.pow(0.95, scope.zoomSpeed);\r\n\t}\r\n\r\n\tfunction rotateLeft(angle) {\r\n\t\tsphericalDelta.theta -= angle;\r\n\t}\r\n\r\n\tfunction rotateUp(angle) {\r\n\t\tsphericalDelta.phi -= angle;\r\n\t}\r\n\r\n\tvar panLeft = (function () {\r\n\t\tvar v = new Vector3();\r\n\r\n\t\treturn function panLeft(distance, objectMatrix) {\r\n\t\t\tv.setFromMatrixColumn(objectMatrix, 0); // get X column of objectMatrix\r\n\t\t\tv.multiplyScalar(-distance);\r\n\r\n\t\t\tpanOffset.add(v);\r\n\t\t};\r\n\t})();\r\n\r\n\tvar panUp = (function () {\r\n\t\tvar v = new Vector3();\r\n\r\n\t\treturn function panUp(distance, objectMatrix) {\r\n\t\t\tif (scope.screenSpacePanning === true) {\r\n\t\t\t\tv.setFromMatrixColumn(objectMatrix, 1);\r\n\t\t\t} else {\r\n\t\t\t\tv.setFromMatrixColumn(objectMatrix, 0);\r\n\t\t\t\tv.crossVectors(scope.object.up, v);\r\n\t\t\t}\r\n\r\n\t\t\tv.multiplyScalar(distance);\r\n\r\n\t\t\tpanOffset.add(v);\r\n\t\t};\r\n\t})();\r\n\r\n\t// deltaX and deltaY are in pixels; right and down are positive\r\n\tvar pan = (function () {\r\n\t\tvar offset = new Vector3();\r\n\r\n\t\treturn function pan(deltaX, deltaY) {\r\n\t\t\tvar element = scope.domElement;\r\n\r\n\t\t\tif (scope.object.isPerspectiveCamera) {\r\n\t\t\t\t// perspective\r\n\t\t\t\tvar position = scope.object.position;\r\n\t\t\t\toffset.copy(position).sub(scope.target);\r\n\t\t\t\tvar targetDistance = offset.length();\r\n\r\n\t\t\t\t// half of the fov is center to top of screen\r\n\t\t\t\ttargetDistance *= Math.tan(((scope.object.fov / 2) * Math.PI) / 180.0);\r\n\r\n\t\t\t\t// we use only clientHeight here so aspect ratio does not distort speed\r\n\t\t\t\tpanLeft((2 * deltaX * targetDistance) / element.clientHeight, scope.object.matrix);\r\n\t\t\t\tpanUp((2 * deltaY * targetDistance) / element.clientHeight, scope.object.matrix);\r\n\t\t\t} else if (scope.object.isOrthographicCamera) {\r\n\t\t\t\t// orthographic\r\n\t\t\t\tpanLeft(\r\n\t\t\t\t\t(deltaX * (scope.object.right - scope.object.left)) / scope.object.zoom / element.clientWidth,\r\n\t\t\t\t\tscope.object.matrix\r\n\t\t\t\t);\r\n\t\t\t\tpanUp(\r\n\t\t\t\t\t(deltaY * (scope.object.top - scope.object.bottom)) / scope.object.zoom / element.clientHeight,\r\n\t\t\t\t\tscope.object.matrix\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\t// camera neither orthographic nor perspective\r\n\t\t\t\tconsole.warn('WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.');\r\n\t\t\t\tscope.enablePan = false;\r\n\t\t\t}\r\n\t\t};\r\n\t})();\r\n\r\n\tfunction dollyIn(dollyScale) {\r\n\t\tif (scope.object.isPerspectiveCamera) {\r\n\t\t\tscale /= dollyScale;\r\n\t\t} else if (scope.object.isOrthographicCamera) {\r\n\t\t\tscope.object.zoom = Math.max(scope.minZoom, Math.min(scope.maxZoom, scope.object.zoom * dollyScale));\r\n\t\t\tscope.object.updateProjectionMatrix();\r\n\t\t\tzoomChanged = true;\r\n\t\t} else {\r\n\t\t\tconsole.warn('WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.');\r\n\t\t\tscope.enableZoom = false;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction dollyOut(dollyScale) {\r\n\t\tif (scope.object.isPerspectiveCamera) {\r\n\t\t\tscale *= dollyScale;\r\n\t\t} else if (scope.object.isOrthographicCamera) {\r\n\t\t\tscope.object.zoom = Math.max(scope.minZoom, Math.min(scope.maxZoom, scope.object.zoom / dollyScale));\r\n\t\t\tscope.object.updateProjectionMatrix();\r\n\t\t\tzoomChanged = true;\r\n\t\t} else {\r\n\t\t\tconsole.warn('WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.');\r\n\t\t\tscope.enableZoom = false;\r\n\t\t}\r\n\t}\r\n\r\n\t//\r\n\t// event callbacks - update the object state\r\n\t//\r\n\r\n\tfunction handleMouseDownRotate(event) {\r\n\t\trotateStart.set(event.clientX, event.clientY);\r\n\t}\r\n\r\n\tfunction handleMouseDownDolly(event) {\r\n\t\tdollyStart.set(event.clientX, event.clientY);\r\n\t}\r\n\r\n\tfunction handleMouseDownPan(event) {\r\n\t\tpanStart.set(event.clientX, event.clientY);\r\n\t}\r\n\r\n\tfunction handleMouseMoveRotate(event) {\r\n\t\trotateEnd.set(event.clientX, event.clientY);\r\n\r\n\t\trotateDelta.subVectors(rotateEnd, rotateStart).multiplyScalar(scope.rotateSpeed);\r\n\r\n\t\tvar element = scope.domElement;\r\n\r\n\t\trotateLeft((2 * Math.PI * rotateDelta.x) / element.clientHeight); // yes, height\r\n\r\n\t\trotateUp((2 * Math.PI * rotateDelta.y) / element.clientHeight);\r\n\r\n\t\trotateStart.copy(rotateEnd);\r\n\r\n\t\tscope.update();\r\n\t}\r\n\r\n\tfunction handleMouseMoveDolly(event) {\r\n\t\tdollyEnd.set(event.clientX, event.clientY);\r\n\r\n\t\tdollyDelta.subVectors(dollyEnd, dollyStart);\r\n\r\n\t\tif (dollyDelta.y > 0) {\r\n\t\t\tdollyIn(getZoomScale());\r\n\t\t} else if (dollyDelta.y < 0) {\r\n\t\t\tdollyOut(getZoomScale());\r\n\t\t}\r\n\r\n\t\tdollyStart.copy(dollyEnd);\r\n\r\n\t\tscope.update();\r\n\t}\r\n\r\n\tfunction handleMouseMovePan(event) {\r\n\t\tpanEnd.set(event.clientX, event.clientY);\r\n\r\n\t\tpanDelta.subVectors(panEnd, panStart).multiplyScalar(scope.panSpeed);\r\n\r\n\t\tpan(panDelta.x, panDelta.y);\r\n\r\n\t\tpanStart.copy(panEnd);\r\n\r\n\t\tscope.update();\r\n\t}\r\n\r\n\tfunction handleMouseUp(/*event*/) {\r\n\t\t// no-op\r\n\t}\r\n\r\n\tfunction handleMouseWheel(event) {\r\n\t\tif (event.deltaY < 0) {\r\n\t\t\tdollyOut(getZoomScale());\r\n\t\t} else if (event.deltaY > 0) {\r\n\t\t\tdollyIn(getZoomScale());\r\n\t\t}\r\n\r\n\t\tscope.update();\r\n\t}\r\n\r\n\tfunction handleKeyDown(event) {\r\n\t\tvar needsUpdate = false;\r\n\r\n\t\tswitch (event.keyCode) {\r\n\t\t\tcase scope.keys.UP:\r\n\t\t\t\tpan(0, scope.keyPanSpeed);\r\n\t\t\t\tneedsUpdate = true;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase scope.keys.BOTTOM:\r\n\t\t\t\tpan(0, -scope.keyPanSpeed);\r\n\t\t\t\tneedsUpdate = true;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase scope.keys.LEFT:\r\n\t\t\t\tpan(scope.keyPanSpeed, 0);\r\n\t\t\t\tneedsUpdate = true;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase scope.keys.RIGHT:\r\n\t\t\t\tpan(-scope.keyPanSpeed, 0);\r\n\t\t\t\tneedsUpdate = true;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tif (needsUpdate) {\r\n\t\t\t// prevent the browser from scrolling on cursor keys\r\n\t\t\tevent.preventDefault();\r\n\r\n\t\t\tscope.update();\r\n\t\t}\r\n\t}\r\n\r\n\tfunction handleTouchStartRotate(event) {\r\n\t\tif (event.touches.length == 1) {\r\n\t\t\trotateStart.set(event.touches[0].pageX, event.touches[0].pageY);\r\n\t\t} else {\r\n\t\t\tvar x = 0.5 * (event.touches[0].pageX + event.touches[1].pageX);\r\n\t\t\tvar y = 0.5 * (event.touches[0].pageY + event.touches[1].pageY);\r\n\r\n\t\t\trotateStart.set(x, y);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction handleTouchStartPan(event) {\r\n\t\tif (event.touches.length == 1) {\r\n\t\t\tpanStart.set(event.touches[0].pageX, event.touches[0].pageY);\r\n\t\t} else {\r\n\t\t\tvar x = 0.5 * (event.touches[0].pageX + event.touches[1].pageX);\r\n\t\t\tvar y = 0.5 * (event.touches[0].pageY + event.touches[1].pageY);\r\n\r\n\t\t\tpanStart.set(x, y);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction handleTouchStartDolly(event) {\r\n\t\tvar dx = event.touches[0].pageX - event.touches[1].pageX;\r\n\t\tvar dy = event.touches[0].pageY - event.touches[1].pageY;\r\n\r\n\t\tvar distance = Math.sqrt(dx * dx + dy * dy);\r\n\r\n\t\tdollyStart.set(0, distance);\r\n\t}\r\n\r\n\tfunction handleTouchStartDollyPan(event) {\r\n\t\tif (scope.enableZoom) handleTouchStartDolly(event);\r\n\r\n\t\tif (scope.enablePan) handleTouchStartPan(event);\r\n\t}\r\n\r\n\tfunction handleTouchStartDollyRotate(event) {\r\n\t\tif (scope.enableZoom) handleTouchStartDolly(event);\r\n\r\n\t\tif (scope.enableRotate) handleTouchStartRotate(event);\r\n\t}\r\n\r\n\tfunction handleTouchMoveRotate(event) {\r\n\t\tif (event.touches.length == 1) {\r\n\t\t\trotateEnd.set(event.touches[0].pageX, event.touches[0].pageY);\r\n\t\t} else {\r\n\t\t\tvar x = 0.5 * (event.touches[0].pageX + event.touches[1].pageX);\r\n\t\t\tvar y = 0.5 * (event.touches[0].pageY + event.touches[1].pageY);\r\n\r\n\t\t\trotateEnd.set(x, y);\r\n\t\t}\r\n\r\n\t\trotateDelta.subVectors(rotateEnd, rotateStart).multiplyScalar(scope.rotateSpeed);\r\n\r\n\t\tvar element = scope.domElement;\r\n\r\n\t\trotateLeft((2 * Math.PI * rotateDelta.x) / element.clientHeight); // yes, height\r\n\r\n\t\trotateUp((2 * Math.PI * rotateDelta.y) / element.clientHeight);\r\n\r\n\t\trotateStart.copy(rotateEnd);\r\n\t}\r\n\r\n\tfunction handleTouchMovePan(event) {\r\n\t\tif (event.touches.length == 1) {\r\n\t\t\tpanEnd.set(event.touches[0].pageX, event.touches[0].pageY);\r\n\t\t} else {\r\n\t\t\tvar x = 0.5 * (event.touches[0].pageX + event.touches[1].pageX);\r\n\t\t\tvar y = 0.5 * (event.touches[0].pageY + event.touches[1].pageY);\r\n\r\n\t\t\tpanEnd.set(x, y);\r\n\t\t}\r\n\r\n\t\tpanDelta.subVectors(panEnd, panStart).multiplyScalar(scope.panSpeed);\r\n\r\n\t\tpan(panDelta.x, panDelta.y);\r\n\r\n\t\tpanStart.copy(panEnd);\r\n\t}\r\n\r\n\tfunction handleTouchMoveDolly(event) {\r\n\t\tvar dx = event.touches[0].pageX - event.touches[1].pageX;\r\n\t\tvar dy = event.touches[0].pageY - event.touches[1].pageY;\r\n\r\n\t\tvar distance = Math.sqrt(dx * dx + dy * dy);\r\n\r\n\t\tdollyEnd.set(0, distance);\r\n\r\n\t\tdollyDelta.set(0, Math.pow(dollyEnd.y / dollyStart.y, scope.zoomSpeed));\r\n\r\n\t\tdollyIn(dollyDelta.y);\r\n\r\n\t\tdollyStart.copy(dollyEnd);\r\n\t}\r\n\r\n\tfunction handleTouchMoveDollyPan(event) {\r\n\t\tif (scope.enableZoom) handleTouchMoveDolly(event);\r\n\r\n\t\tif (scope.enablePan) handleTouchMovePan(event);\r\n\t}\r\n\r\n\tfunction handleTouchMoveDollyRotate(event) {\r\n\t\tif (scope.enableZoom) handleTouchMoveDolly(event);\r\n\r\n\t\tif (scope.enableRotate) handleTouchMoveRotate(event);\r\n\t}\r\n\r\n\tfunction handleTouchEnd(/*event*/) {\r\n\t\t// no-op\r\n\t}\r\n\r\n\t//\r\n\t// event handlers - FSM: listen for events and reset state\r\n\t//\r\n\r\n\tfunction onMouseDown(event) {\r\n\t\tif (scope.enabled === false) return;\r\n\r\n\t\t// Prevent the browser from scrolling.\r\n\r\n\t\tevent.preventDefault();\r\n\r\n\t\t// Manually set the focus since calling preventDefault above\r\n\t\t// prevents the browser from setting it automatically.\r\n\r\n\t\tscope.domElement.focus ? scope.domElement.focus() : window.focus();\r\n\r\n\t\tswitch (event.button) {\r\n\t\t\tcase 0:\r\n\t\t\t\tswitch (scope.mouseButtons.LEFT) {\r\n\t\t\t\t\tcase MOUSE.ROTATE:\r\n\t\t\t\t\t\tif (event.ctrlKey || event.metaKey || event.shiftKey) {\r\n\t\t\t\t\t\t\tif (scope.enablePan === false) return;\r\n\r\n\t\t\t\t\t\t\thandleMouseDownPan(event);\r\n\r\n\t\t\t\t\t\t\tstate = STATE.PAN;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tif (scope.enableRotate === false) return;\r\n\r\n\t\t\t\t\t\t\thandleMouseDownRotate(event);\r\n\r\n\t\t\t\t\t\t\tstate = STATE.ROTATE;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase MOUSE.PAN:\r\n\t\t\t\t\t\tif (event.ctrlKey || event.metaKey || event.shiftKey) {\r\n\t\t\t\t\t\t\tif (scope.enableRotate === false) return;\r\n\r\n\t\t\t\t\t\t\thandleMouseDownRotate(event);\r\n\r\n\t\t\t\t\t\t\tstate = STATE.ROTATE;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tif (scope.enablePan === false) return;\r\n\r\n\t\t\t\t\t\t\thandleMouseDownPan(event);\r\n\r\n\t\t\t\t\t\t\tstate = STATE.PAN;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tstate = STATE.NONE;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 1:\r\n\t\t\t\tswitch (scope.mouseButtons.MIDDLE) {\r\n\t\t\t\t\tcase MOUSE.DOLLY:\r\n\t\t\t\t\t\tif (scope.enableZoom === false) return;\r\n\r\n\t\t\t\t\t\thandleMouseDownDolly(event);\r\n\r\n\t\t\t\t\t\tstate = STATE.DOLLY;\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tstate = STATE.NONE;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 2:\r\n\t\t\t\tswitch (scope.mouseButtons.RIGHT) {\r\n\t\t\t\t\tcase MOUSE.ROTATE:\r\n\t\t\t\t\t\tif (scope.enableRotate === false) return;\r\n\r\n\t\t\t\t\t\thandleMouseDownRotate(event);\r\n\r\n\t\t\t\t\t\tstate = STATE.ROTATE;\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase MOUSE.PAN:\r\n\t\t\t\t\t\tif (scope.enablePan === false) return;\r\n\r\n\t\t\t\t\t\thandleMouseDownPan(event);\r\n\r\n\t\t\t\t\t\tstate = STATE.PAN;\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tstate = STATE.NONE;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\tif (state !== STATE.NONE) {\r\n\t\t\tdocument.addEventListener('mousemove', onMouseMove, false);\r\n\t\t\tdocument.addEventListener('mouseup', onMouseUp, false);\r\n\r\n\t\t\tscope.dispatchEvent(startEvent);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction onMouseMove(event) {\r\n\t\tif (scope.enabled === false) return;\r\n\r\n\t\tevent.preventDefault();\r\n\r\n\t\tswitch (state) {\r\n\t\t\tcase STATE.ROTATE:\r\n\t\t\t\tif (scope.enableRotate === false) return;\r\n\r\n\t\t\t\thandleMouseMoveRotate(event);\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase STATE.DOLLY:\r\n\t\t\t\tif (scope.enableZoom === false) return;\r\n\r\n\t\t\t\thandleMouseMoveDolly(event);\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase STATE.PAN:\r\n\t\t\t\tif (scope.enablePan === false) return;\r\n\r\n\t\t\t\thandleMouseMovePan(event);\r\n\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction onMouseUp(event) {\r\n\t\tif (scope.enabled === false) return;\r\n\r\n\t\thandleMouseUp(event);\r\n\r\n\t\tdocument.removeEventListener('mousemove', onMouseMove, false);\r\n\t\tdocument.removeEventListener('mouseup', onMouseUp, false);\r\n\r\n\t\tscope.dispatchEvent(endEvent);\r\n\r\n\t\tstate = STATE.NONE;\r\n\t}\r\n\r\n\tfunction onMouseWheel(event) {\r\n\t\tif (scope.enabled === false || scope.enableZoom === false || (state !== STATE.NONE && state !== STATE.ROTATE))\r\n\t\t\treturn;\r\n\r\n\t\tevent.preventDefault();\r\n\t\tevent.stopPropagation();\r\n\r\n\t\tscope.dispatchEvent(startEvent);\r\n\r\n\t\thandleMouseWheel(event);\r\n\r\n\t\tscope.dispatchEvent(endEvent);\r\n\t}\r\n\r\n\tfunction onKeyDown(event) {\r\n\t\tif (scope.enabled === false || scope.enableKeys === false || scope.enablePan === false) return;\r\n\r\n\t\thandleKeyDown(event);\r\n\t}\r\n\r\n\tfunction onTouchStart(event) {\r\n\t\tif (scope.enabled === false) return;\r\n\r\n\t\t// Let the click event emit\r\n\t\t// event.preventDefault();\r\n\r\n\t\tswitch (event.touches.length) {\r\n\t\t\tcase 1:\r\n\t\t\t\tswitch (scope.touches.ONE) {\r\n\t\t\t\t\tcase TOUCH.ROTATE:\r\n\t\t\t\t\t\tif (scope.enableRotate === false) return;\r\n\r\n\t\t\t\t\t\thandleTouchStartRotate(event);\r\n\r\n\t\t\t\t\t\tstate = STATE.TOUCH_ROTATE;\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase TOUCH.PAN:\r\n\t\t\t\t\t\tif (scope.enablePan === false) return;\r\n\r\n\t\t\t\t\t\thandleTouchStartPan(event);\r\n\r\n\t\t\t\t\t\tstate = STATE.TOUCH_PAN;\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tstate = STATE.NONE;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 2:\r\n\t\t\t\tswitch (scope.touches.TWO) {\r\n\t\t\t\t\tcase TOUCH.DOLLY_PAN:\r\n\t\t\t\t\t\tif (scope.enableZoom === false && scope.enablePan === false) return;\r\n\r\n\t\t\t\t\t\thandleTouchStartDollyPan(event);\r\n\r\n\t\t\t\t\t\tstate = STATE.TOUCH_DOLLY_PAN;\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase TOUCH.DOLLY_ROTATE:\r\n\t\t\t\t\t\tif (scope.enableZoom === false && scope.enableRotate === false) return;\r\n\r\n\t\t\t\t\t\thandleTouchStartDollyRotate(event);\r\n\r\n\t\t\t\t\t\tstate = STATE.TOUCH_DOLLY_ROTATE;\r\n\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tstate = STATE.NONE;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\tstate = STATE.NONE;\r\n\t\t}\r\n\r\n\t\tif (state !== STATE.NONE) {\r\n\t\t\tscope.dispatchEvent(startEvent);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction onTouchMove(event) {\r\n\t\tif (scope.enabled === false) return;\r\n\r\n\t\tevent.preventDefault();\r\n\t\tevent.stopPropagation();\r\n\r\n\t\tswitch (state) {\r\n\t\t\tcase STATE.TOUCH_ROTATE:\r\n\t\t\t\tif (scope.enableRotate === false) return;\r\n\r\n\t\t\t\thandleTouchMoveRotate(event);\r\n\r\n\t\t\t\tscope.update();\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase STATE.TOUCH_PAN:\r\n\t\t\t\tif (scope.enablePan === false) return;\r\n\r\n\t\t\t\thandleTouchMovePan(event);\r\n\r\n\t\t\t\tscope.update();\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase STATE.TOUCH_DOLLY_PAN:\r\n\t\t\t\tif (scope.enableZoom === false && scope.enablePan === false) return;\r\n\r\n\t\t\t\thandleTouchMoveDollyPan(event);\r\n\r\n\t\t\t\tscope.update();\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase STATE.TOUCH_DOLLY_ROTATE:\r\n\t\t\t\tif (scope.enableZoom === false && scope.enableRotate === false) return;\r\n\r\n\t\t\t\thandleTouchMoveDollyRotate(event);\r\n\r\n\t\t\t\tscope.update();\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\tstate = STATE.NONE;\r\n\t\t}\r\n\t}\r\n\r\n\tfunction onTouchEnd(event) {\r\n\t\tif (scope.enabled === false) return;\r\n\r\n\t\thandleTouchEnd(event);\r\n\r\n\t\tscope.dispatchEvent(endEvent);\r\n\r\n\t\tstate = STATE.NONE;\r\n\t}\r\n\r\n\tfunction onContextMenu(event) {\r\n\t\tif (scope.enabled === false) return;\r\n\r\n\t\tevent.preventDefault();\r\n\t}\r\n\r\n\t//\r\n\r\n\tscope.domElement.addEventListener('contextmenu', onContextMenu, false);\r\n\r\n\tscope.domElement.addEventListener('mousedown', onMouseDown, false);\r\n\tscope.domElement.addEventListener('wheel', onMouseWheel, false);\r\n\r\n\tscope.domElement.addEventListener('touchstart', onTouchStart, false);\r\n\tscope.domElement.addEventListener('touchend', onTouchEnd, false);\r\n\tscope.domElement.addEventListener('touchmove', onTouchMove, false);\r\n\r\n\tscope.domElement.addEventListener('keydown', onKeyDown, false);\r\n\r\n\t// make sure element can receive keys.\r\n\r\n\tif (scope.domElement.tabIndex === -1) {\r\n\t\tscope.domElement.tabIndex = 0;\r\n\t}\r\n\r\n\t// force an update at start\r\n\r\n\tthis.update();\r\n};\r\n\r\nOrbitControls.prototype = Object.create(EventDispatcher.prototype);\r\nOrbitControls.prototype.constructor = OrbitControls;\r\n\r\n// This set of controls performs orbiting, dollying (zooming), and panning.\r\n// Unlike TrackballControls, it maintains the \"up\" direction object.up (+Y by default).\r\n// This is very similar to OrbitControls, another set of touch behavior\r\n//\r\n//    Orbit - right mouse, or left mouse + ctrl/meta/shiftKey / touch: two-finger rotate\r\n//    Zoom - middle mouse, or mousewheel / touch: two-finger spread or squish\r\n//    Pan - left mouse, or arrow keys / touch: one-finger move\r\n\r\nvar MapControls = function (object, domElement) {\r\n\tOrbitControls.call(this, object, domElement);\r\n\r\n\tthis.mouseButtons.LEFT = MOUSE.PAN;\r\n\tthis.mouseButtons.RIGHT = MOUSE.ROTATE;\r\n\r\n\tthis.touches.ONE = TOUCH.PAN;\r\n\tthis.touches.TWO = TOUCH.DOLLY_ROTATE;\r\n};\r\n\r\nMapControls.prototype = Object.create(EventDispatcher.prototype);\r\nMapControls.prototype.constructor = MapControls;\r\n\r\nexport { OrbitControls, MapControls };\r\n","import * as THREE from 'three';\r\nimport { Section } from '../common/Section';\r\nimport { AnimeNameTitle } from '../common/AnimeNameTitle';\r\nimport {\r\n\tTextUniformConfig,\r\n\tTextConfig,\r\n\tAnimeName,\r\n\tAnimeTitleUniforms,\r\n\tdiffuseEquation,\r\n\tspecularFresnelEquation,\r\n\tspecularNDFEquation,\r\n\tspecularVisEquation,\r\n\tspecularAOList,\r\n\tpanelDefinesRegs\r\n} from './const/config';\r\nimport { pbrDefaultDefines, pbrDefaultUniforms } from './const/defaultParams';\r\nimport { computeMeshBoundingBox, clamp } from 'JS/Utils';\r\n// Modules\r\nimport { TextureBG } from 'MODULES/TextureBG/TextureBG';\r\nimport { PBRMaterial, PBRProgram } from 'MODULES/PBRMaterial/';\r\nimport { Background } from 'MODULES/CubeBG/Background';\r\nimport { RingButton, CloseButton } from 'MODULES/Button/';\r\n\r\nimport { gsap } from 'gsap';\r\nimport * as dat from 'dat.gui';\r\n// Test\r\nimport { OrbitControls } from 'LIB/threejs/controls/OrbitControls';\r\nimport { initAnimeTitleGUI } from '../common/InitGUI';\r\n\r\nexport class WorkSection extends Section {\r\n\tconstructor(viewer) {\r\n\t\tsuper(viewer);\r\n\t\tthis.name = 'WorkSection';\r\n\t\tthis.debug = 0;\r\n\t\tthis.visible = true;\r\n\t\tthis.pbrProgram = new PBRProgram();\r\n\r\n\t\tthis.cameraInitPos = new THREE.Vector3(0, 0, 3);\r\n\t\tthis.cameraLookAtPos = new THREE.Vector3(0, 0, 0);\r\n\r\n\t\tthis.intersectsArr = [];\r\n\t\tthis.intersects = []; // intersect result\r\n\t\tthis.raycaster = new THREE.Raycaster();\r\n\t\tthis.raycaster.layers.set(this.layers.UI_LAYER);\r\n\t\tthis.isModelViewing = false;\r\n\r\n\t\t// Env param\r\n\t\tthis.envRotation = 0;\r\n\t\tthis.envRotationFromPanel = new THREE.Matrix4().makeRotationY(this.envRotation);\r\n\t\tthis.envRotationMat4 = new THREE.Matrix4().copy(this.envRotationFromPanel);\r\n\t\tthis.envRotationMat = { value: new THREE.Matrix3().setFromMatrix4(this.envRotationMat4) };\r\n\t\tthis.envRotationMatBG = { value: new THREE.Matrix3().copy(this.envRotationMat.value) };\r\n\t\tthis.envBrightness = { value: 1.0 };\r\n\t\tthis.sunLightPanelRotateMat = new THREE.Matrix4();\r\n\t\tthis.cameraRotationMatrix = new THREE.Matrix4();\r\n\r\n\t\t// Model init transform\r\n\t\tthis.modelInitScale = 0.08;\r\n\t\tthis.modelInitPosY = -0.3;\r\n\t\tthis.modelInitRotationZ = -Math.PI / 15;\r\n\r\n\t\tthis.modelViewingScale = 0.1;\r\n\t\tthis.modelViewingPosY = -0.5;\r\n\t\tthis.modelViewingRotateZ = 0;\r\n\r\n\t\tthis.clickNDCPos = new THREE.Vector2();\r\n\t}\r\n\r\n\tinit() {\r\n\t\tthis.initBackground();\r\n\t\tlet environment = this.assetLibrary.get('EnvMap-Milkyway'); // Milkyway Industrial\r\n\t\tlet { sunlightInfo, backgroundEnv, uBGEnvironmentSize } = environment;\r\n\t\tthis.loadSunLight(sunlightInfo);\r\n\t\tthis.sunLightStartPos = this.sunLight.position.clone();\r\n\t\tthis.loadCubeBackground(backgroundEnv, uBGEnvironmentSize);\r\n\t\tthis.initCamera();\r\n\t\t// Load Model\r\n\t\tlet gltfScene = (this.gltfScene = this.assetLibrary.get('Model-Chess').scene);\r\n\t\tgltfScene.scale.setScalar(this.modelInitScale);\r\n\t\tgltfScene.position.y = this.modelInitPosY;\r\n\t\tgltfScene.rotation.z = this.modelInitRotationZ;\r\n\t\tthis.scene.add(gltfScene);\r\n\t\t// Load Shader\r\n\t\tlet { pbrVS, pbrFS } = this.pbrProgram.getPBRShader();\r\n\t\t// Replace PBR Material\r\n\t\tgltfScene.traverse(child => {\r\n\t\t\tif (child.isMesh) {\r\n\t\t\t\tchild.material = new PBRMaterial(child, environment, {\r\n\t\t\t\t\tpbrVS,\r\n\t\t\t\t\tpbrFS\r\n\t\t\t\t});\r\n\t\t\t\tchild.material.uniforms.uEnvironmentTransform = this.envRotationMat;\r\n\t\t\t\tchild.material.uniforms.uEnvBrightness = this.envBrightness;\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.initText();\r\n\t\tthis.initUIPanel();\r\n\t\tthis.initEvent();\r\n\r\n\t\tif (this.debug) this.initGUI();\r\n\t}\r\n\r\n\tinitGUI() {\r\n\t\tconst gui = new dat.GUI();\r\n\t\tinitAnimeTitleGUI(gui, this.animeNameTitle.material);\r\n\t\tlet textMaterial = this.textMaterial;\r\n\t\tconsole.log(this.textMaterial);\r\n\t\tlet params = {\r\n\t\t\t// Text\r\n\t\t\ttextTopColor: textMaterial.uniforms.topColor.value.getStyle(),\r\n\t\t\ttextBottomColor: textMaterial.uniforms.bottomColor.value.getStyle()\r\n\t\t};\r\n\t\t// Text\r\n\t\tconst textFolder = gui.addFolder('Text');\r\n\t\ttextFolder\r\n\t\t\t.addColor(params, 'textTopColor')\r\n\t\t\t.name('topColor')\r\n\t\t\t.onChange(value => {\r\n\t\t\t\ttextMaterial.uniforms.topColor.value.setStyle(value);\r\n\t\t\t});\r\n\t\ttextFolder\r\n\t\t\t.addColor(params, 'textBottomColor')\r\n\t\t\t.name('bottomColor')\r\n\t\t\t.onChange(value => {\r\n\t\t\t\ttextMaterial.uniforms.bottomColor.value.setStyle(value);\r\n\t\t\t});\r\n\t\ttextFolder.open();\r\n\t}\r\n\r\n\tinitPanelGUI() {\r\n\t\t// Control gui\r\n\t\tconst gui = new dat.GUI();\r\n\t\tlet gltfScene = this.gltfScene;\r\n\t\tif(this.isMobile) gui.close();\r\n\t\tlet params = (this.guiParams = {\r\n\t\t\tenableIBL: !!pbrDefaultDefines.ENABLE_IBL,\r\n\t\t\tenableLight: !!pbrDefaultDefines.ENABLE_LIGHT,\r\n\t\t\tenvRotation: this.envRotation,\r\n\t\t\tenvBrightness: this.envBrightness.value,\r\n\t\t\tmetalness: pbrDefaultUniforms.metalness.value,\r\n\t\t\troughness: pbrDefaultUniforms.roughness.value,\r\n\t\t\t// Equations\r\n\t\t\tdiffuseEquation: diffuseEquation[0],\r\n\t\t\tspecularFresnelEquation: specularFresnelEquation[0],\r\n\t\t\tspecularNDFEquation: specularNDFEquation[0],\r\n\t\t\tspecularVisEquation: specularVisEquation[0],\r\n\t\t\t// Anisotropy\r\n\t\t\tenableAnisotropy: !!pbrDefaultDefines.ENABLE_ANISOTROPY,\r\n\t\t\tanisotropyFactor: pbrDefaultUniforms.uAnisotropyFactor.value,\r\n\t\t\tanisotropyRotation: pbrDefaultUniforms.uAnisotropyRotation.value,\r\n\t\t\t// ClearCoat\r\n\t\t\tenableClearCoat: !!pbrDefaultDefines.ENABLE_CLEARCOAT,\r\n\t\t\tclearCoatRoughness: pbrDefaultUniforms.uClearCoatRoughness.value,\r\n\t\t\tclearCoat: pbrDefaultUniforms.uClearCoat.value,\r\n\t\t\t// Advance\r\n\t\t\tenableCompensation: !!pbrDefaultDefines.ENERGY_COMPENSATION,\r\n\t\t\tenableSpecularAA: !!pbrDefaultDefines.GEOMETRIC_SPECULAR_AA,\r\n\t\t\tspecularAAVariance: pbrDefaultUniforms.uSpecularAAVariance.value,\r\n\t\t\tspecularAAThreshold: pbrDefaultUniforms.uSpecularAAThreshold.value,\r\n\t\t\tspecularAO: specularAOList[0],\r\n\t\t\tenableMSSpecularAO: !!pbrDefaultDefines.MS_SPECULAR_AO,\r\n\t\t\tenableMSDiffuseAO: !!pbrDefaultDefines.MS_DIFFUSE_AO\r\n\t\t});\r\n\t\t// PBR\r\n\t\tconst pbrFolder = gui.addFolder('PBR');\r\n\t\tpbrFolder.add(params, 'enableIBL').onChange(value => {\r\n\t\t\tthis.guiParams.enableIBL = value;\r\n\t\t\tthis.reCompileShader();\r\n\t\t});\r\n\t\tpbrFolder\r\n\t\t\t.add(params, 'enableLight')\r\n\t\t\t.name('enableSunLight')\r\n\t\t\t.onChange(value => {\r\n\t\t\t\tthis.guiParams.enableLight = value;\r\n\t\t\t\tthis.reCompileShader();\r\n\t\t\t});\r\n\t\tpbrFolder\r\n\t\t\t.add(params, 'envRotation', -Math.PI, Math.PI)\r\n\t\t\t.step(0.1)\r\n\t\t\t.onChange(value => {\r\n\t\t\t\tthis.envRotation = value;\r\n\t\t\t});\r\n\t\tpbrFolder\r\n\t\t\t.add(params, 'envBrightness', 0, 2)\r\n\t\t\t.step(0.1)\r\n\t\t\t.onChange(value => {\r\n\t\t\t\tthis.envBrightness.value = value;\r\n\t\t\t});\r\n\t\tpbrFolder\r\n\t\t\t.add(params, 'metalness', 0, 1)\r\n\t\t\t.step(0.01)\r\n\t\t\t.onChange(value => {\r\n\t\t\t\tgltfScene.traverse(child => {\r\n\t\t\t\t\tif (child.isMesh) {\r\n\t\t\t\t\t\tchild.material.uniforms.metalness.value = value;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\tpbrFolder\r\n\t\t\t.add(params, 'roughness', 0, 1)\r\n\t\t\t.step(0.01)\r\n\t\t\t.onChange(value => {\r\n\t\t\t\tgltfScene.traverse(child => {\r\n\t\t\t\t\tif (child.isMesh) {\r\n\t\t\t\t\t\tchild.material.uniforms.roughness.value = value;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\tpbrFolder.open();\r\n\r\n\t\t// Equations\r\n\t\tconst equationsFolder = gui.addFolder('Equations');\r\n\t\tequationsFolder\r\n\t\t\t.add(params, 'diffuseEquation', diffuseEquation)\r\n\t\t\t.name('diffuse')\r\n\t\t\t.onChange(value => {\r\n\t\t\t\tthis.guiParams.diffuseEquation = value;\r\n\t\t\t\tthis.reCompileShader();\r\n\t\t\t});\r\n\t\tequationsFolder\r\n\t\t\t.add(params, 'specularFresnelEquation', specularFresnelEquation)\r\n\t\t\t.name('fresnel')\r\n\t\t\t.onChange(value => {\r\n\t\t\t\tthis.guiParams.specularFresnelEquation = value;\r\n\t\t\t\tthis.reCompileShader();\r\n\t\t\t});\r\n\t\tequationsFolder\r\n\t\t\t.add(params, 'specularNDFEquation', specularNDFEquation)\r\n\t\t\t.name('NDF')\r\n\t\t\t.onChange(value => {\r\n\t\t\t\tthis.guiParams.specularNDFEquation = value;\r\n\t\t\t\tthis.reCompileShader();\r\n\t\t\t});\r\n\t\tequationsFolder\r\n\t\t\t.add(params, 'specularVisEquation', specularVisEquation)\r\n\t\t\t.name('geometry')\r\n\t\t\t.onChange(value => {\r\n\t\t\t\tthis.guiParams.specularVisEquation = value;\r\n\t\t\t\tthis.reCompileShader();\r\n\t\t\t});\r\n\t\tequationsFolder.open();\r\n\r\n\t\t// Anisotropy\r\n\t\tlet anisotropyFolader = gui.addFolder('Anisotropy');\r\n\t\tanisotropyFolader\r\n\t\t\t.add(params, 'enableAnisotropy')\r\n\t\t\t.name('enable')\r\n\t\t\t.onChange(value => {\r\n\t\t\t\tthis.guiParams.enableAnisotropy = value;\r\n\t\t\t\tthis.reCompileShader();\r\n\t\t\t});\r\n\t\tanisotropyFolader\r\n\t\t\t.add(params, 'anisotropyRotation', -3.14, 3.14)\r\n\t\t\t.step(0.01)\r\n\t\t\t.name('rotation')\r\n\t\t\t.onChange(value => {\r\n\t\t\t\tgltfScene.traverse(child => {\r\n\t\t\t\t\tif (child.isMesh) {\r\n\t\t\t\t\t\tchild.material.uniforms.uAnisotropyRotation.value = value;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\tanisotropyFolader\r\n\t\t\t.add(params, 'anisotropyFactor', 0, 1)\r\n\t\t\t.name('factor')\r\n\t\t\t.step(0.01)\r\n\t\t\t.onChange(value => {\r\n\t\t\t\tgltfScene.traverse(child => {\r\n\t\t\t\t\tif (child.isMesh) {\r\n\t\t\t\t\t\tchild.material.uniforms.uAnisotropyFactor.value = value;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t// ClearCoat\r\n\t\tlet clearCoatFolader = gui.addFolder('ClearCoat');\r\n\t\tclearCoatFolader\r\n\t\t\t.add(params, 'enableClearCoat')\r\n\t\t\t.name('enable')\r\n\t\t\t.onChange(value => {\r\n\t\t\t\tthis.guiParams.enableClearCoat = value;\r\n\t\t\t\tthis.reCompileShader();\r\n\t\t\t});\r\n\t\tclearCoatFolader\r\n\t\t\t.add(params, 'clearCoat', 0, 1)\r\n\t\t\t.step(0.01)\r\n\t\t\t.name('clearCoat')\r\n\t\t\t.onChange(value => {\r\n\t\t\t\tgltfScene.traverse(child => {\r\n\t\t\t\t\tif (child.isMesh) {\r\n\t\t\t\t\t\tchild.material.uniforms.uClearCoat.value = value;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\tclearCoatFolader\r\n\t\t\t.add(params, 'clearCoatRoughness', 0, 1)\r\n\t\t\t.step(0.01)\r\n\t\t\t.name('roughness')\r\n\t\t\t.onChange(value => {\r\n\t\t\t\tgltfScene.traverse(child => {\r\n\t\t\t\t\tif (child.isMesh) {\r\n\t\t\t\t\t\tchild.material.uniforms.uClearCoatRoughness.value = value;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t// Advance\r\n\t\tconst advanceFolder = gui.addFolder('Advance');\r\n\t\tadvanceFolder\r\n\t\t\t.add(params, 'enableCompensation')\r\n\t\t\t.name('compensation')\r\n\t\t\t.onChange(value => {\r\n\t\t\t\tthis.guiParams.enableCompensation = value;\r\n\t\t\t\tthis.reCompileShader();\r\n\t\t\t});\r\n\t\tadvanceFolder\r\n\t\t\t.add(params, 'enableSpecularAA')\r\n\t\t\t.name('specularAA')\r\n\t\t\t.onChange(value => {\r\n\t\t\t\tthis.guiParams.enableSpecularAA = value;\r\n\t\t\t\tthis.reCompileShader();\r\n\t\t\t});\r\n\t\tadvanceFolder\r\n\t\t\t.add(params, 'specularAAVariance', 0, 1)\r\n\t\t\t.name('sAAVariance')\r\n\t\t\t.step(0.01)\r\n\t\t\t.onChange(value => {\r\n\t\t\t\tgltfScene.traverse(child => {\r\n\t\t\t\t\tif (child.isMesh) {\r\n\t\t\t\t\t\tchild.material.uniforms.uSpecularAAVariance.value = value;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\tadvanceFolder\r\n\t\t\t.add(params, 'enableMSSpecularAO')\r\n\t\t\t.name('msSpecularAO')\r\n\t\t\t.onChange(value => {\r\n\t\t\t\tthis.guiParams.enableMSSpecularAO = value;\r\n\t\t\t\tthis.reCompileShader();\r\n\t\t\t});\r\n\t\tadvanceFolder\r\n\t\t\t.add(params, 'enableMSDiffuseAO')\r\n\t\t\t.name('msDiffuseAO')\r\n\t\t\t.onChange(value => {\r\n\t\t\t\tthis.guiParams.enableMSDiffuseAO = value;\r\n\t\t\t\tthis.reCompileShader();\r\n\t\t\t});\r\n\t\tadvanceFolder.add(params, 'specularAO', specularAOList).onChange(value => {\r\n\t\t\tthis.guiParams.specularAO = value;\r\n\t\t\tthis.reCompileShader();\r\n\t\t});\r\n\t}\r\n\r\n\tsetDefinesFromGUI(defines) {\r\n\t\tlet guiParams = this.guiParams;\r\n\t\t// Clean\r\n\t\tlet reg = panelDefinesRegs;\r\n\t\tObject.keys(defines).map(key => {\r\n\t\t\tif (reg.test(key)) {\r\n\t\t\t\tdelete defines[key];\r\n\t\t\t}\r\n\t\t});\r\n\t\t// Reset\r\n\t\tif (guiParams.enableIBL) defines.ENABLE_IBL = 1;\r\n\t\tif (guiParams.enableLight) defines.ENABLE_LIGHT = 1;\r\n\t\tif (guiParams.enableAnisotropy) defines.ENABLE_ANISOTROPY = 1;\r\n\t\tif (guiParams.enableClearCoat) defines.ENABLE_CLEARCOAT = 1;\r\n\t\tif (guiParams.enableCompensation) defines.ENERGY_COMPENSATION = 1;\r\n\t\tif (guiParams.enableSpecularAA) defines.GEOMETRIC_SPECULAR_AA = 1;\r\n\t\tif (guiParams.enableMSSpecularAO) defines.MS_SPECULAR_AO = 1;\r\n\t\tif (guiParams.enableMSDiffuseAO) defines.MS_DIFFUSE_AO = 1;\r\n\r\n\t\tdefines[`DIFFUSE_${guiParams.diffuseEquation.toUpperCase()}`] = 1;\r\n\t\tdefines[`F_${guiParams.specularFresnelEquation.toUpperCase()}`] = 1;\r\n\t\tdefines[`NDF_${guiParams.specularNDFEquation.toUpperCase()}`] = 1;\r\n\t\tdefines[`V_${guiParams.specularVisEquation.toUpperCase()}`] = 1;\r\n\t\tdefines[`SPECULAR_AO_${guiParams.specularAO.toUpperCase()}`] = 1;\r\n\t\treturn defines;\r\n\t}\r\n\r\n\treCompileShader() {\r\n\t\tthis.gltfScene.traverse(child => {\r\n\t\t\tif (child.isMesh && child.material) {\r\n\t\t\t\tthis.setDefinesFromGUI(child.material.defines);\r\n\t\t\t\tchild.material.needsUpdate = true;\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\tinitUIPanel() {\r\n\t\t// Click Btn\r\n\t\tthis.ringBtn = new RingButton(this, this.layers.UI_LAYER, 'Click');\r\n\t\tthis.ringBtn.container.position.set(30, 0, 0);\r\n\t\tthis.uiScene.add(this.ringBtn.container);\r\n\t\t// Close Btn\r\n\t\tthis.closeBtn = new CloseButton(this, this.layers.UI_LAYER);\r\n\t\tlet closeContainer = this.closeBtn.container;\r\n\t\tconst closeBtnScale = 0.45;\r\n\t\tthis.closeBtnBox = computeMeshBoundingBox(this.closeBtn.mesh).length.multiplyScalar(closeBtnScale);\r\n\t\tcloseContainer.scale.setScalar(closeBtnScale);\r\n\t\tthis.uiScene.add(closeContainer);\r\n\t\tthis.resizeUIPanel(this.width, this.height);\r\n\t\t// Panel gui\r\n\t\tthis.initPanelGUI();\r\n\t}\r\n\r\n\tresizeUIPanel(width, height) {\r\n\t\tlet closeContainer = this.closeBtn.container;\r\n\t\tconst topOffset = height / 2 - this.closeBtnBox.y / 2 - 20;\r\n\t\tconst leftOffset = -width / 2 + this.closeBtnBox.x / 2 + 20;\r\n\t\tcloseContainer.position.set(leftOffset, topOffset, 0);\r\n\t}\r\n\r\n\tloadSunLight(sunlightInfo) {\r\n\t\tif (!this.sunLight) this.sunLight = new THREE.DirectionalLight(0xffffff, 0.1);\r\n\t\tthis.sunLight.position.copy(sunlightInfo.position);\r\n\t\tthis.scene.add(this.sunLight);\r\n\t}\r\n\r\n\tloadCubeBackground(backgroundEnv, uBGEnvironmentSize) {\r\n\t\tlet cubeBackground = (this.cubeBackground = new Background(\r\n\t\t\t{\r\n\t\t\t\tenvMap: backgroundEnv.texture,\r\n\t\t\t\tuBGEnvironmentSize\r\n\t\t\t},\r\n\t\t\t500\r\n\t\t));\r\n\t\tcubeBackground.material.uniforms.uEnvironmentTransform = this.envRotationMatBG;\r\n\t\tcubeBackground.material.uniforms.uEnvBrightness = this.envBrightness;\r\n\t\tthis.scene.add(cubeBackground);\r\n\t}\r\n\r\n\tinitCamera() {\r\n\t\tthis.camera.position.copy(this.cameraInitPos);\r\n\t\tthis.camera.lookAt(this.cameraLookAtPos);\r\n\r\n\t\tthis.control = new OrbitControls(this.camera, this.viewer.container);\r\n\t\tthis.control.enabled = false;\r\n\t\tthis.control.enablePan = false;\r\n\t\tthis.control.minDistance = 1;\r\n\t\tthis.control.maxDistance = 5;\r\n\t}\r\n\r\n\tinitText() {\r\n\t\tlet material = (this.textMaterial = this.fontGenerator.createFontMaterial(1));\r\n\t\tmaterial.uniforms.time = { value: 0.0 };\r\n\t\t// Apply text color\r\n\t\tObject.keys(TextUniformConfig).map(key => {\r\n\t\t\tmaterial.uniforms[`${key}`] = { value: TextUniformConfig[key].clone() };\r\n\t\t});\r\n\r\n\t\tthis.titleMesh = this.initTextMesh(TextConfig.mainTitle, material);\r\n\t\tthis.subTitleMesh = this.initTextMesh(TextConfig.subTitle, material);\r\n\t\tthis.contentMesh = this.initTextMesh(TextConfig.content, material);\r\n\t\tthis.animeNameTitle = new AnimeNameTitle(this, AnimeName, AnimeTitleUniforms);\r\n\t\tthis.resizeText(this.width, this.height);\r\n\t}\r\n\r\n\tresizeText(width, height) {\r\n\t\tif (!this.isMobile) {\r\n\t\t\tthis.resizeTextForPC(width, height);\r\n\t\t} else {\r\n\t\t\tthis.resizeTextForMobile(width, height);\r\n\t\t}\r\n\r\n\t\tthis.animeNameTitle.resize(width, height);\r\n\t}\r\n\r\n\tresizeTextForPC(width, height) {\r\n\t\tlet { titleMesh, subTitleMesh, contentMesh } = this;\r\n\t\tconst topOffset = height / 4;\r\n\t\tconst leftOffset = -width / 2.25;\r\n\t\tconst titleScale = clamp(width / 1000, 1.2, 1.4);\r\n\t\ttitleMesh.scale.setScalar(titleScale);\r\n\t\ttitleMesh.position.set(leftOffset, topOffset, 0);\r\n\r\n\t\tconst subTitleScale = clamp(width / 1500, 0.8, 1.1);\r\n\t\tlet subBBox = computeMeshBoundingBox(subTitleMesh).length.multiplyScalar(subTitleScale);\r\n\t\tsubTitleMesh.scale.setScalar(subTitleScale);\r\n\t\tsubTitleMesh.position.set(leftOffset, topOffset, 0);\r\n\r\n\t\tconst contentScale = clamp(width / 2000, 0.4, 0.6);\r\n\t\tlet contentBBox = computeMeshBoundingBox(contentMesh).length.multiplyScalar(contentScale);\r\n\t\tcontentMesh.scale.setScalar(contentScale);\r\n\t\tcontentMesh.position.set(leftOffset, topOffset, 0);\r\n\r\n\t\t// Gap between title and subtitle\r\n\t\tsubTitleMesh.position.y = topOffset - subBBox.y - 20;\r\n\t\tcontentMesh.position.y = subTitleMesh.position.y - contentBBox.y - 20;\r\n\t}\r\n\r\n\tresizeTextForMobile(width, height) {\r\n\t\tlet { titleMesh, subTitleMesh, contentMesh } = this;\r\n\t\tconst topOffset = height / 2.4;\r\n\t\tconst leftOffset = -width / 2.25;\r\n\t\tconst titleScale = clamp(width / 500, 0.7, 0.9);\r\n\t\ttitleMesh.scale.setScalar(titleScale);\r\n\t\ttitleMesh.position.set(leftOffset, topOffset, 0);\r\n\r\n\t\tconst subTitleScale = clamp(width / 800, 0.4, 0.5);\r\n\t\tlet subBBox = computeMeshBoundingBox(subTitleMesh).length.multiplyScalar(subTitleScale);\r\n\t\tsubTitleMesh.scale.setScalar(subTitleScale);\r\n\t\tsubTitleMesh.position.set(leftOffset, topOffset, 0);\r\n\r\n\t\tconst contentScale = clamp(width / 1000, 0.3, 0.4);\r\n\t\tlet contentBBox = computeMeshBoundingBox(contentMesh).length.multiplyScalar(contentScale);\r\n\t\tcontentMesh.scale.setScalar(contentScale);\r\n\t\tcontentMesh.position.set(leftOffset, topOffset, 0);\r\n\r\n\t\t// Gap between title and subtitle\r\n\t\tsubTitleMesh.position.y = topOffset - subBBox.y - 10;\r\n\t\tcontentMesh.position.y = subTitleMesh.position.y - contentBBox.y - 10;\r\n\t}\r\n\r\n\tinitBackground() {\r\n\t\tlet texture = this.assetLibrary.get('Texture-NGNL1');\r\n\t\tlet bgMesh = (this.bgMesh = new TextureBG(texture, this.postProcessingMaterial));\r\n\t\tbgMesh.layers.set(this.layers.BG_LAYER);\r\n\t\tthis.scene.add(bgMesh);\r\n\t}\r\n\r\n\tupdateEnvironmentRotation(value) {\r\n\t\t// Get panel rotation\r\n\t\tthis.envRotationFromPanel.makeRotationY(value);\r\n\t\t// Sync camera roatation\r\n\t\tthis.cameraRotationMatrix.makeRotationFromQuaternion(this.camera.quaternion);\r\n\t\tthis.envRotationMat4.multiplyMatrices(this.envRotationFromPanel, this.cameraRotationMatrix);\r\n\t\tthis.envRotationMat.value.setFromMatrix4(this.envRotationMat4);\r\n\t\tthis.envRotationMatBG.value.setFromMatrix4(this.envRotationFromPanel);\r\n\t\t// Direction compute by position\r\n\t\tlet resultSunlight = this.sunLightStartPos.clone();\r\n\t\tthis.sunLightPanelRotateMat.getInverse(this.envRotationFromPanel);\r\n\t\tresultSunlight.applyMatrix4(this.sunLightPanelRotateMat);\r\n\t\tthis.sunLight.position.copy(resultSunlight);\r\n\t}\r\n\r\n\topenModelViewer() {\r\n\t\tif (this.isModelViewing) return;\r\n\t\tthis.isModelViewing = true;\r\n\t\tconst duration = 1;\r\n\t\t// 1.Reset Model Transform(Tween)\r\n\t\tgsap.to(this.gltfScene.rotation, { z: this.modelViewingRotateZ, duration, ease: 'power2.out' });\r\n\t\tgsap.to(this.gltfScene.scale, {\r\n\t\t\tx: this.modelViewingScale,\r\n\t\t\ty: this.modelViewingScale,\r\n\t\t\tz: this.modelViewingScale,\r\n\t\t\tduration,\r\n\t\t\tease: 'power2.out'\r\n\t\t});\r\n\t\tgsap.to(this.gltfScene.position, { y: this.modelViewingPosY, duration, ease: 'power2.out' });\r\n\t\t// 2.Background change\r\n\t\tgsap.to(this.bgMesh.material.uniforms.opacity, {\r\n\t\t\tvalue: 0,\r\n\t\t\tduration,\r\n\t\t\tease: 'power2.out',\r\n\t\t\tonComplete: () => {\r\n\t\t\t\tthis.bgMesh.visible = false;\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.cubeBackground.visible = true;\r\n\t\tgsap.to(this.cubeBackground.material.uniforms.opacity, { value: 1, duration, ease: 'power2.out' });\r\n\t\t// 3.Control change\r\n\t\tthis.control.enabled = true;\r\n\t\t// 4.Panel\r\n\t\tdocument.querySelector('.dg.main').setAttribute('style', 'display: block');\r\n\t\tgsap.fromTo('.dg.main', { opacity: 0 }, { opacity: 1, duration, ease: 'power2.out' });\r\n\t\t// 5.Button animation\r\n\t\tgsap.to(this.ringBtn, {\r\n\t\t\topacity: 0,\r\n\t\t\tduration,\r\n\t\t\tease: 'power2.out',\r\n\t\t\tonComplete: () => {\r\n\t\t\t\tthis.ringBtn.visible = false;\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.closeBtn.visible = true;\r\n\t\tgsap.to(this.closeBtn, { opacity: 0.5, duration, ease: 'power2.out' });\r\n\t\tthis.intersectsArr = [this.closeBtn.hitArea];\r\n\t\t// 6.Text\r\n\t\tlet textOpacity = this.textMaterial.uniforms.opacity;\r\n\t\tgsap.fromTo(textOpacity, { value: 1 }, { value: 0, duration, ease: 'power2.out' });\r\n\t\tgsap.to(this.animeNameTitle.material.uniforms.opacity, { value: 0, duration, ease: 'power2.out' });\r\n\t}\r\n\r\n\tcloseModelViewer() {\r\n\t\tif (!this.isModelViewing) return;\r\n\t\tthis.isModelViewing = false;\r\n\t\tconst duration = 1;\r\n\t\t// 1.Resue Model Transform(Tween)\r\n\t\tgsap.to(this.camera.position, {\r\n\t\t\tx: this.cameraInitPos.x,\r\n\t\t\ty: this.cameraInitPos.y,\r\n\t\t\tz: this.cameraInitPos.z,\r\n\t\t\tduration,\r\n\t\t\tease: 'power2.out',\r\n\t\t\tonUpdate: () => {\r\n\t\t\t\tthis.camera.lookAt(this.cameraLookAtPos);\r\n\t\t\t}\r\n\t\t});\r\n\t\tgsap.to(this.gltfScene.rotation, { z: -Math.PI / 15, duration, ease: 'power2.out' });\r\n\t\tgsap.to(this.gltfScene.scale, {\r\n\t\t\tx: this.modelInitScale,\r\n\t\t\ty: this.modelInitScale,\r\n\t\t\tz: this.modelInitScale,\r\n\t\t\tduration,\r\n\t\t\tease: 'power2.out'\r\n\t\t});\r\n\t\tgsap.to(this.gltfScene.position, { y: this.modelInitPosY, duration, ease: 'power2.out' });\r\n\t\t// 2.Background change\r\n\t\tthis.bgMesh.visible = true;\r\n\t\tgsap.to(this.bgMesh.material.uniforms.opacity, {\r\n\t\t\tvalue: 1,\r\n\t\t\tduration,\r\n\t\t\tease: 'power2.out'\r\n\t\t});\r\n\t\tgsap.to(this.cubeBackground.material.uniforms.opacity, {\r\n\t\t\tvalue: 0,\r\n\t\t\tduration,\r\n\t\t\tease: 'power2.out',\r\n\t\t\tonComplete: () => {\r\n\t\t\t\tthis.cubeBackground.visible = false;\r\n\t\t\t}\r\n\t\t});\r\n\t\t// 3.Control change\r\n\t\tthis.control.enabled = false;\r\n\t\t// 4.Panel Hide\r\n\t\tgsap.fromTo(\r\n\t\t\t'.dg.main',\r\n\t\t\t{ opacity: 1 },\r\n\t\t\t{\r\n\t\t\t\topacity: 0,\r\n\t\t\t\tduration,\r\n\t\t\t\tease: 'power2.out',\r\n\t\t\t\tonComplete: () => {\r\n\t\t\t\t\tdocument.querySelector('.dg.main').setAttribute('style', 'display: none');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t);\r\n\t\t// 5.Button animation\r\n\t\tthis.ringBtn.visible = true;\r\n\t\tgsap.to(this.ringBtn, {\r\n\t\t\topacity: 0.5,\r\n\t\t\tduration,\r\n\t\t\tease: 'power2.out'\r\n\t\t});\r\n\t\tgsap.to(this.closeBtn, {\r\n\t\t\topacity: 0,\r\n\t\t\tduration,\r\n\t\t\tease: 'power2.out',\r\n\t\t\tonComplete: () => {\r\n\t\t\t\tthis.closeBtn.visible = false;\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.intersectsArr = [this.ringBtn.hitArea];\r\n\t\t// 6.Text\r\n\t\tlet textOpacity = this.textMaterial.uniforms.opacity;\r\n\t\tgsap.fromTo(textOpacity, { value: 0 }, { value: 1, duration, ease: 'power2.out' });\r\n\t\tgsap.to(this.animeNameTitle.material.uniforms.opacity, { value: 1, duration, ease: 'power2.out' });\r\n\t}\r\n\r\n\twhileVisible(order) {\r\n\t\tlet cameraPos = this.camera.position;\r\n\t\tlet modelRotation = this.gltfScene.rotation;\r\n\t\tlet textOpacity = this.textMaterial.uniforms.opacity;\r\n\t\tgsap.killTweensOf(cameraPos);\r\n\t\tif (order === 'pre') {\r\n\t\t\tgsap.fromTo(cameraPos, { y: -0.5 }, { y: 0, duration: this.viewer.scrollAnimeDuration });\r\n\t\t} else {\r\n\t\t\tgsap.fromTo(cameraPos, { y: 0.5 }, { y: 0, duration: this.viewer.scrollAnimeDuration });\r\n\t\t\tgsap.fromTo(\r\n\t\t\t\tmodelRotation,\r\n\t\t\t\t{ z: -Math.PI / 15 },\r\n\t\t\t\t{ z: -Math.PI / 10, duration: this.viewer.scrollAnimeDuration / 2 }\r\n\t\t\t);\r\n\t\t}\r\n\t\tgsap.fromTo(textOpacity, { value: 0 }, { value: 1, duration: 1.5, delay: 0.5, ease: 'power2.out' });\r\n\t\tgsap.to(this.animeNameTitle.material.uniforms.opacity, { value: 1, duration: 1, delay: 1, ease: 'power2.out' });\r\n\t\tgsap.to(this.ringBtn, { opacity: 0.5, duration: 1.5, delay: 0.5, ease: 'power2.out' });\r\n\t\tgsap.fromTo(\r\n\t\t\tthis.bgMesh.material.uniforms.vignetteDarkness,\r\n\t\t\t{ value: 1 },\r\n\t\t\t{ value: 0.6, duration: 1.5, delay: 0.8, ease: 'power2.out' }\r\n\t\t);\r\n\t}\r\n\r\n\twhileNoVisible(order) {\r\n\t\tlet cameraPos = this.camera.position;\r\n\t\tlet textOpacity = this.textMaterial.uniforms.opacity;\r\n\t\tgsap.killTweensOf(cameraPos);\r\n\t\tif (order === 'pre') {\r\n\t\t\tgsap.fromTo(cameraPos, { y: 0 }, { y: 0.5, duration: this.viewer.scrollAnimeDuration });\r\n\t\t} else {\r\n\t\t\tgsap.fromTo(cameraPos, { y: 0 }, { y: -0.5, duration: this.viewer.scrollAnimeDuration });\r\n\t\t}\r\n\t\tgsap.fromTo(textOpacity, { value: 1 }, { value: 0, duration: 0.5, ease: 'power2.out' });\r\n\t\tgsap.to(this.animeNameTitle.material.uniforms.opacity, { value: 0, duration: 1, ease: 'power2.out' });\r\n\t\tgsap.to(this.ringBtn, { opacity: 0.0, duration: 0.5, ease: 'power2.out' });\r\n\t}\r\n\r\n\tinitEvent() {\r\n\t\tif(!this.isMobile) this.eventHandler.onMouseMoveEvent.bind(this.onMouseMove.bind(this));\r\n\t\tthis.intersectsArr.push(this.ringBtn.hitArea);\r\n\t\tthis.eventHandler.onClickEvent.bind(this.onClick.bind(this));\r\n\t}\r\n\r\n\tonClick() {\r\n\t\tif (!this.visible) return;\r\n\t\tif (this.isMobile) {\r\n\t\t\tlet x = event.clientX;\r\n\t\t\tlet y = event.clientY;\r\n\t\t\tthis.clickNDCPos.set((x / window.innerWidth) * 2 - 1, (-y / window.innerHeight) * 2 + 1);\r\n\t\t\tthis.raycaster.setFromCamera(this.clickNDCPos, this.uiCamera);\r\n\t\t\tthis.intersects = this.raycaster.intersectObjects(this.intersectsArr);\r\n\t\t}\r\n\t\tif (!this.intersects.length) return;\r\n\t\tlet intersectsRes = this.intersects[0].object;\r\n\t\tif (intersectsRes.name === 'ringButton') {\r\n\t\t\tthis.openModelViewer();\r\n\t\t} else if (intersectsRes.name === 'closeButton') {\r\n\t\t\tthis.closeModelViewer();\r\n\t\t}\r\n\t}\r\n\r\n\tonMouseMove() {\r\n\t\tif (!this.visible) return;\r\n\t\tthis.raycaster.setFromCamera(this.state.pointer.ndcPosition, this.uiCamera);\r\n\t\tthis.intersects = this.raycaster.intersectObjects(this.intersectsArr);\r\n\t\tif (this.intersects.length > 0) {\r\n\t\t\tdocument.body.setAttribute('cursor', 'pointer');\r\n\t\t} else {\r\n\t\t\tdocument.body.removeAttribute('cursor');\r\n\t\t}\r\n\t}\r\n\r\n\tresize(width, height, dpr) {\r\n\t\tconst pixelWidth = width * dpr;\r\n\t\tconst pixelHeight = height * dpr;\r\n\t\tthis.postProcessingMaterial.resize(pixelWidth, pixelHeight);\r\n\t\tthis.camera.aspect = width / height;\r\n\t\tthis.camera.updateProjectionMatrix();\r\n\t\tthis.uiCamera.left = -width / 2;\r\n\t\tthis.uiCamera.right = width / 2;\r\n\t\tthis.uiCamera.top = height / 2;\r\n\t\tthis.uiCamera.bottom = -height / 2;\r\n\t\tthis.uiCamera.updateProjectionMatrix();\r\n\t\tthis.bgMesh.resize(width, height);\r\n\t\tthis.resizeText(width, height);\r\n\t\tthis.resizeUIPanel(width, height);\r\n\t}\r\n\r\n\trender({ renderer, orthoCamera, target, deltaTime } = {}) {\r\n\t\tif (!this.visible) return;\r\n\t\tthis.updateEnvironmentRotation(this.envRotation);\r\n\t\t// BG\r\n\t\torthoCamera.layers.set(this.layers.BG_LAYER);\r\n\t\trenderer.render(this.scene, orthoCamera);\r\n\t\t// Scene\r\n\t\trenderer.render(this.scene, this.camera);\r\n\t\t// UI\r\n\t\tif (this.isModelViewing) {\r\n\t\t\tthis.closeBtn.update(deltaTime);\r\n\t\t} else {\r\n\t\t\tthis.ringBtn.update(deltaTime);\r\n\t\t}\r\n\t\tif (this.isModelViewing) this.control.update();\r\n\t\tthis.uiCamera.layers.set(this.layers.UI_LAYER);\r\n\t\trenderer.render(this.uiScene, this.uiCamera);\r\n\t}\r\n}\r\n","import * as THREE from 'three';\r\n\r\nconst BGUniformsConfig = {\r\n\tbaseColor: new THREE.Color('#000000'),\r\n\tarea1Color: new THREE.Color('#FFFFFF'),\r\n\tarea2Color: new THREE.Color('#FFFFFF'),\r\n\tarea1Position: new THREE.Vector2(0.2, 0.2),\r\n\tarea2Position: new THREE.Vector2(0.9, 0.9)\r\n};\r\n\r\nconst TextUniformConfig = {\r\n\ttopColor: new THREE.Color('rgb(245,230,255)'),\r\n\tbottomColor: new THREE.Color('rgb(255,255,255)')\r\n};\r\n\r\nconst TextConfig = {\r\n\tmainTitle: `About !`,\r\n\tsubTitle: `Hi! You can call me Mr. Gum! \r\n\ti'm a handsome developer :).\r\n\tIf you also like me or\r\n\t have some good ideas, \r\n\tplease contact me \r\n\tfor a pleasant discussion ~`\r\n};\r\nconst AnimeName = '[ Tran Le Quyen ]';\r\n\r\nconst AnimeTitleUniforms = {\r\n\ttopColor: new THREE.Color('rgb(245,230,255)'),\r\n\tbottomColor: new THREE.Color('rgb(255,255,255)')\r\n};\r\n\r\nexport { BGUniformsConfig, TextUniformConfig, TextConfig, AnimeName, AnimeTitleUniforms };\r\n","export default \"#define GLSLIFY 1\\nattribute float aSize;\\nattribute float aAlpha;\\n\\nvarying vec3 vPosition;\\nvarying float vPreAlpha;\\n\\nvoid main() {\\n\\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\\n\\tgl_Position = projectionMatrix * mvPosition;\\n\\tgl_PointSize = aSize * (300.0 / - mvPosition.z);\\n\\t\\n\\tvPosition = vec3(mvPosition.xyz);\\n\\tvPreAlpha = aAlpha;\\n}\";","export default \"precision highp float;\\n#define GLSLIFY 1\\n\\nvarying vec3 vPosition;\\nvarying float vPreAlpha;\\n\\nuniform vec3 innerColor;\\nuniform vec3 outerColor;\\n\\nfloat ndot(vec2 a, vec2 b) { return a.x*b.x - a.y*b.y; }\\nfloat sdRhombus(in vec2 p, in vec2 b) {\\n    vec2 q = abs(p);\\n\\n    float h = clamp( (-2.0*ndot(q,b) + ndot(b,b) )/dot(b,b), -1.0, 1.0 );\\n    float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );\\n    d *= sign( q.x*b.y + q.y*b.x - b.x*b.y );\\n    \\n\\treturn d;\\n}\\n\\nvoid main() {\\n\\tvec2 st = (gl_PointCoord - vec2(0.5, 0.5)) * 2.0; // [-1,1]\\n\\tfloat r = sdRhombus(st, vec2(0.6, 0.2));\\n\\tfloat alpha = 1. - sign(r);\\n\\tvec3 col;\\n\\tcol = mix(innerColor, outerColor, r);\\n\\tgl_FragColor = vec4(col, alpha * vPreAlpha);\\n}\";","import * as THREE from 'three';\r\nimport { Particle } from 'MODULES/Particle/Particle';\r\nimport vertexShader from './shaders/particle.vs';\r\nimport fragmentShader from './shaders/particle.fs';\r\nimport { symmetryRandom } from 'JS/Utils';\r\n\r\nexport class ParticleChip {\r\n\tconstructor(scene) {\r\n\t\tthis.scene = scene;\r\n\t\tthis.deltaTime = 0;\r\n\t\tthis.particleControl = {\r\n\t\t\tparticleNum: 200,\r\n\t\t\tarea: [3.0, 2.0, 4.0]\r\n\t\t};\r\n\t\t// Data\r\n\t\tthis.geometry = new THREE.BufferGeometry();\r\n\t\tthis.positions = new Float32Array(this.particleControl.particleNum * 3);\r\n\t\tthis.sizes = new Float32Array(this.particleControl.particleNum);\r\n\t\tthis.alphas = new Float32Array(this.particleControl.particleNum);\r\n\t\tthis.initParticle();\r\n\t}\r\n\r\n\tget mesh() {\r\n\t\treturn this.points;\r\n\t}\r\n\r\n\tinitParticle() {\r\n\t\tlet { particleControl } = this;\r\n\t\tlet { particleNum, area } = particleControl;\r\n\t\tparticleControl.particles = new Array(particleNum);\r\n\t\tlet tempVec3 = new THREE.Vector3();\r\n\t\tlet tempVelocity = 0;\r\n\t\tfor (let i = 0; i < particleNum; i++) {\r\n\t\t\tparticleControl.particles[i] = new Particle();\r\n\t\t\tlet particle = particleControl.particles[i];\r\n\t\t\t// Init Transform\r\n\t\t\ttempVec3.x = symmetryRandom() * 0.3 - 5.8;\r\n\t\t\ttempVec3.y = symmetryRandom() * 0.2 - 0.1;\r\n\t\t\ttempVec3.z = symmetryRandom() * 0.3 - 1;\r\n\t\t\ttempVec3.normalize();\r\n\t\t\ttempVelocity = 2.0 + Math.random() * 1.0;\r\n\t\t\ttempVec3.multiplyScalar(tempVelocity);\r\n\t\t\t// Velocity\r\n\t\t\tparticle.setVelocity(tempVec3.x, tempVec3.y, tempVec3.z - 1);\r\n\t\t\t// Position\r\n\t\t\tparticle.setPosition(symmetryRandom() * area[0], symmetryRandom() * area[1], symmetryRandom() * area[2]);\r\n\t\t\t// Size\r\n\t\t\tparticle.setSize(Math.random() / 5);\r\n\t\t\t// Alpha\r\n\t\t\tparticle.setAlpha(Math.random());\r\n\t\t}\r\n\t\t// Attributes\r\n\t\tthis.geometry.setAttribute('position', new THREE.BufferAttribute(this.positions, 3));\r\n\t\tthis.geometry.setAttribute('aSize', new THREE.BufferAttribute(this.sizes, 1));\r\n\t\tthis.geometry.setAttribute('aAlpha', new THREE.BufferAttribute(this.alphas, 1));\r\n\r\n\t\t// Uniforms\r\n\t\tthis.uniforms = {\r\n\t\t\tfar: {\r\n\t\t\t\ttype: 'f',\r\n\t\t\t\tvalue: area[2]\r\n\t\t\t},\r\n\t\t\tinnerColor: { value: new THREE.Color('#FFFFFF') },\r\n\t\t\touterColor: { value: new THREE.Color('#EEEEEE') }\r\n\t\t};\r\n\t\tthis.points = new THREE.Points(\r\n\t\t\tthis.geometry,\r\n\t\t\tnew THREE.ShaderMaterial({\r\n\t\t\t\tuniforms: this.uniforms,\r\n\t\t\t\tvertexShader,\r\n\t\t\t\tfragmentShader,\r\n\t\t\t\tblending: THREE.AdditiveBlending,\r\n\t\t\t\ttransparent: true\r\n\t\t\t})\r\n\t\t);\r\n\t\tthis.scene.add(this.points);\r\n\t}\r\n\r\n\t// Cycle Position\r\n\trepeatPos(particle, area) {\r\n\t\tfor (let index = 0; index < 3; index++) {\r\n\t\t\tlet limit = area[index];\r\n\t\t\tif (Math.abs(particle.position[index]) - particle.size * 0.5 > limit) {\r\n\t\t\t\t// Out Of Area\r\n\t\t\t\tif (particle.position[index] > 0) {\r\n\t\t\t\t\tparticle.position[index] -= limit * 2.0;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tparticle.position[index] += limit * 2.0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\trenderParticle() {\r\n\t\tlet { particleNum, area, particles } = this.particleControl;\r\n\t\t// Update Data\r\n\t\tfor (let i = 0; i < particleNum; i++) {\r\n\t\t\tlet particle = particles[i];\r\n\t\t\tparticle.update(this.deltaTime);\r\n\t\t\tthis.repeatPos(particle, area);\r\n\t\t\t// Position\r\n\t\t\tthis.positions[i * 3] = particle.position[0];\r\n\t\t\tthis.positions[i * 3 + 1] = particle.position[1];\r\n\t\t\tthis.positions[i * 3 + 2] = particle.position[2];\r\n\t\t\t// Size\r\n\t\t\tthis.sizes[i] = particle.size;\r\n\t\t\t// Alpha\r\n\t\t\tthis.alphas[i] = particle.alpha;\r\n\t\t}\r\n\t\tthis.geometry.attributes['position'].needsUpdate = true;\r\n\t\tthis.geometry.attributes['aSize'].needsUpdate = true;\r\n\t}\r\n\r\n\trender(time) {\r\n\t\tthis.deltaTime = time;\r\n\t\tthis.renderParticle();\r\n\t}\r\n}\r\n","import * as THREE from 'three';\r\nimport { Section } from '../common/Section';\r\nimport { AnimeNameTitle } from '../common/AnimeNameTitle';\r\nimport { TextUniformConfig, TextConfig, AnimeName, AnimeTitleUniforms } from './const/config';\r\nimport { computeMeshBoundingBox, clamp } from 'JS/Utils';\r\n// Modules\r\nimport { TextureBG } from 'MODULES/TextureBG/TextureBG';\r\nimport { ParticleChip } from 'MODULES/ParticleChip/ParticleChip';\r\nimport { RectangleButton, CloseButton } from 'MODULES/Button/';\r\nimport { BlurMaterial } from 'MODULES/PostProcessing/';\r\nimport { gsap } from 'gsap';\r\n\r\nimport { initAnimeTitleGUI } from '../common/InitGUI';\r\nimport * as dat from 'dat.gui';\r\n\r\nexport class AboutSection extends Section {\r\n\tconstructor(viewer) {\r\n\t\tsuper(viewer);\r\n\t\tthis.name = 'AboutSection';\r\n\t\tthis.debug = 0;\r\n\r\n\t\tthis.cameraInitPos = new THREE.Vector3(0, 0, 2);\r\n\t\tthis.cameraLookAtPos = new THREE.Vector3(0, 0, 0);\r\n\r\n\t\tthis.intersectsArr = [];\r\n\t\tthis.intersects = []; // intersect result\r\n\t\tthis.raycaster = new THREE.Raycaster();\r\n\t\tthis.raycaster.layers.set(this.layers.UI_LAYER);\r\n\t\tthis.isOpenContactPanel = false;\r\n\t\tthis.blurIterations = {\r\n\t\t\tstart: 0,\r\n\t\t\ttarget: 3,\r\n\t\t\tvalue: 0\r\n\t\t};\r\n\r\n\t\tthis.clickNDCPos = new THREE.Vector2();\r\n\t}\r\n\r\n\tinit() {\r\n\t\tthis.initCamera();\r\n\t\tthis.initBackground();\r\n\t\tthis.initParticleChip();\r\n\t\tthis.initText();\r\n\t\tthis.initUIPanel();\r\n\t\tthis.initPostprocessing();\r\n\t\tthis.initEvent();\r\n\r\n\t\tif (this.debug) this.initGUI();\r\n\t}\r\n\r\n\tinitGUI() {\r\n\t\tconst gui = new dat.GUI();\r\n\t\tinitAnimeTitleGUI(gui, this.animeNameTitle.material);\r\n\t\tlet textMaterial = this.textMaterial;\r\n\t\tconsole.log(this.textMaterial);\r\n\t\tlet params = {\r\n\t\t\t// Text\r\n\t\t\ttextTopColor: textMaterial.uniforms.topColor.value.getStyle(),\r\n\t\t\ttextBottomColor: textMaterial.uniforms.bottomColor.value.getStyle()\r\n\t\t};\r\n\t\t// Text\r\n\t\tconst textFolder = gui.addFolder('Text');\r\n\t\ttextFolder\r\n\t\t\t.addColor(params, 'textTopColor')\r\n\t\t\t.name('topColor')\r\n\t\t\t.onChange(value => {\r\n\t\t\t\ttextMaterial.uniforms.topColor.value.setStyle(value);\r\n\t\t\t});\r\n\t\ttextFolder\r\n\t\t\t.addColor(params, 'textBottomColor')\r\n\t\t\t.name('bottomColor')\r\n\t\t\t.onChange(value => {\r\n\t\t\t\ttextMaterial.uniforms.bottomColor.value.setStyle(value);\r\n\t\t\t});\r\n\t\ttextFolder.open();\r\n\t}\r\n\r\n\tinitPostprocessing() {\r\n\t\tthis.postScene = new THREE.Scene();\r\n\t\tthis.postCamera = this.viewer.postCamera;\r\n\t\tthis.postRenderTarget = this.viewer.postRenderTarget.clone();\r\n\t\tthis.postScreenMesh = new THREE.Mesh(this.viewer.screenGeometry);\r\n\t\tthis.postScreenMesh.frustumCulled = false;\r\n\t\tthis.postScene.add(this.postScreenMesh);\r\n\r\n\t\tthis.blurVerticalMaterial = new BlurMaterial({\r\n\t\t\tdirection: new THREE.Vector2(0, 1)\r\n\t\t});\r\n\t\tthis.blurHorizontalMaterial = new BlurMaterial({\r\n\t\t\tdirection: new THREE.Vector2(1, 0)\r\n\t\t});\r\n\t}\r\n\r\n\trenderPost(renderTarget) {\r\n\t\t// if(!this.isOpenContactPanel) return;\r\n\t\tlet blurIterations = this.blurIterations.value;\r\n\t\tif (blurIterations < 0.1) return;\r\n\t\tfor (let i = 0; i < blurIterations; i++) {\r\n\t\t\tlet inputTexture = renderTarget.texture;\r\n\t\t\tthis.blurVerticalMaterial.uniforms.inputBuffer.value = inputTexture;\r\n\t\t\tthis.blurVerticalMaterial.uniforms.direction.value.setY(blurIterations - i + 1);\r\n\t\t\tthis.postScene.overrideMaterial = this.blurVerticalMaterial;\r\n\t\t\tthis.renderer.setRenderTarget(this.postRenderTarget);\r\n\t\t\tthis.renderer.render(this.postScene, this.postCamera);\r\n\r\n\t\t\tthis.blurHorizontalMaterial.uniforms.inputBuffer.value = this.postRenderTarget.texture;\r\n\t\t\tthis.blurHorizontalMaterial.uniforms.direction.value.setX(blurIterations - i + 1);\r\n\t\t\tthis.postScene.overrideMaterial = this.blurHorizontalMaterial;\r\n\t\t\tthis.renderer.setRenderTarget(renderTarget);\r\n\t\t\tthis.renderer.render(this.postScene, this.postCamera);\r\n\t\t}\r\n\t}\r\n\r\n\tinitUIPanel() {\r\n\t\t// Contact Button\r\n\t\tthis.contactBtn = new RectangleButton(this, this.layers.UI_LAYER, 'Contact Me');\r\n\t\tthis.contactBtn.container.scale.setScalar(1);\r\n\t\tthis.uiScene.add(this.contactBtn.container);\r\n\t\t// Close Btn\r\n\t\tthis.closeBtn = new CloseButton(this, this.layers.UI_LAYER);\r\n\t\tlet closeContainer = this.closeBtn.container;\r\n\t\tconst closeBtnScale = 0.45;\r\n\t\tthis.closeBtnBox = computeMeshBoundingBox(this.closeBtn.mesh).length.multiplyScalar(closeBtnScale);\r\n\t\tcloseContainer.scale.setScalar(closeBtnScale);\r\n\r\n\t\tthis.uiScene.add(closeContainer);\r\n\t\tthis.resizeUIPanel(this.width, this.height);\r\n\t}\r\n\r\n\tresizeUIPanel(width, height) {\r\n\t\tif(!this.isMobile){\r\n\t\t\tthis.contactBtn.container.position.set(-width / 3, -height / 4, 0);\r\n\t\t}else{\r\n\t\t\tthis.contactBtn.container.position.set(-width / 3.5, height / 2.5, 0);\r\n\t\t}\r\n\t\tlet closeContainer = this.closeBtn.container;\r\n\t\tconst topOffset = height / 2 - this.closeBtnBox.y / 2 - 20;\r\n\t\tconst leftOffset = width / 2 - this.closeBtnBox.x / 2 - 20;\r\n\t\tcloseContainer.position.set(leftOffset, topOffset, 0);\r\n\t}\r\n\r\n\tinitCamera() {\r\n\t\tthis.camera.position.copy(this.cameraInitPos);\r\n\t\tthis.camera.lookAt(this.cameraLookAtPos);\r\n\t}\r\n\r\n\tinitParticleChip() {\r\n\t\tthis.particleChip = new ParticleChip(this.scene);\r\n\t}\r\n\r\n\tinitText() {\r\n\t\tlet material = (this.textMaterial = this.fontGenerator.createFontMaterial(1));\r\n\t\tmaterial.uniforms.time = { value: 0.0 };\r\n\t\t// Apply text color\r\n\t\tObject.keys(TextUniformConfig).map(key => {\r\n\t\t\tmaterial.uniforms[`${key}`] = { value: TextUniformConfig[key].clone() };\r\n\t\t});\r\n\r\n\t\tthis.titleMesh = this.initTextMesh(TextConfig.mainTitle, material);\r\n\t\tthis.subTitleMesh = this.initTextMesh(TextConfig.subTitle, material);\r\n\t\tthis.animeNameTitle = new AnimeNameTitle(this, AnimeName, AnimeTitleUniforms);\r\n\t\tthis.resizeText(this.width, this.height);\r\n\t}\r\n\r\n\tresizeText(width, height) {\r\n\t\tif (!this.isMobile) {\r\n\t\t\tthis.resizeTextForPC(width, height);\r\n\t\t} else {\r\n\t\t\tthis.resizeTextForMobile(width, height);\r\n\t\t}\r\n\r\n\t\tthis.animeNameTitle.resize(width, height);\r\n\t}\r\n\r\n\tresizeTextForPC(width, height) {\r\n\t\tlet { titleMesh, subTitleMesh } = this;\r\n\t\tconst topOffset = height / 4;\r\n\t\tconst leftOffset = -width / 2.25;\r\n\t\tconst titleScale = clamp(width / 1000, 1.2, 1.4);\r\n\t\ttitleMesh.scale.setScalar(titleScale);\r\n\t\ttitleMesh.position.set(leftOffset, topOffset, 0);\r\n\r\n\t\tconst subTitleScale = clamp(width / 2000, 0.4, 0.6);\r\n\t\tlet subBBox = computeMeshBoundingBox(subTitleMesh).length.multiplyScalar(subTitleScale);\r\n\t\tsubTitleMesh.scale.setScalar(subTitleScale);\r\n\t\tsubTitleMesh.position.set(leftOffset, topOffset, 0);\r\n\r\n\t\t// Gap between title and subtitle\r\n\t\tsubTitleMesh.position.y = topOffset - subBBox.y - 20;\r\n\t}\r\n\r\n\tresizeTextForMobile(width, height) {\r\n\t\tlet { titleMesh, subTitleMesh } = this;\r\n\t\tconst topOffset = -height / 5;\r\n\t\tconst leftOffset = -width / 2.25;\r\n\t\tconst titleScale = clamp(width / 500, 0.7, 0.9);\r\n\t\ttitleMesh.scale.setScalar(titleScale);\r\n\t\ttitleMesh.position.set(leftOffset, topOffset, 0);\r\n\r\n\t\tconst subTitleScale = clamp(width / 1000, 0.35, 0.45);\r\n\t\tlet subBBox = computeMeshBoundingBox(subTitleMesh).length.multiplyScalar(subTitleScale);\r\n\t\tsubTitleMesh.scale.setScalar(subTitleScale);\r\n\t\tsubTitleMesh.position.set(leftOffset, topOffset, 0);\r\n\r\n\t\t// Gap between title and subtitle\r\n\t\tsubTitleMesh.position.y = topOffset - subBBox.y - 20;\r\n\t}\r\n\r\n\tinitBackground() {\r\n\t\tlet texture = this.assetLibrary.get('Texture-OnePunch1');\r\n\t\t// let texture = this.assetLibrary.get('Texture-Wuyu1');\r\n\t\tlet bgMesh = (this.bgMesh = new TextureBG(texture, this.postProcessingMaterial));\r\n\t\tbgMesh.layers.set(this.layers.BG_LAYER);\r\n\t\tthis.scene.add(bgMesh);\r\n\t}\r\n\r\n\twhileVisible(order) {\r\n\t\tlet cameraPos = this.camera.position;\r\n\t\tlet textOpacity = this.textMaterial.uniforms.opacity;\r\n\t\tgsap.killTweensOf(cameraPos);\r\n\t\tif (order === 'pre') {\r\n\t\t\tgsap.fromTo(cameraPos, { y: -0.5 }, { y: 0, duration: this.viewer.scrollAnimeDuration });\r\n\t\t} else {\r\n\t\t\tgsap.fromTo(cameraPos, { y: 0.5 }, { y: 0, duration: this.viewer.scrollAnimeDuration });\r\n\t\t}\r\n\t\tgsap.fromTo(textOpacity, { value: 0 }, { value: 1, duration: 1.5, delay: 0.5, ease: 'power2.out' });\r\n\t\tgsap.to(this.animeNameTitle.material.uniforms.opacity, { value: 1, duration: 1, delay: 1, ease: 'power2.out' });\r\n\t\tgsap.fromTo(\r\n\t\t\tthis.bgMesh.material.uniforms.vignetteDarkness,\r\n\t\t\t{ value: 1 },\r\n\t\t\t{ value: 0.6, duration: 1.5, delay: 0.8, ease: 'power2.out' }\r\n\t\t);\r\n\t\tgsap.to(this.contactBtn, { opacity: 0.8, duration: 1.5, delay: 0.5, ease: 'power2.out' });\r\n\t}\r\n\r\n\twhileNoVisible(order) {\r\n\t\tlet cameraPos = this.camera.position;\r\n\t\tlet textOpacity = this.textMaterial.uniforms.opacity;\r\n\t\tgsap.killTweensOf(cameraPos);\r\n\t\tif (order === 'pre') {\r\n\t\t\tgsap.fromTo(cameraPos, { y: 0 }, { y: 0.5, duration: this.viewer.scrollAnimeDuration });\r\n\t\t} else {\r\n\t\t\tgsap.fromTo(cameraPos, { y: 0 }, { y: -0.5, duration: this.viewer.scrollAnimeDuration });\r\n\t\t}\r\n\t\tgsap.fromTo(textOpacity, { value: 1 }, { value: 0, duration: 0.5, ease: 'power2.out' });\r\n\t\tgsap.to(this.animeNameTitle.material.uniforms.opacity, { value: 0, duration: 1, ease: 'power2.out' });\r\n\t\tgsap.to(this.contactBtn, { opacity: 0.0, duration: 0.8, ease: 'power2.out' });\r\n\t\t// Close\r\n\t\tif (this.isOpenContactPanel) this.closeContactPanel();\r\n\t}\r\n\r\n\topenContactPanel() {\r\n\t\tif (this.isOpenContactPanel) return;\r\n\t\tthis.isOpenContactPanel = true;\r\n\t\tconst duration = 1;\r\n\t\t// 1.Blur BG\r\n\t\tgsap.fromTo(\r\n\t\t\tthis.blurIterations,\r\n\t\t\t{ value: this.blurIterations.start },\r\n\t\t\t{ value: this.blurIterations.target, duration, ease: 'power2.out' }\r\n\t\t);\r\n\t\t// 2.Button Animation\r\n\t\tgsap.to(this.contactBtn, {\r\n\t\t\topacity: 0,\r\n\t\t\tduration,\r\n\t\t\tease: 'power2.out',\r\n\t\t\tonComplete: () => {\r\n\t\t\t\tthis.contactBtn.visible = false;\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.closeBtn.visible = true;\r\n\t\tgsap.to(this.closeBtn, { opacity: 0.5, duration, ease: 'power2.out' });\r\n\t\tthis.intersectsArr = [this.closeBtn.hitArea];\r\n\t\t// 3.Text\r\n\t\tlet textOpacity = this.textMaterial.uniforms.opacity;\r\n\t\tgsap.fromTo(textOpacity, { value: 1 }, { value: 0, duration, ease: 'power2.out' });\r\n\t\tgsap.to(this.animeNameTitle.material.uniforms.opacity, { value: 0, duration, ease: 'power2.out' });\r\n\t\t// 4.2D\r\n\t\tthis.viewer.toggleConactPanle(true);\r\n\t}\r\n\r\n\tcloseContactPanel() {\r\n\t\tif (!this.isOpenContactPanel) return;\r\n\t\tthis.isOpenContactPanel = false;\r\n\t\tconst duration = 1;\r\n\t\t// 1.Blur BG\r\n\t\tgsap.fromTo(\r\n\t\t\tthis.blurIterations,\r\n\t\t\t{ value: this.blurIterations.target },\r\n\t\t\t{ value: this.blurIterations.start, duration, ease: 'power2.out' }\r\n\t\t);\r\n\t\t// 2.Button Animation\r\n\t\tthis.contactBtn.visible = true;\r\n\t\tgsap.to(this.contactBtn, {\r\n\t\t\topacity: 0.8,\r\n\t\t\tduration,\r\n\t\t\tease: 'power2.out'\r\n\t\t});\r\n\t\tgsap.to(this.closeBtn, {\r\n\t\t\topacity: 0,\r\n\t\t\tduration,\r\n\t\t\tease: 'power2.out',\r\n\t\t\tonComplete: () => {\r\n\t\t\t\tthis.closeBtn.visible = false;\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.intersectsArr = [this.contactBtn.hitArea];\r\n\t\t// 3.Text\r\n\t\tlet textOpacity = this.textMaterial.uniforms.opacity;\r\n\t\tgsap.fromTo(textOpacity, { value: 0 }, { value: 1, duration, ease: 'power2.out' });\r\n\t\tgsap.to(this.animeNameTitle.material.uniforms.opacity, { value: 1, duration, ease: 'power2.out' });\r\n\t\t// 4.2D\r\n\t\tthis.viewer.toggleConactPanle(false);\r\n\t}\r\n\r\n\tinitEvent() {\r\n\t\tif (!this.isMobile) this.eventHandler.onMouseMoveEvent.bind(this.onMouseMove.bind(this));\r\n\t\tthis.intersectsArr.push(this.contactBtn.hitArea);\r\n\t\tthis.eventHandler.onClickEvent.bind(this.onClick.bind(this));\r\n\t}\r\n\r\n\tonClick() {\r\n\t\tif (!this.visible) return;\r\n\t\tif (this.isMobile) {\r\n\t\t\tlet x = event.clientX;\r\n\t\t\tlet y = event.clientY;\r\n\t\t\tthis.clickNDCPos.set((x / window.innerWidth) * 2 - 1, (-y / window.innerHeight) * 2 + 1);\r\n\t\t\tconsole.log(this.clickNDCPos);\r\n\t\t\tthis.raycaster.setFromCamera(this.clickNDCPos, this.uiCamera);\r\n\t\t\tthis.intersects = this.raycaster.intersectObjects(this.intersectsArr);\r\n\t\t}\r\n\t\tif (!this.intersects.length) return;\r\n\t\tlet intersectsRes = this.intersects[0].object;\r\n\t\tif (intersectsRes.name === 'rectangleButton') {\r\n\t\t\tthis.openContactPanel();\r\n\t\t} else if (intersectsRes.name === 'closeButton') {\r\n\t\t\tthis.closeContactPanel();\r\n\t\t}\r\n\t}\r\n\r\n\tonMouseMove() {\r\n\t\tif (!this.visible) return;\r\n\t\tthis.raycaster.setFromCamera(this.state.pointer.ndcPosition, this.uiCamera);\r\n\t\tthis.intersects = this.raycaster.intersectObjects(this.intersectsArr);\r\n\t\tif (this.intersects.length > 0) {\r\n\t\t\tdocument.body.setAttribute('cursor', 'pointer');\r\n\t\t} else {\r\n\t\t\tdocument.body.removeAttribute('cursor');\r\n\t\t}\r\n\t}\r\n\r\n\tresize(width, height, dpr) {\r\n\t\tconst pixelWidth = width * dpr;\r\n\t\tconst pixelHeight = height * dpr;\r\n\t\tthis.postProcessingMaterial.resize(pixelWidth, pixelHeight);\r\n\t\tthis.postRenderTarget.setSize(pixelWidth, pixelHeight);\r\n\t\tthis.camera.aspect = width / height;\r\n\t\tthis.camera.updateProjectionMatrix();\r\n\t\tthis.uiCamera.left = -width / 2;\r\n\t\tthis.uiCamera.right = width / 2;\r\n\t\tthis.uiCamera.top = height / 2;\r\n\t\tthis.uiCamera.bottom = -height / 2;\r\n\t\tthis.uiCamera.updateProjectionMatrix();\r\n\t\tthis.bgMesh.resize(width, height);\r\n\t\tthis.resizeText(width, height);\r\n\t\tthis.resizeUIPanel(width, height);\r\n\t}\r\n\r\n\trender({ renderer, orthoCamera, target, deltaTime } = {}) {\r\n\t\tif (!this.visible) return;\r\n\t\t// BG\r\n\t\torthoCamera.layers.set(this.layers.BG_LAYER);\r\n\t\trenderer.render(this.scene, orthoCamera);\r\n\t\t// Scene\r\n\t\tif (this.particleChip) this.particleChip.render(deltaTime);\r\n\t\trenderer.render(this.scene, this.camera);\r\n\r\n\t\tthis.renderPost(target);\r\n\t\t// UI\r\n\t\tif (this.isOpenContactPanel) {\r\n\t\t\tthis.closeBtn.update(deltaTime);\r\n\t\t} else {\r\n\t\t\tthis.contactBtn.update(deltaTime);\r\n\t\t}\r\n\t\tthis.uiCamera.layers.set(this.layers.UI_LAYER);\r\n\t\trenderer.render(this.uiScene, this.uiCamera);\r\n\t}\r\n}\r\n","export default class Signal {\r\n\tconstructor() {\r\n\t\tthis._listeners = [];\r\n\t\tthis._lookUp = new Map();\r\n\t}\r\n\r\n\tbind(event, self) {\r\n\t\tthis._lookUp.set(event, this._listeners.length);\r\n\t\tlet resFun = self ? event.bind(self) : event;\r\n\t\tthis._listeners.push(resFun);\r\n\t}\r\n\r\n\tunbind(key) {\r\n\t\tlet pos = this._lookUp.get(key);\r\n\t\t// Delete\r\n\t\tthis._listeners.splice(pos, 1);\r\n\t\tthis._lookUp.delete(key);\r\n\t}\r\n\r\n\tdispatch(key) {\r\n\t\tfor (let len = this._listeners.length, i = 0; i < len; i++) this._listeners[i](key);\r\n\t}\r\n\r\n\tget hasListeners() {\r\n\t\treturn this._listeners.length > 0;\r\n\t}\r\n}\r\n","import * as THREE from 'three';\r\nimport Signal from 'JS/Signal';\r\nimport normalizeWheel from 'normalize-wheel';\r\n\r\nexport class EventHandler {\r\n\tconstructor(isMobile) {\r\n\t\tthis.isMobile = isMobile;\r\n\t\tthis.initEvent();\r\n\t\tthis.time = +new Date();\r\n\t\tthis.lastTime = null;\r\n\t\tthis.touchStartPos = new THREE.Vector2();\r\n\t\tthis.touchMovePos = new THREE.Vector2();\r\n\t}\r\n\r\n\tinitEvent() {\r\n\t\tif (!this.isMobile) {\r\n\t\t\t// PC\r\n\t\t\tthis.onMouseMoveEvent = new Signal();\r\n\t\t\tthis.onScrollEvent = new Signal();\r\n\t\t\tdocument.addEventListener('mousemove', this.onMouseMove.bind(this), { passive: true });\r\n\t\t\tdocument.addEventListener('wheel', this.onScroll.bind(this), { passive: false });\r\n\t\t} else {\r\n\t\t\t// Mobile\r\n\t\t\tthis.onTouchMoveEvent = new Signal();\r\n\t\t\tdocument.addEventListener('touchstart', this.onTouchStart.bind(this));\r\n\t\t\tdocument.addEventListener('touchmove', this.onTouchMove.bind(this));\r\n\t\t}\r\n\t\tthis.onClickEvent = new Signal();\r\n\t\tdocument.addEventListener('click', this.onClick.bind(this));\r\n\t}\r\n\r\n\tonClick(event) {\r\n\t\tthis.onClickEvent.dispatch(event);\r\n\t}\r\n\r\n\tonMouseMove(event) {\r\n\t\tthis.onMouseMoveEvent.dispatch(event);\r\n\t}\r\n\r\n\tonScroll(event) {\r\n\t\t// 禁止滚动回弹\r\n\t\tevent.preventDefault();\r\n\t\tthis.time = +new Date();\r\n\t\t// 节流缓解神奇的触控板延后触发\r\n\t\tif (this.time - this.lastTime > 1400 || !this.lastTime) {\r\n\t\t\tlet normalEvent = normalizeWheel(event);\r\n\t\t\tthis.onScrollEvent.dispatch(normalEvent);\r\n\t\t\tthis.lastTime = this.time;\r\n\t\t}\r\n\t}\r\n\r\n\tonTouchStart(event) {\r\n\t\tthis.touchStartPos.set(event.touches[0].clientX, event.touches[0].clientY);\r\n\t}\r\n\r\n\tonTouchMove(event) {\r\n\t\tthis.touchMovePos.set(event.touches[0].clientX, event.touches[0].clientY);\r\n\t\tlet offset = {\r\n\t\t\tx: this.touchMovePos.x,\r\n\t\t\ty: this.touchMovePos.y,\r\n\t\t\toffsetX: this.touchMovePos.x - this.touchStartPos.x,\r\n\t\t\toffsetY: this.touchMovePos.y - this.touchStartPos.y\r\n\t\t};\r\n\t\tthis.onTouchMoveEvent.dispatch(offset);\r\n\t}\r\n}\r\n","export default \"#define GLSLIFY 1\\nattribute vec2 uv;\\nattribute vec4 position;\\nuniform mat4 projectionMatrix;\\nuniform mat4 modelViewMatrix;\\nvarying vec2 vUv;\\nuniform float time;\\n\\nvoid main() {\\n  vUv = uv;\\n  vec3 p = vec3(position.x, position.y, position.z);\\n\\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(p, 1.0);\\n}\";","export default \"#define GLSLIFY 1\\nattribute vec2 uv;\\nattribute vec4 position;\\nuniform mat4 projectionMatrix;\\nuniform mat4 modelViewMatrix;\\nvarying vec2 vUv;\\nuniform float time;\\n\\n//\\n// Description : Array and textureless GLSL 2D/3D/4D simplex\\n//               noise functions.\\n//      Author : Ian McEwan, Ashima Arts.\\n//  Maintainer : ijm\\n//     Lastmod : 20110822 (ijm)\\n//     License : Copyright (C) 2011 Ashima Arts. All rights reserved.\\n//               Distributed under the MIT License. See LICENSE file.\\n//               https://github.com/ashima/webgl-noise\\n//\\n\\nvec4 mod289(vec4 x) {\\n  return x - floor(x * (1.0 / 289.0)) * 289.0; }\\n\\nfloat mod289(float x) {\\n  return x - floor(x * (1.0 / 289.0)) * 289.0; }\\n\\nvec4 permute(vec4 x) {\\n     return mod289(((x*34.0)+1.0)*x);\\n}\\n\\nfloat permute(float x) {\\n     return mod289(((x*34.0)+1.0)*x);\\n}\\n\\nvec4 taylorInvSqrt(vec4 r)\\n{\\n  return 1.79284291400159 - 0.85373472095314 * r;\\n}\\n\\nfloat taylorInvSqrt(float r)\\n{\\n  return 1.79284291400159 - 0.85373472095314 * r;\\n}\\n\\nvec4 grad4(float j, vec4 ip)\\n  {\\n  const vec4 ones = vec4(1.0, 1.0, 1.0, -1.0);\\n  vec4 p,s;\\n\\n  p.xyz = floor( fract (vec3(j) * ip.xyz) * 7.0) * ip.z - 1.0;\\n  p.w = 1.5 - dot(abs(p.xyz), ones.xyz);\\n  s = vec4(lessThan(p, vec4(0.0)));\\n  p.xyz = p.xyz + (s.xyz*2.0 - 1.0) * s.www;\\n\\n  return p;\\n  }\\n\\n// (sqrt(5) - 1)/4 = F4, used once below\\n#define F4 0.309016994374947451\\n\\nfloat snoise(vec4 v)\\n  {\\n  const vec4  C = vec4( 0.138196601125011,  // (5 - sqrt(5))/20  G4\\n                        0.276393202250021,  // 2 * G4\\n                        0.414589803375032,  // 3 * G4\\n                       -0.447213595499958); // -1 + 4 * G4\\n\\n// First corner\\n  vec4 i  = floor(v + dot(v, vec4(F4)) );\\n  vec4 x0 = v -   i + dot(i, C.xxxx);\\n\\n// Other corners\\n\\n// Rank sorting originally contributed by Bill Licea-Kane, AMD (formerly ATI)\\n  vec4 i0;\\n  vec3 isX = step( x0.yzw, x0.xxx );\\n  vec3 isYZ = step( x0.zww, x0.yyz );\\n//  i0.x = dot( isX, vec3( 1.0 ) );\\n  i0.x = isX.x + isX.y + isX.z;\\n  i0.yzw = 1.0 - isX;\\n//  i0.y += dot( isYZ.xy, vec2( 1.0 ) );\\n  i0.y += isYZ.x + isYZ.y;\\n  i0.zw += 1.0 - isYZ.xy;\\n  i0.z += isYZ.z;\\n  i0.w += 1.0 - isYZ.z;\\n\\n  // i0 now contains the unique values 0,1,2,3 in each channel\\n  vec4 i3 = clamp( i0, 0.0, 1.0 );\\n  vec4 i2 = clamp( i0-1.0, 0.0, 1.0 );\\n  vec4 i1 = clamp( i0-2.0, 0.0, 1.0 );\\n\\n  //  x0 = x0 - 0.0 + 0.0 * C.xxxx\\n  //  x1 = x0 - i1  + 1.0 * C.xxxx\\n  //  x2 = x0 - i2  + 2.0 * C.xxxx\\n  //  x3 = x0 - i3  + 3.0 * C.xxxx\\n  //  x4 = x0 - 1.0 + 4.0 * C.xxxx\\n  vec4 x1 = x0 - i1 + C.xxxx;\\n  vec4 x2 = x0 - i2 + C.yyyy;\\n  vec4 x3 = x0 - i3 + C.zzzz;\\n  vec4 x4 = x0 + C.wwww;\\n\\n// Permutations\\n  i = mod289(i);\\n  float j0 = permute( permute( permute( permute(i.w) + i.z) + i.y) + i.x);\\n  vec4 j1 = permute( permute( permute( permute (\\n             i.w + vec4(i1.w, i2.w, i3.w, 1.0 ))\\n           + i.z + vec4(i1.z, i2.z, i3.z, 1.0 ))\\n           + i.y + vec4(i1.y, i2.y, i3.y, 1.0 ))\\n           + i.x + vec4(i1.x, i2.x, i3.x, 1.0 ));\\n\\n// Gradients: 7x7x6 points over a cube, mapped onto a 4-cross polytope\\n// 7*7*6 = 294, which is close to the ring size 17*17 = 289.\\n  vec4 ip = vec4(1.0/294.0, 1.0/49.0, 1.0/7.0, 0.0) ;\\n\\n  vec4 p0 = grad4(j0,   ip);\\n  vec4 p1 = grad4(j1.x, ip);\\n  vec4 p2 = grad4(j1.y, ip);\\n  vec4 p3 = grad4(j1.z, ip);\\n  vec4 p4 = grad4(j1.w, ip);\\n\\n// Normalise gradients\\n  vec4 norm = taylorInvSqrt(vec4(dot(p0,p0), dot(p1,p1), dot(p2, p2), dot(p3,p3)));\\n  p0 *= norm.x;\\n  p1 *= norm.y;\\n  p2 *= norm.z;\\n  p3 *= norm.w;\\n  p4 *= taylorInvSqrt(dot(p4,p4));\\n\\n// Mix contributions from the five corners\\n  vec3 m0 = max(0.6 - vec3(dot(x0,x0), dot(x1,x1), dot(x2,x2)), 0.0);\\n  vec2 m1 = max(0.6 - vec2(dot(x3,x3), dot(x4,x4)            ), 0.0);\\n  m0 = m0 * m0;\\n  m1 = m1 * m1;\\n  return 49.0 * ( dot(m0*m0, vec3( dot( p0, x0 ), dot( p1, x1 ), dot( p2, x2 )))\\n               + dot(m1*m1, vec2( dot( p3, x3 ), dot( p4, x4 ) ) ) ) ;\\n\\n  }\\n\\nvoid main() {\\n  vUv = uv;\\n  vec3 p = vec3(position.x, position.y, position.z);\\n  float n = snoise(vec4(p, 1.0 + time * 0.5)) * 2.0;\\n  p.y += n * 0.5;\\n  p.z += n * 0.5;\\n\\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(p, 1.0);\\n}\";","export default \"#define GLSLIFY 1\\nattribute vec2 uv;\\nattribute vec4 position;\\nuniform mat4 projectionMatrix;\\nuniform mat4 modelViewMatrix;\\nvarying vec2 vUv;\\nuniform float time;\\n\\nvoid main() {\\n  vUv = uv;\\n  vec3 p = vec3(position.x, position.y, position.z);\\n\\n  gl_Position = projectionMatrix * modelViewMatrix * vec4(p, 1.0);\\n}\";","export default \"#ifdef GL_OES_standard_derivatives\\n#extension GL_OES_standard_derivatives : enable\\n#endif\\n\\nprecision highp float;\\n#define GLSLIFY 1\\nuniform float opacity;\\nuniform vec3 color;\\nuniform sampler2D map;\\nvarying vec2 vUv;\\nuniform float time;\\nuniform vec2 resolution;\\n\\nuniform vec3 color1;\\nuniform vec3 color2;\\nuniform vec3 color3;\\nuniform vec3 color4;\\n\\n// https://iquilezles.org/www/articles/palettes/palettes.htm\\nvec3 palette(in float t, in vec3 a, in vec3 b, in vec3 c, in vec3 d ) {\\n  return a + b*cos( 6.28318*(c*t+d) );\\n}\\n\\nfloat median(float r, float g, float b) {\\n  return max(min(r, g), min(max(r, g), b));\\n}\\n\\nvoid main() {\\n  vec3 sample = texture2D(map, vUv).rgb;\\n  float sigDist = median(sample.r, sample.g, sample.b) - 0.5;\\n  float alpha = clamp(sigDist/abs(dFdx(sigDist)) + abs(dFdy(sigDist)) + 0.5, 0.0, 1.0);\\n\\n  float speed = .5;\\n  vec2 p = gl_FragCoord.xy * 0.01 + 0.5;\\n  p.x *= .3;\\n  p.y *= .8;\\n  // float scale = 10.0;\\n  // vec2 p = vUv * scale + 0.5;\\n\\n  for(int i = 1; i < 10; i++) {\\n    p.x += 0.45 / float(i) * sin(float(i) * 3.0 * p.y + time * speed);\\n    p.y += 0.45 / float(i) * cos(float(i) * 3.0 * p.x + time * speed);\\n  }\\n\\n  float r = cos(p.x + p.y + 1.0) * .5 + 0.5;\\n\\n  // Color mixing\\n  vec3 palette = palette(r, color1, color2, color3, color4);\\n\\n  gl_FragColor = vec4(palette, alpha * opacity);\\n  if (gl_FragColor.a < 0.0001) discard;\\n}\";","export default \"#ifdef GL_OES_standard_derivatives\\n#extension GL_OES_standard_derivatives : enable\\n#endif\\n\\nprecision highp float;\\n#define GLSLIFY 1\\nuniform float opacity;\\nuniform vec3 color;\\nuniform sampler2D map;\\nvarying vec2 vUv;\\nuniform float time;\\nuniform vec2 resolution;\\n\\nuniform vec3 topColor;\\nuniform vec3 bottomColor;\\n\\nfloat median(float r, float g, float b) {\\n  return max(min(r, g), min(max(r, g), b));\\n}\\n\\nvoid main() {\\n  vec3 sample = texture2D(map, vUv).rgb;\\n  float sigDist = median(sample.r, sample.g, sample.b) - 0.5;\\n  float alpha = clamp(sigDist/fwidth(sigDist) + 0.5, 0.0, 1.0);\\n\\n  vec3 newColor = mix(bottomColor, topColor, vUv.y);\\n\\n  // gl_FragColor = vec4(color.xyz, alpha * opacity);\\n  gl_FragColor = vec4(newColor, alpha * opacity);\\n  \\n  if (gl_FragColor.a < 0.0001) discard;\\n}\";","export default \"#ifdef GL_OES_standard_derivatives\\n#extension GL_OES_standard_derivatives : enable\\n#endif\\n\\nprecision highp float;\\n#define GLSLIFY 1\\nuniform float opacity;\\nuniform vec3 color;\\nuniform sampler2D map;\\nvarying vec2 vUv;\\nuniform float time;\\n\\nfloat median(float r, float g, float b) {\\n  return max(min(r, g), min(max(r, g), b));\\n}\\n\\nvoid main() {\\n  vec3 sample = texture2D(map, vUv).rgb;\\n  float sigDist = median(sample.r, sample.g, sample.b) - 0.5;\\n  float alpha = clamp(sigDist/fwidth(sigDist) + 0.5, 0.0, 1.0);\\n  gl_FragColor = vec4(color.xyz, alpha * opacity);\\n  if (gl_FragColor.a < 0.0001) discard;\\n}\";","import vertex1 from './vertex/fontType1.glsl';\r\nimport vertex2 from './vertex/fontType2.glsl';\r\nimport vertex3 from './vertex/fontType3.glsl';\r\n\r\nimport fragment1 from './fragment/fontType1.glsl';\r\nimport fragment2 from './fragment/fontType2.glsl';\r\nimport fragment3 from './fragment/fontType3.glsl';\r\n\r\nexport const fontShaders = [\r\n\t{ vertex: vertex1, fragment: fragment1 },\r\n\t{ vertex: vertex2, fragment: fragment2 },\r\n\t{ vertex: vertex3, fragment: fragment3 }\r\n];\r\n","import * as THREE from 'three';\r\nimport createGeometry from 'three-bmfont-text';\r\nimport MSDFShader from 'three-bmfont-text/shaders/msdf';\r\nimport { fontShaders } from 'MODULES/FontShaders/';\r\n\r\nexport class FontGenerator {\r\n\tconstructor(assetLibrary) {\r\n\t\tthis.fontTexture = assetLibrary.get('Texture-Lato');\r\n\t\tthis.font = assetLibrary.get('Font-Lato');\r\n\t}\r\n\r\n\tcreateFontMaterial(fontShadersKey, opts) {\r\n\t\tlet material = new THREE.RawShaderMaterial(\r\n\t\t\tMSDFShader({\r\n\t\t\t\tvertexShader: fontShaders[fontShadersKey].vertex,\r\n\t\t\t\tfragmentShader: fontShaders[fontShadersKey].fragment,\r\n\t\t\t\tmap: this.fontTexture,\r\n\t\t\t\tcolor: 0xffffff,\r\n\t\t\t\ttransparent: true,\r\n\t\t\t\tdepthTest: false,\r\n\t\t\t\tnegate: false,\r\n\t\t\t\topacity: 0 // Through animation to 1\r\n\t\t\t})\r\n\t\t);\r\n\t\tmaterial.uniforms.resolution = { value: new THREE.Vector2(window.innerWidth, window.innerHeight) };\r\n\t\treturn material;\r\n\t}\r\n\r\n\tcreateFontMesh(text, material) {\r\n\t\tconst geometry = createGeometry({ font: this.font, text });\r\n\t\treturn new THREE.Mesh(geometry, material);\r\n\t}\r\n}\r\n","import * as THREE from 'three';\r\nimport { HomeSection, AnimeSection, WorkSection, AboutSection } from './sections/index';\r\nimport { EventHandler } from 'JS/EventHandler';\r\n// Text\r\nimport { FontGenerator } from './sections/common/FontGenerator';\r\nimport { gsap } from 'gsap';\r\n\r\nexport default class ScenesViewer {\r\n\tconstructor(mainScene) {\r\n\t\tthis.mainScene = mainScene;\r\n\t\tthis.renderer = mainScene.renderer;\r\n\t\tthis.isMobile = mainScene.isMobile;\r\n\t\tthis.scene = mainScene.scene;\r\n\t\tthis.clock = mainScene.clock;\r\n\t\tthis.assetLibrary = mainScene.assetLibrary;\r\n\t\tthis.fontGenerator = new FontGenerator(this.assetLibrary);\r\n\t\tthis.container = mainScene.container;\r\n\t\tthis.scene = mainScene.scene;\r\n\t\tthis.camera = mainScene.camera;\r\n\t\t// Viewport\r\n\t\tthis.width = mainScene.width;\r\n\t\tthis.height = mainScene.height;\r\n\t\tthis.dpr = mainScene.dpr;\r\n\r\n\t\tthis.scrollMultiplier = 1.2;\r\n\t\tthis.isSectionChanging = false;\r\n\t\tthis.scrollAnimeDuration = 1.4;\r\n\r\n\t\tthis.state = {\r\n\t\t\tpreloadFinished: false,\r\n\t\t\tscissors: [\r\n\t\t\t\t[0, window.innerHeight],\r\n\t\t\t\t[0, window.innerHeight]\r\n\t\t\t],\r\n\t\t\t// Section\r\n\t\t\tvisibleSections: [0],\r\n\t\t\tcurrentScetionIndex: 0,\r\n\t\t\tnextSectionIndex: null,\r\n\t\t\t// Mouse move\r\n\t\t\tpointer: {\r\n\t\t\t\tposition: [0, 0],\r\n\t\t\t\tpositionNorm: [0, 0],\r\n\t\t\t\tndcPosition: new THREE.Vector2()\r\n\t\t\t},\r\n\t\t\t// Scroll\r\n\t\t\tscrollDirection: '',\r\n\t\t\tscroll: {\r\n\t\t\t\tprogress: 0\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.initEvent();\r\n\r\n\t\t// Reuse Geometry\r\n\t\tlet screenGeometry = (this.screenGeometry = new THREE.BufferGeometry());\r\n\t\tlet posVertices = new Float32Array([-1, -1, 0, 3, -1, 0, -1, 3, 0]);\r\n\t\tlet uvVertices = new Float32Array([0, 0, 2, 0, 0, 2]);\r\n\t\tscreenGeometry.setAttribute('position', new THREE.BufferAttribute(posVertices, 3));\r\n\t\tscreenGeometry.setAttribute('uv', new THREE.BufferAttribute(uvVertices, 2));\r\n\r\n\t\tthis.init();\r\n\t\tthis.initPostprocessing();\r\n\t\tthis.initSection();\r\n\t}\r\n\r\n\tinitEvent() {\r\n\t\tthis.eventHandler = new EventHandler(this.isMobile);\r\n\t\tif(!this.isMobile){\r\n\t\t\tthis.eventHandler.onMouseMoveEvent.bind(this.onMouseMove.bind(this));\r\n\t\t\tthis.eventHandler.onScrollEvent.bind(this.onScroll.bind(this));\r\n\t\t}else{\r\n\t\t\tthis.eventHandler.onTouchMoveEvent.bind(this.onTouchMoveEvent.bind(this));\r\n\t\t}\r\n\t}\r\n\r\n\tinit() {\r\n\t\t// 复用RenderTarget\r\n\t\tthis.targets = new Array(2).fill().map(() => {\r\n\t\t\tlet quad = new THREE.Mesh(this.screenGeometry);\r\n\t\t\tquad.frustumCulled = false;\r\n\t\t\tthis.scene.add(quad);\r\n\t\t\tlet target = new THREE.WebGLRenderTarget(this.width, this.height);\r\n\t\t\ttarget.texture.encoding = this.renderer.outputEncoding;\r\n\t\t\ttarget.texture.generateMipmaps = false;\r\n\t\t\treturn {\r\n\t\t\t\ttarget,\r\n\t\t\t\tquad\r\n\t\t\t};\r\n\t\t});\r\n\r\n\t\tthis.camera = new THREE.PerspectiveCamera(45, 1, 1, 700);\r\n\t\tthis.camera.position.z = 10;\r\n\t\tthis.scene.add(this.camera);\r\n\r\n\t\tthis.orthoCamera = new THREE.OrthographicCamera(1, 1, 1, 1, 0, 1000);\r\n\t\tthis.orthoCamera.position.z = 10;\r\n\t\tthis.scene.add(this.orthoCamera);\r\n\t}\r\n\r\n\tinitSection() {\r\n\t\tthis.sections = [];\r\n\t\tthis.sections[0] = new HomeSection(this);\r\n\t\tthis.sections[1] = new AnimeSection(this);\r\n\t\tthis.sections[2] = new WorkSection(this);\r\n\t\tthis.sections[3] = new AboutSection(this);\r\n\t\t// Init every section\r\n\t\tthis.sections.forEach((section, index) => {\r\n\t\t\tsection.visible = this.state.currentScetionIndex === index ? true : false;\r\n\t\t\tthis.state.visibleSections = [this.state.currentScetionIndex];\r\n\t\t\tsection.init();\r\n\t\t\tsection.postProcessingMaterial.map = this.targets[0].target.texture;\r\n\t\t\tthis.targets[0].quad.material = section.postProcessingMaterial;\r\n\t\t\tsection.precompile();\r\n\t\t});\r\n\t}\r\n\r\n\tinitPostprocessing() {\r\n\t\tthis.postCamera = new THREE.OrthographicCamera(-1, 1, 1, -1, 0, 1);\r\n\t\tthis.postRenderTarget = new THREE.WebGLRenderTarget(this.width, this.height, {\r\n\t\t\tminFilter: THREE.LinearFilter,\r\n\t\t\tmagFilter: THREE.LinearFilter,\r\n\t\t\tstencilBuffer: false,\r\n\t\t\tdepthBuffer: false,\r\n\t\t\tencoding: this.renderer.outputEncoding\r\n\t\t});\r\n\t\tthis.postRenderTarget.texture.generateMipmaps = false;\r\n\t}\r\n\r\n\tentryAnime() {\r\n\t\t// Todo:\r\n\t\t// 1.Router\r\n\t\t// 2.Every Section has their own entry anime\r\n\t\tthis.sections[0].entryAnime(() => {\r\n\t\t\tthis.preloadFinished = true;\r\n\t\t});\r\n\t}\r\n\r\n\ttoggleConactPanle(status) {\r\n\t\tthis.mainScene.toggleConactCallback(status);\r\n\t}\r\n\r\n\tonMouseMove(event) {\r\n\t\tthis.setPointerPos({\r\n\t\t\tx: event.clientX,\r\n\t\t\ty: event.clientY\r\n\t\t});\r\n\t}\r\n\r\n\tonTouchMoveEvent(event) {\r\n\t\tconst offsetY = event.offsetY;\r\n\t\tconst offsetX = event.offsetX;\r\n\t\t// Y\r\n\t\tif (Math.abs(offsetX) < Math.abs(offsetY) && Math.abs(offsetY) > 50) {\r\n\t\t\tthis.state.scrollDirection = offsetY > 0 ? 'Up' : 'Down';\r\n\t\t\tthis.swapSection();\r\n\t\t}\r\n\t\t// X\r\n\t\tthis.setPointerPos({\r\n\t\t\tx: event.x,\r\n\t\t\ty: event.y\r\n\t\t});\r\n\t}\r\n\r\n\tsetPointerPos({ x, y } = {}) {\r\n\t\t// Record to state\r\n\t\tthis.state.pointer.position = [x, y];\r\n\t\tthis.state.pointer.positionNorm = [x / window.innerWidth, y / window.innerHeight];\r\n\t\tthis.state.pointer.ndcPosition.set(\r\n\t\t\tthis.state.pointer.positionNorm[0] * 2 - 1,\r\n\t\t\t-this.state.pointer.positionNorm[1] * 2 + 1\r\n\t\t);\r\n\t}\r\n\r\n\tonScroll(event) {\r\n\t\tthis.state.scrollDirection = event.pixelY > 0 ? 'Down' : 'Up';\r\n\t\tthis.swapSection();\r\n\t}\r\n\r\n\tswapSection() {\r\n\t\tlet state = this.state;\r\n\t\tif (this.isSectionChanging) return;\r\n\t\tthis.isSectionChanging = true;\r\n\t\tconst isUpScroll = state.scrollDirection === 'Up';\r\n\r\n\t\t// Infinite loop\r\n\t\tif (isUpScroll) {\r\n\t\t\tif (state.currentScetionIndex === 0) {\r\n\t\t\t\tstate.nextSectionIndex = this.sections.length - 1;\r\n\t\t\t} else {\r\n\t\t\t\tstate.nextSectionIndex = state.currentScetionIndex - 1;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tstate.nextSectionIndex = (state.currentScetionIndex + 1) % this.sections.length;\r\n\t\t}\r\n\t\tstate.visibleSections = [state.currentScetionIndex, state.nextSectionIndex];\r\n\t\tlet currentSection = this.sections[state.currentScetionIndex];\r\n\t\tlet nextSection = this.sections[state.nextSectionIndex];\r\n\t\t// Reset visible status\r\n\t\tthis.sections.forEach((section, index) => {\r\n\t\t\tif (state.currentScetionIndex === index || state.nextSectionIndex === index) {\r\n\t\t\t\tsection.visible = true;\r\n\t\t\t} else {\r\n\t\t\t\tsection.visible = false;\r\n\t\t\t}\r\n\t\t});\r\n\t\t// Hooks\r\n\t\tcurrentSection.whileNoVisible(isUpScroll ? 'pre' : 'next');\r\n\t\tnextSection.whileVisible(isUpScroll ? 'pre' : 'next');\r\n\t\t// Animation\r\n\t\tlet curScissors = state.scissors[0];\r\n\t\tlet nextScissors = state.scissors[1];\r\n\t\tgsap.killTweensOf(state.scroll);\r\n\t\tgsap.fromTo(\r\n\t\t\tstate.scroll,\r\n\t\t\t{ progress: 0 },\r\n\t\t\t{\r\n\t\t\t\tprogress: 1,\r\n\t\t\t\tduration: this.scrollAnimeDuration,\r\n\t\t\t\tease: 'power2.out',\r\n\t\t\t\tonUpdate: () => {\r\n\t\t\t\t\tlet progress = state.scroll.progress;\r\n\t\t\t\t\tif (isUpScroll) progress = 1 - progress;\r\n\t\t\t\t\tcurrentSection.postProcessingMaterial.progress = progress;\r\n\t\t\t\t\tcurrentSection.postProcessingMaterial.isNext = isUpScroll ? true : false;\r\n\t\t\t\t\tnextSection.postProcessingMaterial.progress = progress;\r\n\t\t\t\t\tnextSection.postProcessingMaterial.isNext = isUpScroll ? false : true;\r\n\t\t\t\t\t// Scissors optimize\r\n\t\t\t\t\tcurScissors[0] = isUpScroll ? 0 : this.height * progress;\r\n\t\t\t\t\tcurScissors[1] = isUpScroll ? this.height * progress : this.height - curScissors[0];\r\n\r\n\t\t\t\t\tnextScissors[0] = isUpScroll ? this.height * progress : 0; // Down Scroll\r\n\t\t\t\t\tnextScissors[1] = isUpScroll ? this.height - nextScissors[0] : this.height * progress;\r\n\t\t\t\t},\r\n\t\t\t\tonComplete: () => {\r\n\t\t\t\t\tthis.sections[state.currentScetionIndex].visible = false;\r\n\t\t\t\t\tstate.currentScetionIndex = state.nextSectionIndex;\r\n\t\t\t\t\tstate.nextSectionIndex = null;\r\n\t\t\t\t\tstate.visibleSections = [state.currentScetionIndex];\r\n\t\t\t\t\tthis.isSectionChanging = false;\r\n\t\t\t\t\tcurScissors[0] = 0;\r\n\t\t\t\t\tcurScissors[1] = this.height;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t);\r\n\t}\r\n\r\n\tresize(width, height) {\r\n\t\tthis.width = width;\r\n\t\tthis.height = height;\r\n\t\tlet dpr = this.renderer.getPixelRatio();\r\n\t\tthis.camera.aspect = width / height;\r\n\t\tthis.camera.updateProjectionMatrix();\r\n\t\tthis.sections.forEach(section => {\r\n\t\t\tsection.resize(width, height, dpr);\r\n\t\t});\r\n\r\n\t\tconst pixelWidth = width * dpr;\r\n\t\tconst pixelHeight = height * dpr;\r\n\t\tthis.targets.forEach(target => {\r\n\t\t\tlet renderTarget = target.target;\r\n\t\t\trenderTarget.setSize(pixelWidth, pixelHeight);\r\n\t\t});\r\n\t\tthis.postRenderTarget.setSize(pixelWidth, pixelHeight);\r\n\t}\r\n\r\n\tupdate() {\r\n\t\tlet deltaTime = this.clock.getDelta();\r\n\t\tlet { dpr, width, height, renderer, scene, orthoCamera } = this;\r\n\t\t// Clear before rendering\r\n\t\tthis.targets.forEach(target => {\r\n\t\t\tthis.renderer.setRenderTarget(target.target);\r\n\t\t\tthis.renderer.clear();\r\n\t\t});\r\n\t\t// Render each sections scene to quad\r\n\t\tthis.state.visibleSections.forEach((item, index) => {\r\n\t\t\tlet section = this.sections[item];\r\n\t\t\tif (section.render) {\r\n\t\t\t\tlet scissor = this.state.scissors[index];\r\n\t\t\t\tlet scissorY = scissor[0];\r\n\t\t\t\tlet scissorHeight = scissor[1];\r\n\r\n\t\t\t\tlet target = this.targets[index];\r\n\t\t\t\tlet renderTarget = target.target;\r\n\t\t\t\tlet quad = target.quad;\r\n\r\n\t\t\t\tif(this.isSectionChanging){\r\n\t\t\t\t\trenderTarget.scissorTest = true;\r\n\t\t\t\t\t// From left corner\r\n\t\t\t\t\trenderTarget.scissor.set(0, scissorY * dpr, width * dpr, scissorHeight * dpr);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tquad.material = section.postProcessingMaterial;\r\n\t\t\t\tquad.material.map = renderTarget.texture;\r\n\r\n\t\t\t\trenderer.setRenderTarget(renderTarget);\r\n\t\t\t\tsection.render({\r\n\t\t\t\t\trenderer,\r\n\t\t\t\t\torthoCamera,\r\n\t\t\t\t\ttarget: renderTarget,\r\n\t\t\t\t\tdeltaTime\r\n\t\t\t\t});\r\n\t\t\t\trenderTarget.scissorTest = false;\r\n\t\t\t}\r\n\t\t});\r\n\t\t// Render quads\r\n\t\tthis.orthoCamera.layers.set(0);\r\n\t\tthis.renderer.setRenderTarget(null);\r\n\t\tthis.renderer.clear();\r\n\t\tthis.renderer.render(this.scene, this.orthoCamera);\r\n\t}\r\n}\r\n","/**\r\n * @author Rich Tibbett / https://github.com/richtr\r\n * @author mrdoob / http://mrdoob.com/\r\n * @author Tony Parisi / http://www.tonyparisi.com/\r\n * @author Takahiro / https://github.com/takahirox\r\n * @author Don McCurdy / https://www.donmccurdy.com\r\n */\r\n\r\nimport {\r\n\tAnimationClip,\r\n\tBone,\r\n\tBox3,\r\n\tBufferAttribute,\r\n\tBufferGeometry,\r\n\tClampToEdgeWrapping,\r\n\tColor,\r\n\tDirectionalLight,\r\n\tDoubleSide,\r\n\tFileLoader,\r\n\tFrontSide,\r\n\tGroup,\r\n\tInterleavedBuffer,\r\n\tInterleavedBufferAttribute,\r\n\tInterpolant,\r\n\tInterpolateDiscrete,\r\n\tInterpolateLinear,\r\n\tLine,\r\n\tLineBasicMaterial,\r\n\tLineLoop,\r\n\tLineSegments,\r\n\tLinearFilter,\r\n\tLinearMipmapLinearFilter,\r\n\tLinearMipmapNearestFilter,\r\n\tLoader,\r\n\tLoaderUtils,\r\n\tMaterial,\r\n\tMathUtils,\r\n\tMatrix4,\r\n\tMesh,\r\n\tMeshBasicMaterial,\r\n\tMeshStandardMaterial,\r\n\tMirroredRepeatWrapping,\r\n\tNearestFilter,\r\n\tNearestMipmapLinearFilter,\r\n\tNearestMipmapNearestFilter,\r\n\tNumberKeyframeTrack,\r\n\tObject3D,\r\n\tOrthographicCamera,\r\n\tPerspectiveCamera,\r\n\tPointLight,\r\n\tPoints,\r\n\tPointsMaterial,\r\n\tPropertyBinding,\r\n\tQuaternionKeyframeTrack,\r\n\tRGBAFormat,\r\n\tRGBFormat,\r\n\tRepeatWrapping,\r\n\tScene,\r\n\tSkeleton,\r\n\tSkinnedMesh,\r\n\tSphere,\r\n\tSpotLight,\r\n\tTangentSpaceNormalMap,\r\n\tTextureLoader,\r\n\tTriangleFanDrawMode,\r\n\tTriangleStripDrawMode,\r\n\tVector2,\r\n\tVector3,\r\n\tVectorKeyframeTrack,\r\n\tVertexColors,\r\n\tsRGBEncoding\r\n} from 'three';\r\n\r\nvar GLTFLoader = (function () {\r\n\tfunction GLTFLoader(manager) {\r\n\t\tLoader.call(this, manager);\r\n\r\n\t\tthis.dracoLoader = null;\r\n\t\tthis.ddsLoader = null;\r\n\t}\r\n\r\n\tGLTFLoader.prototype = Object.assign(Object.create(Loader.prototype), {\r\n\t\tconstructor: GLTFLoader,\r\n\r\n\t\tload: function (url, onLoad, onProgress, onError) {\r\n\t\t\tvar scope = this;\r\n\r\n\t\t\tvar resourcePath;\r\n\r\n\t\t\tif (this.resourcePath !== '') {\r\n\t\t\t\tresourcePath = this.resourcePath;\r\n\t\t\t} else if (this.path !== '') {\r\n\t\t\t\tresourcePath = this.path;\r\n\t\t\t} else {\r\n\t\t\t\tresourcePath = LoaderUtils.extractUrlBase(url);\r\n\t\t\t}\r\n\r\n\t\t\t// Tells the LoadingManager to track an extra item, which resolves after\r\n\t\t\t// the model is fully loaded. This means the count of items loaded will\r\n\t\t\t// be incorrect, but ensures manager.onLoad() does not fire early.\r\n\t\t\tscope.manager.itemStart(url);\r\n\r\n\t\t\tvar _onError = function (e) {\r\n\t\t\t\tif (onError) {\r\n\t\t\t\t\tonError(e);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tconsole.error(e);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tscope.manager.itemError(url);\r\n\t\t\t\tscope.manager.itemEnd(url);\r\n\t\t\t};\r\n\r\n\t\t\tvar loader = new FileLoader(scope.manager);\r\n\r\n\t\t\tloader.setPath(this.path);\r\n\t\t\tloader.setResponseType('arraybuffer');\r\n\r\n\t\t\tif (scope.crossOrigin === 'use-credentials') {\r\n\t\t\t\tloader.setWithCredentials(true);\r\n\t\t\t}\r\n\r\n\t\t\tloader.load(\r\n\t\t\t\turl,\r\n\t\t\t\tfunction (data) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tscope.parse(\r\n\t\t\t\t\t\t\tdata,\r\n\t\t\t\t\t\t\tresourcePath,\r\n\t\t\t\t\t\t\tfunction (gltf) {\r\n\t\t\t\t\t\t\t\tonLoad(gltf);\r\n\r\n\t\t\t\t\t\t\t\tscope.manager.itemEnd(url);\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t_onError\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\t_onError(e);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\tonProgress,\r\n\t\t\t\t_onError\r\n\t\t\t);\r\n\t\t},\r\n\r\n\t\tsetDRACOLoader: function (dracoLoader) {\r\n\t\t\tthis.dracoLoader = dracoLoader;\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tsetDDSLoader: function (ddsLoader) {\r\n\t\t\tthis.ddsLoader = ddsLoader;\r\n\t\t\treturn this;\r\n\t\t},\r\n\r\n\t\tparse: function (data, path, onLoad, onError) {\r\n\t\t\tvar content;\r\n\t\t\tvar extensions = {};\r\n\r\n\t\t\tif (typeof data === 'string') {\r\n\t\t\t\tcontent = data;\r\n\t\t\t} else {\r\n\t\t\t\tvar magic = LoaderUtils.decodeText(new Uint8Array(data, 0, 4));\r\n\r\n\t\t\t\tif (magic === BINARY_EXTENSION_HEADER_MAGIC) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\textensions[EXTENSIONS.KHR_BINARY_GLTF] = new GLTFBinaryExtension(data);\r\n\t\t\t\t\t} catch (error) {\r\n\t\t\t\t\t\tif (onError) onError(error);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tcontent = extensions[EXTENSIONS.KHR_BINARY_GLTF].content;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tcontent = LoaderUtils.decodeText(new Uint8Array(data));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar json = JSON.parse(content);\r\n\r\n\t\t\tif (json.asset === undefined || json.asset.version[0] < 2) {\r\n\t\t\t\tif (onError)\r\n\t\t\t\t\tonError(new Error('THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.'));\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tif (json.extensionsUsed) {\r\n\t\t\t\tfor (var i = 0; i < json.extensionsUsed.length; ++i) {\r\n\t\t\t\t\tvar extensionName = json.extensionsUsed[i];\r\n\t\t\t\t\tvar extensionsRequired = json.extensionsRequired || [];\r\n\r\n\t\t\t\t\tswitch (extensionName) {\r\n\t\t\t\t\t\tcase EXTENSIONS.KHR_LIGHTS_PUNCTUAL:\r\n\t\t\t\t\t\t\textensions[extensionName] = new GLTFLightsExtension(json);\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase EXTENSIONS.KHR_MATERIALS_UNLIT:\r\n\t\t\t\t\t\t\textensions[extensionName] = new GLTFMaterialsUnlitExtension();\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:\r\n\t\t\t\t\t\t\textensions[extensionName] = new GLTFMaterialsPbrSpecularGlossinessExtension();\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase EXTENSIONS.KHR_DRACO_MESH_COMPRESSION:\r\n\t\t\t\t\t\t\textensions[extensionName] = new GLTFDracoMeshCompressionExtension(json, this.dracoLoader);\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase EXTENSIONS.MSFT_TEXTURE_DDS:\r\n\t\t\t\t\t\t\textensions[extensionName] = new GLTFTextureDDSExtension(this.ddsLoader);\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase EXTENSIONS.KHR_TEXTURE_TRANSFORM:\r\n\t\t\t\t\t\t\textensions[extensionName] = new GLTFTextureTransformExtension();\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tcase EXTENSIONS.KHR_MESH_QUANTIZATION:\r\n\t\t\t\t\t\t\textensions[extensionName] = new GLTFMeshQuantizationExtension();\r\n\t\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\t\tdefault:\r\n\t\t\t\t\t\t\tif (extensionsRequired.indexOf(extensionName) >= 0) {\r\n\t\t\t\t\t\t\t\tconsole.warn('THREE.GLTFLoader: Unknown extension \"' + extensionName + '\".');\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar parser = new GLTFParser(json, extensions, {\r\n\t\t\t\tpath: path || this.resourcePath || '',\r\n\t\t\t\tcrossOrigin: this.crossOrigin,\r\n\t\t\t\tmanager: this.manager\r\n\t\t\t});\r\n\r\n\t\t\tparser.parse(onLoad, onError);\r\n\t\t}\r\n\t});\r\n\r\n\t/* GLTFREGISTRY */\r\n\r\n\tfunction GLTFRegistry() {\r\n\t\tvar objects = {};\r\n\r\n\t\treturn {\r\n\t\t\tget: function (key) {\r\n\t\t\t\treturn objects[key];\r\n\t\t\t},\r\n\r\n\t\t\tadd: function (key, object) {\r\n\t\t\t\tobjects[key] = object;\r\n\t\t\t},\r\n\r\n\t\t\tremove: function (key) {\r\n\t\t\t\tdelete objects[key];\r\n\t\t\t},\r\n\r\n\t\t\tremoveAll: function () {\r\n\t\t\t\tobjects = {};\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\t/*********************************/\r\n\t/********** EXTENSIONS ***********/\r\n\t/*********************************/\r\n\r\n\tvar EXTENSIONS = {\r\n\t\tKHR_BINARY_GLTF: 'KHR_binary_glTF',\r\n\t\tKHR_DRACO_MESH_COMPRESSION: 'KHR_draco_mesh_compression',\r\n\t\tKHR_LIGHTS_PUNCTUAL: 'KHR_lights_punctual',\r\n\t\tKHR_MATERIALS_PBR_SPECULAR_GLOSSINESS: 'KHR_materials_pbrSpecularGlossiness',\r\n\t\tKHR_MATERIALS_UNLIT: 'KHR_materials_unlit',\r\n\t\tKHR_TEXTURE_TRANSFORM: 'KHR_texture_transform',\r\n\t\tKHR_MESH_QUANTIZATION: 'KHR_mesh_quantization',\r\n\t\tMSFT_TEXTURE_DDS: 'MSFT_texture_dds'\r\n\t};\r\n\r\n\t/**\r\n\t * DDS Texture Extension\r\n\t *\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/MSFT_texture_dds\r\n\t *\r\n\t */\r\n\tfunction GLTFTextureDDSExtension(ddsLoader) {\r\n\t\tif (!ddsLoader) {\r\n\t\t\tthrow new Error('THREE.GLTFLoader: Attempting to load .dds texture without importing DDSLoader');\r\n\t\t}\r\n\r\n\t\tthis.name = EXTENSIONS.MSFT_TEXTURE_DDS;\r\n\t\tthis.ddsLoader = ddsLoader;\r\n\t}\r\n\r\n\t/**\r\n\t * Punctual Lights Extension\r\n\t *\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_lights_punctual\r\n\t */\r\n\tfunction GLTFLightsExtension(json) {\r\n\t\tthis.name = EXTENSIONS.KHR_LIGHTS_PUNCTUAL;\r\n\r\n\t\tvar extension = (json.extensions && json.extensions[EXTENSIONS.KHR_LIGHTS_PUNCTUAL]) || {};\r\n\t\tthis.lightDefs = extension.lights || [];\r\n\t}\r\n\r\n\tGLTFLightsExtension.prototype.loadLight = function (lightIndex) {\r\n\t\tvar lightDef = this.lightDefs[lightIndex];\r\n\t\tvar lightNode;\r\n\r\n\t\tvar color = new Color(0xffffff);\r\n\t\tif (lightDef.color !== undefined) color.fromArray(lightDef.color);\r\n\r\n\t\tvar range = lightDef.range !== undefined ? lightDef.range : 0;\r\n\r\n\t\tswitch (lightDef.type) {\r\n\t\t\tcase 'directional':\r\n\t\t\t\tlightNode = new DirectionalLight(color);\r\n\t\t\t\tlightNode.target.position.set(0, 0, -1);\r\n\t\t\t\tlightNode.add(lightNode.target);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'point':\r\n\t\t\t\tlightNode = new PointLight(color);\r\n\t\t\t\tlightNode.distance = range;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 'spot':\r\n\t\t\t\tlightNode = new SpotLight(color);\r\n\t\t\t\tlightNode.distance = range;\r\n\t\t\t\t// Handle spotlight properties.\r\n\t\t\t\tlightDef.spot = lightDef.spot || {};\r\n\t\t\t\tlightDef.spot.innerConeAngle =\r\n\t\t\t\t\tlightDef.spot.innerConeAngle !== undefined ? lightDef.spot.innerConeAngle : 0;\r\n\t\t\t\tlightDef.spot.outerConeAngle =\r\n\t\t\t\t\tlightDef.spot.outerConeAngle !== undefined ? lightDef.spot.outerConeAngle : Math.PI / 4.0;\r\n\t\t\t\tlightNode.angle = lightDef.spot.outerConeAngle;\r\n\t\t\t\tlightNode.penumbra = 1.0 - lightDef.spot.innerConeAngle / lightDef.spot.outerConeAngle;\r\n\t\t\t\tlightNode.target.position.set(0, 0, -1);\r\n\t\t\t\tlightNode.add(lightNode.target);\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\tthrow new Error('THREE.GLTFLoader: Unexpected light type, \"' + lightDef.type + '\".');\r\n\t\t}\r\n\r\n\t\t// Some lights (e.g. spot) default to a position other than the origin. Reset the position\r\n\t\t// here, because node-level parsing will only override position if explicitly specified.\r\n\t\tlightNode.position.set(0, 0, 0);\r\n\r\n\t\tlightNode.decay = 2;\r\n\r\n\t\tif (lightDef.intensity !== undefined) lightNode.intensity = lightDef.intensity;\r\n\r\n\t\tlightNode.name = lightDef.name || 'light_' + lightIndex;\r\n\r\n\t\treturn Promise.resolve(lightNode);\r\n\t};\r\n\r\n\t/**\r\n\t * Unlit Materials Extension\r\n\t *\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_unlit\r\n\t */\r\n\tfunction GLTFMaterialsUnlitExtension() {\r\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_UNLIT;\r\n\t}\r\n\r\n\tGLTFMaterialsUnlitExtension.prototype.getMaterialType = function () {\r\n\t\treturn MeshBasicMaterial;\r\n\t};\r\n\r\n\tGLTFMaterialsUnlitExtension.prototype.extendParams = function (materialParams, materialDef, parser) {\r\n\t\tvar pending = [];\r\n\r\n\t\tmaterialParams.color = new Color(1.0, 1.0, 1.0);\r\n\t\tmaterialParams.opacity = 1.0;\r\n\r\n\t\tvar metallicRoughness = materialDef.pbrMetallicRoughness;\r\n\r\n\t\tif (metallicRoughness) {\r\n\t\t\tif (Array.isArray(metallicRoughness.baseColorFactor)) {\r\n\t\t\t\tvar array = metallicRoughness.baseColorFactor;\r\n\r\n\t\t\t\tmaterialParams.color.fromArray(array);\r\n\t\t\t\tmaterialParams.opacity = array[3];\r\n\t\t\t}\r\n\r\n\t\t\tif (metallicRoughness.baseColorTexture !== undefined) {\r\n\t\t\t\tpending.push(parser.assignTexture(materialParams, 'map', metallicRoughness.baseColorTexture));\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn Promise.all(pending);\r\n\t};\r\n\r\n\t/* BINARY EXTENSION */\r\n\tvar BINARY_EXTENSION_HEADER_MAGIC = 'glTF';\r\n\tvar BINARY_EXTENSION_HEADER_LENGTH = 12;\r\n\tvar BINARY_EXTENSION_CHUNK_TYPES = { JSON: 0x4e4f534a, BIN: 0x004e4942 };\r\n\r\n\tfunction GLTFBinaryExtension(data) {\r\n\t\tthis.name = EXTENSIONS.KHR_BINARY_GLTF;\r\n\t\tthis.content = null;\r\n\t\tthis.body = null;\r\n\r\n\t\tvar headerView = new DataView(data, 0, BINARY_EXTENSION_HEADER_LENGTH);\r\n\r\n\t\tthis.header = {\r\n\t\t\tmagic: LoaderUtils.decodeText(new Uint8Array(data.slice(0, 4))),\r\n\t\t\tversion: headerView.getUint32(4, true),\r\n\t\t\tlength: headerView.getUint32(8, true)\r\n\t\t};\r\n\r\n\t\tif (this.header.magic !== BINARY_EXTENSION_HEADER_MAGIC) {\r\n\t\t\tthrow new Error('THREE.GLTFLoader: Unsupported glTF-Binary header.');\r\n\t\t} else if (this.header.version < 2.0) {\r\n\t\t\tthrow new Error('THREE.GLTFLoader: Legacy binary file detected.');\r\n\t\t}\r\n\r\n\t\tvar chunkView = new DataView(data, BINARY_EXTENSION_HEADER_LENGTH);\r\n\t\tvar chunkIndex = 0;\r\n\r\n\t\twhile (chunkIndex < chunkView.byteLength) {\r\n\t\t\tvar chunkLength = chunkView.getUint32(chunkIndex, true);\r\n\t\t\tchunkIndex += 4;\r\n\r\n\t\t\tvar chunkType = chunkView.getUint32(chunkIndex, true);\r\n\t\t\tchunkIndex += 4;\r\n\r\n\t\t\tif (chunkType === BINARY_EXTENSION_CHUNK_TYPES.JSON) {\r\n\t\t\t\tvar contentArray = new Uint8Array(data, BINARY_EXTENSION_HEADER_LENGTH + chunkIndex, chunkLength);\r\n\t\t\t\tthis.content = LoaderUtils.decodeText(contentArray);\r\n\t\t\t} else if (chunkType === BINARY_EXTENSION_CHUNK_TYPES.BIN) {\r\n\t\t\t\tvar byteOffset = BINARY_EXTENSION_HEADER_LENGTH + chunkIndex;\r\n\t\t\t\tthis.body = data.slice(byteOffset, byteOffset + chunkLength);\r\n\t\t\t}\r\n\r\n\t\t\t// Clients must ignore chunks with unknown types.\r\n\r\n\t\t\tchunkIndex += chunkLength;\r\n\t\t}\r\n\r\n\t\tif (this.content === null) {\r\n\t\t\tthrow new Error('THREE.GLTFLoader: JSON content not found.');\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * DRACO Mesh Compression Extension\r\n\t *\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_draco_mesh_compression\r\n\t */\r\n\tfunction GLTFDracoMeshCompressionExtension(json, dracoLoader) {\r\n\t\tif (!dracoLoader) {\r\n\t\t\tthrow new Error('THREE.GLTFLoader: No DRACOLoader instance provided.');\r\n\t\t}\r\n\r\n\t\tthis.name = EXTENSIONS.KHR_DRACO_MESH_COMPRESSION;\r\n\t\tthis.json = json;\r\n\t\tthis.dracoLoader = dracoLoader;\r\n\t\tthis.dracoLoader.preload();\r\n\t}\r\n\r\n\tGLTFDracoMeshCompressionExtension.prototype.decodePrimitive = function (primitive, parser) {\r\n\t\tvar json = this.json;\r\n\t\tvar dracoLoader = this.dracoLoader;\r\n\t\tvar bufferViewIndex = primitive.extensions[this.name].bufferView;\r\n\t\tvar gltfAttributeMap = primitive.extensions[this.name].attributes;\r\n\t\tvar threeAttributeMap = {};\r\n\t\tvar attributeNormalizedMap = {};\r\n\t\tvar attributeTypeMap = {};\r\n\r\n\t\tfor (var attributeName in gltfAttributeMap) {\r\n\t\t\tvar threeAttributeName = ATTRIBUTES[attributeName] || attributeName.toLowerCase();\r\n\r\n\t\t\tthreeAttributeMap[threeAttributeName] = gltfAttributeMap[attributeName];\r\n\t\t}\r\n\r\n\t\tfor (attributeName in primitive.attributes) {\r\n\t\t\tvar threeAttributeName = ATTRIBUTES[attributeName] || attributeName.toLowerCase();\r\n\r\n\t\t\tif (gltfAttributeMap[attributeName] !== undefined) {\r\n\t\t\t\tvar accessorDef = json.accessors[primitive.attributes[attributeName]];\r\n\t\t\t\tvar componentType = WEBGL_COMPONENT_TYPES[accessorDef.componentType];\r\n\r\n\t\t\t\tattributeTypeMap[threeAttributeName] = componentType;\r\n\t\t\t\tattributeNormalizedMap[threeAttributeName] = accessorDef.normalized === true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn parser.getDependency('bufferView', bufferViewIndex).then(function (bufferView) {\r\n\t\t\treturn new Promise(function (resolve) {\r\n\t\t\t\tdracoLoader.decodeDracoFile(\r\n\t\t\t\t\tbufferView,\r\n\t\t\t\t\tfunction (geometry) {\r\n\t\t\t\t\t\tfor (var attributeName in geometry.attributes) {\r\n\t\t\t\t\t\t\tvar attribute = geometry.attributes[attributeName];\r\n\t\t\t\t\t\t\tvar normalized = attributeNormalizedMap[attributeName];\r\n\r\n\t\t\t\t\t\t\tif (normalized !== undefined) attribute.normalized = normalized;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tresolve(geometry);\r\n\t\t\t\t\t},\r\n\t\t\t\t\tthreeAttributeMap,\r\n\t\t\t\t\tattributeTypeMap\r\n\t\t\t\t);\r\n\t\t\t});\r\n\t\t});\r\n\t};\r\n\r\n\t/**\r\n\t * Texture Transform Extension\r\n\t *\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_texture_transform\r\n\t */\r\n\tfunction GLTFTextureTransformExtension() {\r\n\t\tthis.name = EXTENSIONS.KHR_TEXTURE_TRANSFORM;\r\n\t}\r\n\r\n\tGLTFTextureTransformExtension.prototype.extendTexture = function (texture, transform) {\r\n\t\ttexture = texture.clone();\r\n\r\n\t\tif (transform.offset !== undefined) {\r\n\t\t\ttexture.offset.fromArray(transform.offset);\r\n\t\t}\r\n\r\n\t\tif (transform.rotation !== undefined) {\r\n\t\t\ttexture.rotation = transform.rotation;\r\n\t\t}\r\n\r\n\t\tif (transform.scale !== undefined) {\r\n\t\t\ttexture.repeat.fromArray(transform.scale);\r\n\t\t}\r\n\r\n\t\tif (transform.texCoord !== undefined) {\r\n\t\t\tconsole.warn('THREE.GLTFLoader: Custom UV sets in \"' + this.name + '\" extension not yet supported.');\r\n\t\t}\r\n\r\n\t\ttexture.needsUpdate = true;\r\n\r\n\t\treturn texture;\r\n\t};\r\n\r\n\t/**\r\n\t * Specular-Glossiness Extension\r\n\t *\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_pbrSpecularGlossiness\r\n\t */\r\n\r\n\t/**\r\n\t * A sub class of StandardMaterial with some of the functionality\r\n\t * changed via the `onBeforeCompile` callback\r\n\t * @pailhead\r\n\t */\r\n\r\n\tfunction GLTFMeshStandardSGMaterial(params) {\r\n\t\tMeshStandardMaterial.call(this);\r\n\r\n\t\tthis.isGLTFSpecularGlossinessMaterial = true;\r\n\r\n\t\t//various chunks that need replacing\r\n\t\tvar specularMapParsFragmentChunk = ['#ifdef USE_SPECULARMAP', '\tuniform sampler2D specularMap;', '#endif'].join(\r\n\t\t\t'\\n'\r\n\t\t);\r\n\r\n\t\tvar glossinessMapParsFragmentChunk = [\r\n\t\t\t'#ifdef USE_GLOSSINESSMAP',\r\n\t\t\t'\tuniform sampler2D glossinessMap;',\r\n\t\t\t'#endif'\r\n\t\t].join('\\n');\r\n\r\n\t\tvar specularMapFragmentChunk = [\r\n\t\t\t'vec3 specularFactor = specular;',\r\n\t\t\t'#ifdef USE_SPECULARMAP',\r\n\t\t\t'\tvec4 texelSpecular = texture2D( specularMap, vUv );',\r\n\t\t\t'\ttexelSpecular = sRGBToLinear( texelSpecular );',\r\n\t\t\t'\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture',\r\n\t\t\t'\tspecularFactor *= texelSpecular.rgb;',\r\n\t\t\t'#endif'\r\n\t\t].join('\\n');\r\n\r\n\t\tvar glossinessMapFragmentChunk = [\r\n\t\t\t'float glossinessFactor = glossiness;',\r\n\t\t\t'#ifdef USE_GLOSSINESSMAP',\r\n\t\t\t'\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );',\r\n\t\t\t'\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture',\r\n\t\t\t'\tglossinessFactor *= texelGlossiness.a;',\r\n\t\t\t'#endif'\r\n\t\t].join('\\n');\r\n\r\n\t\tvar lightPhysicalFragmentChunk = [\r\n\t\t\t'PhysicalMaterial material;',\r\n\t\t\t'material.diffuseColor = diffuseColor.rgb;',\r\n\t\t\t'vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );',\r\n\t\t\t'float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );',\r\n\t\t\t'material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.',\r\n\t\t\t'material.specularRoughness += geometryRoughness;',\r\n\t\t\t'material.specularRoughness = min( material.specularRoughness, 1.0 );',\r\n\t\t\t'material.specularColor = specularFactor.rgb;'\r\n\t\t].join('\\n');\r\n\r\n\t\tvar uniforms = {\r\n\t\t\tspecular: { value: new Color().setHex(0xffffff) },\r\n\t\t\tglossiness: { value: 1 },\r\n\t\t\tspecularMap: { value: null },\r\n\t\t\tglossinessMap: { value: null }\r\n\t\t};\r\n\r\n\t\tthis._extraUniforms = uniforms;\r\n\r\n\t\t// please see #14031 or #13198 for an alternate approach\r\n\t\tthis.onBeforeCompile = function (shader) {\r\n\t\t\tfor (var uniformName in uniforms) {\r\n\t\t\t\tshader.uniforms[uniformName] = uniforms[uniformName];\r\n\t\t\t}\r\n\r\n\t\t\tshader.fragmentShader = shader.fragmentShader.replace('uniform float roughness;', 'uniform vec3 specular;');\r\n\t\t\tshader.fragmentShader = shader.fragmentShader.replace(\r\n\t\t\t\t'uniform float metalness;',\r\n\t\t\t\t'uniform float glossiness;'\r\n\t\t\t);\r\n\t\t\tshader.fragmentShader = shader.fragmentShader.replace(\r\n\t\t\t\t'#include <roughnessmap_pars_fragment>',\r\n\t\t\t\tspecularMapParsFragmentChunk\r\n\t\t\t);\r\n\t\t\tshader.fragmentShader = shader.fragmentShader.replace(\r\n\t\t\t\t'#include <metalnessmap_pars_fragment>',\r\n\t\t\t\tglossinessMapParsFragmentChunk\r\n\t\t\t);\r\n\t\t\tshader.fragmentShader = shader.fragmentShader.replace(\r\n\t\t\t\t'#include <roughnessmap_fragment>',\r\n\t\t\t\tspecularMapFragmentChunk\r\n\t\t\t);\r\n\t\t\tshader.fragmentShader = shader.fragmentShader.replace(\r\n\t\t\t\t'#include <metalnessmap_fragment>',\r\n\t\t\t\tglossinessMapFragmentChunk\r\n\t\t\t);\r\n\t\t\tshader.fragmentShader = shader.fragmentShader.replace(\r\n\t\t\t\t'#include <lights_physical_fragment>',\r\n\t\t\t\tlightPhysicalFragmentChunk\r\n\t\t\t);\r\n\t\t};\r\n\r\n\t\t/*eslint-disable*/\r\n\t\tObject.defineProperties(this, {\r\n\t\t\tspecular: {\r\n\t\t\t\tget: function () {\r\n\t\t\t\t\treturn uniforms.specular.value;\r\n\t\t\t\t},\r\n\t\t\t\tset: function (v) {\r\n\t\t\t\t\tuniforms.specular.value = v;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tspecularMap: {\r\n\t\t\t\tget: function () {\r\n\t\t\t\t\treturn uniforms.specularMap.value;\r\n\t\t\t\t},\r\n\t\t\t\tset: function (v) {\r\n\t\t\t\t\tuniforms.specularMap.value = v;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tglossiness: {\r\n\t\t\t\tget: function () {\r\n\t\t\t\t\treturn uniforms.glossiness.value;\r\n\t\t\t\t},\r\n\t\t\t\tset: function (v) {\r\n\t\t\t\t\tuniforms.glossiness.value = v;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tglossinessMap: {\r\n\t\t\t\tget: function () {\r\n\t\t\t\t\treturn uniforms.glossinessMap.value;\r\n\t\t\t\t},\r\n\t\t\t\tset: function (v) {\r\n\t\t\t\t\tuniforms.glossinessMap.value = v;\r\n\t\t\t\t\t//how about something like this - @pailhead\r\n\t\t\t\t\tif (v) {\r\n\t\t\t\t\t\tthis.defines.USE_GLOSSINESSMAP = '';\r\n\t\t\t\t\t\t// set USE_ROUGHNESSMAP to enable vUv\r\n\t\t\t\t\t\tthis.defines.USE_ROUGHNESSMAP = '';\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tdelete this.defines.USE_ROUGHNESSMAP;\r\n\t\t\t\t\t\tdelete this.defines.USE_GLOSSINESSMAP;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t/*eslint-enable*/\r\n\t\tdelete this.metalness;\r\n\t\tdelete this.roughness;\r\n\t\tdelete this.metalnessMap;\r\n\t\tdelete this.roughnessMap;\r\n\r\n\t\tthis.setValues(params);\r\n\t}\r\n\r\n\tGLTFMeshStandardSGMaterial.prototype = Object.create(MeshStandardMaterial.prototype);\r\n\tGLTFMeshStandardSGMaterial.prototype.constructor = GLTFMeshStandardSGMaterial;\r\n\r\n\tGLTFMeshStandardSGMaterial.prototype.copy = function (source) {\r\n\t\tMeshStandardMaterial.prototype.copy.call(this, source);\r\n\t\tthis.specularMap = source.specularMap;\r\n\t\tthis.specular.copy(source.specular);\r\n\t\tthis.glossinessMap = source.glossinessMap;\r\n\t\tthis.glossiness = source.glossiness;\r\n\t\tdelete this.metalness;\r\n\t\tdelete this.roughness;\r\n\t\tdelete this.metalnessMap;\r\n\t\tdelete this.roughnessMap;\r\n\t\treturn this;\r\n\t};\r\n\r\n\tfunction GLTFMaterialsPbrSpecularGlossinessExtension() {\r\n\t\treturn {\r\n\t\t\tname: EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,\r\n\r\n\t\t\tspecularGlossinessParams: [\r\n\t\t\t\t'color',\r\n\t\t\t\t'map',\r\n\t\t\t\t'lightMap',\r\n\t\t\t\t'lightMapIntensity',\r\n\t\t\t\t'aoMap',\r\n\t\t\t\t'aoMapIntensity',\r\n\t\t\t\t'emissive',\r\n\t\t\t\t'emissiveIntensity',\r\n\t\t\t\t'emissiveMap',\r\n\t\t\t\t'bumpMap',\r\n\t\t\t\t'bumpScale',\r\n\t\t\t\t'normalMap',\r\n\t\t\t\t'normalMapType',\r\n\t\t\t\t'displacementMap',\r\n\t\t\t\t'displacementScale',\r\n\t\t\t\t'displacementBias',\r\n\t\t\t\t'specularMap',\r\n\t\t\t\t'specular',\r\n\t\t\t\t'glossinessMap',\r\n\t\t\t\t'glossiness',\r\n\t\t\t\t'alphaMap',\r\n\t\t\t\t'envMap',\r\n\t\t\t\t'envMapIntensity',\r\n\t\t\t\t'refractionRatio'\r\n\t\t\t],\r\n\r\n\t\t\tgetMaterialType: function () {\r\n\t\t\t\treturn GLTFMeshStandardSGMaterial;\r\n\t\t\t},\r\n\r\n\t\t\textendParams: function (materialParams, materialDef, parser) {\r\n\t\t\t\tvar pbrSpecularGlossiness = materialDef.extensions[this.name];\r\n\r\n\t\t\t\tmaterialParams.color = new Color(1.0, 1.0, 1.0);\r\n\t\t\t\tmaterialParams.opacity = 1.0;\r\n\r\n\t\t\t\tvar pending = [];\r\n\r\n\t\t\t\tif (Array.isArray(pbrSpecularGlossiness.diffuseFactor)) {\r\n\t\t\t\t\tvar array = pbrSpecularGlossiness.diffuseFactor;\r\n\r\n\t\t\t\t\tmaterialParams.color.fromArray(array);\r\n\t\t\t\t\tmaterialParams.opacity = array[3];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (pbrSpecularGlossiness.diffuseTexture !== undefined) {\r\n\t\t\t\t\tpending.push(parser.assignTexture(materialParams, 'map', pbrSpecularGlossiness.diffuseTexture));\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmaterialParams.emissive = new Color(0.0, 0.0, 0.0);\r\n\t\t\t\tmaterialParams.glossiness =\r\n\t\t\t\t\tpbrSpecularGlossiness.glossinessFactor !== undefined ? pbrSpecularGlossiness.glossinessFactor : 1.0;\r\n\t\t\t\tmaterialParams.specular = new Color(1.0, 1.0, 1.0);\r\n\r\n\t\t\t\tif (Array.isArray(pbrSpecularGlossiness.specularFactor)) {\r\n\t\t\t\t\tmaterialParams.specular.fromArray(pbrSpecularGlossiness.specularFactor);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (pbrSpecularGlossiness.specularGlossinessTexture !== undefined) {\r\n\t\t\t\t\tvar specGlossMapDef = pbrSpecularGlossiness.specularGlossinessTexture;\r\n\t\t\t\t\tpending.push(parser.assignTexture(materialParams, 'glossinessMap', specGlossMapDef));\r\n\t\t\t\t\tpending.push(parser.assignTexture(materialParams, 'specularMap', specGlossMapDef));\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn Promise.all(pending);\r\n\t\t\t},\r\n\r\n\t\t\tcreateMaterial: function (materialParams) {\r\n\t\t\t\tvar material = new GLTFMeshStandardSGMaterial(materialParams);\r\n\t\t\t\tmaterial.fog = true;\r\n\r\n\t\t\t\tmaterial.color = materialParams.color;\r\n\r\n\t\t\t\tmaterial.map = materialParams.map === undefined ? null : materialParams.map;\r\n\r\n\t\t\t\tmaterial.lightMap = null;\r\n\t\t\t\tmaterial.lightMapIntensity = 1.0;\r\n\r\n\t\t\t\tmaterial.aoMap = materialParams.aoMap === undefined ? null : materialParams.aoMap;\r\n\t\t\t\tmaterial.aoMapIntensity = 1.0;\r\n\r\n\t\t\t\tmaterial.emissive = materialParams.emissive;\r\n\t\t\t\tmaterial.emissiveIntensity = 1.0;\r\n\t\t\t\tmaterial.emissiveMap = materialParams.emissiveMap === undefined ? null : materialParams.emissiveMap;\r\n\r\n\t\t\t\tmaterial.bumpMap = materialParams.bumpMap === undefined ? null : materialParams.bumpMap;\r\n\t\t\t\tmaterial.bumpScale = 1;\r\n\r\n\t\t\t\tmaterial.normalMap = materialParams.normalMap === undefined ? null : materialParams.normalMap;\r\n\t\t\t\tmaterial.normalMapType = TangentSpaceNormalMap;\r\n\r\n\t\t\t\tif (materialParams.normalScale) material.normalScale = materialParams.normalScale;\r\n\r\n\t\t\t\tmaterial.displacementMap = null;\r\n\t\t\t\tmaterial.displacementScale = 1;\r\n\t\t\t\tmaterial.displacementBias = 0;\r\n\r\n\t\t\t\tmaterial.specularMap = materialParams.specularMap === undefined ? null : materialParams.specularMap;\r\n\t\t\t\tmaterial.specular = materialParams.specular;\r\n\r\n\t\t\t\tmaterial.glossinessMap =\r\n\t\t\t\t\tmaterialParams.glossinessMap === undefined ? null : materialParams.glossinessMap;\r\n\t\t\t\tmaterial.glossiness = materialParams.glossiness;\r\n\r\n\t\t\t\tmaterial.alphaMap = null;\r\n\r\n\t\t\t\tmaterial.envMap = materialParams.envMap === undefined ? null : materialParams.envMap;\r\n\t\t\t\tmaterial.envMapIntensity = 1.0;\r\n\r\n\t\t\t\tmaterial.refractionRatio = 0.98;\r\n\r\n\t\t\t\treturn material;\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\t/**\r\n\t * Mesh Quantization Extension\r\n\t *\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_mesh_quantization\r\n\t */\r\n\tfunction GLTFMeshQuantizationExtension() {\r\n\t\tthis.name = EXTENSIONS.KHR_MESH_QUANTIZATION;\r\n\t}\r\n\r\n\t/*********************************/\r\n\t/********** INTERPOLATION ********/\r\n\t/*********************************/\r\n\r\n\t// Spline Interpolation\r\n\t// Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#appendix-c-spline-interpolation\r\n\tfunction GLTFCubicSplineInterpolant(parameterPositions, sampleValues, sampleSize, resultBuffer) {\r\n\t\tInterpolant.call(this, parameterPositions, sampleValues, sampleSize, resultBuffer);\r\n\t}\r\n\r\n\tGLTFCubicSplineInterpolant.prototype = Object.create(Interpolant.prototype);\r\n\tGLTFCubicSplineInterpolant.prototype.constructor = GLTFCubicSplineInterpolant;\r\n\r\n\tGLTFCubicSplineInterpolant.prototype.copySampleValue_ = function (index) {\r\n\t\t// Copies a sample value to the result buffer. See description of glTF\r\n\t\t// CUBICSPLINE values layout in interpolate_() function below.\r\n\r\n\t\tvar result = this.resultBuffer,\r\n\t\t\tvalues = this.sampleValues,\r\n\t\t\tvalueSize = this.valueSize,\r\n\t\t\toffset = index * valueSize * 3 + valueSize;\r\n\r\n\t\tfor (var i = 0; i !== valueSize; i++) {\r\n\t\t\tresult[i] = values[offset + i];\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t};\r\n\r\n\tGLTFCubicSplineInterpolant.prototype.beforeStart_ = GLTFCubicSplineInterpolant.prototype.copySampleValue_;\r\n\r\n\tGLTFCubicSplineInterpolant.prototype.afterEnd_ = GLTFCubicSplineInterpolant.prototype.copySampleValue_;\r\n\r\n\tGLTFCubicSplineInterpolant.prototype.interpolate_ = function (i1, t0, t, t1) {\r\n\t\tvar result = this.resultBuffer;\r\n\t\tvar values = this.sampleValues;\r\n\t\tvar stride = this.valueSize;\r\n\r\n\t\tvar stride2 = stride * 2;\r\n\t\tvar stride3 = stride * 3;\r\n\r\n\t\tvar td = t1 - t0;\r\n\r\n\t\tvar p = (t - t0) / td;\r\n\t\tvar pp = p * p;\r\n\t\tvar ppp = pp * p;\r\n\r\n\t\tvar offset1 = i1 * stride3;\r\n\t\tvar offset0 = offset1 - stride3;\r\n\r\n\t\tvar s2 = -2 * ppp + 3 * pp;\r\n\t\tvar s3 = ppp - pp;\r\n\t\tvar s0 = 1 - s2;\r\n\t\tvar s1 = s3 - pp + p;\r\n\r\n\t\t// Layout of keyframe output values for CUBICSPLINE animations:\r\n\t\t//   [ inTangent_1, splineVertex_1, outTangent_1, inTangent_2, splineVertex_2, ... ]\r\n\t\tfor (var i = 0; i !== stride; i++) {\r\n\t\t\tvar p0 = values[offset0 + i + stride]; // splineVertex_k\r\n\t\t\tvar m0 = values[offset0 + i + stride2] * td; // outTangent_k * (t_k+1 - t_k)\r\n\t\t\tvar p1 = values[offset1 + i + stride]; // splineVertex_k+1\r\n\t\t\tvar m1 = values[offset1 + i] * td; // inTangent_k+1 * (t_k+1 - t_k)\r\n\r\n\t\t\tresult[i] = s0 * p0 + s1 * m0 + s2 * p1 + s3 * m1;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t};\r\n\r\n\t/*********************************/\r\n\t/********** INTERNALS ************/\r\n\t/*********************************/\r\n\r\n\t/* CONSTANTS */\r\n\r\n\tvar WEBGL_CONSTANTS = {\r\n\t\tFLOAT: 5126,\r\n\t\t//FLOAT_MAT2: 35674,\r\n\t\tFLOAT_MAT3: 35675,\r\n\t\tFLOAT_MAT4: 35676,\r\n\t\tFLOAT_VEC2: 35664,\r\n\t\tFLOAT_VEC3: 35665,\r\n\t\tFLOAT_VEC4: 35666,\r\n\t\tLINEAR: 9729,\r\n\t\tREPEAT: 10497,\r\n\t\tSAMPLER_2D: 35678,\r\n\t\tPOINTS: 0,\r\n\t\tLINES: 1,\r\n\t\tLINE_LOOP: 2,\r\n\t\tLINE_STRIP: 3,\r\n\t\tTRIANGLES: 4,\r\n\t\tTRIANGLE_STRIP: 5,\r\n\t\tTRIANGLE_FAN: 6,\r\n\t\tUNSIGNED_BYTE: 5121,\r\n\t\tUNSIGNED_SHORT: 5123\r\n\t};\r\n\r\n\tvar WEBGL_COMPONENT_TYPES = {\r\n\t\t5120: Int8Array,\r\n\t\t5121: Uint8Array,\r\n\t\t5122: Int16Array,\r\n\t\t5123: Uint16Array,\r\n\t\t5125: Uint32Array,\r\n\t\t5126: Float32Array\r\n\t};\r\n\r\n\tvar WEBGL_FILTERS = {\r\n\t\t9728: NearestFilter,\r\n\t\t9729: LinearFilter,\r\n\t\t9984: NearestMipmapNearestFilter,\r\n\t\t9985: LinearMipmapNearestFilter,\r\n\t\t9986: NearestMipmapLinearFilter,\r\n\t\t9987: LinearMipmapLinearFilter\r\n\t};\r\n\r\n\tvar WEBGL_WRAPPINGS = {\r\n\t\t33071: ClampToEdgeWrapping,\r\n\t\t33648: MirroredRepeatWrapping,\r\n\t\t10497: RepeatWrapping\r\n\t};\r\n\r\n\tvar WEBGL_TYPE_SIZES = {\r\n\t\tSCALAR: 1,\r\n\t\tVEC2: 2,\r\n\t\tVEC3: 3,\r\n\t\tVEC4: 4,\r\n\t\tMAT2: 4,\r\n\t\tMAT3: 9,\r\n\t\tMAT4: 16\r\n\t};\r\n\r\n\tvar ATTRIBUTES = {\r\n\t\tPOSITION: 'position',\r\n\t\tNORMAL: 'normal',\r\n\t\tTANGENT: 'tangent',\r\n\t\tTEXCOORD_0: 'uv',\r\n\t\tTEXCOORD_1: 'uv2',\r\n\t\tCOLOR_0: 'color',\r\n\t\tWEIGHTS_0: 'skinWeight',\r\n\t\tJOINTS_0: 'skinIndex'\r\n\t};\r\n\r\n\tvar PATH_PROPERTIES = {\r\n\t\tscale: 'scale',\r\n\t\ttranslation: 'position',\r\n\t\trotation: 'quaternion',\r\n\t\tweights: 'morphTargetInfluences'\r\n\t};\r\n\r\n\tvar INTERPOLATION = {\r\n\t\tCUBICSPLINE: undefined, // We use a custom interpolant (GLTFCubicSplineInterpolation) for CUBICSPLINE tracks. Each\r\n\t\t// keyframe track will be initialized with a default interpolation type, then modified.\r\n\t\tLINEAR: InterpolateLinear,\r\n\t\tSTEP: InterpolateDiscrete\r\n\t};\r\n\r\n\tvar ALPHA_MODES = {\r\n\t\tOPAQUE: 'OPAQUE',\r\n\t\tMASK: 'MASK',\r\n\t\tBLEND: 'BLEND'\r\n\t};\r\n\r\n\tvar MIME_TYPE_FORMATS = {\r\n\t\t'image/png': RGBAFormat,\r\n\t\t'image/jpeg': RGBFormat\r\n\t};\r\n\r\n\t/* UTILITY FUNCTIONS */\r\n\r\n\tfunction resolveURL(url, path) {\r\n\t\t// Invalid URL\r\n\t\tif (typeof url !== 'string' || url === '') return '';\r\n\r\n\t\t// Host Relative URL\r\n\t\tif (/^https?:\\/\\//i.test(path) && /^\\//.test(url)) {\r\n\t\t\tpath = path.replace(/(^https?:\\/\\/[^\\/]+).*/i, '$1');\r\n\t\t}\r\n\r\n\t\t// Absolute URL http://,https://,//\r\n\t\tif (/^(https?:)?\\/\\//i.test(url)) return url;\r\n\r\n\t\t// Data URI\r\n\t\tif (/^data:.*,.*$/i.test(url)) return url;\r\n\r\n\t\t// Blob URL\r\n\t\tif (/^blob:.*$/i.test(url)) return url;\r\n\r\n\t\t// Relative URL\r\n\t\treturn path + url;\r\n\t}\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#default-material\r\n\t */\r\n\tfunction createDefaultMaterial(cache) {\r\n\t\tif (cache['DefaultMaterial'] === undefined) {\r\n\t\t\tcache['DefaultMaterial'] = new MeshStandardMaterial({\r\n\t\t\t\tcolor: 0xffffff,\r\n\t\t\t\temissive: 0x000000,\r\n\t\t\t\tmetalness: 1,\r\n\t\t\t\troughness: 1,\r\n\t\t\t\ttransparent: false,\r\n\t\t\t\tdepthTest: true,\r\n\t\t\t\tside: FrontSide\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn cache['DefaultMaterial'];\r\n\t}\r\n\r\n\tfunction addUnknownExtensionsToUserData(knownExtensions, object, objectDef) {\r\n\t\t// Add unknown glTF extensions to an object's userData.\r\n\r\n\t\tfor (var name in objectDef.extensions) {\r\n\t\t\tif (knownExtensions[name] === undefined) {\r\n\t\t\t\tobject.userData.gltfExtensions = object.userData.gltfExtensions || {};\r\n\t\t\t\tobject.userData.gltfExtensions[name] = objectDef.extensions[name];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Object3D|Material|BufferGeometry} object\r\n\t * @param {GLTF.definition} gltfDef\r\n\t */\r\n\tfunction assignExtrasToUserData(object, gltfDef) {\r\n\t\tif (gltfDef.extras !== undefined) {\r\n\t\t\tif (typeof gltfDef.extras === 'object') {\r\n\t\t\t\tObject.assign(object.userData, gltfDef.extras);\r\n\t\t\t} else {\r\n\t\t\t\tconsole.warn('THREE.GLTFLoader: Ignoring primitive type .extras, ' + gltfDef.extras);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#morph-targets\r\n\t *\r\n\t * @param {BufferGeometry} geometry\r\n\t * @param {Array<GLTF.Target>} targets\r\n\t * @param {GLTFParser} parser\r\n\t * @return {Promise<BufferGeometry>}\r\n\t */\r\n\tfunction addMorphTargets(geometry, targets, parser) {\r\n\t\tvar hasMorphPosition = false;\r\n\t\tvar hasMorphNormal = false;\r\n\r\n\t\tfor (var i = 0, il = targets.length; i < il; i++) {\r\n\t\t\tvar target = targets[i];\r\n\r\n\t\t\tif (target.POSITION !== undefined) hasMorphPosition = true;\r\n\t\t\tif (target.NORMAL !== undefined) hasMorphNormal = true;\r\n\r\n\t\t\tif (hasMorphPosition && hasMorphNormal) break;\r\n\t\t}\r\n\r\n\t\tif (!hasMorphPosition && !hasMorphNormal) return Promise.resolve(geometry);\r\n\r\n\t\tvar pendingPositionAccessors = [];\r\n\t\tvar pendingNormalAccessors = [];\r\n\r\n\t\tfor (var i = 0, il = targets.length; i < il; i++) {\r\n\t\t\tvar target = targets[i];\r\n\r\n\t\t\tif (hasMorphPosition) {\r\n\t\t\t\tvar pendingAccessor =\r\n\t\t\t\t\ttarget.POSITION !== undefined\r\n\t\t\t\t\t\t? parser.getDependency('accessor', target.POSITION)\r\n\t\t\t\t\t\t: geometry.attributes.position;\r\n\r\n\t\t\t\tpendingPositionAccessors.push(pendingAccessor);\r\n\t\t\t}\r\n\r\n\t\t\tif (hasMorphNormal) {\r\n\t\t\t\tvar pendingAccessor =\r\n\t\t\t\t\ttarget.NORMAL !== undefined\r\n\t\t\t\t\t\t? parser.getDependency('accessor', target.NORMAL)\r\n\t\t\t\t\t\t: geometry.attributes.normal;\r\n\r\n\t\t\t\tpendingNormalAccessors.push(pendingAccessor);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn Promise.all([Promise.all(pendingPositionAccessors), Promise.all(pendingNormalAccessors)]).then(function (\r\n\t\t\taccessors\r\n\t\t) {\r\n\t\t\tvar morphPositions = accessors[0];\r\n\t\t\tvar morphNormals = accessors[1];\r\n\r\n\t\t\tif (hasMorphPosition) geometry.morphAttributes.position = morphPositions;\r\n\t\t\tif (hasMorphNormal) geometry.morphAttributes.normal = morphNormals;\r\n\t\t\tgeometry.morphTargetsRelative = true;\r\n\r\n\t\t\treturn geometry;\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Mesh} mesh\r\n\t * @param {GLTF.Mesh} meshDef\r\n\t */\r\n\tfunction updateMorphTargets(mesh, meshDef) {\r\n\t\tmesh.updateMorphTargets();\r\n\r\n\t\tif (meshDef.weights !== undefined) {\r\n\t\t\tfor (var i = 0, il = meshDef.weights.length; i < il; i++) {\r\n\t\t\t\tmesh.morphTargetInfluences[i] = meshDef.weights[i];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// .extras has user-defined data, so check that .extras.targetNames is an array.\r\n\t\tif (meshDef.extras && Array.isArray(meshDef.extras.targetNames)) {\r\n\t\t\tvar targetNames = meshDef.extras.targetNames;\r\n\r\n\t\t\tif (mesh.morphTargetInfluences.length === targetNames.length) {\r\n\t\t\t\tmesh.morphTargetDictionary = {};\r\n\r\n\t\t\t\tfor (var i = 0, il = targetNames.length; i < il; i++) {\r\n\t\t\t\t\tmesh.morphTargetDictionary[targetNames[i]] = i;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconsole.warn('THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.');\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction createPrimitiveKey(primitiveDef) {\r\n\t\tvar dracoExtension = primitiveDef.extensions && primitiveDef.extensions[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION];\r\n\t\tvar geometryKey;\r\n\r\n\t\tif (dracoExtension) {\r\n\t\t\tgeometryKey =\r\n\t\t\t\t'draco:' +\r\n\t\t\t\tdracoExtension.bufferView +\r\n\t\t\t\t':' +\r\n\t\t\t\tdracoExtension.indices +\r\n\t\t\t\t':' +\r\n\t\t\t\tcreateAttributesKey(dracoExtension.attributes);\r\n\t\t} else {\r\n\t\t\tgeometryKey =\r\n\t\t\t\tprimitiveDef.indices + ':' + createAttributesKey(primitiveDef.attributes) + ':' + primitiveDef.mode;\r\n\t\t}\r\n\r\n\t\treturn geometryKey;\r\n\t}\r\n\r\n\tfunction createAttributesKey(attributes) {\r\n\t\tvar attributesKey = '';\r\n\r\n\t\tvar keys = Object.keys(attributes).sort();\r\n\r\n\t\tfor (var i = 0, il = keys.length; i < il; i++) {\r\n\t\t\tattributesKey += keys[i] + ':' + attributes[keys[i]] + ';';\r\n\t\t}\r\n\r\n\t\treturn attributesKey;\r\n\t}\r\n\r\n\t/* GLTF PARSER */\r\n\r\n\tfunction GLTFParser(json, extensions, options) {\r\n\t\tthis.json = json || {};\r\n\t\tthis.extensions = extensions || {};\r\n\t\tthis.options = options || {};\r\n\r\n\t\t// loader object cache\r\n\t\tthis.cache = new GLTFRegistry();\r\n\r\n\t\t// BufferGeometry caching\r\n\t\tthis.primitiveCache = {};\r\n\r\n\t\tthis.textureLoader = new TextureLoader(this.options.manager);\r\n\t\tthis.textureLoader.setCrossOrigin(this.options.crossOrigin);\r\n\r\n\t\tthis.fileLoader = new FileLoader(this.options.manager);\r\n\t\tthis.fileLoader.setResponseType('arraybuffer');\r\n\r\n\t\tif (this.options.crossOrigin === 'use-credentials') {\r\n\t\t\tthis.fileLoader.setWithCredentials(true);\r\n\t\t}\r\n\t}\r\n\r\n\tGLTFParser.prototype.parse = function (onLoad, onError) {\r\n\t\tvar parser = this;\r\n\t\tvar json = this.json;\r\n\t\tvar extensions = this.extensions;\r\n\r\n\t\t// Clear the loader cache\r\n\t\tthis.cache.removeAll();\r\n\r\n\t\t// Mark the special nodes/meshes in json for efficient parse\r\n\t\tthis.markDefs();\r\n\r\n\t\tPromise.all([this.getDependencies('scene'), this.getDependencies('animation'), this.getDependencies('camera')])\r\n\t\t\t.then(function (dependencies) {\r\n\t\t\t\tvar result = {\r\n\t\t\t\t\tscene: dependencies[0][json.scene || 0],\r\n\t\t\t\t\tscenes: dependencies[0],\r\n\t\t\t\t\tanimations: dependencies[1],\r\n\t\t\t\t\tcameras: dependencies[2],\r\n\t\t\t\t\tasset: json.asset,\r\n\t\t\t\t\tparser: parser,\r\n\t\t\t\t\tuserData: {}\r\n\t\t\t\t};\r\n\r\n\t\t\t\taddUnknownExtensionsToUserData(extensions, result, json);\r\n\r\n\t\t\t\tassignExtrasToUserData(result, json);\r\n\r\n\t\t\t\tonLoad(result);\r\n\t\t\t})\r\n\t\t\t.catch(onError);\r\n\t};\r\n\r\n\t/**\r\n\t * Marks the special nodes/meshes in json for efficient parse.\r\n\t */\r\n\tGLTFParser.prototype.markDefs = function () {\r\n\t\tvar nodeDefs = this.json.nodes || [];\r\n\t\tvar skinDefs = this.json.skins || [];\r\n\t\tvar meshDefs = this.json.meshes || [];\r\n\r\n\t\tvar meshReferences = {};\r\n\t\tvar meshUses = {};\r\n\r\n\t\t// Nothing in the node definition indicates whether it is a Bone or an\r\n\t\t// Object3D. Use the skins' joint references to mark bones.\r\n\t\tfor (var skinIndex = 0, skinLength = skinDefs.length; skinIndex < skinLength; skinIndex++) {\r\n\t\t\tvar joints = skinDefs[skinIndex].joints;\r\n\r\n\t\t\tfor (var i = 0, il = joints.length; i < il; i++) {\r\n\t\t\t\tnodeDefs[joints[i]].isBone = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Meshes can (and should) be reused by multiple nodes in a glTF asset. To\r\n\t\t// avoid having more than one Mesh with the same name, count\r\n\t\t// references and rename instances below.\r\n\t\t//\r\n\t\t// Example: CesiumMilkTruck sample model reuses \"Wheel\" meshes.\r\n\t\tfor (var nodeIndex = 0, nodeLength = nodeDefs.length; nodeIndex < nodeLength; nodeIndex++) {\r\n\t\t\tvar nodeDef = nodeDefs[nodeIndex];\r\n\r\n\t\t\tif (nodeDef.mesh !== undefined) {\r\n\t\t\t\tif (meshReferences[nodeDef.mesh] === undefined) {\r\n\t\t\t\t\tmeshReferences[nodeDef.mesh] = meshUses[nodeDef.mesh] = 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmeshReferences[nodeDef.mesh]++;\r\n\r\n\t\t\t\t// Nothing in the mesh definition indicates whether it is\r\n\t\t\t\t// a SkinnedMesh or Mesh. Use the node's mesh reference\r\n\t\t\t\t// to mark SkinnedMesh if node has skin.\r\n\t\t\t\tif (nodeDef.skin !== undefined) {\r\n\t\t\t\t\tmeshDefs[nodeDef.mesh].isSkinnedMesh = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.json.meshReferences = meshReferences;\r\n\t\tthis.json.meshUses = meshUses;\r\n\t};\r\n\r\n\t/**\r\n\t * Requests the specified dependency asynchronously, with caching.\r\n\t * @param {string} type\r\n\t * @param {number} index\r\n\t * @return {Promise<Object3D|Material|THREE.Texture|AnimationClip|ArrayBuffer|Object>}\r\n\t */\r\n\tGLTFParser.prototype.getDependency = function (type, index) {\r\n\t\tvar cacheKey = type + ':' + index;\r\n\t\tvar dependency = this.cache.get(cacheKey);\r\n\r\n\t\tif (!dependency) {\r\n\t\t\tswitch (type) {\r\n\t\t\t\tcase 'scene':\r\n\t\t\t\t\tdependency = this.loadScene(index);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'node':\r\n\t\t\t\t\tdependency = this.loadNode(index);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'mesh':\r\n\t\t\t\t\tdependency = this.loadMesh(index);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'accessor':\r\n\t\t\t\t\tdependency = this.loadAccessor(index);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'bufferView':\r\n\t\t\t\t\tdependency = this.loadBufferView(index);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'buffer':\r\n\t\t\t\t\tdependency = this.loadBuffer(index);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'material':\r\n\t\t\t\t\tdependency = this.loadMaterial(index);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'texture':\r\n\t\t\t\t\tdependency = this.loadTexture(index);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'skin':\r\n\t\t\t\t\tdependency = this.loadSkin(index);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'animation':\r\n\t\t\t\t\tdependency = this.loadAnimation(index);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'camera':\r\n\t\t\t\t\tdependency = this.loadCamera(index);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'light':\r\n\t\t\t\t\tdependency = this.extensions[EXTENSIONS.KHR_LIGHTS_PUNCTUAL].loadLight(index);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\tthrow new Error('Unknown type: ' + type);\r\n\t\t\t}\r\n\r\n\t\t\tthis.cache.add(cacheKey, dependency);\r\n\t\t}\r\n\r\n\t\treturn dependency;\r\n\t};\r\n\r\n\t/**\r\n\t * Requests all dependencies of the specified type asynchronously, with caching.\r\n\t * @param {string} type\r\n\t * @return {Promise<Array<Object>>}\r\n\t */\r\n\tGLTFParser.prototype.getDependencies = function (type) {\r\n\t\tvar dependencies = this.cache.get(type);\r\n\r\n\t\tif (!dependencies) {\r\n\t\t\tvar parser = this;\r\n\t\t\tvar defs = this.json[type + (type === 'mesh' ? 'es' : 's')] || [];\r\n\r\n\t\t\tdependencies = Promise.all(\r\n\t\t\t\tdefs.map(function (def, index) {\r\n\t\t\t\t\treturn parser.getDependency(type, index);\r\n\t\t\t\t})\r\n\t\t\t);\r\n\r\n\t\t\tthis.cache.add(type, dependencies);\r\n\t\t}\r\n\r\n\t\treturn dependencies;\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views\r\n\t * @param {number} bufferIndex\r\n\t * @return {Promise<ArrayBuffer>}\r\n\t */\r\n\tGLTFParser.prototype.loadBuffer = function (bufferIndex) {\r\n\t\tvar bufferDef = this.json.buffers[bufferIndex];\r\n\t\tvar loader = this.fileLoader;\r\n\r\n\t\tif (bufferDef.type && bufferDef.type !== 'arraybuffer') {\r\n\t\t\tthrow new Error('THREE.GLTFLoader: ' + bufferDef.type + ' buffer type is not supported.');\r\n\t\t}\r\n\r\n\t\t// If present, GLB container is required to be the first buffer.\r\n\t\tif (bufferDef.uri === undefined && bufferIndex === 0) {\r\n\t\t\treturn Promise.resolve(this.extensions[EXTENSIONS.KHR_BINARY_GLTF].body);\r\n\t\t}\r\n\r\n\t\tvar options = this.options;\r\n\r\n\t\treturn new Promise(function (resolve, reject) {\r\n\t\t\tloader.load(resolveURL(bufferDef.uri, options.path), resolve, undefined, function () {\r\n\t\t\t\treject(new Error('THREE.GLTFLoader: Failed to load buffer \"' + bufferDef.uri + '\".'));\r\n\t\t\t});\r\n\t\t});\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views\r\n\t * @param {number} bufferViewIndex\r\n\t * @return {Promise<ArrayBuffer>}\r\n\t */\r\n\tGLTFParser.prototype.loadBufferView = function (bufferViewIndex) {\r\n\t\tvar bufferViewDef = this.json.bufferViews[bufferViewIndex];\r\n\r\n\t\treturn this.getDependency('buffer', bufferViewDef.buffer).then(function (buffer) {\r\n\t\t\tvar byteLength = bufferViewDef.byteLength || 0;\r\n\t\t\tvar byteOffset = bufferViewDef.byteOffset || 0;\r\n\t\t\treturn buffer.slice(byteOffset, byteOffset + byteLength);\r\n\t\t});\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#accessors\r\n\t * @param {number} accessorIndex\r\n\t * @return {Promise<BufferAttribute|InterleavedBufferAttribute>}\r\n\t */\r\n\tGLTFParser.prototype.loadAccessor = function (accessorIndex) {\r\n\t\tvar parser = this;\r\n\t\tvar json = this.json;\r\n\r\n\t\tvar accessorDef = this.json.accessors[accessorIndex];\r\n\r\n\t\tif (accessorDef.bufferView === undefined && accessorDef.sparse === undefined) {\r\n\t\t\t// Ignore empty accessors, which may be used to declare runtime\r\n\t\t\t// information about attributes coming from another source (e.g. Draco\r\n\t\t\t// compression extension).\r\n\t\t\treturn Promise.resolve(null);\r\n\t\t}\r\n\r\n\t\tvar pendingBufferViews = [];\r\n\r\n\t\tif (accessorDef.bufferView !== undefined) {\r\n\t\t\tpendingBufferViews.push(this.getDependency('bufferView', accessorDef.bufferView));\r\n\t\t} else {\r\n\t\t\tpendingBufferViews.push(null);\r\n\t\t}\r\n\r\n\t\tif (accessorDef.sparse !== undefined) {\r\n\t\t\tpendingBufferViews.push(this.getDependency('bufferView', accessorDef.sparse.indices.bufferView));\r\n\t\t\tpendingBufferViews.push(this.getDependency('bufferView', accessorDef.sparse.values.bufferView));\r\n\t\t}\r\n\r\n\t\treturn Promise.all(pendingBufferViews).then(function (bufferViews) {\r\n\t\t\tvar bufferView = bufferViews[0];\r\n\r\n\t\t\tvar itemSize = WEBGL_TYPE_SIZES[accessorDef.type];\r\n\t\t\tvar TypedArray = WEBGL_COMPONENT_TYPES[accessorDef.componentType];\r\n\r\n\t\t\t// For VEC3: itemSize is 3, elementBytes is 4, itemBytes is 12.\r\n\t\t\tvar elementBytes = TypedArray.BYTES_PER_ELEMENT;\r\n\t\t\tvar itemBytes = elementBytes * itemSize;\r\n\t\t\tvar byteOffset = accessorDef.byteOffset || 0;\r\n\t\t\tvar byteStride =\r\n\t\t\t\taccessorDef.bufferView !== undefined ? json.bufferViews[accessorDef.bufferView].byteStride : undefined;\r\n\t\t\tvar normalized = accessorDef.normalized === true;\r\n\t\t\tvar array, bufferAttribute;\r\n\r\n\t\t\t// The buffer is not interleaved if the stride is the item size in bytes.\r\n\t\t\tif (byteStride && byteStride !== itemBytes) {\r\n\t\t\t\t// Each \"slice\" of the buffer, as defined by 'count' elements of 'byteStride' bytes, gets its own InterleavedBuffer\r\n\t\t\t\t// This makes sure that IBA.count reflects accessor.count properly\r\n\t\t\t\tvar ibSlice = Math.floor(byteOffset / byteStride);\r\n\t\t\t\tvar ibCacheKey =\r\n\t\t\t\t\t'InterleavedBuffer:' +\r\n\t\t\t\t\taccessorDef.bufferView +\r\n\t\t\t\t\t':' +\r\n\t\t\t\t\taccessorDef.componentType +\r\n\t\t\t\t\t':' +\r\n\t\t\t\t\tibSlice +\r\n\t\t\t\t\t':' +\r\n\t\t\t\t\taccessorDef.count;\r\n\t\t\t\tvar ib = parser.cache.get(ibCacheKey);\r\n\r\n\t\t\t\tif (!ib) {\r\n\t\t\t\t\tarray = new TypedArray(\r\n\t\t\t\t\t\tbufferView,\r\n\t\t\t\t\t\tibSlice * byteStride,\r\n\t\t\t\t\t\t(accessorDef.count * byteStride) / elementBytes\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\t// Integer parameters to IB/IBA are in array elements, not bytes.\r\n\t\t\t\t\tib = new InterleavedBuffer(array, byteStride / elementBytes);\r\n\r\n\t\t\t\t\tparser.cache.add(ibCacheKey, ib);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbufferAttribute = new InterleavedBufferAttribute(\r\n\t\t\t\t\tib,\r\n\t\t\t\t\titemSize,\r\n\t\t\t\t\t(byteOffset % byteStride) / elementBytes,\r\n\t\t\t\t\tnormalized\r\n\t\t\t\t);\r\n\t\t\t} else {\r\n\t\t\t\tif (bufferView === null) {\r\n\t\t\t\t\tarray = new TypedArray(accessorDef.count * itemSize);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tarray = new TypedArray(bufferView, byteOffset, accessorDef.count * itemSize);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbufferAttribute = new BufferAttribute(array, itemSize, normalized);\r\n\t\t\t}\r\n\r\n\t\t\t// https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#sparse-accessors\r\n\t\t\tif (accessorDef.sparse !== undefined) {\r\n\t\t\t\tvar itemSizeIndices = WEBGL_TYPE_SIZES.SCALAR;\r\n\t\t\t\tvar TypedArrayIndices = WEBGL_COMPONENT_TYPES[accessorDef.sparse.indices.componentType];\r\n\r\n\t\t\t\tvar byteOffsetIndices = accessorDef.sparse.indices.byteOffset || 0;\r\n\t\t\t\tvar byteOffsetValues = accessorDef.sparse.values.byteOffset || 0;\r\n\r\n\t\t\t\tvar sparseIndices = new TypedArrayIndices(\r\n\t\t\t\t\tbufferViews[1],\r\n\t\t\t\t\tbyteOffsetIndices,\r\n\t\t\t\t\taccessorDef.sparse.count * itemSizeIndices\r\n\t\t\t\t);\r\n\t\t\t\tvar sparseValues = new TypedArray(\r\n\t\t\t\t\tbufferViews[2],\r\n\t\t\t\t\tbyteOffsetValues,\r\n\t\t\t\t\taccessorDef.sparse.count * itemSize\r\n\t\t\t\t);\r\n\r\n\t\t\t\tif (bufferView !== null) {\r\n\t\t\t\t\t// Avoid modifying the original ArrayBuffer, if the bufferView wasn't initialized with zeroes.\r\n\t\t\t\t\tbufferAttribute = new BufferAttribute(\r\n\t\t\t\t\t\tbufferAttribute.array.slice(),\r\n\t\t\t\t\t\tbufferAttribute.itemSize,\r\n\t\t\t\t\t\tbufferAttribute.normalized\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (var i = 0, il = sparseIndices.length; i < il; i++) {\r\n\t\t\t\t\tvar index = sparseIndices[i];\r\n\r\n\t\t\t\t\tbufferAttribute.setX(index, sparseValues[i * itemSize]);\r\n\t\t\t\t\tif (itemSize >= 2) bufferAttribute.setY(index, sparseValues[i * itemSize + 1]);\r\n\t\t\t\t\tif (itemSize >= 3) bufferAttribute.setZ(index, sparseValues[i * itemSize + 2]);\r\n\t\t\t\t\tif (itemSize >= 4) bufferAttribute.setW(index, sparseValues[i * itemSize + 3]);\r\n\t\t\t\t\tif (itemSize >= 5)\r\n\t\t\t\t\t\tthrow new Error('THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn bufferAttribute;\r\n\t\t});\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#textures\r\n\t * @param {number} textureIndex\r\n\t * @return {Promise<THREE.Texture>}\r\n\t */\r\n\tGLTFParser.prototype.loadTexture = function (textureIndex) {\r\n\t\tvar parser = this;\r\n\t\tvar json = this.json;\r\n\t\tvar options = this.options;\r\n\t\tvar textureLoader = this.textureLoader;\r\n\r\n\t\tvar URL = window.URL || window.webkitURL;\r\n\r\n\t\tvar textureDef = json.textures[textureIndex];\r\n\r\n\t\tvar textureExtensions = textureDef.extensions || {};\r\n\r\n\t\tvar source;\r\n\r\n\t\tif (textureExtensions[EXTENSIONS.MSFT_TEXTURE_DDS]) {\r\n\t\t\tsource = json.images[textureExtensions[EXTENSIONS.MSFT_TEXTURE_DDS].source];\r\n\t\t} else {\r\n\t\t\tsource = json.images[textureDef.source];\r\n\t\t}\r\n\r\n\t\tvar sourceURI = source.uri;\r\n\t\tvar isObjectURL = false;\r\n\r\n\t\tif (source.bufferView !== undefined) {\r\n\t\t\t// Load binary image data from bufferView, if provided.\r\n\r\n\t\t\tsourceURI = parser.getDependency('bufferView', source.bufferView).then(function (bufferView) {\r\n\t\t\t\tisObjectURL = true;\r\n\t\t\t\tvar blob = new Blob([bufferView], { type: source.mimeType });\r\n\t\t\t\tsourceURI = URL.createObjectURL(blob);\r\n\t\t\t\treturn sourceURI;\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn Promise.resolve(sourceURI)\r\n\t\t\t.then(function (sourceURI) {\r\n\t\t\t\t// Load Texture resource.\r\n\r\n\t\t\t\tvar loader = options.manager.getHandler(sourceURI);\r\n\r\n\t\t\t\tif (!loader) {\r\n\t\t\t\t\tloader = textureExtensions[EXTENSIONS.MSFT_TEXTURE_DDS]\r\n\t\t\t\t\t\t? parser.extensions[EXTENSIONS.MSFT_TEXTURE_DDS].ddsLoader\r\n\t\t\t\t\t\t: textureLoader;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn new Promise(function (resolve, reject) {\r\n\t\t\t\t\tloader.load(resolveURL(sourceURI, options.path), resolve, undefined, reject);\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t\t.then(function (texture) {\r\n\t\t\t\t// Clean up resources and configure Texture.\r\n\r\n\t\t\t\tif (isObjectURL === true) {\r\n\t\t\t\t\tURL.revokeObjectURL(sourceURI);\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttexture.flipY = false;\r\n\r\n\t\t\t\tif (textureDef.name !== undefined) texture.name = textureDef.name;\r\n\r\n\t\t\t\t// Ignore unknown mime types, like DDS files.\r\n\t\t\t\tif (source.mimeType in MIME_TYPE_FORMATS) {\r\n\t\t\t\t\ttexture.format = MIME_TYPE_FORMATS[source.mimeType];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar samplers = json.samplers || {};\r\n\t\t\t\tvar sampler = samplers[textureDef.sampler] || {};\r\n\r\n\t\t\t\ttexture.magFilter = WEBGL_FILTERS[sampler.magFilter] || LinearFilter;\r\n\t\t\t\ttexture.minFilter = WEBGL_FILTERS[sampler.minFilter] || LinearMipmapLinearFilter;\r\n\t\t\t\ttexture.wrapS = WEBGL_WRAPPINGS[sampler.wrapS] || RepeatWrapping;\r\n\t\t\t\ttexture.wrapT = WEBGL_WRAPPINGS[sampler.wrapT] || RepeatWrapping;\r\n\r\n\t\t\t\treturn texture;\r\n\t\t\t});\r\n\t};\r\n\r\n\t/**\r\n\t * Asynchronously assigns a texture to the given material parameters.\r\n\t * @param {Object} materialParams\r\n\t * @param {string} mapName\r\n\t * @param {Object} mapDef\r\n\t * @return {Promise}\r\n\t */\r\n\tGLTFParser.prototype.assignTexture = function (materialParams, mapName, mapDef) {\r\n\t\tvar parser = this;\r\n\r\n\t\treturn this.getDependency('texture', mapDef.index).then(function (texture) {\r\n\t\t\tif (!texture.isCompressedTexture) {\r\n\t\t\t\tswitch (mapName) {\r\n\t\t\t\t\tcase 'aoMap':\r\n\t\t\t\t\tcase 'emissiveMap':\r\n\t\t\t\t\tcase 'metalnessMap':\r\n\t\t\t\t\tcase 'normalMap':\r\n\t\t\t\t\tcase 'roughnessMap':\r\n\t\t\t\t\t\ttexture.format = RGBFormat;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Materials sample aoMap from UV set 1 and other maps from UV set 0 - this can't be configured\r\n\t\t\t// However, we will copy UV set 0 to UV set 1 on demand for aoMap\r\n\t\t\tif (\r\n\t\t\t\tmapDef.texCoord !== undefined &&\r\n\t\t\t\tmapDef.texCoord != 0 &&\r\n\t\t\t\t!(mapName === 'aoMap' && mapDef.texCoord == 1)\r\n\t\t\t) {\r\n\t\t\t\tconsole.warn(\r\n\t\t\t\t\t'THREE.GLTFLoader: Custom UV set ' +\r\n\t\t\t\t\t\tmapDef.texCoord +\r\n\t\t\t\t\t\t' for texture ' +\r\n\t\t\t\t\t\tmapName +\r\n\t\t\t\t\t\t' not yet supported.'\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\tif (parser.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM]) {\r\n\t\t\t\tvar transform =\r\n\t\t\t\t\tmapDef.extensions !== undefined ? mapDef.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM] : undefined;\r\n\r\n\t\t\t\tif (transform) {\r\n\t\t\t\t\ttexture = parser.extensions[EXTENSIONS.KHR_TEXTURE_TRANSFORM].extendTexture(texture, transform);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tmaterialParams[mapName] = texture;\r\n\t\t});\r\n\t};\r\n\r\n\t/**\r\n\t * Assigns final material to a Mesh, Line, or Points instance. The instance\r\n\t * already has a material (generated from the glTF material options alone)\r\n\t * but reuse of the same glTF material may require multiple threejs materials\r\n\t * to accomodate different primitive types, defines, etc. New materials will\r\n\t * be created if necessary, and reused from a cache.\r\n\t * @param  {Object3D} mesh Mesh, Line, or Points instance.\r\n\t */\r\n\tGLTFParser.prototype.assignFinalMaterial = function (mesh) {\r\n\t\tvar geometry = mesh.geometry;\r\n\t\tvar material = mesh.material;\r\n\t\tvar extensions = this.extensions;\r\n\r\n\t\tvar useVertexTangents = geometry.attributes.tangent !== undefined;\r\n\t\tvar useVertexColors = geometry.attributes.color !== undefined;\r\n\t\tvar useFlatShading = geometry.attributes.normal === undefined;\r\n\t\tvar useSkinning = mesh.isSkinnedMesh === true;\r\n\t\tvar useMorphTargets = Object.keys(geometry.morphAttributes).length > 0;\r\n\t\tvar useMorphNormals = useMorphTargets && geometry.morphAttributes.normal !== undefined;\r\n\r\n\t\tif (mesh.isPoints) {\r\n\t\t\tvar cacheKey = 'PointsMaterial:' + material.uuid;\r\n\r\n\t\t\tvar pointsMaterial = this.cache.get(cacheKey);\r\n\r\n\t\t\tif (!pointsMaterial) {\r\n\t\t\t\tpointsMaterial = new PointsMaterial();\r\n\t\t\t\tMaterial.prototype.copy.call(pointsMaterial, material);\r\n\t\t\t\tpointsMaterial.color.copy(material.color);\r\n\t\t\t\tpointsMaterial.map = material.map;\r\n\t\t\t\tpointsMaterial.sizeAttenuation = false; // glTF spec says points should be 1px\r\n\r\n\t\t\t\tthis.cache.add(cacheKey, pointsMaterial);\r\n\t\t\t}\r\n\r\n\t\t\tmaterial = pointsMaterial;\r\n\t\t} else if (mesh.isLine) {\r\n\t\t\tvar cacheKey = 'LineBasicMaterial:' + material.uuid;\r\n\r\n\t\t\tvar lineMaterial = this.cache.get(cacheKey);\r\n\r\n\t\t\tif (!lineMaterial) {\r\n\t\t\t\tlineMaterial = new LineBasicMaterial();\r\n\t\t\t\tMaterial.prototype.copy.call(lineMaterial, material);\r\n\t\t\t\tlineMaterial.color.copy(material.color);\r\n\r\n\t\t\t\tthis.cache.add(cacheKey, lineMaterial);\r\n\t\t\t}\r\n\r\n\t\t\tmaterial = lineMaterial;\r\n\t\t}\r\n\r\n\t\t// Clone the material if it will be modified\r\n\t\tif (useVertexTangents || useVertexColors || useFlatShading || useSkinning || useMorphTargets) {\r\n\t\t\tvar cacheKey = 'ClonedMaterial:' + material.uuid + ':';\r\n\r\n\t\t\tif (material.isGLTFSpecularGlossinessMaterial) cacheKey += 'specular-glossiness:';\r\n\t\t\tif (useSkinning) cacheKey += 'skinning:';\r\n\t\t\tif (useVertexTangents) cacheKey += 'vertex-tangents:';\r\n\t\t\tif (useVertexColors) cacheKey += 'vertex-colors:';\r\n\t\t\tif (useFlatShading) cacheKey += 'flat-shading:';\r\n\t\t\tif (useMorphTargets) cacheKey += 'morph-targets:';\r\n\t\t\tif (useMorphNormals) cacheKey += 'morph-normals:';\r\n\r\n\t\t\tvar cachedMaterial = this.cache.get(cacheKey);\r\n\r\n\t\t\tif (!cachedMaterial) {\r\n\t\t\t\tcachedMaterial = material.clone();\r\n\r\n\t\t\t\tif (useSkinning) cachedMaterial.skinning = true;\r\n\t\t\t\tif (useVertexTangents) cachedMaterial.vertexTangents = true;\r\n\t\t\t\tif (useVertexColors) cachedMaterial.vertexColors = VertexColors;\r\n\t\t\t\tif (useFlatShading) cachedMaterial.flatShading = true;\r\n\t\t\t\tif (useMorphTargets) cachedMaterial.morphTargets = true;\r\n\t\t\t\tif (useMorphNormals) cachedMaterial.morphNormals = true;\r\n\r\n\t\t\t\tthis.cache.add(cacheKey, cachedMaterial);\r\n\t\t\t}\r\n\r\n\t\t\tmaterial = cachedMaterial;\r\n\t\t}\r\n\r\n\t\t// workarounds for mesh and geometry\r\n\r\n\t\tif (material.aoMap && geometry.attributes.uv2 === undefined && geometry.attributes.uv !== undefined) {\r\n\t\t\tgeometry.setAttribute('uv2', new BufferAttribute(geometry.attributes.uv.array, 2));\r\n\t\t}\r\n\r\n\t\t// https://github.com/mrdoob/three.js/issues/11438#issuecomment-507003995\r\n\t\tif (material.normalScale && !useVertexTangents) {\r\n\t\t\tmaterial.normalScale.y = -material.normalScale.y;\r\n\t\t}\r\n\r\n\t\tmesh.material = material;\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#materials\r\n\t * @param {number} materialIndex\r\n\t * @return {Promise<Material>}\r\n\t */\r\n\tGLTFParser.prototype.loadMaterial = function (materialIndex) {\r\n\t\tvar parser = this;\r\n\t\tvar json = this.json;\r\n\t\tvar extensions = this.extensions;\r\n\t\tvar materialDef = json.materials[materialIndex];\r\n\r\n\t\tvar materialType;\r\n\t\tvar materialParams = {};\r\n\t\tvar materialExtensions = materialDef.extensions || {};\r\n\r\n\t\tvar pending = [];\r\n\r\n\t\tif (materialExtensions[EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]) {\r\n\t\t\tvar sgExtension = extensions[EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];\r\n\t\t\tmaterialType = sgExtension.getMaterialType();\r\n\t\t\tpending.push(sgExtension.extendParams(materialParams, materialDef, parser));\r\n\t\t} else if (materialExtensions[EXTENSIONS.KHR_MATERIALS_UNLIT]) {\r\n\t\t\tvar kmuExtension = extensions[EXTENSIONS.KHR_MATERIALS_UNLIT];\r\n\t\t\tmaterialType = kmuExtension.getMaterialType();\r\n\t\t\tpending.push(kmuExtension.extendParams(materialParams, materialDef, parser));\r\n\t\t} else {\r\n\t\t\t// Specification:\r\n\t\t\t// https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#metallic-roughness-material\r\n\r\n\t\t\tmaterialType = MeshStandardMaterial;\r\n\r\n\t\t\tvar metallicRoughness = materialDef.pbrMetallicRoughness || {};\r\n\r\n\t\t\tmaterialParams.color = new Color(1.0, 1.0, 1.0);\r\n\t\t\tmaterialParams.opacity = 1.0;\r\n\r\n\t\t\tif (Array.isArray(metallicRoughness.baseColorFactor)) {\r\n\t\t\t\tvar array = metallicRoughness.baseColorFactor;\r\n\r\n\t\t\t\tmaterialParams.color.fromArray(array);\r\n\t\t\t\tmaterialParams.opacity = array[3];\r\n\t\t\t}\r\n\r\n\t\t\tif (metallicRoughness.baseColorTexture !== undefined) {\r\n\t\t\t\tpending.push(parser.assignTexture(materialParams, 'map', metallicRoughness.baseColorTexture));\r\n\t\t\t}\r\n\r\n\t\t\tmaterialParams.metalness =\r\n\t\t\t\tmetallicRoughness.metallicFactor !== undefined ? metallicRoughness.metallicFactor : 1.0;\r\n\t\t\tmaterialParams.roughness =\r\n\t\t\t\tmetallicRoughness.roughnessFactor !== undefined ? metallicRoughness.roughnessFactor : 1.0;\r\n\r\n\t\t\tif (metallicRoughness.metallicRoughnessTexture !== undefined) {\r\n\t\t\t\tpending.push(\r\n\t\t\t\t\tparser.assignTexture(materialParams, 'metalnessMap', metallicRoughness.metallicRoughnessTexture)\r\n\t\t\t\t);\r\n\t\t\t\tpending.push(\r\n\t\t\t\t\tparser.assignTexture(materialParams, 'roughnessMap', metallicRoughness.metallicRoughnessTexture)\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (materialDef.doubleSided === true) {\r\n\t\t\tmaterialParams.side = DoubleSide;\r\n\t\t}\r\n\r\n\t\tvar alphaMode = materialDef.alphaMode || ALPHA_MODES.OPAQUE;\r\n\r\n\t\tif (alphaMode === ALPHA_MODES.BLEND) {\r\n\t\t\tmaterialParams.transparent = true;\r\n\t\t} else {\r\n\t\t\tmaterialParams.transparent = false;\r\n\r\n\t\t\tif (alphaMode === ALPHA_MODES.MASK) {\r\n\t\t\t\tmaterialParams.alphaTest = materialDef.alphaCutoff !== undefined ? materialDef.alphaCutoff : 0.5;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (materialDef.normalTexture !== undefined && materialType !== MeshBasicMaterial) {\r\n\t\t\tpending.push(parser.assignTexture(materialParams, 'normalMap', materialDef.normalTexture));\r\n\r\n\t\t\tmaterialParams.normalScale = new Vector2(1, 1);\r\n\r\n\t\t\tif (materialDef.normalTexture.scale !== undefined) {\r\n\t\t\t\tmaterialParams.normalScale.set(materialDef.normalTexture.scale, materialDef.normalTexture.scale);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (materialDef.occlusionTexture !== undefined && materialType !== MeshBasicMaterial) {\r\n\t\t\tpending.push(parser.assignTexture(materialParams, 'aoMap', materialDef.occlusionTexture));\r\n\r\n\t\t\tif (materialDef.occlusionTexture.strength !== undefined) {\r\n\t\t\t\tmaterialParams.aoMapIntensity = materialDef.occlusionTexture.strength;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (materialDef.emissiveFactor !== undefined && materialType !== MeshBasicMaterial) {\r\n\t\t\tmaterialParams.emissive = new Color().fromArray(materialDef.emissiveFactor);\r\n\t\t}\r\n\r\n\t\tif (materialDef.emissiveTexture !== undefined && materialType !== MeshBasicMaterial) {\r\n\t\t\tpending.push(parser.assignTexture(materialParams, 'emissiveMap', materialDef.emissiveTexture));\r\n\t\t}\r\n\r\n\t\treturn Promise.all(pending).then(function () {\r\n\t\t\tvar material;\r\n\r\n\t\t\tif (materialType === GLTFMeshStandardSGMaterial) {\r\n\t\t\t\tmaterial = extensions[EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(materialParams);\r\n\t\t\t} else {\r\n\t\t\t\tmaterial = new materialType(materialParams);\r\n\t\t\t}\r\n\r\n\t\t\tif (materialDef.name !== undefined) material.name = materialDef.name;\r\n\r\n\t\t\t// baseColorTexture, emissiveTexture, and specularGlossinessTexture use sRGB encoding.\r\n\t\t\tif (material.map) material.map.encoding = sRGBEncoding;\r\n\t\t\tif (material.emissiveMap) material.emissiveMap.encoding = sRGBEncoding;\r\n\r\n\t\t\tassignExtrasToUserData(material, materialDef);\r\n\r\n\t\t\tif (materialDef.extensions) addUnknownExtensionsToUserData(extensions, material, materialDef);\r\n\r\n\t\t\treturn material;\r\n\t\t});\r\n\t};\r\n\r\n\t/**\r\n\t * @param {BufferGeometry} geometry\r\n\t * @param {GLTF.Primitive} primitiveDef\r\n\t * @param {GLTFParser} parser\r\n\t */\r\n\tfunction computeBounds(geometry, primitiveDef, parser) {\r\n\t\tvar attributes = primitiveDef.attributes;\r\n\r\n\t\tvar box = new Box3();\r\n\r\n\t\tif (attributes.POSITION !== undefined) {\r\n\t\t\tvar accessor = parser.json.accessors[attributes.POSITION];\r\n\r\n\t\t\tvar min = accessor.min;\r\n\t\t\tvar max = accessor.max;\r\n\r\n\t\t\t// glTF requires 'min' and 'max', but VRM (which extends glTF) currently ignores that requirement.\r\n\r\n\t\t\tif (min !== undefined && max !== undefined) {\r\n\t\t\t\tbox.set(new Vector3(min[0], min[1], min[2]), new Vector3(max[0], max[1], max[2]));\r\n\t\t\t} else {\r\n\t\t\t\tconsole.warn('THREE.GLTFLoader: Missing min/max properties for accessor POSITION.');\r\n\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tvar targets = primitiveDef.targets;\r\n\r\n\t\tif (targets !== undefined) {\r\n\t\t\tvar vector = new Vector3();\r\n\r\n\t\t\tfor (var i = 0, il = targets.length; i < il; i++) {\r\n\t\t\t\tvar target = targets[i];\r\n\r\n\t\t\t\tif (target.POSITION !== undefined) {\r\n\t\t\t\t\tvar accessor = parser.json.accessors[target.POSITION];\r\n\t\t\t\t\tvar min = accessor.min;\r\n\t\t\t\t\tvar max = accessor.max;\r\n\r\n\t\t\t\t\t// glTF requires 'min' and 'max', but VRM (which extends glTF) currently ignores that requirement.\r\n\r\n\t\t\t\t\tif (min !== undefined && max !== undefined) {\r\n\t\t\t\t\t\t// we need to get max of absolute components because target weight is [-1,1]\r\n\t\t\t\t\t\tvector.setX(Math.max(Math.abs(min[0]), Math.abs(max[0])));\r\n\t\t\t\t\t\tvector.setY(Math.max(Math.abs(min[1]), Math.abs(max[1])));\r\n\t\t\t\t\t\tvector.setZ(Math.max(Math.abs(min[2]), Math.abs(max[2])));\r\n\r\n\t\t\t\t\t\tbox.expandByVector(vector);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconsole.warn('THREE.GLTFLoader: Missing min/max properties for accessor POSITION.');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tgeometry.boundingBox = box;\r\n\r\n\t\tvar sphere = new Sphere();\r\n\r\n\t\tbox.getCenter(sphere.center);\r\n\t\tsphere.radius = box.min.distanceTo(box.max) / 2;\r\n\r\n\t\tgeometry.boundingSphere = sphere;\r\n\t}\r\n\r\n\t/**\r\n\t * @param {BufferGeometry} geometry\r\n\t * @param {GLTF.Primitive} primitiveDef\r\n\t * @param {GLTFParser} parser\r\n\t * @return {Promise<BufferGeometry>}\r\n\t */\r\n\tfunction addPrimitiveAttributes(geometry, primitiveDef, parser) {\r\n\t\tvar attributes = primitiveDef.attributes;\r\n\r\n\t\tvar pending = [];\r\n\r\n\t\tfunction assignAttributeAccessor(accessorIndex, attributeName) {\r\n\t\t\treturn parser.getDependency('accessor', accessorIndex).then(function (accessor) {\r\n\t\t\t\tgeometry.setAttribute(attributeName, accessor);\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfor (var gltfAttributeName in attributes) {\r\n\t\t\tvar threeAttributeName = ATTRIBUTES[gltfAttributeName] || gltfAttributeName.toLowerCase();\r\n\r\n\t\t\t// Skip attributes already provided by e.g. Draco extension.\r\n\t\t\tif (threeAttributeName in geometry.attributes) continue;\r\n\r\n\t\t\tpending.push(assignAttributeAccessor(attributes[gltfAttributeName], threeAttributeName));\r\n\t\t}\r\n\r\n\t\tif (primitiveDef.indices !== undefined && !geometry.index) {\r\n\t\t\tvar accessor = parser.getDependency('accessor', primitiveDef.indices).then(function (accessor) {\r\n\t\t\t\tgeometry.setIndex(accessor);\r\n\t\t\t});\r\n\r\n\t\t\tpending.push(accessor);\r\n\t\t}\r\n\r\n\t\tassignExtrasToUserData(geometry, primitiveDef);\r\n\r\n\t\tcomputeBounds(geometry, primitiveDef, parser);\r\n\r\n\t\treturn Promise.all(pending).then(function () {\r\n\t\t\treturn primitiveDef.targets !== undefined\r\n\t\t\t\t? addMorphTargets(geometry, primitiveDef.targets, parser)\r\n\t\t\t\t: geometry;\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * @param {BufferGeometry} geometry\r\n\t * @param {Number} drawMode\r\n\t * @return {BufferGeometry}\r\n\t */\r\n\tfunction toTrianglesDrawMode(geometry, drawMode) {\r\n\t\tvar index = geometry.getIndex();\r\n\r\n\t\t// generate index if not present\r\n\r\n\t\tif (index === null) {\r\n\t\t\tvar indices = [];\r\n\r\n\t\t\tvar position = geometry.getAttribute('position');\r\n\r\n\t\t\tif (position !== undefined) {\r\n\t\t\t\tfor (var i = 0; i < position.count; i++) {\r\n\t\t\t\t\tindices.push(i);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tgeometry.setIndex(indices);\r\n\t\t\t\tindex = geometry.getIndex();\r\n\t\t\t} else {\r\n\t\t\t\tconsole.error(\r\n\t\t\t\t\t'THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible.'\r\n\t\t\t\t);\r\n\t\t\t\treturn geometry;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//\r\n\r\n\t\tvar numberOfTriangles = index.count - 2;\r\n\t\tvar newIndices = [];\r\n\r\n\t\tif (drawMode === TriangleFanDrawMode) {\r\n\t\t\t// gl.TRIANGLE_FAN\r\n\r\n\t\t\tfor (var i = 1; i <= numberOfTriangles; i++) {\r\n\t\t\t\tnewIndices.push(index.getX(0));\r\n\t\t\t\tnewIndices.push(index.getX(i));\r\n\t\t\t\tnewIndices.push(index.getX(i + 1));\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// gl.TRIANGLE_STRIP\r\n\r\n\t\t\tfor (var i = 0; i < numberOfTriangles; i++) {\r\n\t\t\t\tif (i % 2 === 0) {\r\n\t\t\t\t\tnewIndices.push(index.getX(i));\r\n\t\t\t\t\tnewIndices.push(index.getX(i + 1));\r\n\t\t\t\t\tnewIndices.push(index.getX(i + 2));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tnewIndices.push(index.getX(i + 2));\r\n\t\t\t\t\tnewIndices.push(index.getX(i + 1));\r\n\t\t\t\t\tnewIndices.push(index.getX(i));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (newIndices.length / 3 !== numberOfTriangles) {\r\n\t\t\tconsole.error('THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.');\r\n\t\t}\r\n\r\n\t\t// build final geometry\r\n\r\n\t\tvar newGeometry = geometry.clone();\r\n\t\tnewGeometry.setIndex(newIndices);\r\n\r\n\t\treturn newGeometry;\r\n\t}\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#geometry\r\n\t *\r\n\t * Creates BufferGeometries from primitives.\r\n\t *\r\n\t * @param {Array<GLTF.Primitive>} primitives\r\n\t * @return {Promise<Array<BufferGeometry>>}\r\n\t */\r\n\tGLTFParser.prototype.loadGeometries = function (primitives) {\r\n\t\tvar parser = this;\r\n\t\tvar extensions = this.extensions;\r\n\t\tvar cache = this.primitiveCache;\r\n\r\n\t\tfunction createDracoPrimitive(primitive) {\r\n\t\t\treturn extensions[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION]\r\n\t\t\t\t.decodePrimitive(primitive, parser)\r\n\t\t\t\t.then(function (geometry) {\r\n\t\t\t\t\treturn addPrimitiveAttributes(geometry, primitive, parser);\r\n\t\t\t\t});\r\n\t\t}\r\n\r\n\t\tvar pending = [];\r\n\r\n\t\tfor (var i = 0, il = primitives.length; i < il; i++) {\r\n\t\t\tvar primitive = primitives[i];\r\n\t\t\tvar cacheKey = createPrimitiveKey(primitive);\r\n\r\n\t\t\t// See if we've already created this geometry\r\n\t\t\tvar cached = cache[cacheKey];\r\n\r\n\t\t\tif (cached) {\r\n\t\t\t\t// Use the cached geometry if it exists\r\n\t\t\t\tpending.push(cached.promise);\r\n\t\t\t} else {\r\n\t\t\t\tvar geometryPromise;\r\n\r\n\t\t\t\tif (primitive.extensions && primitive.extensions[EXTENSIONS.KHR_DRACO_MESH_COMPRESSION]) {\r\n\t\t\t\t\t// Use DRACO geometry if available\r\n\t\t\t\t\tgeometryPromise = createDracoPrimitive(primitive);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Otherwise create a new geometry\r\n\t\t\t\t\tgeometryPromise = addPrimitiveAttributes(new BufferGeometry(), primitive, parser);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Cache this geometry\r\n\t\t\t\tcache[cacheKey] = { primitive: primitive, promise: geometryPromise };\r\n\r\n\t\t\t\tpending.push(geometryPromise);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn Promise.all(pending);\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#meshes\r\n\t * @param {number} meshIndex\r\n\t * @return {Promise<Group|Mesh|SkinnedMesh>}\r\n\t */\r\n\tGLTFParser.prototype.loadMesh = function (meshIndex) {\r\n\t\tvar parser = this;\r\n\t\tvar json = this.json;\r\n\r\n\t\tvar meshDef = json.meshes[meshIndex];\r\n\t\tvar primitives = meshDef.primitives;\r\n\r\n\t\tvar pending = [];\r\n\r\n\t\tfor (var i = 0, il = primitives.length; i < il; i++) {\r\n\t\t\tvar material =\r\n\t\t\t\tprimitives[i].material === undefined\r\n\t\t\t\t\t? createDefaultMaterial(this.cache)\r\n\t\t\t\t\t: this.getDependency('material', primitives[i].material);\r\n\r\n\t\t\tpending.push(material);\r\n\t\t}\r\n\r\n\t\tpending.push(parser.loadGeometries(primitives));\r\n\r\n\t\treturn Promise.all(pending).then(function (results) {\r\n\t\t\tvar materials = results.slice(0, results.length - 1);\r\n\t\t\tvar geometries = results[results.length - 1];\r\n\r\n\t\t\tvar meshes = [];\r\n\r\n\t\t\tfor (var i = 0, il = geometries.length; i < il; i++) {\r\n\t\t\t\tvar geometry = geometries[i];\r\n\t\t\t\tvar primitive = primitives[i];\r\n\r\n\t\t\t\t// 1. create Mesh\r\n\r\n\t\t\t\tvar mesh;\r\n\r\n\t\t\t\tvar material = materials[i];\r\n\r\n\t\t\t\tif (\r\n\t\t\t\t\tprimitive.mode === WEBGL_CONSTANTS.TRIANGLES ||\r\n\t\t\t\t\tprimitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP ||\r\n\t\t\t\t\tprimitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN ||\r\n\t\t\t\t\tprimitive.mode === undefined\r\n\t\t\t\t) {\r\n\t\t\t\t\t// .isSkinnedMesh isn't in glTF spec. See .markDefs()\r\n\t\t\t\t\tmesh =\r\n\t\t\t\t\t\tmeshDef.isSkinnedMesh === true\r\n\t\t\t\t\t\t\t? new SkinnedMesh(geometry, material)\r\n\t\t\t\t\t\t\t: new Mesh(geometry, material);\r\n\r\n\t\t\t\t\tif (mesh.isSkinnedMesh === true && !mesh.geometry.attributes.skinWeight.normalized) {\r\n\t\t\t\t\t\t// we normalize floating point skin weight array to fix malformed assets (see #15319)\r\n\t\t\t\t\t\t// it's important to skip this for non-float32 data since normalizeSkinWeights assumes non-normalized inputs\r\n\t\t\t\t\t\tmesh.normalizeSkinWeights();\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (primitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP) {\r\n\t\t\t\t\t\tmesh.geometry = toTrianglesDrawMode(mesh.geometry, TriangleStripDrawMode);\r\n\t\t\t\t\t} else if (primitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN) {\r\n\t\t\t\t\t\tmesh.geometry = toTrianglesDrawMode(mesh.geometry, TriangleFanDrawMode);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (primitive.mode === WEBGL_CONSTANTS.LINES) {\r\n\t\t\t\t\tmesh = new LineSegments(geometry, material);\r\n\t\t\t\t} else if (primitive.mode === WEBGL_CONSTANTS.LINE_STRIP) {\r\n\t\t\t\t\tmesh = new Line(geometry, material);\r\n\t\t\t\t} else if (primitive.mode === WEBGL_CONSTANTS.LINE_LOOP) {\r\n\t\t\t\t\tmesh = new LineLoop(geometry, material);\r\n\t\t\t\t} else if (primitive.mode === WEBGL_CONSTANTS.POINTS) {\r\n\t\t\t\t\tmesh = new Points(geometry, material);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthrow new Error('THREE.GLTFLoader: Primitive mode unsupported: ' + primitive.mode);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (Object.keys(mesh.geometry.morphAttributes).length > 0) {\r\n\t\t\t\t\tupdateMorphTargets(mesh, meshDef);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tmesh.name = meshDef.name || 'mesh_' + meshIndex;\r\n\r\n\t\t\t\tif (geometries.length > 1) mesh.name += '_' + i;\r\n\r\n\t\t\t\tassignExtrasToUserData(mesh, meshDef);\r\n\r\n\t\t\t\tparser.assignFinalMaterial(mesh);\r\n\r\n\t\t\t\tmeshes.push(mesh);\r\n\t\t\t}\r\n\r\n\t\t\tif (meshes.length === 1) {\r\n\t\t\t\treturn meshes[0];\r\n\t\t\t}\r\n\r\n\t\t\tvar group = new Group();\r\n\r\n\t\t\tfor (var i = 0, il = meshes.length; i < il; i++) {\r\n\t\t\t\tgroup.add(meshes[i]);\r\n\t\t\t}\r\n\r\n\t\t\treturn group;\r\n\t\t});\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#cameras\r\n\t * @param {number} cameraIndex\r\n\t * @return {Promise<THREE.Camera>}\r\n\t */\r\n\tGLTFParser.prototype.loadCamera = function (cameraIndex) {\r\n\t\tvar camera;\r\n\t\tvar cameraDef = this.json.cameras[cameraIndex];\r\n\t\tvar params = cameraDef[cameraDef.type];\r\n\r\n\t\tif (!params) {\r\n\t\t\tconsole.warn('THREE.GLTFLoader: Missing camera parameters.');\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (cameraDef.type === 'perspective') {\r\n\t\t\tcamera = new PerspectiveCamera(\r\n\t\t\t\tMathUtils.radToDeg(params.yfov),\r\n\t\t\t\tparams.aspectRatio || 1,\r\n\t\t\t\tparams.znear || 1,\r\n\t\t\t\tparams.zfar || 2e6\r\n\t\t\t);\r\n\t\t} else if (cameraDef.type === 'orthographic') {\r\n\t\t\tcamera = new OrthographicCamera(\r\n\t\t\t\tparams.xmag / -2,\r\n\t\t\t\tparams.xmag / 2,\r\n\t\t\t\tparams.ymag / 2,\r\n\t\t\t\tparams.ymag / -2,\r\n\t\t\t\tparams.znear,\r\n\t\t\t\tparams.zfar\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tif (cameraDef.name !== undefined) camera.name = cameraDef.name;\r\n\r\n\t\tassignExtrasToUserData(camera, cameraDef);\r\n\r\n\t\treturn Promise.resolve(camera);\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#skins\r\n\t * @param {number} skinIndex\r\n\t * @return {Promise<Object>}\r\n\t */\r\n\tGLTFParser.prototype.loadSkin = function (skinIndex) {\r\n\t\tvar skinDef = this.json.skins[skinIndex];\r\n\r\n\t\tvar skinEntry = { joints: skinDef.joints };\r\n\r\n\t\tif (skinDef.inverseBindMatrices === undefined) {\r\n\t\t\treturn Promise.resolve(skinEntry);\r\n\t\t}\r\n\r\n\t\treturn this.getDependency('accessor', skinDef.inverseBindMatrices).then(function (accessor) {\r\n\t\t\tskinEntry.inverseBindMatrices = accessor;\r\n\r\n\t\t\treturn skinEntry;\r\n\t\t});\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#animations\r\n\t * @param {number} animationIndex\r\n\t * @return {Promise<AnimationClip>}\r\n\t */\r\n\tGLTFParser.prototype.loadAnimation = function (animationIndex) {\r\n\t\tvar json = this.json;\r\n\r\n\t\tvar animationDef = json.animations[animationIndex];\r\n\r\n\t\tvar pendingNodes = [];\r\n\t\tvar pendingInputAccessors = [];\r\n\t\tvar pendingOutputAccessors = [];\r\n\t\tvar pendingSamplers = [];\r\n\t\tvar pendingTargets = [];\r\n\r\n\t\tfor (var i = 0, il = animationDef.channels.length; i < il; i++) {\r\n\t\t\tvar channel = animationDef.channels[i];\r\n\t\t\tvar sampler = animationDef.samplers[channel.sampler];\r\n\t\t\tvar target = channel.target;\r\n\t\t\tvar name = target.node !== undefined ? target.node : target.id; // NOTE: target.id is deprecated.\r\n\t\t\tvar input = animationDef.parameters !== undefined ? animationDef.parameters[sampler.input] : sampler.input;\r\n\t\t\tvar output =\r\n\t\t\t\tanimationDef.parameters !== undefined ? animationDef.parameters[sampler.output] : sampler.output;\r\n\r\n\t\t\tpendingNodes.push(this.getDependency('node', name));\r\n\t\t\tpendingInputAccessors.push(this.getDependency('accessor', input));\r\n\t\t\tpendingOutputAccessors.push(this.getDependency('accessor', output));\r\n\t\t\tpendingSamplers.push(sampler);\r\n\t\t\tpendingTargets.push(target);\r\n\t\t}\r\n\r\n\t\treturn Promise.all([\r\n\t\t\tPromise.all(pendingNodes),\r\n\t\t\tPromise.all(pendingInputAccessors),\r\n\t\t\tPromise.all(pendingOutputAccessors),\r\n\t\t\tPromise.all(pendingSamplers),\r\n\t\t\tPromise.all(pendingTargets)\r\n\t\t]).then(function (dependencies) {\r\n\t\t\tvar nodes = dependencies[0];\r\n\t\t\tvar inputAccessors = dependencies[1];\r\n\t\t\tvar outputAccessors = dependencies[2];\r\n\t\t\tvar samplers = dependencies[3];\r\n\t\t\tvar targets = dependencies[4];\r\n\r\n\t\t\tvar tracks = [];\r\n\r\n\t\t\tfor (var i = 0, il = nodes.length; i < il; i++) {\r\n\t\t\t\tvar node = nodes[i];\r\n\t\t\t\tvar inputAccessor = inputAccessors[i];\r\n\t\t\t\tvar outputAccessor = outputAccessors[i];\r\n\t\t\t\tvar sampler = samplers[i];\r\n\t\t\t\tvar target = targets[i];\r\n\r\n\t\t\t\tif (node === undefined) continue;\r\n\r\n\t\t\t\tnode.updateMatrix();\r\n\t\t\t\tnode.matrixAutoUpdate = true;\r\n\r\n\t\t\t\tvar TypedKeyframeTrack;\r\n\r\n\t\t\t\tswitch (PATH_PROPERTIES[target.path]) {\r\n\t\t\t\t\tcase PATH_PROPERTIES.weights:\r\n\t\t\t\t\t\tTypedKeyframeTrack = NumberKeyframeTrack;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase PATH_PROPERTIES.rotation:\r\n\t\t\t\t\t\tTypedKeyframeTrack = QuaternionKeyframeTrack;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase PATH_PROPERTIES.position:\r\n\t\t\t\t\tcase PATH_PROPERTIES.scale:\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tTypedKeyframeTrack = VectorKeyframeTrack;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar targetName = node.name ? node.name : node.uuid;\r\n\r\n\t\t\t\tvar interpolation =\r\n\t\t\t\t\tsampler.interpolation !== undefined ? INTERPOLATION[sampler.interpolation] : InterpolateLinear;\r\n\r\n\t\t\t\tvar targetNames = [];\r\n\r\n\t\t\t\tif (PATH_PROPERTIES[target.path] === PATH_PROPERTIES.weights) {\r\n\t\t\t\t\t// Node may be a Group (glTF mesh with several primitives) or a Mesh.\r\n\t\t\t\t\tnode.traverse(function (object) {\r\n\t\t\t\t\t\tif (object.isMesh === true && object.morphTargetInfluences) {\r\n\t\t\t\t\t\t\ttargetNames.push(object.name ? object.name : object.uuid);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttargetNames.push(targetName);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar outputArray = outputAccessor.array;\r\n\r\n\t\t\t\tif (outputAccessor.normalized) {\r\n\t\t\t\t\tvar scale;\r\n\r\n\t\t\t\t\tif (outputArray.constructor === Int8Array) {\r\n\t\t\t\t\t\tscale = 1 / 127;\r\n\t\t\t\t\t} else if (outputArray.constructor === Uint8Array) {\r\n\t\t\t\t\t\tscale = 1 / 255;\r\n\t\t\t\t\t} else if (outputArray.constructor == Int16Array) {\r\n\t\t\t\t\t\tscale = 1 / 32767;\r\n\t\t\t\t\t} else if (outputArray.constructor === Uint16Array) {\r\n\t\t\t\t\t\tscale = 1 / 65535;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthrow new Error('THREE.GLTFLoader: Unsupported output accessor component type.');\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tvar scaled = new Float32Array(outputArray.length);\r\n\r\n\t\t\t\t\tfor (var j = 0, jl = outputArray.length; j < jl; j++) {\r\n\t\t\t\t\t\tscaled[j] = outputArray[j] * scale;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\toutputArray = scaled;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfor (var j = 0, jl = targetNames.length; j < jl; j++) {\r\n\t\t\t\t\tvar track = new TypedKeyframeTrack(\r\n\t\t\t\t\t\ttargetNames[j] + '.' + PATH_PROPERTIES[target.path],\r\n\t\t\t\t\t\tinputAccessor.array,\r\n\t\t\t\t\t\toutputArray,\r\n\t\t\t\t\t\tinterpolation\r\n\t\t\t\t\t);\r\n\r\n\t\t\t\t\t// Override interpolation with custom factory method.\r\n\t\t\t\t\tif (sampler.interpolation === 'CUBICSPLINE') {\r\n\t\t\t\t\t\ttrack.createInterpolant = function InterpolantFactoryMethodGLTFCubicSpline(result) {\r\n\t\t\t\t\t\t\t// A CUBICSPLINE keyframe in glTF has three output values for each input value,\r\n\t\t\t\t\t\t\t// representing inTangent, splineVertex, and outTangent. As a result, track.getValueSize()\r\n\t\t\t\t\t\t\t// must be divided by three to get the interpolant's sampleSize argument.\r\n\r\n\t\t\t\t\t\t\treturn new GLTFCubicSplineInterpolant(\r\n\t\t\t\t\t\t\t\tthis.times,\r\n\t\t\t\t\t\t\t\tthis.values,\r\n\t\t\t\t\t\t\t\tthis.getValueSize() / 3,\r\n\t\t\t\t\t\t\t\tresult\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t};\r\n\r\n\t\t\t\t\t\t// Mark as CUBICSPLINE. `track.getInterpolation()` doesn't support custom interpolants.\r\n\t\t\t\t\t\ttrack.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline = true;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttracks.push(track);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tvar name = animationDef.name !== undefined ? animationDef.name : 'animation_' + animationIndex;\r\n\r\n\t\t\treturn new AnimationClip(name, undefined, tracks);\r\n\t\t});\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#nodes-and-hierarchy\r\n\t * @param {number} nodeIndex\r\n\t * @return {Promise<Object3D>}\r\n\t */\r\n\tGLTFParser.prototype.loadNode = function (nodeIndex) {\r\n\t\tvar json = this.json;\r\n\t\tvar extensions = this.extensions;\r\n\t\tvar parser = this;\r\n\r\n\t\tvar meshReferences = json.meshReferences;\r\n\t\tvar meshUses = json.meshUses;\r\n\r\n\t\tvar nodeDef = json.nodes[nodeIndex];\r\n\r\n\t\treturn (function () {\r\n\t\t\tvar pending = [];\r\n\r\n\t\t\tif (nodeDef.mesh !== undefined) {\r\n\t\t\t\tpending.push(\r\n\t\t\t\t\tparser.getDependency('mesh', nodeDef.mesh).then(function (mesh) {\r\n\t\t\t\t\t\tvar node;\r\n\r\n\t\t\t\t\t\tif (meshReferences[nodeDef.mesh] > 1) {\r\n\t\t\t\t\t\t\tvar instanceNum = meshUses[nodeDef.mesh]++;\r\n\r\n\t\t\t\t\t\t\tnode = mesh.clone();\r\n\t\t\t\t\t\t\tnode.name += '_instance_' + instanceNum;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tnode = mesh;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// if weights are provided on the node, override weights on the mesh.\r\n\t\t\t\t\t\tif (nodeDef.weights !== undefined) {\r\n\t\t\t\t\t\t\tnode.traverse(function (o) {\r\n\t\t\t\t\t\t\t\tif (!o.isMesh) return;\r\n\r\n\t\t\t\t\t\t\t\tfor (var i = 0, il = nodeDef.weights.length; i < il; i++) {\r\n\t\t\t\t\t\t\t\t\to.morphTargetInfluences[i] = nodeDef.weights[i];\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\treturn node;\r\n\t\t\t\t\t})\r\n\t\t\t\t);\r\n\t\t\t}\r\n\r\n\t\t\tif (nodeDef.camera !== undefined) {\r\n\t\t\t\tpending.push(parser.getDependency('camera', nodeDef.camera));\r\n\t\t\t}\r\n\r\n\t\t\tif (\r\n\t\t\t\tnodeDef.extensions &&\r\n\t\t\t\tnodeDef.extensions[EXTENSIONS.KHR_LIGHTS_PUNCTUAL] &&\r\n\t\t\t\tnodeDef.extensions[EXTENSIONS.KHR_LIGHTS_PUNCTUAL].light !== undefined\r\n\t\t\t) {\r\n\t\t\t\tpending.push(parser.getDependency('light', nodeDef.extensions[EXTENSIONS.KHR_LIGHTS_PUNCTUAL].light));\r\n\t\t\t}\r\n\r\n\t\t\treturn Promise.all(pending);\r\n\t\t})().then(function (objects) {\r\n\t\t\tvar node;\r\n\r\n\t\t\t// .isBone isn't in glTF spec. See .markDefs\r\n\t\t\tif (nodeDef.isBone === true) {\r\n\t\t\t\tnode = new Bone();\r\n\t\t\t} else if (objects.length > 1) {\r\n\t\t\t\tnode = new Group();\r\n\t\t\t} else if (objects.length === 1) {\r\n\t\t\t\tnode = objects[0];\r\n\t\t\t} else {\r\n\t\t\t\tnode = new Object3D();\r\n\t\t\t}\r\n\r\n\t\t\tif (node !== objects[0]) {\r\n\t\t\t\tfor (var i = 0, il = objects.length; i < il; i++) {\r\n\t\t\t\t\tnode.add(objects[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (nodeDef.name !== undefined) {\r\n\t\t\t\tnode.userData.name = nodeDef.name;\r\n\t\t\t\tnode.name = PropertyBinding.sanitizeNodeName(nodeDef.name);\r\n\t\t\t}\r\n\r\n\t\t\tassignExtrasToUserData(node, nodeDef);\r\n\r\n\t\t\tif (nodeDef.extensions) addUnknownExtensionsToUserData(extensions, node, nodeDef);\r\n\r\n\t\t\tif (nodeDef.matrix !== undefined) {\r\n\t\t\t\tvar matrix = new Matrix4();\r\n\t\t\t\tmatrix.fromArray(nodeDef.matrix);\r\n\t\t\t\tnode.applyMatrix4(matrix);\r\n\t\t\t} else {\r\n\t\t\t\tif (nodeDef.translation !== undefined) {\r\n\t\t\t\t\tnode.position.fromArray(nodeDef.translation);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (nodeDef.rotation !== undefined) {\r\n\t\t\t\t\tnode.quaternion.fromArray(nodeDef.rotation);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (nodeDef.scale !== undefined) {\r\n\t\t\t\t\tnode.scale.fromArray(nodeDef.scale);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn node;\r\n\t\t});\r\n\t};\r\n\r\n\t/**\r\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#scenes\r\n\t * @param {number} sceneIndex\r\n\t * @return {Promise<Scene>}\r\n\t */\r\n\tGLTFParser.prototype.loadScene = (function () {\r\n\t\t// scene node hierachy builder\r\n\r\n\t\tfunction buildNodeHierachy(nodeId, parentObject, json, parser) {\r\n\t\t\tvar nodeDef = json.nodes[nodeId];\r\n\r\n\t\t\treturn parser\r\n\t\t\t\t.getDependency('node', nodeId)\r\n\t\t\t\t.then(function (node) {\r\n\t\t\t\t\tif (nodeDef.skin === undefined) return node;\r\n\r\n\t\t\t\t\t// build skeleton here as well\r\n\r\n\t\t\t\t\tvar skinEntry;\r\n\r\n\t\t\t\t\treturn parser\r\n\t\t\t\t\t\t.getDependency('skin', nodeDef.skin)\r\n\t\t\t\t\t\t.then(function (skin) {\r\n\t\t\t\t\t\t\tskinEntry = skin;\r\n\r\n\t\t\t\t\t\t\tvar pendingJoints = [];\r\n\r\n\t\t\t\t\t\t\tfor (var i = 0, il = skinEntry.joints.length; i < il; i++) {\r\n\t\t\t\t\t\t\t\tpendingJoints.push(parser.getDependency('node', skinEntry.joints[i]));\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\treturn Promise.all(pendingJoints);\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.then(function (jointNodes) {\r\n\t\t\t\t\t\t\tnode.traverse(function (mesh) {\r\n\t\t\t\t\t\t\t\tif (!mesh.isMesh) return;\r\n\r\n\t\t\t\t\t\t\t\tvar bones = [];\r\n\t\t\t\t\t\t\t\tvar boneInverses = [];\r\n\r\n\t\t\t\t\t\t\t\tfor (var j = 0, jl = jointNodes.length; j < jl; j++) {\r\n\t\t\t\t\t\t\t\t\tvar jointNode = jointNodes[j];\r\n\r\n\t\t\t\t\t\t\t\t\tif (jointNode) {\r\n\t\t\t\t\t\t\t\t\t\tbones.push(jointNode);\r\n\r\n\t\t\t\t\t\t\t\t\t\tvar mat = new Matrix4();\r\n\r\n\t\t\t\t\t\t\t\t\t\tif (skinEntry.inverseBindMatrices !== undefined) {\r\n\t\t\t\t\t\t\t\t\t\t\tmat.fromArray(skinEntry.inverseBindMatrices.array, j * 16);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t\t\tboneInverses.push(mat);\r\n\t\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\t\tconsole.warn(\r\n\t\t\t\t\t\t\t\t\t\t\t'THREE.GLTFLoader: Joint \"%s\" could not be found.',\r\n\t\t\t\t\t\t\t\t\t\t\tskinEntry.joints[j]\r\n\t\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\tmesh.bind(new Skeleton(bones, boneInverses), mesh.matrixWorld);\r\n\t\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\t\t\treturn node;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t})\r\n\t\t\t\t.then(function (node) {\r\n\t\t\t\t\t// build node hierachy\r\n\r\n\t\t\t\t\tparentObject.add(node);\r\n\r\n\t\t\t\t\tvar pending = [];\r\n\r\n\t\t\t\t\tif (nodeDef.children) {\r\n\t\t\t\t\t\tvar children = nodeDef.children;\r\n\r\n\t\t\t\t\t\tfor (var i = 0, il = children.length; i < il; i++) {\r\n\t\t\t\t\t\t\tvar child = children[i];\r\n\t\t\t\t\t\t\tpending.push(buildNodeHierachy(child, node, json, parser));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\treturn Promise.all(pending);\r\n\t\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn function loadScene(sceneIndex) {\r\n\t\t\tvar json = this.json;\r\n\t\t\tvar extensions = this.extensions;\r\n\t\t\tvar sceneDef = this.json.scenes[sceneIndex];\r\n\t\t\tvar parser = this;\r\n\r\n\t\t\tvar scene = new Scene();\r\n\t\t\tif (sceneDef.name !== undefined) scene.name = sceneDef.name;\r\n\r\n\t\t\tassignExtrasToUserData(scene, sceneDef);\r\n\r\n\t\t\tif (sceneDef.extensions) addUnknownExtensionsToUserData(extensions, scene, sceneDef);\r\n\r\n\t\t\tvar nodeIds = sceneDef.nodes || [];\r\n\r\n\t\t\tvar pending = [];\r\n\r\n\t\t\tfor (var i = 0, il = nodeIds.length; i < il; i++) {\r\n\t\t\t\tpending.push(buildNodeHierachy(nodeIds[i], scene, json, parser));\r\n\t\t\t}\r\n\r\n\t\t\treturn Promise.all(pending).then(function () {\r\n\t\t\t\treturn scene;\r\n\t\t\t});\r\n\t\t};\r\n\t})();\r\n\r\n\treturn GLTFLoader;\r\n})();\r\n\r\nexport { GLTFLoader };\r\n","const zlib = window.Zlib;\r\n\r\nfunction isGunzipBuffer(arrayBuffer) {\r\n\tlet typedArray = new Uint8Array(arrayBuffer);\r\n\treturn typedArray[0] === 0x1f && typedArray[1] === 0x8b;\r\n}\r\n\r\nfunction gunzip(arrayBuffer) {\r\n\tlet typedArray = new Uint8Array(arrayBuffer);\r\n\tif (!zlib) {\r\n\t\tconsole.error(\r\n\t\t\t'Lack of necessary dependencies: gunzip.min.js.\\n You can add this vendors to enable this feature or get it at https://github.com/imaya/zlib.js/blob/master/bin/gunzip.min.js'\r\n\t\t);\r\n\t\treturn;\r\n\t}\r\n\tlet zdec = new zlib.Gunzip(typedArray);\r\n\tlet result = zdec.decompress();\r\n\treturn result.buffer;\r\n}\r\n\r\nexport { isGunzipBuffer, gunzip };\r\n","import * as THREE from 'three';\r\nimport { isGunzipBuffer, gunzip } from './zlib';\r\n\r\nexport default class CubeMapEnv {\r\n\tconstructor(data, size, options) {\r\n\t\tthis._options = options || {};\r\n\t\tthis._size = size;\r\n\t\tthis._data = data;\r\n\t}\r\n\r\n\t// Convert to RGBA Buffer\r\n\tdeinterleaveImage4(size, src, dst) {\r\n\t\tlet npixel = size * size;\r\n\t\tlet npixel2 = 2 * size * size;\r\n\t\tlet npixel3 = 3 * size * size;\r\n\t\tlet idx = 0;\r\n\t\tfor (let i = 0; i < npixel; i++) {\r\n\t\t\tdst[idx++] = src[i];\r\n\t\t\tdst[idx++] = src[i + npixel];\r\n\t\t\tdst[idx++] = src[i + npixel2];\r\n\t\t\tdst[idx++] = src[i + npixel3];\r\n\t\t}\r\n\t}\r\n\r\n\tloadPacked() {\r\n\t\tlet readInputArray = inputArray => {\r\n\t\t\tlet data = inputArray;\r\n\t\t\tif (isGunzipBuffer(data)) data = gunzip(data);\r\n\r\n\t\t\tconst maxLevel = Math.log(this._size) / Math.LN2;\r\n\t\t\tlet offset = 0;\r\n\t\t\tlet images = {};\r\n\t\t\t// Load cube mipmaps data\r\n\t\t\t// Per mipmaps level => 6 faces data\r\n\t\t\tfor (let i = 0; i <= maxLevel; i++) {\r\n\t\t\t\tlet size = Math.pow(2, maxLevel - i);\r\n\t\t\t\tlet byteSize;\r\n\t\t\t\tif (offset >= data.byteLength) break;\r\n\t\t\t\tfor (let face = 0; face < 6; face++) {\r\n\t\t\t\t\t// Add entry if does not exist\r\n\t\t\t\t\tif (!images[face]) images[face] = [];\r\n\t\t\t\t\tlet imageData;\r\n\t\t\t\t\tlet deinterleave;\r\n\r\n\t\t\t\t\t// RGBA\r\n\t\t\t\t\tbyteSize = size * size * 4;\r\n\t\t\t\t\t// Read a block of data\r\n\t\t\t\t\timageData = new Uint8Array(data, offset, byteSize);\r\n\t\t\t\t\t// Split it\r\n\t\t\t\t\tdeinterleave = new Uint8Array(byteSize);\r\n\t\t\t\t\tthis.deinterleaveImage4(size, imageData, deinterleave);\r\n\r\n\t\t\t\t\timageData = deinterleave;\r\n\t\t\t\t\timages[face].push(imageData);\r\n\t\t\t\t\t// Next block\r\n\t\t\t\t\toffset += byteSize;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._packedImages = images;\r\n\t\t\tthis.createRGBA8Packed();\r\n\t\t};\r\n\r\n\t\treturn readInputArray(this._data);\r\n\t}\r\n\r\n\tcreateRGBA8Packed() {\r\n\t\tlet cubeTextures = (this.cubeTextures = []);\r\n\t\tlet size = this._size;\r\n\t\tlet packedImages = this._packedImages;\r\n\t\t// CubeTexture Mipmap\r\n\t\tconst numMips = packedImages[0].length;\r\n\t\tlet textureEncoding = THREE.LogLuvEncoding;\r\n\r\n\t\tfor (let mip = 0; mip < numMips; mip++) {\r\n\t\t\tlet cubeTexture = new THREE.CubeTexture();\r\n\t\t\tcubeTextures.push(cubeTexture);\r\n\t\t\tcubeTexture.format = THREE.RGBAFormat;\r\n\t\t\tcubeTexture.encoding = textureEncoding;\r\n\t\t\tcubeTexture.minFilter = THREE.LinearMipMapLinearFilter;\r\n\t\t\tcubeTexture.magFilter = THREE.LinearFilter;\r\n\t\t\tcubeTexture.generateMipmaps = false;\r\n\r\n\t\t\t// Get per face data\r\n\t\t\tfor (let face = 0; face < 6; face++) {\r\n\t\t\t\tlet dataTexture = new THREE.DataTexture(packedImages[face][mip], size, size, THREE.RGBAFormat);\r\n\t\t\t\tdataTexture.format = cubeTexture.format;\r\n\t\t\t\tdataTexture.encoding = textureEncoding;\r\n\t\t\t\tdataTexture.type = cubeTexture.type;\r\n\t\t\t\tdataTexture.generateMipmaps = false;\r\n\t\t\t\tcubeTexture.images[face] = dataTexture;\r\n\t\t\t\tcubeTexture.needsUpdate = true;\r\n\t\t\t}\r\n\t\t\tcubeTexture.needsUpdate = true;\r\n\t\t\tsize = size / 2;\r\n\t\t}\r\n\t\t// Integrate\r\n\t\tthis.texture = new THREE.CubeTexture();\r\n\t\tthis.texture.format = THREE.RGBAFormat;\r\n\t\tthis.texture.encoding = textureEncoding;\r\n\t\tthis.texture.minFilter = this._options.minFilter || THREE.LinearMipMapLinearFilter;\r\n\t\tthis.texture.magFilter = this._options.magFilter || THREE.LinearFilter;\r\n\t\tthis.texture.generateMipmaps = false;\r\n\r\n\t\tfor (let i = 0; i < 6; i++) {\r\n\t\t\tthis.texture.image[i] = this.cubeTextures[0].images[i];\r\n\t\t\tfor (let m = 1; m < numMips; m++) {\r\n\t\t\t\tthis.texture.mipmaps[m - 1] = this.cubeTextures[m];\r\n\t\t\t\tthis.cubeTextures[m].needsUpdate = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.texture.needsUpdate = true;\r\n\t}\r\n}\r\n","import * as THREE from 'three';\r\nimport { isGunzipBuffer, gunzip } from './zlib';\r\n\r\nexport default class PanoramaEnv {\r\n\tconstructor(data, size, options) {\r\n\t\tthis._options = options || {};\r\n\t\tthis._size = size;\r\n\t\tthis._data = data;\r\n\t\tthis._texture = null;\r\n\t}\r\n\r\n\tget texture() {\r\n\t\treturn this._texture;\r\n\t}\r\n\r\n\t// Convert to RGBA Buffer\r\n\tdeinterleaveImage4(size, src, dst) {\r\n\t\tlet npixel = size * size;\r\n\t\tlet npixel2 = 2 * size * size;\r\n\t\tlet npixel3 = 3 * size * size;\r\n\t\tlet idx = 0;\r\n\t\tfor (let i = 0; i < npixel; i++) {\r\n\t\t\tdst[idx++] = src[i];\r\n\t\t\tdst[idx++] = src[i + npixel];\r\n\t\t\tdst[idx++] = src[i + npixel2];\r\n\t\t\tdst[idx++] = src[i + npixel3];\r\n\t\t}\r\n\t}\r\n\r\n\tloadPacked() {\r\n\t\tlet readInputArray = inputArray => {\r\n\t\t\tlet data = inputArray;\r\n\t\t\tif (isGunzipBuffer(data)) data = gunzip(data);\r\n\r\n\t\t\tlet size = this._size;\r\n\t\t\tlet imageData, deinterleave;\r\n\r\n\t\t\timageData = new Uint8Array(data);\r\n\t\t\tdeinterleave = new Uint8Array(data.byteLength);\r\n\t\t\tthis.deinterleaveImage4(size, imageData, deinterleave);\r\n\r\n\t\t\timageData = deinterleave;\r\n\r\n\t\t\tlet dataTexture = new THREE.DataTexture(imageData, size, size, THREE.RGBAFormat);\r\n\t\t\tdataTexture.encoding = THREE.LogLuvEncoding;\r\n\t\t\tdataTexture.flipY = true;\r\n\t\t\tdataTexture.needsUpdate = true;\r\n\t\t\tthis._texture = dataTexture;\r\n\t\t\tdataTexture.magFilter = THREE.LinearFilter;\r\n\t\t\tdataTexture.minFilter = THREE.LinearFilter;\r\n\t\t};\r\n\r\n\t\treturn readInputArray(this._data);\r\n\t}\r\n}\r\n","import * as THREE from 'three';\r\nimport { isGunzipBuffer, gunzip } from './zlib';\r\n\r\nexport default class IntegrateBRDF {\r\n\tconstructor(data, size) {\r\n\t\tthis._data = data;\r\n\t\tthis._size = size;\r\n\t}\r\n\r\n\tloadPacked() {\r\n\t\tlet readInputArray = inputArray => {\r\n\t\t\tlet size = this._size;\r\n\t\t\tlet data = inputArray;\r\n\t\t\tif (isGunzipBuffer(data)) data = gunzip(data);\r\n\r\n\t\t\tlet byteSize = size * size * 4;\r\n\t\t\tlet imageData = new Uint8Array(data, 0, byteSize);\r\n\t\t\tlet _texture = new THREE.DataTexture(imageData, size, size, THREE.RGBAFormat);\r\n\t\t\treturn _texture;\r\n\t\t};\r\n\r\n\t\treturn readInputArray(this._data);\r\n\t}\r\n}\r\n","export default class EnvironmentSphericalHarmonics {\r\n\tconstructor(file) {\r\n\t\tthis._file = file;\r\n\t\tthis.initSHCoef(file);\r\n\t}\r\n\r\n\tinitSHCoef(sphCoef) {\r\n\t\t// use spherical harmonics with 9 coef\r\n\t\tthis._sphCoef = sphCoef.slice(0, 9 * 3);\r\n\r\n\t\tlet coef0 = 1.0 / (2.0 * Math.sqrt(Math.PI));\r\n\t\tlet coef1 = -(Math.sqrt(3.0 / Math.PI) * 0.5);\r\n\t\tlet coef2 = -coef1;\r\n\t\tlet coef3 = coef1;\r\n\t\tlet coef4 = Math.sqrt(15.0 / Math.PI) * 0.5;\r\n\t\tlet coef5 = -coef4;\r\n\t\tlet coef6 = Math.sqrt(5.0 / Math.PI) * 0.25;\r\n\t\tlet coef7 = coef5;\r\n\t\tlet coef8 = Math.sqrt(15.0 / Math.PI) * 0.25;\r\n\r\n\t\tlet coef = [\r\n\t\t\tcoef0,\r\n\t\t\tcoef0,\r\n\t\t\tcoef0,\r\n\t\t\tcoef1,\r\n\t\t\tcoef1,\r\n\t\t\tcoef1,\r\n\t\t\tcoef2,\r\n\t\t\tcoef2,\r\n\t\t\tcoef2,\r\n\t\t\tcoef3,\r\n\t\t\tcoef3,\r\n\t\t\tcoef3,\r\n\t\t\tcoef4,\r\n\t\t\tcoef4,\r\n\t\t\tcoef4,\r\n\t\t\tcoef5,\r\n\t\t\tcoef5,\r\n\t\t\tcoef5,\r\n\t\t\tcoef6,\r\n\t\t\tcoef6,\r\n\t\t\tcoef6,\r\n\t\t\tcoef7,\r\n\t\t\tcoef7,\r\n\t\t\tcoef7,\r\n\t\t\tcoef8,\r\n\t\t\tcoef8,\r\n\t\t\tcoef8\r\n\t\t];\r\n\r\n\t\tthis._sphCoef = coef.map((value, index) => {\r\n\t\t\treturn value * this._sphCoef[index];\r\n\t\t});\r\n\t\tthis._uniformSpherical = new Float32Array(3 * 9);\r\n\t\tfor (let i = 0; i < 9; i++) {\r\n\t\t\tthis._uniformSpherical[i * 3] = this._sphCoef[i * 3];\r\n\t\t\tthis._uniformSpherical[i * 3 + 1] = this._sphCoef[i * 3 + 1];\r\n\t\t\tthis._uniformSpherical[i * 3 + 2] = this._sphCoef[i * 3 + 2];\r\n\t\t}\r\n\t}\r\n}\r\n","function requestFileFromURL(url, options) {\r\n\treturn new Promise(function (resolve, reject) {\r\n\t\tvar req = new XMLHttpRequest();\r\n\t\treq.open('GET', url, true);\r\n\r\n\t\tvar responseType = options && options.responseType ? options.responseType.toLowerCase() : undefined;\r\n\r\n\t\t// handle responseType\r\n\t\tif (responseType) req.responseType = responseType;\r\n\r\n\t\tif (options && options.progress) {\r\n\t\t\treq.addEventListener('progress', options.progress, false);\r\n\t\t}\r\n\r\n\t\treq.addEventListener('error', reject, false);\r\n\r\n\t\treq.addEventListener('load', function () {\r\n\t\t\tif (req.responseType === 'arraybuffer' || req.responseType === 'blob') resolve(req.response);\r\n\t\t\telse resolve(req.responseText);\r\n\t\t});\r\n\r\n\t\treq.send(null);\r\n\t});\r\n}\r\n\r\nfunction requestFileFromReader(file, options) {\r\n\treturn new Promise(function (resolve) {\r\n\t\tvar responseType = options && options.responseType ? options.responseType.toLowerCase() : undefined;\r\n\t\tvar reader = new window.FileReader();\r\n\t\treader.onload = function (data) {\r\n\t\t\tresolve(data.target.result);\r\n\t\t};\r\n\t\t// handle responseType\r\n\t\tif (responseType) {\r\n\t\t\tif (responseType === 'arraybuffer') reader.readAsArrayBuffer(file);\r\n\t\t\telse if (responseType === 'blob') resolve(file);\r\n\t\t\telse if (responseType === 'string') reader.readAsText(file);\r\n\t\t\telse reader.readAsDataURL(file);\r\n\t\t} else {\r\n\t\t\treader.readAsText(file);\r\n\t\t}\r\n\t});\r\n}\r\n\r\nfunction requestFile(urlOrFile, options) {\r\n\tif (typeof urlOrFile === 'string') {\r\n\t\treturn requestFileFromURL(urlOrFile, options);\r\n\t} else {\r\n\t\treturn requestFileFromReader(urlOrFile, options);\r\n\t}\r\n}\r\n\r\nexport default requestFile;\r\n","import requestFile from './requestFile.js';\r\n\r\nlet mimeTypes = new Map();\r\n\r\nvar isString = function (str) {\r\n\treturn typeof str === 'string' || str instanceof String;\r\n};\r\n\r\nvar isBlobURL = function (str) {\r\n\treturn str.substr(0, 9) === 'blob:http';\r\n};\r\n\r\nvar isHttpURL = function (str) {\r\n\treturn str.substr(0, 7) === 'http://' || str.substr(0, 8) === 'https://';\r\n};\r\n\r\nvar isURL = function (str) {\r\n\tif (!isString(str)) return false;\r\n\r\n\treturn isBlobURL(str) || isHttpURL(str);\r\n};\r\n\r\nvar createImageFromURL = function (url) {\r\n\treturn new Promise(function (resolve, reject) {\r\n\t\tvar img = new Image();\r\n\t\timg.onerror = function () {\r\n\t\t\treject(img);\r\n\t\t};\r\n\r\n\t\timg.onload = function () {\r\n\t\t\tresolve(img);\r\n\t\t};\r\n\t\timg.src = url;\r\n\t});\r\n};\r\n\r\nvar createImageFromBlob = function (blob) {\r\n\tvar privateURL = window.URL.createObjectURL(blob);\r\n\tvar promise = createImageFromURL(privateURL);\r\n\r\n\tpromise.finally(function () {\r\n\t\twindow.URL.revokeObjectURL(privateURL);\r\n\t});\r\n\treturn promise;\r\n};\r\n\r\nvar createArrayBufferFromBlob = function (blob) {\r\n\treturn new Promise(function (resolve, reject) {\r\n\t\tvar fr = new FileReader();\r\n\r\n\t\tfr.onerror = function () {\r\n\t\t\treject(fr);\r\n\t\t};\r\n\r\n\t\tfr.onload = function () {\r\n\t\t\tresolve(this.result);\r\n\t\t};\r\n\t\tfr.readAsArrayBuffer(blob);\r\n\t});\r\n};\r\n\r\nvar createArrayBufferFromURL = function (url) {\r\n\treturn requestFile(url, {\r\n\t\tresponseType: 'arraybuffer'\r\n\t});\r\n};\r\n\r\nvar createJSONFromURL = function (url) {\r\n\treturn requestFile(url).then(function (string) {\r\n\t\treturn JSON.parse(string);\r\n\t});\r\n};\r\n\r\nvar createJSONFromString = function (str) {\r\n\tvar obj = JSON.parse(str);\r\n\treturn Promise.resolve(obj);\r\n};\r\n\r\nvar fileHelper = {\r\n\tcreateJSONFromURL: createJSONFromURL,\r\n\tcreateArrayBufferFromURL: createArrayBufferFromURL,\r\n\tcreateArrayBufferFromBlob: createArrayBufferFromBlob,\r\n\tcreateImageFromBlob: createImageFromBlob,\r\n\tcreateImageFromURL: createImageFromURL,\r\n\r\n\trequestURI: requestFile,\r\n\trequestResource: function (uri, options) {\r\n\t\tvar extension = fileHelper.getExtension(uri);\r\n\t\tvar mimetype = fileHelper.getMimeType(extension);\r\n\r\n\t\tvar responseType = options && options.responseType ? options.responseType.toLowerCase() : undefined;\r\n\t\tif (responseType) return requestFile(uri, options);\r\n\r\n\t\tif (mimetype) {\r\n\t\t\tif (mimetype.match('image')) return createImageFromURL(uri);\r\n\t\t\telse if (mimetype.match('binary')) return createArrayBufferFromURL(uri);\r\n\t\t\telse if (mimetype.match('json')) return createJSONFromURL(uri);\r\n\t\t\telse if (mimetype.match('text')) return requestFile(uri);\r\n\t\t}\r\n\r\n\t\treturn requestFile(uri);\r\n\t},\r\n\r\n\t//     file.png :  url          -> fetch/createImage            ->   Image\r\n\t//     file.png :  blob         -> createImage                  ->   Image\r\n\t//     file.png :  Image        -> passthroug                   ->   Image\r\n\t//     file.txt :  blob         -> FileReader                   ->   String\r\n\t//     file.txt :  string       -> passthroug                   ->   String\r\n\t//     file.txt :  url          -> fetch                        ->   String\r\n\t//     file.json:  string       -> JSON.parse                   ->   Object\r\n\t//     file.json:  url          -> fetch/JSON.parse             ->   Object\r\n\t//     file.json:  blob         -> FileReader/JSON.parse        ->   Object\r\n\t//     file.bin :  blob         -> FileReader/readAsArrayBuffer ->   arrayBuffer\r\n\t//     file.bin :  url          -> fetch as arra yBuffer        ->   arrayBuffer\r\n\t//     file.bin :  arrayBuffer  -> passthroug                   ->   arrayBuffer\r\n\tresolveData: function (uri, data) {\r\n\t\tvar extension = fileHelper.getExtension(uri);\r\n\t\tvar mimetype = fileHelper.getMimeType(extension);\r\n\t\tvar createData;\r\n\r\n\t\tif (mimetype) {\r\n\t\t\tif (mimetype.match('image')) {\r\n\t\t\t\tif (isString(data)) createData = createImageFromURL;\r\n\t\t\t\telse if (data instanceof Blob) createData = createImageFromBlob;\r\n\t\t\t} else if (mimetype.match('json')) {\r\n\t\t\t\tif (isURL(data)) createData = createJSONFromURL;\r\n\t\t\t\telse createData = createJSONFromString;\r\n\t\t\t} else if (mimetype.match('binary')) {\r\n\t\t\t\tif (isString(data)) createData = createArrayBufferFromURL;\r\n\t\t\t\telse if (data instanceof Blob) createData = createArrayBufferFromBlob;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar promise;\r\n\t\tif (createData) {\r\n\t\t\tpromise = createData(data);\r\n\t\t} else {\r\n\t\t\tpromise = Promise.resolve(data);\r\n\t\t}\r\n\t\treturn promise;\r\n\t},\r\n\r\n\tresolveFilesMap: function (filesMap) {\r\n\t\tvar promises = [];\r\n\r\n\t\tfor (var filename in filesMap) {\r\n\t\t\tvar data = filesMap[filename];\r\n\t\t\tvar promise = fileHelper.resolveData(filename, data).then(\r\n\t\t\t\tfunction (fname, dataResolved) {\r\n\t\t\t\t\tthis[fname] = dataResolved;\r\n\t\t\t\t}.bind(filesMap, filename)\r\n\t\t\t);\r\n\t\t\tpromises.push(promise);\r\n\t\t}\r\n\r\n\t\treturn Promise.all(promises).then(function () {\r\n\t\t\treturn filesMap;\r\n\t\t});\r\n\t},\r\n\r\n\tgetMimeType: function (extension) {\r\n\t\treturn mimeTypes.get(extension);\r\n\t},\r\n\r\n\tgetExtension: function (url) {\r\n\t\treturn url.substr(url.lastIndexOf('.') + 1);\r\n\t},\r\n\r\n\taddMimeTypeForExtension: function (extension, mimeType) {\r\n\t\tif (mimeTypes.has(extension) !== undefined) {\r\n\t\t\tconsole.warn(\"the '\" + extension + \"' already has a mimetype: \" + mimeTypes.get(extension));\r\n\t\t}\r\n\t\tmimeTypes.set(extension, mimeType);\r\n\t}\r\n};\r\n\r\nmimeTypes.set('bin', 'application/octet-binary');\r\nmimeTypes.set('b3dm', 'application/octet-binary');\r\nmimeTypes.set('glb', 'application/octet-binary');\r\nmimeTypes.set('zip', 'application/octet-binary');\r\nmimeTypes.set('gz', 'application/octet-binary');\r\n// Image\r\nmimeTypes.set('png', 'image/png');\r\nmimeTypes.set('jpg', 'image/jpeg');\r\nmimeTypes.set('jpeg', 'image/jpeg');\r\nmimeTypes.set('gif', 'image/gif');\r\n// Text\r\nmimeTypes.set('json', 'application/json');\r\nmimeTypes.set('gltf', 'application/json');\r\nmimeTypes.set('osgjs', 'application/json');\r\nmimeTypes.set('txt', 'text/plain');\r\nmimeTypes.set('glsl', 'text/plain');\r\n\r\nexport default fileHelper;\r\n","// refer: https://github.com/cedricpinson/osgjs\r\n\r\nimport * as THREE from 'three';\r\nimport EnvironmentCubeMap from './EnvironmentCubeMap';\r\nimport EnvironmentPanorama from './EnvironmentPanorama';\r\nimport IntegrateBRDFMap from './IntegrateBRDFMap';\r\nimport EnvironmentSphericalHarmonics from './EnvironmentSphericalHarmonics';\r\nimport fileHelper from './fileHelper';\r\nconst brdfLUTPath = './assets/envMap/brdf_ue4.bin.gz';\r\n\r\nclass Environment {\r\n\tconstructor(assetLibrary) {\r\n\t\tlet { textureLODSupport, isMobile } = assetLibrary;\r\n\t\tthis.isMobile = isMobile;\r\n\t\tthis.textureLODSupport = textureLODSupport;\r\n\t\tthis.assetLibrary = assetLibrary;\r\n\t\tthis._config = undefined;\r\n\t\tthis._files = {};\r\n\t\tthis.uIntegrateBRDF = assetLibrary.get('uIntegrateBRDF');\r\n\t}\r\n\r\n\tasync loadPackage(url, opts = {}) {\r\n\t\tthis.url = url;\r\n\t\tthis.needBG = opts.needBG;\r\n\t\tconst configSrc = `${url}config.json`;\r\n\t\tlet config = await fileHelper.requestResource(configSrc);\r\n\t\treturn await this.init(config);\r\n\t}\r\n\r\n\tgetImage(type, encoding, format) {\r\n\t\tlet results = this.getTextures(type, encoding, format);\r\n\t\tif (!results.length) return undefined;\r\n\t\t// Add limitSize\r\n\t\tif (results[0].limitSize) results[0].images[0].limitSize = results[0].limitSize;\r\n\t\treturn results[0].images[0];\r\n\t}\r\n\r\n\t// Filter texture by condition\r\n\tgetTextures(type, encoding, format) {\r\n\t\tlet textures = this._config.textures;\r\n\t\tlet results = textures.filter(texture => {\r\n\t\t\treturn texture.encoding === encoding && texture.format === format && texture.type === type;\r\n\t\t});\r\n\t\treturn results;\r\n\t}\r\n\r\n\tasync init(config) {\r\n\t\t// LUV format only\r\n\t\tthis._config = config;\r\n\r\n\t\tlet envMapFormat = 'panorama';\r\n\t\tif (this.textureLODSupport) envMapFormat = 'cubemap';\r\n\r\n\t\tlet textureData = this.getImage('specular_ue4', 'luv', envMapFormat);\r\n\t\tlet mapFile = textureData.file;\r\n\t\tlet mapSize = textureData.width;\r\n\t\tlet mapData = await fileHelper.requestResource(`${this.url}${mapFile}`);\r\n\t\tif (envMapFormat === 'cubemap') {\r\n\t\t\tthis.mapEnv = new EnvironmentCubeMap(mapData, mapSize, config);\r\n\t\t} else {\r\n\t\t\tthis.mapEnv = new EnvironmentPanorama(mapData, mapSize, config);\r\n\t\t}\r\n\t\tthis.mapEnv.loadPacked();\r\n\t\tlet minTextureSize = textureData.limitSize;\r\n\t\tlet nbLod = Math.log(mapSize) / Math.LN2;\r\n\t\tlet maxLod = nbLod - Math.log(minTextureSize) / Math.LN2;\r\n\t\tthis.uEnvironmentLodRange = [nbLod, maxLod];\r\n\t\tthis.uEnvironmentSize = [mapSize, envMapFormat == 'cubemap'? mapSize: mapSize/2];\r\n\r\n\t\tif (!this.uIntegrateBRDF) {\r\n\t\t\t// LUT\r\n\t\t\tlet lutTextureData = this.getImage('brdf_ue4', 'rg16', 'lut');\r\n\t\t\tlet lutSize = lutTextureData.width;\r\n\t\t\tlet lutData = await fileHelper.requestResource(brdfLUTPath);\r\n\t\t\tthis._integrateBRDF = new IntegrateBRDFMap(lutData, lutSize);\r\n\t\t\tthis.uIntegrateBRDF = this._integrateBRDF.loadPacked();\r\n\t\t\tthis.assetLibrary.set('uIntegrateBRDF', this.uIntegrateBRDF);\r\n\t\t}\r\n\r\n\t\t// Background\r\n\t\tif (this.needBG) {\r\n\t\t\tlet bgTextureData = this.getImage('background', 'luv', 'cubemap');\r\n\t\t\tlet bgFile = bgTextureData.file;\r\n\t\t\tlet bgSize = bgTextureData.width;\r\n\t\t\tlet bgData = await fileHelper.requestResource(`${this.url}${bgFile}`);\r\n\t\t\tthis.backgroundEnv = new EnvironmentCubeMap(bgData, bgSize, {\r\n\t\t\t\tminFilter: THREE.LinearFilter,\r\n\t\t\t\tmagFilter: THREE.LinearFilter\r\n\t\t\t});\r\n\t\t\tthis.backgroundEnv.loadPacked();\r\n\t\t\tthis.uBGEnvironmentSize = [bgSize, bgSize];\r\n\t\t}\r\n\r\n\t\t// EnvironmentSphericalHarmonics\r\n\t\tthis._spherical = new EnvironmentSphericalHarmonics(config.diffuseSPH);\r\n\t\tthis.uEnvironmentSphericalHarmonics = this._spherical._uniformSpherical;\r\n\r\n\t\t// Light\r\n\t\tif (config.Lights) {\r\n\t\t\tlet sunlight = config.Lights[0];\r\n\t\t\tthis.sunlightInfo = {\r\n\t\t\t\tcolor: new THREE.Color().fromArray(sunlight.color),\r\n\t\t\t\tposition: new THREE.Vector3().fromArray(sunlight.direction).negate(),\r\n\t\t\t\tintensity: sunlight.luminosity\r\n\t\t\t};\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n}\r\n\r\nexport { Environment };\r\n","import * as THREE from 'three';\r\nimport Signal from 'JS/Signal';\r\nimport { GLTFLoader } from 'LIB/threejs/loaders/GLTFLoader';\r\nimport { Environment } from 'MODULES/Environment/Environment';\r\nimport { checkLODSupport } from 'JS/Utils';\r\nimport loadFont from 'load-bmfont';\r\n\r\nexport default class AssetLibrary {\r\n\tconstructor(isMobile) {\r\n\t\tthis.loadedNumber = 0;\r\n\t\tthis.loadQueue = [];\r\n\t\tthis.assets = {};\r\n\t\tthis.onCompleteEvent = new Signal();\r\n\t\tthis.onProgressEvent = new Signal();\r\n\t\tthis.isMobile = isMobile;\r\n\t\tthis.textureLODSupport = checkLODSupport();\r\n\t}\r\n\r\n\tget onComplete() {\r\n\t\treturn this.onCompleteEvent;\r\n\t}\r\n\r\n\tget onProgress() {\r\n\t\treturn this.onProgressEvent;\r\n\t}\r\n\r\n\tget(key) {\r\n\t\treturn this.assets[key];\r\n\t}\r\n\r\n\tset(key, value) {\r\n\t\tthis.assets[key] = value;\r\n\t}\r\n\r\n\taddLoadQueue(key, path, type, parser, opts) {\r\n\t\tthis.loadQueue.push({ key, filePath: path, type, parser, opts });\r\n\t}\r\n\r\n\tload() {\r\n\t\tif (this.loadQueue.length === 0) return void this.onComplete.dispatch();\r\n\t\tlet asset = this.loadQueue[this.loadedNumber];\r\n\t\tswitch (asset.type) {\r\n\t\t\tcase 'Texture':\r\n\t\t\t\tthis.loadTexture(asset.filePath, asset.key, asset.parser);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'Model':\r\n\t\t\t\tthis.loadModel(asset.filePath, asset.key, asset.parser);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'EnvMap':\r\n\t\t\t\tthis.loadEnvMap(asset.filePath, asset.key, asset.opts);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'Font':\r\n\t\t\t\tthis.loadFontAsset(asset.filePath, asset.key);\r\n\t\t\t\tbreak;\r\n\t\t\tdefault:\r\n\t\t\t\tconsole.error(`No support ${asset.type} type asset!`);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tloadTexture(filePath, key, parser) {\r\n\t\tlet loader = new (parser || THREE.TextureLoader)();\r\n\t\tloader.load(filePath, texture => {\r\n\t\t\tthis.assets[key] = texture;\r\n\t\t\ttexture.minFilter = THREE.LinearFilter;\r\n\t\t\tthis.onAssetLoaded();\r\n\t\t});\r\n\t}\r\n\r\n\tloadModel(filePath, key, parser) {\r\n\t\tlet loader = new (parser || GLTFLoader)();\r\n\t\tloader.load(filePath, model => {\r\n\t\t\tthis.assets[key] = model;\r\n\t\t\tthis.onAssetLoaded();\r\n\t\t});\r\n\t}\r\n\r\n\tloadEnvMap(filePath, key, opts) {\r\n\t\tnew Environment(this).loadPackage(filePath, opts).then(env => {\r\n\t\t\tthis.assets[key] = env;\r\n\t\t\tthis.onAssetLoaded();\r\n\t\t});\r\n\t}\r\n\r\n\tloadFontAsset(filePath, key) {\r\n\t\tloadFont('./assets/fonts/Lato.fnt', (err, font) => {\r\n\t\t\tthis.assets[key] = font;\r\n\t\t\tthis.onAssetLoaded();\r\n\t\t});\r\n\t}\r\n\r\n\tonAssetLoaded() {\r\n\t\tthis.loadedNumber += 1;\r\n\t\tthis.onProgress.dispatch(this.loadedNumber / this.loadQueue.length);\r\n\t\tif (this.loadedNumber === this.loadQueue.length) {\r\n\t\t\t// Load Complete\r\n\t\t\tthis.onComplete.dispatch(this);\r\n\t\t} else {\r\n\t\t\t// Or continue load next asset\r\n\t\t\tthis.load();\r\n\t\t}\r\n\t}\r\n}\r\n","const commonAssetList = [\r\n\t// Home Section\r\n\t{\r\n\t\tkey: 'EnvMap-Industrial',\r\n\t\tpath: './assets/envMap/Industrial/',\r\n\t\ttype: 'EnvMap'\r\n\t},\r\n\t{\r\n\t\tkey: 'Model-FF7',\r\n\t\tpath: './assets/models/FF7.glb',\r\n\t\ttype: 'Model'\r\n\t},\r\n\t{\r\n\t\tkey: 'Texture-Cloud',\r\n\t\tpath: require('../assets/images/7.png'),\r\n\t\ttype: 'Texture'\r\n\t},\r\n\t{\r\n\t\tkey: 'Texture-Aerith',\r\n\t\tpath: require('../assets/images/5.png'),\r\n\t\ttype: 'Texture'\r\n\t},\r\n\t{\r\n\t\tkey: 'Font-Lato',\r\n\t\tpath: './assets/fonts/Lato.fnt',\r\n\t\ttype: 'Font'\r\n\t},\r\n\t{\r\n\t\tkey: 'Texture-Lato',\r\n\t\tpath: './assets/fonts/Lato.png',\r\n\t\ttype: 'Texture'\r\n\t},\r\n\t// Gallery Section\r\n\t{\r\n\t\tkey: 'Texture-Diamond1',\r\n\t\tpath: require('../assets/images/983837.png'),\r\n\t\ttype: 'Texture'\r\n\t},\r\n\t{\r\n\t\tkey: 'Texture-Diamond2',\r\n\t\tpath: require('../assets/images/developer.png'),\r\n\t\ttype: 'Texture'\r\n\t},\r\n\t{\r\n\t\tkey: 'Texture-Binguo1',\r\n\t\tpath: require('../assets/images/bingua4.png'),\r\n\t\ttype: 'Texture'\r\n\t},\r\n\t{\r\n\t\tkey: 'Texture-Binguo2',\r\n\t\tpath: require('../assets/images/Binguo1.jpg'),\r\n\t\ttype: 'Texture'\r\n\t},\r\n\t{\r\n\t\tkey: 'Texture-STM1',\r\n\t\tpath: require('../assets/images/4.png'),\r\n\t\ttype: 'Texture'\r\n\t},\r\n\t{\r\n\t\tkey: 'Texture-STM2',\r\n\t\tpath: require('../assets/images/1109789.png'),\r\n\t\ttype: 'Texture'\r\n\t},\r\n\t// Work Section\r\n\t{\r\n\t\tkey: 'EnvMap-Milkyway',\r\n\t\tpath: './assets/envMap/Milkyway/',\r\n\t\ttype: 'EnvMap',\r\n\t\topts: {\r\n\t\t\tneedBG: true\r\n\t\t}\r\n\t},\r\n\t{\r\n\t\tkey: 'Model-Chess',\r\n\t\tpath: './assets/models/Chess/scene.gltf',\r\n\t\ttype: 'Model'\r\n\t},\r\n];\r\n\r\nconst PCPreloadConfigList = [\r\n\t{\r\n\t\tkey: 'Texture-NGNL1',\r\n\t\tpath: require('../assets/images/9.jpg'),\r\n\t\ttype: 'Texture'\r\n\t},\r\n\t{\r\n\t\tkey: 'Texture-OnePunch1',\r\n\t\tpath: require('../assets/images/11.jpg'),\r\n\t\ttype: 'Texture'\r\n\t}\r\n].concat(commonAssetList);\r\n\r\nconst MobilePreloadConfigList = [\r\n\t{\r\n\t\tkey: 'Texture-NGNL1',\r\n\t\tpath: require('../assets/images/mobile/9.png'),\r\n\t\ttype: 'Texture'\r\n\t},\r\n\t{\r\n\t\tkey: 'Texture-OnePunch1',\r\n\t\tpath: require('../assets/images/mobile/11.png'),\r\n\t\ttype: 'Texture'\r\n\t}\r\n].concat(commonAssetList);\r\n\r\nexport { MobilePreloadConfigList, PCPreloadConfigList };\r\n","import * as THREE from 'three';\r\nimport ScenesViewer from './ScenesViewer';\r\nimport AssetLibrary from './loader/AssetLibrary';\r\nimport { PCPreloadConfigList, MobilePreloadConfigList } from 'CONST/assetsPreloadConfig';\r\nimport { getEleWidth, getEleHeight, debounce } from 'JS/Utils';\r\n// import Stats from 'LIB/threejs/libs/stats.module.js';\r\n\r\nexport default class MainScene {\r\n\tconstructor(container, isMobile, toggleConactCallback) {\r\n\t\tthis.container = container;\r\n\t\tthis.isMobile = isMobile;\r\n\t\tthis.preloadConfigList = isMobile ? MobilePreloadConfigList : PCPreloadConfigList;\r\n\t\tthis.width = getEleWidth(container);\r\n\t\tthis.height = getEleHeight(container);\r\n\t\tthis.clock = new THREE.Clock();\r\n\t\tthis.dpr = window.devicePixelRatio;\r\n\t\tthis.assetLibrary = new AssetLibrary(isMobile);\r\n\t\tthis.scene = new THREE.Scene();\r\n\t\t// Camera\r\n\t\tconst camera = (this.camera = new THREE.PerspectiveCamera(45, this.width / this.height, 0.1, 1000));\r\n\t\tcamera.position.set(0, 0, 10);\r\n\t\t// Renderer\r\n\t\tconst renderer = (this.renderer = new THREE.WebGL1Renderer({\r\n\t\t\tantialias: true\r\n\t\t}));\r\n\t\trenderer.domElement.id = 'canvasWebGL';\r\n\t\trenderer.setPixelRatio(this.dpr);\r\n\t\trenderer.setSize(this.width, this.height);\r\n\t\trenderer.gammaFactor = 2.2;\r\n\t\trenderer.toneMapping = THREE.ACESFilmicToneMapping;\r\n\t\trenderer.outputEncoding = THREE.sRGBEncoding;\r\n\t\trenderer.setClearColor(0x000000, 1);\r\n\t\trenderer.autoClear = false;\r\n\t\tcontainer.appendChild(renderer.domElement);\r\n\t\t// Callback\r\n\t\tthis.toggleConactCallback = toggleConactCallback;\r\n\t\t// Test\r\n\t\t// this.stats = new Stats();\r\n\t\t// document.body.appendChild(this.stats.dom);\r\n\t}\r\n\r\n\tloadAssets(onProgress, onComplete) {\r\n\t\tlet assetLibrary = this.assetLibrary;\r\n\t\tthis.preloadConfigList.forEach(config => {\r\n\t\t\tassetLibrary.addLoadQueue(config.key, config.path, config.type, config.parser, config.opts);\r\n\t\t});\r\n\t\tassetLibrary.onProgress.bind(onProgress);\r\n\t\tassetLibrary.onComplete.bind(onComplete);\r\n\t\tassetLibrary.load();\r\n\t}\r\n\r\n\tinitScene() {\r\n\t\tthis.scenesViewer = new ScenesViewer(this);\r\n\t\tthis.update();\r\n\t\tthis.initEvents();\r\n\t}\r\n\r\n\tentryAnime() {\r\n\t\tthis.scenesViewer.entryAnime();\r\n\t}\r\n\r\n\tinitEvents() {\r\n\t\twindow.addEventListener('resize', debounce(this.onWindowResize.bind(this), 100), false);\r\n\t\tthis.onWindowResize();\r\n\t}\r\n\r\n\tonWindowResize() {\r\n\t\tthis.width = getEleWidth(this.container);\r\n\t\tthis.height = getEleHeight(this.container);\r\n\t\tthis.dpr = window.devicePixelRatio;\r\n\t\tthis.renderer.setPixelRatio(this.dpr);\r\n\t\tthis.renderer.setSize(this.width, this.height);\r\n\t\tthis.scenesViewer.resize(this.width, this.height);\r\n\t}\r\n\r\n\tupdate() {\r\n\t\tthis.scenesViewer.update();\r\n\t\trequestAnimationFrame(this.update.bind(this));\r\n\t\t// Test\r\n\t\t// this.stats.update();\r\n\t}\r\n}\r\n","var render = function render(){var _vm=this,_c=_vm._self._c;return (!_vm.loadingAnimeFinished)?_c('section',{staticClass:\"loadingContainer\",class:_vm.isMobile ? 'mobile' : ''},[_c('div',{staticClass:\"loadingSVG\"},[_c('svg',{staticClass:\"svgOutline svgLoading\",attrs:{\"viewBox\":\"0 0 33 33\"}},[_c('polygon',{staticClass:\"svgTriangle\",attrs:{\"fill\":\"none\",\"stroke\":\"#fff\",\"stroke-width\":\"1\",\"points\":\"16,1 32,32 1,32\"}})]),_c('svg',{staticClass:\"svgInner svgLoading\",attrs:{\"viewBox\":\"0 0 33 33\"}},[_c('polygon',{staticClass:\"svgTriangle\",attrs:{\"fill\":\"none\",\"stroke\":\"#fff\",\"stroke-width\":\"1\",\"points\":\"16,1 32,32 1,32\"}})]),_c('svg',{staticClass:\"svgFill\",attrs:{\"viewBox\":\"0 0 33 33\"}},[_c('polygon',{staticClass:\"svgTriangle\",attrs:{\"fill\":\"none\",\"stroke\":\"#fff\",\"stroke-width\":\"1.1\",\"points\":\"16,1 32,32 1,32\"}})])]),_c('div',{staticClass:\"loadingText\"},[_c('h1',{staticClass:\"loadingPercent\"},[_vm._v(_vm._s(`${Math.floor(_vm.loadingPercentNum)}%`))]),_c('p',{staticClass:\"LG\"},[_vm._v(_vm._s(_vm.loadingText))])]),_c('s',[_vm._v(\"(1m8)\")]),_vm._v(\" cân nặng:\"),_c('s',[_vm._v(\"(56kg)\")]),_c('p')]):_vm._e()\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n\t<section :class=\"isMobile ? 'mobile' : ''\" class=\"loadingContainer\" v-if=\"!loadingAnimeFinished\">\r\n\t\t<div class=\"loadingSVG\">\r\n\t\t\t<svg class=\"svgOutline svgLoading\" viewBox=\"0 0 33 33\">\r\n\t\t\t\t<polygon class=\"svgTriangle\" fill=\"none\" stroke=\"#fff\" stroke-width=\"1\" points=\"16,1 32,32 1,32\" />\r\n\t\t\t</svg>\r\n\t\t\t<svg class=\"svgInner svgLoading\" viewBox=\"0 0 33 33\">\r\n\t\t\t\t<polygon class=\"svgTriangle\" fill=\"none\" stroke=\"#fff\" stroke-width=\"1\" points=\"16,1 32,32 1,32\" />\r\n\t\t\t</svg>\r\n\t\t\t<svg class=\"svgFill\" viewBox=\"0 0 33 33\">\r\n\t\t\t\t<polygon class=\"svgTriangle\" fill=\"none\" stroke=\"#fff\" stroke-width=\"1.1\" points=\"16,1 32,32 1,32\" />\r\n\t\t\t</svg>\r\n\t\t</div>\r\n\t\t<div class=\"loadingText\">\r\n\t\t\t<h1 class=\"loadingPercent\">{{ `${Math.floor(loadingPercentNum)}%` }}</h1>\r\n\t\t\t<p class=\"LG\">{{ loadingText }}</p>\r\n\t\t</div>\r\n\t\t<p class=\"Tips\" Chiều cao:<s>(1m8)</s> cân nặng:<s>(56kg)</s></p>\r\n\t</section>\r\n</template>\r\n\r\n<script>\r\nimport { gsap } from 'gsap';\r\nexport default {\r\n\tname: 'PreLoader',\r\n\tprops: ['isLoaded', 'loadingPercent', 'isMobile'],\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tloadingPercentNum: 0,\r\n\t\t\tloadingText: 'LOADING...',\r\n\t\t\tloadingAnimeFinished: false\r\n\t\t};\r\n\t},\r\n\tmounted() {},\r\n\twatch: {\r\n\t\tloadingPercent(val, oldVal) {\r\n\t\t\tval *= 100;\r\n\t\t\tgsap.to(this, { loadingPercentNum: val, duration: 1 });\r\n\t\t},\r\n\t\tisLoaded(val, oldVal) {\r\n\t\t\tif (val) {\r\n\t\t\t\t// 1.SVG\r\n\t\t\t\tgsap.to('.svgLoading', { opacity: 0, duration: 0.5 });\r\n\t\t\t\tgsap.to('.svgFill', {\r\n\t\t\t\t\topacity: 1,\r\n\t\t\t\t\tduration: 1,\r\n\t\t\t\t\tonComplete: () => {\r\n\t\t\t\t\t\t// LG Text\r\n\t\t\t\t\t\tthis.loadingText = 'TRẦN LÊ QUYÊN - gumq4';\r\n\t\t\t\t\t\tgsap.to('.loadingContainer', {\r\n\t\t\t\t\t\t\topacity: 0,\r\n\t\t\t\t\t\t\tduration: 1,\r\n\t\t\t\t\t\t\tdelay: 0.4,\r\n\t\t\t\t\t\t\tonComplete: () => {\r\n\t\t\t\t\t\t\t\tthis.loadingAnimeFinished = true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n</script>\r\n\r\n<style lang=\"less\">\r\n// Loading\r\n.loadingContainer {\r\n\tposition: absolute;\r\n\theight: 100%;\r\n\twidth: 100vw;\r\n\tbackground: #000000;\r\n\tcolor: #ffffff;\r\n\ttext-align: center;\r\n\t.loadingSVG {\r\n\t\tposition: absolute;\r\n\t\ttop: 45%;\r\n\t\tleft: 50%;\r\n\t\ttransform: translate(-50%, -50%);\r\n\t\twidth: 10vw;\r\n\t\tsvg {\r\n\t\t\tbottom: 0;\r\n\t\t\tright: 0;\r\n\t\t\tposition: absolute;\r\n\t\t\twidth: 100%;\r\n\t\t\ttop: 50%;\r\n\t\t\tleft: 50%;\r\n\t\t\ttransform: translate(-50%, -50%);\r\n\t\t\t&.svgInner .svgTriangle {\r\n\t\t\t\tstroke-dasharray: 17;\r\n\t\t\t\tanimation: dash 3.5s cubic-bezier(0.35, 0.04, 0.63, 0.95) infinite;\r\n\t\t\t}\r\n\t\t\t&.svgOutline .svgTriangle {\r\n\t\t\t\tstroke: rgba(255, 255, 255, 0.2);\r\n\t\t\t\tfill: none;\r\n\t\t\t\tstroke-width: 1.4px;\r\n\t\t\t}\r\n\t\t\t&.svgFill {\r\n\t\t\t\topacity: 0;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t.loadingText {\r\n\t\tposition: absolute;\r\n\t\tbottom: 15%;\r\n\t\tleft: 50%;\r\n\t\ttransform: translate(-50%, 0);\r\n\t\twidth: 233px;\r\n\t\ttext-align: center;\r\n\t\t.LG {\r\n\t\t\tmargin-top: 50px;\r\n\t\t\tposition: relative;\r\n\t\t\tfont-size: 20px;\r\n\t\t\tletter-spacing: 3px;\r\n\t\t\topacity: 0;\r\n\t\t\ttext-transform: uppercase;\r\n\t\t\tanimation: fadeIn 2.5s forwards;\r\n\r\n\t\t\t&::before,\r\n\t\t\t&::after {\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\tcontent: '';\r\n\t\t\t\ttop: 0;\r\n\t\t\t\tbottom: 0;\r\n\t\t\t\twidth: 2px;\r\n\t\t\t\topacity: 0;\r\n\t\t\t\theight: 100%;\r\n\t\t\t\tbackground: white;\r\n\t\t\t}\r\n\r\n\t\t\t&::before {\r\n\t\t\t\tleft: 50%;\r\n\t\t\t\tanimation: slideLeft 1s forwards;\r\n\t\t\t}\r\n\r\n\t\t\t&::after {\r\n\t\t\t\tright: 50%;\r\n\t\t\t\tanimation: slideRight 1s forwards;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t.Tips {\r\n\t\tfont-size: 20px;\r\n\t\tmargin-top: 50px;\r\n\t\topacity: 0;\r\n\t\tbottom: 5%;\r\n\t\tposition: absolute;\r\n\t\tleft: 50%;\r\n\t\ttransform: translate(-50%, 0);\r\n\t\tanimation: fadeInTips 1s forwards;\r\n\t}\r\n}\r\n\r\n.loadingContainer.mobile {\r\n\t.loadingSVG {\r\n\t\twidth: 30vw;\r\n\t}\r\n}\r\n\r\n@keyframes fadeIn {\r\n\tto {\r\n\t\topacity: 1;\r\n\t}\r\n}\r\n\r\n@keyframes fadeInTips {\r\n\tto {\r\n\t\topacity: 0.6;\r\n\t}\r\n}\r\n\r\n@keyframes slideLeft {\r\n\tto {\r\n\t\tleft: -2%;\r\n\t\topacity: 1;\r\n\t}\r\n}\r\n\r\n@keyframes slideRight {\r\n\tto {\r\n\t\tright: -2%;\r\n\t\topacity: 1;\r\n\t}\r\n}\r\n\r\n@keyframes dash {\r\n\tto {\r\n\t\tstroke-dashoffset: 136;\r\n\t}\r\n}\r\n</style>\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PreLoader.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./PreLoader.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./PreLoader.vue?vue&type=template&id=5cffb1cb&\"\nimport script from \"./PreLoader.vue?vue&type=script&lang=js&\"\nexport * from \"./PreLoader.vue?vue&type=script&lang=js&\"\nimport style0 from \"./PreLoader.vue?vue&type=style&index=0&id=5cffb1cb&prod&lang=less&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function render(){var _vm=this,_c=_vm._self._c;return (_vm.isOpenConactPanel)?_c('section',{staticClass:\"aboutSection\"},[_vm._m(0),_vm._m(1),_vm._m(2)]):_vm._e()\n}\nvar staticRenderFns = [function (){var _vm=this,_c=_vm._self._c;return _c('div',[_c('div',{staticClass:\"sentence revealAnimation animate\"},[_c('h1',[_vm._v(\"『 Thông tin liên lạc của Trần Lê Quyền』\")])])])\n},function (){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"textContainer animate\"},[_c('h2',[_vm._v(\"Contact\")]),_c('div',[_c('a',{attrs:{\"href\":\"https://www.facebook.com/Gumq4/\",\"target\":\"_blank\"}},[_c('span',[_vm._v(\"Facebook\")])]),_c('a',{attrs:{\"href\":\"mailto:tranquyen14042000@gmail.com/\",\"target\":\"_blank\"}},[_c('span',[_vm._v(\"Email\")])]),_c('a',{attrs:{\"href\":\"https://www.instagram.com/gumq4_/\",\"target\":\"_blank\"}},[_c('span',[_vm._v(\"Instagram\")])])])])\n},function (){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"textContainer animate\"},[_c('h2',[_vm._v(\"Other\")]),_c('div',[_c('a',{attrs:{\"href\":\"https://github.com/gumq\",\"target\":\"_blank\"}},[_c('span',[_vm._v(\"github\")])]),_c('a',{attrs:{\"href\":\"https://zalo.me/0389150134\",\"target\":\"_blank\"}},[_c('span',[_vm._v(\"Zalo\")])])])])\n}]\n\nexport { render, staticRenderFns }","<template>\r\n\t<section class=\"aboutSection\" v-if=\"isOpenConactPanel\">\r\n\t\t<div>\r\n\t\t\t<div class=\"sentence revealAnimation animate\">\r\n\t\t\t\t<h1>『 Thông tin liên lạc của Trần Lê Quyền』</h1>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div class=\"textContainer animate\">\r\n\t\t\t<h2>Contact</h2>\r\n\t\t\t<div>\r\n\t\t\t\r\n\t\t\t\t<a href=\"https://www.facebook.com/Gumq4/\" target=\"_blank\">\r\n\t\t\t\t\t<span>Facebook</span>\r\n\t\t\t\t</a>\r\n\t\t\t\t<a href=\"mailto:tranquyen14042000@gmail.com/\" target=\"_blank\">\r\n\t\t\t\t\t<span>Email</span>\r\n\t\t\t\t</a>\r\n\t\t\t\t<a href=\"https://www.instagram.com/gumq4_/\" target=\"_blank\">\r\n\t\t\t\t\t<span>Instagram</span>\r\n\t\t\t\t</a>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div class=\"textContainer animate\">\r\n\t\t\t<h2>Other</h2>\r\n\t\t\t<div>\r\n\t\t\t\t\r\n\t\t\t\t<a href=\"https://github.com/gumq\" target=\"_blank\">\r\n\t\t\t\t\t<span>github</span>\r\n\t\t\t\t</a>\r\n\t\t\t\t<a href=\"https://zalo.me/0389150134\" target=\"_blank\">\r\n\t\t\t\t\t<span>Zalo</span>\r\n\t\t\t\t</a>\r\n\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</section>\r\n</template>\r\n\r\n<script>\r\nimport { gsap } from 'gsap';\r\nexport default {\r\n\tname: 'ConactPanel',\r\n\tprops: ['isOpenConactPanel', 'isMobile']\r\n};\r\n</script>\r\n\r\n<style lang=\"less\">\r\n.aboutSection {\r\n\tcolor: white;\r\n\tposition: absolute;\r\n\ttop: 10%;\r\n\tleft: 10%;\r\n\twidth: 80%;\r\n\theight: 80%;\r\n\ttext-align: center;\r\n\tdisplay: flex;\r\n\tjustify-content: center;\r\n\tflex-direction: column;\r\n\t.sentence {\r\n\t\tdisplay: inline-block;\r\n\t}\r\n}\r\n\r\n.textContainer {\r\n\topacity: 0;\r\n\th2 {\r\n\t\tdisplay: inline-block;\r\n\t\tborder-bottom: 1px solid rgb(224, 224, 224);\r\n\t}\r\n\tspan {\r\n\t\tcolor: #ffffff;\r\n\t\t// padding: 0px 2vw;\r\n\t\tpointer-events: auto;\r\n\t\tmin-width: 150px;\r\n\t\tdisplay: inline-block;\r\n\t\t&:hover {\r\n\t\t\tcursor: pointer;\r\n\t\t\tcolor: #f0f8ff;\r\n\t\t}\r\n\t}\r\n\t&.animate {\r\n\t\tanimation: textEntry 1s forwards;\r\n\t}\r\n}\r\n\r\n@keyframes textEntry {\r\n\t0% {\r\n\t\topacity: 0;\r\n\t}\r\n\t100% {\r\n\t\topacity: 1;\r\n\t}\r\n}\r\n\r\n.revealAnimation {\r\n\tposition: relative;\r\n\th1 {\r\n\t\tmargin: 0;\r\n\t\topacity: 0;\r\n\t}\r\n\t&.animate {\r\n\t\th1 {\r\n\t\t\tanimation: textFadein 0.1s 0.5s forwards;\r\n\t\t}\r\n\t\t&:before {\r\n\t\t\tcontent: '';\r\n\t\t\tposition: absolute;\r\n\t\t\ttop: 0;\r\n\t\t\tright: 0;\r\n\t\t\theight: 100%;\r\n\t\t\tz-index: 10;\r\n\t\t}\r\n\t\t&:before {\r\n\t\t\tbackground-color: white;\r\n\t\t\tanimation: revealAnimation 1s ease;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n@keyframes revealAnimation {\r\n\t0% {\r\n\t\twidth: 0;\r\n\t\tleft: 0;\r\n\t}\r\n\t65% {\r\n\t\twidth: 100%;\r\n\t\tleft: 0;\r\n\t}\r\n\t100% {\r\n\t\twidth: 0;\r\n\t\tleft: 100%;\r\n\t}\r\n}\r\n\r\n@keyframes textFadein {\r\n\t0% {\r\n\t\topacity: 0;\r\n\t}\r\n\t100% {\r\n\t\topacity: 1;\r\n\t}\r\n}\r\n</style>\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ConactPanel.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ConactPanel.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./ConactPanel.vue?vue&type=template&id=743f63ba&\"\nimport script from \"./ConactPanel.vue?vue&type=script&lang=js&\"\nexport * from \"./ConactPanel.vue?vue&type=script&lang=js&\"\nimport style0 from \"./ConactPanel.vue?vue&type=style&index=0&id=743f63ba&prod&lang=less&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","<template>\r\n\t<div class=\"wrapper\">\r\n\t\t<div id=\"canvasContainer\"></div>\r\n\t\t<div class=\"uiContainer\">\r\n\t\t\t<ConactPanel :isMobile=\"isMobile\" :isOpenConactPanel=\"isOpenConactPanel\"></ConactPanel>\r\n\t\t</div>\r\n\t\t<PreLoader :isMobile='isMobile' :isLoaded='isLoaded' :loadingPercent='loadingPercent'></PreLoader>\r\n\t</div>\r\n</template>\r\n\r\n<script>\r\nimport { isMobile } from 'JS/Utils';\r\nimport MainScene from 'WEBGL/MainScene';\r\nimport PreLoader from 'COMPONENT/PreLoader';\r\nimport ConactPanel from 'COMPONENT/ConactPanel';\r\n\r\nexport default {\r\n\tname: 'MainScene',\r\n\tcomponents: {\r\n\t\tPreLoader,\r\n\t\tConactPanel\r\n\t},\r\n\tdata() {\r\n\t\treturn {\r\n\t\t\tisMobile: isMobile(),\r\n\t\t\tisLoaded: false,\r\n\t\t\tloadingPercent: 0,\r\n\t\t\tisOpenConactPanel: false\r\n\t\t};\r\n\t},\r\n\tmounted() {\r\n\t\tlet containerEle = document.querySelector('#canvasContainer');\r\n\t\tthis.mainScene = new MainScene(containerEle, this.isMobile, this.toggleConactPanel.bind(this));\r\n\t\tthis.mainScene.loadAssets(\r\n\t\t\tpersent => {\r\n\t\t\t\tthis.updateProgress(persent);\r\n\t\t\t},\r\n\t\t\t() => {\r\n\t\t\t\tthis.loadCompelete();\r\n\t\t\t}\r\n\t\t);\r\n\t},\r\n\tmethods: {\r\n\t\tupdateProgress(persent) {\r\n\t\t\tthis.loadingPercent = persent;\r\n\t\t},\r\n\t\tloadCompelete() {\r\n\t\t\tthis.mainScene.initScene();\r\n\t\t\tconsole.log('Loaded!!');\r\n\t\t\tthis.isLoaded = true;\r\n\t\t\tthis.mainScene.entryAnime();\r\n\t\t},\r\n\t\ttoggleConactPanel(status) {\r\n\t\t\tthis.isOpenConactPanel = status;\r\n\t\t}\r\n\t}\r\n};\r\n</script>\r\n\r\n<style lang=\"less\">\r\nhtml,\r\nbody {\r\n\tmargin: 0;\r\n\tpadding: 0;\r\n    position: fixed;\r\n\tbox-sizing: border-box;\r\n\tbackground: #000;\r\n\tuser-select: none;\r\n\toverflow: hidden;\r\n}\r\n\r\na {\r\n\ttext-decoration: none;\r\n}\r\n\r\nbody[cursor='pointer'] {\r\n\tcursor: pointer;\r\n}\r\n\r\n.wrapper {\r\n\twidth: 100vw;\r\n\theight: 100vh;\r\n\tposition: relative;\r\n\toverflow: hidden;\r\n}\r\n\r\n// Hide gui default\r\n.dg.main {\r\n\tdisplay: none;\r\n\topacity: 0;\r\n}\r\n\r\n#canvasContainer {\r\n\ttop: 0;\r\n\tleft: 0;\r\n\twidth: 100%;\r\n\theight: 100%;\r\n\tposition: fixed;\r\n\toverflow: hidden;\r\n}\r\n\r\n.uiContainer {\r\n\tposition: absolute;\r\n\ttop: 0;\r\n\tleft: 0;\r\n\twidth: 100%;\r\n\theight: 100%;\r\n\tpointer-events: none;\r\n\toverflow: hidden;\r\n}\r\n</style>\r\n","import mod from \"-!../node_modules/cache-loader/dist/cjs.js??ref--13-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/cache-loader/dist/cjs.js??ref--1-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../node_modules/cache-loader/dist/cjs.js??ref--13-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/cache-loader/dist/cjs.js??ref--1-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=c646c88c&\"\nimport script from \"./index.vue?vue&type=script&lang=js&\"\nexport * from \"./index.vue?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=c646c88c&prod&lang=less&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","import Vue from 'vue';\r\nimport App from './index.vue';\r\n\r\nnew Vue({\r\n\trender: h => h(App)\r\n}).$mount('#container');\r\n","module.exports = __webpack_public_path__ + \"img/7.97bb6ecb.png\";","module.exports = __webpack_public_path__ + \"img/9.bde78526.jpg\";","module.exports = __webpack_public_path__ + \"img/983837.5bbc11d7.png\";","module.exports = __webpack_public_path__ + \"img/11.4799a5b6.jpg\";","module.exports = __webpack_public_path__ + \"img/1109789.2ce6b62f.png\";"],"sourceRoot":""}